(self.webpackChunkperseus=self.webpackChunkperseus||[]).push([[3622],{"./vendor/jsdiff/jsdiff.js":module=>{var JsDiff=function(){function clonePath(path){return{newPos:path.newPos,components:path.components.slice(0)}}function removeEmpty(array){for(var ret=[],i=0;i<array.length;i++)array[i]&&ret.push(array[i]);return ret}var Diff=function(ignoreWhitespace){this.ignoreWhitespace=ignoreWhitespace};Diff.prototype={diff:function(oldString,newString){if(newString===oldString)return[{value:newString}];if(!newString)return[{value:oldString,removed:!0}];if(!oldString)return[{value:newString,added:!0}];newString=this.tokenize(newString),oldString=this.tokenize(oldString);var newLen=newString.length,oldLen=oldString.length,maxEditLength=newLen+oldLen,bestPath=[{newPos:-1,components:[]}],oldPos=this.extractCommon(bestPath[0],newString,oldString,0);if(bestPath[0].newPos+1>=newLen&&oldPos+1>=oldLen)return bestPath[0].components;for(var editLength=1;editLength<=maxEditLength;editLength++)for(var diagonalPath=-1*editLength;diagonalPath<=editLength;diagonalPath+=2){var basePath,addPath=bestPath[diagonalPath-1],removePath=bestPath[diagonalPath+1];oldPos=(removePath?removePath.newPos:0)-diagonalPath,addPath&&(bestPath[diagonalPath-1]=void 0);var canAdd=addPath&&addPath.newPos+1<newLen,canRemove=removePath&&0<=oldPos&&oldPos<oldLen;if(canAdd||canRemove){!canAdd||canRemove&&addPath.newPos<removePath.newPos?(basePath=clonePath(removePath),this.pushComponent(basePath.components,oldString[oldPos],void 0,!0)):((basePath=clonePath(addPath)).newPos++,this.pushComponent(basePath.components,newString[basePath.newPos],!0,void 0));oldPos=this.extractCommon(basePath,newString,oldString,diagonalPath);if(basePath.newPos+1>=newLen&&oldPos+1>=oldLen)return basePath.components;bestPath[diagonalPath]=basePath}else bestPath[diagonalPath]=void 0}},pushComponent:function(components,value,added,removed){var last=components[components.length-1];last&&last.added===added&&last.removed===removed?components[components.length-1]={value:this.join(last.value,value),added,removed}:components.push({value,added,removed})},extractCommon:function(basePath,newString,oldString,diagonalPath){for(var newLen=newString.length,oldLen=oldString.length,newPos=basePath.newPos,oldPos=newPos-diagonalPath;newPos+1<newLen&&oldPos+1<oldLen&&this.equals(newString[newPos+1],oldString[oldPos+1]);)newPos++,oldPos++,this.pushComponent(basePath.components,newString[newPos],void 0,void 0);return basePath.newPos=newPos,oldPos},equals:function(left,right){var reWhitespace=/\S/;return!(!this.ignoreWhitespace||reWhitespace.test(left)||reWhitespace.test(right))||left===right},join:function(left,right){return left+right},tokenize:function(value){return value}};var CharDiff=new Diff,WordDiff=new Diff(!0),WordWithSpaceDiff=new Diff;WordDiff.tokenize=WordWithSpaceDiff.tokenize=function(value){return removeEmpty(value.split(/(\s+|\b)/))};var CssDiff=new Diff(!0);CssDiff.tokenize=function(value){return removeEmpty(value.split(/([{}:;,]|\s+)/))};var LineDiff=new Diff;return LineDiff.tokenize=function(value){for(var retLines=[],lines=value.split(/^/m),i=0;i<lines.length;i++){var line=lines[i],lastLine=lines[i-1];"\n"==line&&lastLine&&"\r"===lastLine[lastLine.length-1]?retLines[retLines.length-1]+="\n":line&&retLines.push(line)}return retLines},{Diff,diffChars:function(oldStr,newStr){return CharDiff.diff(oldStr,newStr)},diffWords:function(oldStr,newStr){return WordDiff.diff(oldStr,newStr)},diffWordsWithSpace:function(oldStr,newStr){return WordWithSpaceDiff.diff(oldStr,newStr)},diffLines:function(oldStr,newStr){return LineDiff.diff(oldStr,newStr)},diffCss:function(oldStr,newStr){return CssDiff.diff(oldStr,newStr)},createPatch:function(fileName,oldStr,newStr,oldHeader,newHeader){var ret=[];ret.push("Index: "+fileName),ret.push("==================================================================="),ret.push("--- "+fileName+(void 0===oldHeader?"":"\t"+oldHeader)),ret.push("+++ "+fileName+(void 0===newHeader?"":"\t"+newHeader));var diff=LineDiff.diff(oldStr,newStr);function contextLines(lines){return lines.map((function(entry){return" "+entry}))}function eofNL(curRange,i,current){var last=diff[diff.length-2],isLast=i===diff.length-2,isLastOfType=i===diff.length-3&&(current.added!==last.added||current.removed!==last.removed);/\n$/.test(current.value)||!isLast&&!isLastOfType||curRange.push("\\ No newline at end of file")}diff[diff.length-1].value||diff.pop(),diff.push({value:"",lines:[]});for(var oldRangeStart=0,newRangeStart=0,curRange=[],oldLine=1,newLine=1,i=0;i<diff.length;i++){var current=diff[i],lines=current.lines||current.value.replace(/\n$/,"").split("\n");if(current.lines=lines,current.added||current.removed){if(!oldRangeStart){var prev=diff[i-1];oldRangeStart=oldLine,newRangeStart=newLine,prev&&(oldRangeStart-=(curRange=contextLines(prev.lines.slice(-4))).length,newRangeStart-=curRange.length)}curRange.push.apply(curRange,lines.map((function(entry){return(current.added?"+":"-")+entry}))),eofNL(curRange,i,current),current.added?newLine+=lines.length:oldLine+=lines.length}else{if(oldRangeStart)if(lines.length<=8&&i<diff.length-2)curRange.push.apply(curRange,contextLines(lines));else{var contextSize=Math.min(lines.length,4);ret.push("@@ -"+oldRangeStart+","+(oldLine-oldRangeStart+contextSize)+" +"+newRangeStart+","+(newLine-newRangeStart+contextSize)+" @@"),ret.push.apply(ret,curRange),ret.push.apply(ret,contextLines(lines.slice(0,contextSize))),lines.length<=4&&eofNL(ret,i,current),oldRangeStart=0,newRangeStart=0,curRange=[]}oldLine+=lines.length,newLine+=lines.length}}return ret.join("\n")+"\n"},applyPatch:function(oldStr,uniDiff){for(var diffstr=uniDiff.split("\n"),diff=[],remEOFNL=!1,addEOFNL=!1,i="I"===diffstr[0][0]?4:0;i<diffstr.length;i++)if("@"===diffstr[i][0]){var meh=diffstr[i].split(/@@ -(\d+),(\d+) \+(\d+),(\d+) @@/);diff.unshift({start:meh[3],oldlength:meh[2],oldlines:[],newlength:meh[4],newlines:[]})}else"+"===diffstr[i][0]?diff[0].newlines.push(diffstr[i].substr(1)):"-"===diffstr[i][0]?diff[0].oldlines.push(diffstr[i].substr(1)):" "===diffstr[i][0]?(diff[0].newlines.push(diffstr[i].substr(1)),diff[0].oldlines.push(diffstr[i].substr(1))):"\\"===diffstr[i][0]&&("+"===diffstr[i-1][0]?remEOFNL=!0:"-"===diffstr[i-1][0]&&(addEOFNL=!0));var str=oldStr.split("\n");for(i=diff.length-1;i>=0;i--){for(var d=diff[i],j=0;j<d.oldlength;j++)if(str[d.start-1+j]!==d.oldlines[j])return!1;Array.prototype.splice.apply(str,[d.start-1,+d.oldlength].concat(d.newlines))}if(remEOFNL)for(;!str[str.length-1];)str.pop();else addEOFNL&&str.push("");return str.join("\n")},convertChangesToXML:function(changes){for(var s,ret=[],i=0;i<changes.length;i++){var change=changes[i];change.added?ret.push("<ins>"):change.removed&&ret.push("<del>"),ret.push((s=change.value,void 0,s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"))),change.added?ret.push("</ins>"):change.removed&&ret.push("</del>")}return ret.join("")},convertChangesToDMP:function(changes){for(var change,ret=[],i=0;i<changes.length;i++)change=changes[i],ret.push([change.added?1:change.removed?-1:0,change.value]);return ret}}}();module.exports=JsDiff},"./packages/perseus-editor/src/diffs/text-diff.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>text_diff});var src=__webpack_require__("./packages/perseus/src/index.ts"),classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),jsdiff=__webpack_require__("./vendor/jsdiff/jsdiff.js"),jsdiff_default=__webpack_require__.n(jsdiff),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),react=__webpack_require__("./node_modules/react/index.js"),index_all=__webpack_require__("./node_modules/underscore/modules/index-all.js");const split_diff=function(diffEntries){const lines=[];let currentLine=[];return index_all.ZP.each(diffEntries,(entry=>{const values=entry.value.split("\n");index_all.ZP.each(values,((value,i)=>{i>0&&(lines.push(currentLine),currentLine=[]);const newEntry=index_all.ZP.extend({},entry,{value});currentLine.push(newEntry)}))})),currentLine.length&&lines.push(currentLine),lines},statusFor=function(chunk){return chunk.added?"added":chunk.removed?"removed":"unchanged"},splitUpChunk=chunk=>index_all.ZP.map(chunk.value,(value=>({value,status:statusFor(chunk)}))),ArrayDiff=new(jsdiff_default().Diff);ArrayDiff.tokenize=array=>index_all.ZP.map(array,(elem=>[elem])),ArrayDiff.join=(a,b)=>a.concat(b),ArrayDiff.equals=index_all.ZP.isEqual;const flattenChunks=chunks=>{return lst=chunks,fn=splitUpChunk,index_all.ZP.flatten(index_all.ZP.map(lst,fn),!0);var lst,fn},string_array_diff=function(a,b){const diffResult=ArrayDiff.diff(a,b),flattened=flattenChunks(diffResult);return{before:index_all.ZP.filter(flattened,(entry=>"added"!==entry.status)),after:index_all.ZP.filter(flattened,(entry=>"removed"!==entry.status))}},{SvgImage}=src.components,IMAGE_REGEX=/http.*?\.png|web\+graphie[^)]*/g,imagesInString=function(str){return str.match(IMAGE_REGEX)||[]},classFor=function(entry,ifAdded,ifRemoved){return entry.added?ifAdded:entry.removed?ifRemoved:""};class ImageDiffSide extends react.Component{static propTypes={images:prop_types_default().arrayOf(prop_types_default().shape({})).isRequired};render(){return react.createElement("div",null,index_all.ZP.map(this.props.images,((entry,index)=>{const className=classnames_default()({image:!0,"image-unchanged":"unchanged"===entry.status,"image-added":"added"===entry.status,"image-removed":"removed"===entry.status});return react.createElement("div",{key:index},react.createElement("div",{className},react.createElement(SvgImage,{src:entry.value,title:entry.value})))})))}}class TextDiff extends react.Component{static propTypes={after:prop_types_default().string,before:prop_types_default().string,title:prop_types_default().string.isRequired};static defaultProps={after:"",before:""};state={collapsed:this.props.before===this.props.after};UNSAFE_componentWillReceiveProps(nextProps){this.setState({collapsed:nextProps.before===nextProps.after})}handleExpand=()=>{this.setState({collapsed:!1})};render(){const diffed=jsdiff_default().diffWords(this.props.before,this.props.after),lines=split_diff(diffed),beforeImages=imagesInString(this.props.before),afterImages=imagesInString(this.props.after),images=string_array_diff(beforeImages,afterImages),renderedLines=index_all.ZP.map(lines,(line=>{const contents={};return contents.before=(0,index_all.ZP)(line).map((function(entry,i){return react.createElement("span",{key:i,className:classFor(entry,"not-present","removed dark")},entry.value)})),contents.after=(0,index_all.ZP)(line).map((function(entry,i){return react.createElement("span",{key:i,className:classFor(entry,"added dark","not-present")},entry.value)})),contents})),className=classnames_default()({"diff-row":!0,collapsed:this.state.collapsed});return react.createElement("div",null,react.createElement("div",{className:"diff-header"},this.props.title),react.createElement("div",{className:"diff-header"},this.props.title),react.createElement("div",{className:"diff-body ui-helper-clearfix"},index_all.ZP.map(["before","after"],((side,index)=>react.createElement("div",{className:"diff-row "+side,key:index},!this.state.collapsed&&index_all.ZP.map(renderedLines,((line,lineNum)=>{const changed=line[side].length>1,lineClass=classnames_default()({"diff-line":!0,added:"after"===side&&changed,removed:"before"===side&&changed});return react.createElement("div",{className:lineClass,key:lineNum},line[side])})),!this.state.collapsed&&react.createElement(ImageDiffSide,{images:images[side]}))))),index_all.ZP.map(["before","after"],((side,index)=>react.createElement("div",{className:className+" "+side,key:index,onClick:this.handleExpand},this.state.collapsed&&react.createElement("span",null,react.createElement("span",{className:"expand-button"}," ","[ show unmodified ]"," "))))))}}const text_diff=TextDiff;try{TextDiff.displayName="TextDiff",TextDiff.__docgenInfo={description:"",displayName:"TextDiff",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/perseus-editor/src/diffs/text-diff.tsx#TextDiff"]={docgenInfo:TextDiff.__docgenInfo,name:"TextDiff",path:"packages/perseus-editor/src/diffs/text-diff.tsx#TextDiff"})}catch(__react_docgen_typescript_loader_error){}}}]);