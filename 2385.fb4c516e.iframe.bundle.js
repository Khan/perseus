"use strict";(self.webpackChunkperseus=self.webpackChunkperseus||[]).push([[2385],{"./packages/perseus-editor/src/components/section-control-button.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>SectionControlButton});var _khanacademy_perseus__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/perseus/src/index.ts"),_khanacademy_wonder_blocks_clickable__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@khanacademy/wonder-blocks-clickable/dist/es/index.js"),_khanacademy_wonder_blocks_color__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@khanacademy/wonder-blocks-color/dist/es/index.js"),aphrodite__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/aphrodite/lib/index.js"),react__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/react/index.js");const{InlineIcon}=_khanacademy_perseus__WEBPACK_IMPORTED_MODULE_0__.components;class SectionControlButton extends react__WEBPACK_IMPORTED_MODULE_4__.Component{render(){const{icon,onClick,title}=this.props;return react__WEBPACK_IMPORTED_MODULE_4__.createElement(_khanacademy_wonder_blocks_clickable__WEBPACK_IMPORTED_MODULE_1__.ZP,{className:"section-control-button simple-button simple-button--small ",onClick:e=>{e.preventDefault(),onClick()},role:"button",hideDefaultFocusRing:!0,"aria-label":title,style:styles.button},(_ref=>{let{hovered,focused,pressed}=_ref;return react__WEBPACK_IMPORTED_MODULE_4__.createElement(InlineIcon,icon)}))}}const styles=aphrodite__WEBPACK_IMPORTED_MODULE_3__.StyleSheet.create({button:{backgroundColor:_khanacademy_wonder_blocks_color__WEBPACK_IMPORTED_MODULE_2__.default.gold,margin:2,paddingRight:10,paddingLeft:10,paddingBottom:2}});try{sectioncontrolbutton.displayName="sectioncontrolbutton",sectioncontrolbutton.__docgenInfo={description:"",displayName:"sectioncontrolbutton",props:{icon:{defaultValue:null,description:"",name:"icon",required:!0,type:{name:"InlineIconProps"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"() => unknown"}},title:{defaultValue:null,description:"",name:"title",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/perseus-editor/src/components/section-control-button.tsx#sectioncontrolbutton"]={docgenInfo:sectioncontrolbutton.__docgenInfo,name:"sectioncontrolbutton",path:"packages/perseus-editor/src/components/section-control-button.tsx#sectioncontrolbutton"})}catch(__react_docgen_typescript_loader_error){}},"./packages/perseus-editor/src/editor.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>editor});var src=__webpack_require__("./packages/perseus/src/index.ts"),jquery=__webpack_require__("./node_modules/jquery/dist/jquery.js"),jquery_default=__webpack_require__.n(jquery),katex=__webpack_require__("./node_modules/katex/dist/katex.js"),katex_default=__webpack_require__.n(katex);const chemParse=function(tokens,stateMachine){let str="",expectedLoc=tokens[tokens.length-1].loc.start;for(let i=tokens.length-1;i>=0;i--)tokens[i].loc.start>expectedLoc&&(str+=" ",expectedLoc=tokens[i].loc.start),str+=tokens[i].text,expectedLoc+=tokens[i].text.length;return texify.go(mhchemParser.go(str,stateMachine))};var mhchemParser={go:function(input,stateMachine){if(!input)return[];void 0===stateMachine&&(stateMachine="ce");let state="0";const buffer={};let lastInput;buffer.parenthesisLevel=0,input=(input=(input=input.replace(/\n/g," ")).replace(/[\u2212\u2013\u2014\u2010]/g,"-")).replace(/[\u2026]/g,"...");let watchdog=10;const output=[];for(;;){lastInput!==input?(watchdog=10,lastInput=input):watchdog--;const machine=mhchemParser.stateMachines[stateMachine],t=machine.transitions[state]||machine.transitions["*"];iterateTransitions:for(let i=0;i<t.length;i++){const matches=mhchemParser.patterns.match_(t[i].pattern,input);if(matches){const task=t[i].task;for(let iA=0;iA<task.action_.length;iA++){var o;if(machine.actions[task.action_[iA].type_])o=machine.actions[task.action_[iA].type_](buffer,matches.match_,task.action_[iA].option);else{if(!mhchemParser.actions[task.action_[iA].type_])throw["MhchemBugA","mhchem bug A. Please report. ("+task.action_[iA].type_+")"];o=mhchemParser.actions[task.action_[iA].type_](buffer,matches.match_,task.action_[iA].option)}mhchemParser.concatArray(output,o)}if(state=task.nextState||state,!(input.length>0))return output;if(task.revisit||(input=matches.remainder),!task.toContinue)break iterateTransitions}}if(watchdog<=0)throw["MhchemBugU","mhchem bug U. Please report."]}},concatArray:function(a,b){if(b)if(Array.isArray(b))for(let iB=0;iB<b.length;iB++)a.push(b[iB]);else a.push(b)},patterns:{patterns:{empty:/^$/,else:/^./,else2:/^./,space:/^\s/,"space A":/^\s(?=[A-Z\\$])/,space$:/^\s$/,"a-z":/^[a-z]/,x:/^x/,x$:/^x$/,i$:/^i$/,letters:/^(?:[a-zA-Z\u03B1-\u03C9\u0391-\u03A9?@]|(?:\\(?:alpha|beta|gamma|delta|epsilon|zeta|eta|theta|iota|kappa|lambda|mu|nu|xi|omicron|pi|rho|sigma|tau|upsilon|phi|chi|psi|omega|Gamma|Delta|Theta|Lambda|Xi|Pi|Sigma|Upsilon|Phi|Psi|Omega)(?:\s+|\{\}|(?![a-zA-Z]))))+/,"\\greek":/^\\(?:alpha|beta|gamma|delta|epsilon|zeta|eta|theta|iota|kappa|lambda|mu|nu|xi|omicron|pi|rho|sigma|tau|upsilon|phi|chi|psi|omega|Gamma|Delta|Theta|Lambda|Xi|Pi|Sigma|Upsilon|Phi|Psi|Omega)(?:\s+|\{\}|(?![a-zA-Z]))/,"one lowercase latin letter $":/^(?:([a-z])(?:$|[^a-zA-Z]))$/,"$one lowercase latin letter$ $":/^\$(?:([a-z])(?:$|[^a-zA-Z]))\$$/,"one lowercase greek letter $":/^(?:\$?[\u03B1-\u03C9]\$?|\$?\\(?:alpha|beta|gamma|delta|epsilon|zeta|eta|theta|iota|kappa|lambda|mu|nu|xi|omicron|pi|rho|sigma|tau|upsilon|phi|chi|psi|omega)\s*\$?)(?:\s+|\{\}|(?![a-zA-Z]))$/,digits:/^[0-9]+/,"-9.,9":/^[+\-]?(?:[0-9]+(?:[,.][0-9]+)?|[0-9]*(?:\.[0-9]+))/,"-9.,9 no missing 0":/^[+\-]?[0-9]+(?:[.,][0-9]+)?/,"(-)(9.,9)(e)(99)":function(input){const m=input.match(/^(\+\-|\+\/\-|\+|\-|\\pm\s?)?([0-9]+(?:[,.][0-9]+)?|[0-9]*(?:\.[0-9]+))?(\((?:[0-9]+(?:[,.][0-9]+)?|[0-9]*(?:\.[0-9]+))\))?(?:([eE]|\s*(\*|x|\\times|\u00D7)\s*10\^)([+\-]?[0-9]+|\{[+\-]?[0-9]+\}))?/);return m&&m[0]?{match_:m.splice(1),remainder:input.substr(m[0].length)}:null},"(-)(9)^(-9)":function(input){const m=input.match(/^(\+\-|\+\/\-|\+|\-|\\pm\s?)?([0-9]+(?:[,.][0-9]+)?|[0-9]*(?:\.[0-9]+)?)\^([+\-]?[0-9]+|\{[+\-]?[0-9]+\})/);return m&&m[0]?{match_:m.splice(1),remainder:input.substr(m[0].length)}:null},"state of aggregation $":function(input){const a=mhchemParser.patterns.findObserveGroups(input,"",/^\([a-z]{1,3}(?=[\),])/,")","");if(a&&a.remainder.match(/^($|[\s,;\)\]\}])/))return a;const m=input.match(/^(?:\((?:\\ca\s?)?\$[amothc]\$\))/);return m?{match_:m[0],remainder:input.substr(m[0].length)}:null},"_{(state of aggregation)}$":/^_\{(\([a-z]{1,3}\))\}/,"{[(":/^(?:\\\{|\[|\()/,")]}":/^(?:\)|\]|\\\})/,", ":/^[,;]\s*/,",":/^[,;]/,".":/^[.]/,". ":/^([.\u22C5\u00B7\u2022])\s*/,"...":/^\.\.\.(?=$|[^.])/,"* ":/^([*])\s*/,"^{(...)}":function(input){return mhchemParser.patterns.findObserveGroups(input,"^{","","","}")},"^($...$)":function(input){return mhchemParser.patterns.findObserveGroups(input,"^","$","$","")},"^a":/^\^([0-9]+|[^\\_])/,"^\\x{}{}":function(input){return mhchemParser.patterns.findObserveGroups(input,"^",/^\\[a-zA-Z]+\{/,"}","","","{","}","",!0)},"^\\x{}":function(input){return mhchemParser.patterns.findObserveGroups(input,"^",/^\\[a-zA-Z]+\{/,"}","")},"^\\x":/^\^(\\[a-zA-Z]+)\s*/,"^(-1)":/^\^(-?\d+)/,"'":/^'/,"_{(...)}":function(input){return mhchemParser.patterns.findObserveGroups(input,"_{","","","}")},"_($...$)":function(input){return mhchemParser.patterns.findObserveGroups(input,"_","$","$","")},_9:/^_([+\-]?[0-9]+|[^\\])/,"_\\x{}{}":function(input){return mhchemParser.patterns.findObserveGroups(input,"_",/^\\[a-zA-Z]+\{/,"}","","","{","}","",!0)},"_\\x{}":function(input){return mhchemParser.patterns.findObserveGroups(input,"_",/^\\[a-zA-Z]+\{/,"}","")},"_\\x":/^_(\\[a-zA-Z]+)\s*/,"^_":/^(?:\^(?=_)|\_(?=\^)|[\^_]$)/,"{}":/^\{\}/,"{...}":function(input){return mhchemParser.patterns.findObserveGroups(input,"","{","}","")},"{(...)}":function(input){return mhchemParser.patterns.findObserveGroups(input,"{","","","}")},"$...$":function(input){return mhchemParser.patterns.findObserveGroups(input,"","$","$","")},"${(...)}$":function(input){return mhchemParser.patterns.findObserveGroups(input,"${","","","}$")},"$(...)$":function(input){return mhchemParser.patterns.findObserveGroups(input,"$","","","$")},"=<>":/^[=<>]/,"#":/^[#\u2261]/,"+":/^\+/,"-$":/^-(?=[\s_},;\]/]|$|\([a-z]+\))/,"-9":/^-(?=[0-9])/,"- orbital overlap":/^-(?=(?:[spd]|sp)(?:$|[\s,;\)\]\}]))/,"-":/^-/,"pm-operator":/^(?:\\pm|\$\\pm\$|\+-|\+\/-)/,operator:/^(?:\+|(?:[\-=<>]|<<|>>|\\approx|\$\\approx\$)(?=\s|$|-?[0-9]))/,arrowUpDown:/^(?:v|\(v\)|\^|\(\^\))(?=$|[\s,;\)\]\}])/,"\\bond{(...)}":function(input){return mhchemParser.patterns.findObserveGroups(input,"\\bond{","","","}")},"->":/^(?:<->|<-->|->|<-|<=>>|<<=>|<=>|[\u2192\u27F6\u21CC])/,CMT:/^[CMT](?=\[)/,"[(...)]":function(input){return mhchemParser.patterns.findObserveGroups(input,"[","","","]")},"1st-level escape":/^(&|\\\\|\\hline)\s*/,"\\,":/^(?:\\[,\ ;:])/,"\\x{}{}":function(input){return mhchemParser.patterns.findObserveGroups(input,"",/^\\[a-zA-Z]+\{/,"}","","","{","}","",!0)},"\\x{}":function(input){return mhchemParser.patterns.findObserveGroups(input,"",/^\\[a-zA-Z]+\{/,"}","")},"\\ca":/^\\ca(?:\s+|(?![a-zA-Z]))/,"\\x":/^(?:\\[a-zA-Z]+\s*|\\[_&{}%])/,orbital:/^(?:[0-9]{1,2}[spdfgh]|[0-9]{0,2}sp)(?=$|[^a-zA-Z])/,others:/^[\/~|]/,"\\frac{(...)}":function(input){return mhchemParser.patterns.findObserveGroups(input,"\\frac{","","","}","{","","","}")},"\\overset{(...)}":function(input){return mhchemParser.patterns.findObserveGroups(input,"\\overset{","","","}","{","","","}")},"\\underset{(...)}":function(input){return mhchemParser.patterns.findObserveGroups(input,"\\underset{","","","}","{","","","}")},"\\underbrace{(...)}":function(input){return mhchemParser.patterns.findObserveGroups(input,"\\underbrace{","","","}_","{","","","}")},"\\color{(...)}0":function(input){return mhchemParser.patterns.findObserveGroups(input,"\\color{","","","}")},"\\color{(...)}{(...)}1":function(input){return mhchemParser.patterns.findObserveGroups(input,"\\color{","","","}","{","","","}")},"\\color(...){(...)}2":function(input){return mhchemParser.patterns.findObserveGroups(input,"\\color","\\","",/^(?=\{)/,"{","","","}")},"\\ce{(...)}":function(input){return mhchemParser.patterns.findObserveGroups(input,"\\ce{","","","}")},oxidation$:/^(?:[+-][IVX]+|\\pm\s*0|\$\\pm\$\s*0)$/,"d-oxidation$":/^(?:[+-]?\s?[IVX]+|\\pm\s*0|\$\\pm\$\s*0)$/,"roman numeral":/^[IVX]+/,"1/2$":/^[+\-]?(?:[0-9]+|\$[a-z]\$|[a-z])\/[0-9]+(?:\$[a-z]\$|[a-z])?$/,amount:function(input){let match;if(match=input.match(/^(?:(?:(?:\([+\-]?[0-9]+\/[0-9]+\)|[+\-]?(?:[0-9]+|\$[a-z]\$|[a-z])\/[0-9]+|[+\-]?[0-9]+[.,][0-9]+|[+\-]?\.[0-9]+|[+\-]?[0-9]+)(?:[a-z](?=\s*[A-Z]))?)|[+\-]?[a-z](?=\s*[A-Z])|\+(?!\s))/),match)return{match_:match[0],remainder:input.substr(match[0].length)};const a=mhchemParser.patterns.findObserveGroups(input,"","$","$","");return a&&(match=a.match_.match(/^\$(?:\(?[+\-]?(?:[0-9]*[a-z]?[+\-])?[0-9]*[a-z](?:[+\-][0-9]*[a-z]?)?\)?|\+|-)\$$/),match)?{match_:match[0],remainder:input.substr(match[0].length)}:null},amount2:function(input){return this.amount(input)},"(KV letters),":/^(?:[A-Z][a-z]{0,2}|i)(?=,)/,formula$:function(input){if(input.match(/^\([a-z]+\)$/))return null;const match=input.match(/^(?:[a-z]|(?:[0-9\ \+\-\,\.\(\)]+[a-z])+[0-9\ \+\-\,\.\(\)]*|(?:[a-z][0-9\ \+\-\,\.\(\)]+)+[a-z]?)$/);return match?{match_:match[0],remainder:input.substr(match[0].length)}:null},uprightEntities:/^(?:pH|pOH|pC|pK|iPr|iBu)(?=$|[^a-zA-Z])/,"/":/^\s*(\/)\s*/,"//":/^\s*(\/\/)\s*/,"*":/^\s*[*.]\s*/},findObserveGroups:function(input,begExcl,begIncl,endIncl,endExcl,beg2Excl,beg2Incl,end2Incl,end2Excl,combine){const _match=function(input,pattern){if("string"==typeof pattern)return 0!==input.indexOf(pattern)?null:pattern;const match=input.match(pattern);return match?match[0]:null};let match=_match(input,begExcl);if(null===match)return null;if(input=input.substr(match.length),match=_match(input,begIncl),null===match)return null;const e=function(input,i,endChars){let braces=0;for(;i<input.length;){const a=input.charAt(i),match=_match(input.substr(i),endChars);if(null!==match&&0===braces)return{endMatchBegin:i,endMatchEnd:i+match.length};if("{"===a)braces++;else if("}"===a){if(0===braces)throw["ExtraCloseMissingOpen","Extra close brace or missing open brace"];braces--}i++}return null}(input,match.length,endIncl||endExcl);if(null===e)return null;const match1=input.substring(0,endIncl?e.endMatchEnd:e.endMatchBegin);if(!beg2Excl&&!beg2Incl)return{match_:match1,remainder:input.substr(e.endMatchEnd)};const group2=this.findObserveGroups(input.substr(e.endMatchEnd),beg2Excl,beg2Incl,end2Incl,end2Excl);if(null===group2)return null;const matchRet=[match1,group2.match_];return{match_:combine?matchRet.join(""):matchRet,remainder:group2.remainder}},match_:function(m,input){const pattern=mhchemParser.patterns.patterns[m];if(void 0===pattern)throw["MhchemBugP","mhchem bug P. Please report. ("+m+")"];if("function"==typeof pattern)return mhchemParser.patterns.patterns[m](input);{const match=input.match(pattern);if(match){let mm;return mm=match[2]?[match[1],match[2]]:match[1]?match[1]:match[0],{match_:mm,remainder:input.substr(match[0].length)}}return null}}},actions:{"a=":function(buffer,m){buffer.a=(buffer.a||"")+m},"b=":function(buffer,m){buffer.b=(buffer.b||"")+m},"p=":function(buffer,m){buffer.p=(buffer.p||"")+m},"o=":function(buffer,m){buffer.o=(buffer.o||"")+m},"q=":function(buffer,m){buffer.q=(buffer.q||"")+m},"d=":function(buffer,m){buffer.d=(buffer.d||"")+m},"rm=":function(buffer,m){buffer.rm=(buffer.rm||"")+m},"text=":function(buffer,m){buffer.text_=(buffer.text_||"")+m},insert:function(buffer,m,a){return{type_:a}},"insert+p1":function(buffer,m,a){return{type_:a,p1:m}},"insert+p1+p2":function(buffer,m,a){return{type_:a,p1:m[0],p2:m[1]}},copy:function(buffer,m){return m},rm:function(buffer,m){return{type_:"rm",p1:m||""}},text:function(buffer,m){return mhchemParser.go(m,"text")},"{text}":function(buffer,m){const ret=["{"];return mhchemParser.concatArray(ret,mhchemParser.go(m,"text")),ret.push("}"),ret},"tex-math":function(buffer,m){return mhchemParser.go(m,"tex-math")},"tex-math tight":function(buffer,m){return mhchemParser.go(m,"tex-math tight")},bond:function(buffer,m,k){return{type_:"bond",kind_:k||m}},"color0-output":function(buffer,m){return{type_:"color0",color:m[0]}},ce:function(buffer,m){return mhchemParser.go(m)},"1/2":function(buffer,m){const ret=[];m.match(/^[+\-]/)&&(ret.push(m.substr(0,1)),m=m.substr(1));const n=m.match(/^([0-9]+|\$[a-z]\$|[a-z])\/([0-9]+)(\$[a-z]\$|[a-z])?$/);return n[1]=n[1].replace(/\$/g,""),ret.push({type_:"frac",p1:n[1],p2:n[2]}),n[3]&&(n[3]=n[3].replace(/\$/g,""),ret.push({type_:"tex-math",p1:n[3]})),ret},"9,9":function(buffer,m){return mhchemParser.go(m,"9,9")}},createTransitions:function(o){let pattern,state,stateArray,i;const transitions={};for(pattern in o)for(state in o[pattern])for(stateArray=state.split("|"),o[pattern][state].stateArray=stateArray,i=0;i<stateArray.length;i++)transitions[stateArray[i]]=[];for(pattern in o)for(state in o[pattern])for(stateArray=o[pattern][state].stateArray||[],i=0;i<stateArray.length;i++){const p=o[pattern][state];if(p.action_){p.action_=[].concat(p.action_);for(let k=0;k<p.action_.length;k++)"string"==typeof p.action_[k]&&(p.action_[k]={type_:p.action_[k]})}else p.action_=[];const patternArray=pattern.split("|");for(let j=0;j<patternArray.length;j++)if("*"===stateArray[i])for(const t in transitions)transitions[t].push({pattern:patternArray[j],task:p});else transitions[stateArray[i]].push({pattern:patternArray[j],task:p})}return transitions},stateMachines:{}};mhchemParser.stateMachines={ce:{transitions:mhchemParser.createTransitions({empty:{"*":{action_:"output"}},else:{"0|1|2":{action_:"beginsWithBond=false",revisit:!0,toContinue:!0}},oxidation$:{0:{action_:"oxidation-output"}},CMT:{r:{action_:"rdt=",nextState:"rt"},rd:{action_:"rqt=",nextState:"rdt"}},arrowUpDown:{"0|1|2|as":{action_:["sb=false","output","operator"],nextState:"1"}},uprightEntities:{"0|1|2":{action_:["o=","output"],nextState:"1"}},orbital:{"0|1|2|3":{action_:"o=",nextState:"o"}},"->":{"0|1|2|3":{action_:"r=",nextState:"r"},"a|as":{action_:["output","r="],nextState:"r"},"*":{action_:["output","r="],nextState:"r"}},"+":{o:{action_:"d= kv",nextState:"d"},"d|D":{action_:"d=",nextState:"d"},q:{action_:"d=",nextState:"qd"},"qd|qD":{action_:"d=",nextState:"qd"},dq:{action_:["output","d="],nextState:"d"},3:{action_:["sb=false","output","operator"],nextState:"0"}},amount:{"0|2":{action_:"a=",nextState:"a"}},"pm-operator":{"0|1|2|a|as":{action_:["sb=false","output",{type_:"operator",option:"\\pm"}],nextState:"0"}},operator:{"0|1|2|a|as":{action_:["sb=false","output","operator"],nextState:"0"}},"-$":{"o|q":{action_:["charge or bond","output"],nextState:"qd"},d:{action_:"d=",nextState:"d"},D:{action_:["output",{type_:"bond",option:"-"}],nextState:"3"},q:{action_:"d=",nextState:"qd"},qd:{action_:"d=",nextState:"qd"},"qD|dq":{action_:["output",{type_:"bond",option:"-"}],nextState:"3"}},"-9":{"3|o":{action_:["output",{type_:"insert",option:"hyphen"}],nextState:"3"}},"- orbital overlap":{o:{action_:["output",{type_:"insert",option:"hyphen"}],nextState:"2"},d:{action_:["output",{type_:"insert",option:"hyphen"}],nextState:"2"}},"-":{"0|1|2":{action_:[{type_:"output",option:1},"beginsWithBond=true",{type_:"bond",option:"-"}],nextState:"3"},3:{action_:{type_:"bond",option:"-"}},a:{action_:["output",{type_:"insert",option:"hyphen"}],nextState:"2"},as:{action_:[{type_:"output",option:2},{type_:"bond",option:"-"}],nextState:"3"},b:{action_:"b="},o:{action_:{type_:"- after o/d",option:!1},nextState:"2"},q:{action_:{type_:"- after o/d",option:!1},nextState:"2"},"d|qd|dq":{action_:{type_:"- after o/d",option:!0},nextState:"2"},"D|qD|p":{action_:["output",{type_:"bond",option:"-"}],nextState:"3"}},amount2:{"1|3":{action_:"a=",nextState:"a"}},letters:{"0|1|2|3|a|as|b|p|bp|o":{action_:"o=",nextState:"o"},"q|dq":{action_:["output","o="],nextState:"o"},"d|D|qd|qD":{action_:"o after d",nextState:"o"}},digits:{o:{action_:"q=",nextState:"q"},"d|D":{action_:"q=",nextState:"dq"},q:{action_:["output","o="],nextState:"o"},a:{action_:"o=",nextState:"o"}},"space A":{"b|p|bp":{}},space:{a:{nextState:"as"},0:{action_:"sb=false"},"1|2":{action_:"sb=true"},"r|rt|rd|rdt|rdq":{action_:"output",nextState:"0"},"*":{action_:["output","sb=true"],nextState:"1"}},"1st-level escape":{"1|2":{action_:["output",{type_:"insert+p1",option:"1st-level escape"}]},"*":{action_:["output",{type_:"insert+p1",option:"1st-level escape"}],nextState:"0"}},"[(...)]":{"r|rt":{action_:"rd=",nextState:"rd"},"rd|rdt":{action_:"rq=",nextState:"rdq"}},"...":{"o|d|D|dq|qd|qD":{action_:["output",{type_:"bond",option:"..."}],nextState:"3"},"*":{action_:[{type_:"output",option:1},{type_:"insert",option:"ellipsis"}],nextState:"1"}},". |* ":{"*":{action_:["output",{type_:"insert",option:"addition compound"}],nextState:"1"}},"state of aggregation $":{"*":{action_:["output","state of aggregation"],nextState:"1"}},"{[(":{"a|as|o":{action_:["o=","output","parenthesisLevel++"],nextState:"2"},"0|1|2|3":{action_:["o=","output","parenthesisLevel++"],nextState:"2"},"*":{action_:["output","o=","output","parenthesisLevel++"],nextState:"2"}},")]}":{"0|1|2|3|b|p|bp|o":{action_:["o=","parenthesisLevel--"],nextState:"o"},"a|as|d|D|q|qd|qD|dq":{action_:["output","o=","parenthesisLevel--"],nextState:"o"}},", ":{"*":{action_:["output","comma"],nextState:"0"}},"^_":{"*":{}},"^{(...)}|^($...$)":{"0|1|2|as":{action_:"b=",nextState:"b"},p:{action_:"b=",nextState:"bp"},"3|o":{action_:"d= kv",nextState:"D"},q:{action_:"d=",nextState:"qD"},"d|D|qd|qD|dq":{action_:["output","d="],nextState:"D"}},"^a|^\\x{}{}|^\\x{}|^\\x|'":{"0|1|2|as":{action_:"b=",nextState:"b"},p:{action_:"b=",nextState:"bp"},"3|o":{action_:"d= kv",nextState:"d"},q:{action_:"d=",nextState:"qd"},"d|qd|D|qD":{action_:"d="},dq:{action_:["output","d="],nextState:"d"}},"_{(state of aggregation)}$":{"d|D|q|qd|qD|dq":{action_:["output","q="],nextState:"q"}},"_{(...)}|_($...$)|_9|_\\x{}{}|_\\x{}|_\\x":{"0|1|2|as":{action_:"p=",nextState:"p"},b:{action_:"p=",nextState:"bp"},"3|o":{action_:"q=",nextState:"q"},"d|D":{action_:"q=",nextState:"dq"},"q|qd|qD|dq":{action_:["output","q="],nextState:"q"}},"=<>":{"0|1|2|3|a|as|o|q|d|D|qd|qD|dq":{action_:[{type_:"output",option:2},"bond"],nextState:"3"}},"#":{"0|1|2|3|a|as|o":{action_:[{type_:"output",option:2},{type_:"bond",option:"#"}],nextState:"3"}},"{}":{"*":{action_:{type_:"output",option:1},nextState:"1"}},"{...}":{"0|1|2|3|a|as|b|p|bp":{action_:"o=",nextState:"o"},"o|d|D|q|qd|qD|dq":{action_:["output","o="],nextState:"o"}},"$...$":{a:{action_:"a="},"0|1|2|3|as|b|p|bp|o":{action_:"o=",nextState:"o"},"as|o":{action_:"o="},"q|d|D|qd|qD|dq":{action_:["output","o="],nextState:"o"}},"\\bond{(...)}":{"*":{action_:[{type_:"output",option:2},"bond"],nextState:"3"}},"\\frac{(...)}":{"*":{action_:[{type_:"output",option:1},"frac-output"],nextState:"3"}},"\\overset{(...)}":{"*":{action_:[{type_:"output",option:2},"overset-output"],nextState:"3"}},"\\underset{(...)}":{"*":{action_:[{type_:"output",option:2},"underset-output"],nextState:"3"}},"\\underbrace{(...)}":{"*":{action_:[{type_:"output",option:2},"underbrace-output"],nextState:"3"}},"\\color{(...)}{(...)}1|\\color(...){(...)}2":{"*":{action_:[{type_:"output",option:2},"color-output"],nextState:"3"}},"\\color{(...)}0":{"*":{action_:[{type_:"output",option:2},"color0-output"]}},"\\ce{(...)}":{"*":{action_:[{type_:"output",option:2},"ce"],nextState:"3"}},"\\,":{"*":{action_:[{type_:"output",option:1},"copy"],nextState:"1"}},"\\x{}{}|\\x{}|\\x":{"0|1|2|3|a|as|b|p|bp|o|c0":{action_:["o=","output"],nextState:"3"},"*":{action_:["output","o=","output"],nextState:"3"}},others:{"*":{action_:[{type_:"output",option:1},"copy"],nextState:"3"}},else2:{a:{action_:"a to o",nextState:"o",revisit:!0},as:{action_:["output","sb=true"],nextState:"1",revisit:!0},"r|rt|rd|rdt|rdq":{action_:["output"],nextState:"0",revisit:!0},"*":{action_:["output","copy"],nextState:"3"}}}),actions:{"o after d":function(buffer,m){let ret;if((buffer.d||"").match(/^[0-9]+$/)){const tmp=buffer.d;buffer.d=void 0,ret=this.output(buffer),buffer.b=tmp}else ret=this.output(buffer);return mhchemParser.actions["o="](buffer,m),ret},"d= kv":function(buffer,m){buffer.d=m,buffer.dType="kv"},"charge or bond":function(buffer,m){if(buffer.beginsWithBond){const ret=[];return mhchemParser.concatArray(ret,this.output(buffer)),mhchemParser.concatArray(ret,mhchemParser.actions.bond(buffer,m,"-")),ret}buffer.d=m},"- after o/d":function(buffer,m,isAfterD){let c1=mhchemParser.patterns.match_("orbital",buffer.o||"");const c2=mhchemParser.patterns.match_("one lowercase greek letter $",buffer.o||""),c3=mhchemParser.patterns.match_("one lowercase latin letter $",buffer.o||""),c4=mhchemParser.patterns.match_("$one lowercase latin letter$ $",buffer.o||""),hyphenFollows="-"===m&&(c1&&""===c1.remainder||c2||c3||c4);!hyphenFollows||buffer.a||buffer.b||buffer.p||buffer.d||buffer.q||c1||!c3||(buffer.o="$"+buffer.o+"$");const ret=[];return hyphenFollows?(mhchemParser.concatArray(ret,this.output(buffer)),ret.push({type_:"hyphen"})):(c1=mhchemParser.patterns.match_("digits",buffer.d||""),isAfterD&&c1&&""===c1.remainder?(mhchemParser.concatArray(ret,mhchemParser.actions["d="](buffer,m)),mhchemParser.concatArray(ret,this.output(buffer))):(mhchemParser.concatArray(ret,this.output(buffer)),mhchemParser.concatArray(ret,mhchemParser.actions.bond(buffer,m,"-")))),ret},"a to o":function(buffer){buffer.o=buffer.a,buffer.a=void 0},"sb=true":function(buffer){buffer.sb=!0},"sb=false":function(buffer){buffer.sb=!1},"beginsWithBond=true":function(buffer){buffer.beginsWithBond=!0},"beginsWithBond=false":function(buffer){buffer.beginsWithBond=!1},"parenthesisLevel++":function(buffer){buffer.parenthesisLevel++},"parenthesisLevel--":function(buffer){buffer.parenthesisLevel--},"state of aggregation":function(buffer,m){return{type_:"state of aggregation",p1:mhchemParser.go(m,"o")}},comma:function(buffer,m){const a=m.replace(/\s*$/,"");return a!==m&&0===buffer.parenthesisLevel?{type_:"comma enumeration L",p1:a}:{type_:"comma enumeration M",p1:a}},output:function(buffer,m,entityFollows){let ret;if(buffer.r){let rd,rq;rd="M"===buffer.rdt?mhchemParser.go(buffer.rd,"tex-math"):"T"===buffer.rdt?[{type_:"text",p1:buffer.rd||""}]:mhchemParser.go(buffer.rd),rq="M"===buffer.rqt?mhchemParser.go(buffer.rq,"tex-math"):"T"===buffer.rqt?[{type_:"text",p1:buffer.rq||""}]:mhchemParser.go(buffer.rq),ret={type_:"arrow",r:buffer.r,rd,rq}}else ret=[],(buffer.a||buffer.b||buffer.p||buffer.o||buffer.q||buffer.d||entityFollows)&&(buffer.sb&&ret.push({type_:"entitySkip"}),buffer.o||buffer.q||buffer.d||buffer.b||buffer.p||2===entityFollows?buffer.o||buffer.q||buffer.d||!buffer.b&&!buffer.p?buffer.o&&"kv"===buffer.dType&&mhchemParser.patterns.match_("d-oxidation$",buffer.d||"")?buffer.dType="oxidation":buffer.o&&"kv"===buffer.dType&&!buffer.q&&(buffer.dType=void 0):(buffer.o=buffer.a,buffer.d=buffer.b,buffer.q=buffer.p,buffer.a=buffer.b=buffer.p=void 0):(buffer.o=buffer.a,buffer.a=void 0),ret.push({type_:"chemfive",a:mhchemParser.go(buffer.a,"a"),b:mhchemParser.go(buffer.b,"bd"),p:mhchemParser.go(buffer.p,"pq"),o:mhchemParser.go(buffer.o,"o"),q:mhchemParser.go(buffer.q,"pq"),d:mhchemParser.go(buffer.d,"oxidation"===buffer.dType?"oxidation":"bd"),dType:buffer.dType}));for(const p in buffer)"parenthesisLevel"!==p&&"beginsWithBond"!==p&&delete buffer[p];return ret},"oxidation-output":function(buffer,m){const ret=["{"];return mhchemParser.concatArray(ret,mhchemParser.go(m,"oxidation")),ret.push("}"),ret},"frac-output":function(buffer,m){return{type_:"frac-ce",p1:mhchemParser.go(m[0]),p2:mhchemParser.go(m[1])}},"overset-output":function(buffer,m){return{type_:"overset",p1:mhchemParser.go(m[0]),p2:mhchemParser.go(m[1])}},"underset-output":function(buffer,m){return{type_:"underset",p1:mhchemParser.go(m[0]),p2:mhchemParser.go(m[1])}},"underbrace-output":function(buffer,m){return{type_:"underbrace",p1:mhchemParser.go(m[0]),p2:mhchemParser.go(m[1])}},"color-output":function(buffer,m){return{type_:"color",color1:m[0],color2:mhchemParser.go(m[1])}},"r=":function(buffer,m){buffer.r=m},"rdt=":function(buffer,m){buffer.rdt=m},"rd=":function(buffer,m){buffer.rd=m},"rqt=":function(buffer,m){buffer.rqt=m},"rq=":function(buffer,m){buffer.rq=m},operator:function(buffer,m,p1){return{type_:"operator",kind_:p1||m}}}},a:{transitions:mhchemParser.createTransitions({empty:{"*":{}},"1/2$":{0:{action_:"1/2"}},else:{0:{nextState:"1",revisit:!0}},"$(...)$":{"*":{action_:"tex-math tight",nextState:"1"}},",":{"*":{action_:{type_:"insert",option:"commaDecimal"}}},else2:{"*":{action_:"copy"}}}),actions:{}},o:{transitions:mhchemParser.createTransitions({empty:{"*":{}},"1/2$":{0:{action_:"1/2"}},else:{0:{nextState:"1",revisit:!0}},letters:{"*":{action_:"rm"}},"\\ca":{"*":{action_:{type_:"insert",option:"circa"}}},"\\x{}{}|\\x{}|\\x":{"*":{action_:"copy"}},"${(...)}$|$(...)$":{"*":{action_:"tex-math"}},"{(...)}":{"*":{action_:"{text}"}},else2:{"*":{action_:"copy"}}}),actions:{}},text:{transitions:mhchemParser.createTransitions({empty:{"*":{action_:"output"}},"{...}":{"*":{action_:"text="}},"${(...)}$|$(...)$":{"*":{action_:"tex-math"}},"\\greek":{"*":{action_:["output","rm"]}},"\\,|\\x{}{}|\\x{}|\\x":{"*":{action_:["output","copy"]}},else:{"*":{action_:"text="}}}),actions:{output:function(buffer){if(buffer.text_){const ret={type_:"text",p1:buffer.text_};for(const p in buffer)delete buffer[p];return ret}}}},pq:{transitions:mhchemParser.createTransitions({empty:{"*":{}},"state of aggregation $":{"*":{action_:"state of aggregation"}},i$:{0:{nextState:"!f",revisit:!0}},"(KV letters),":{0:{action_:"rm",nextState:"0"}},formula$:{0:{nextState:"f",revisit:!0}},"1/2$":{0:{action_:"1/2"}},else:{0:{nextState:"!f",revisit:!0}},"${(...)}$|$(...)$":{"*":{action_:"tex-math"}},"{(...)}":{"*":{action_:"text"}},"a-z":{f:{action_:"tex-math"}},letters:{"*":{action_:"rm"}},"-9.,9":{"*":{action_:"9,9"}},",":{"*":{action_:{type_:"insert+p1",option:"comma enumeration S"}}},"\\color{(...)}{(...)}1|\\color(...){(...)}2":{"*":{action_:"color-output"}},"\\color{(...)}0":{"*":{action_:"color0-output"}},"\\ce{(...)}":{"*":{action_:"ce"}},"\\,|\\x{}{}|\\x{}|\\x":{"*":{action_:"copy"}},else2:{"*":{action_:"copy"}}}),actions:{"state of aggregation":function(buffer,m){return{type_:"state of aggregation subscript",p1:mhchemParser.go(m,"o")}},"color-output":function(buffer,m){return{type_:"color",color1:m[0],color2:mhchemParser.go(m[1],"pq")}}}},bd:{transitions:mhchemParser.createTransitions({empty:{"*":{}},x$:{0:{nextState:"!f",revisit:!0}},formula$:{0:{nextState:"f",revisit:!0}},else:{0:{nextState:"!f",revisit:!0}},"-9.,9 no missing 0":{"*":{action_:"9,9"}},".":{"*":{action_:{type_:"insert",option:"electron dot"}}},"a-z":{f:{action_:"tex-math"}},x:{"*":{action_:{type_:"insert",option:"KV x"}}},letters:{"*":{action_:"rm"}},"'":{"*":{action_:{type_:"insert",option:"prime"}}},"${(...)}$|$(...)$":{"*":{action_:"tex-math"}},"{(...)}":{"*":{action_:"text"}},"\\color{(...)}{(...)}1|\\color(...){(...)}2":{"*":{action_:"color-output"}},"\\color{(...)}0":{"*":{action_:"color0-output"}},"\\ce{(...)}":{"*":{action_:"ce"}},"\\,|\\x{}{}|\\x{}|\\x":{"*":{action_:"copy"}},else2:{"*":{action_:"copy"}}}),actions:{"color-output":function(buffer,m){return{type_:"color",color1:m[0],color2:mhchemParser.go(m[1],"bd")}}}},oxidation:{transitions:mhchemParser.createTransitions({empty:{"*":{}},"roman numeral":{"*":{action_:"roman-numeral"}},"${(...)}$|$(...)$":{"*":{action_:"tex-math"}},else:{"*":{action_:"copy"}}}),actions:{"roman-numeral":function(buffer,m){return{type_:"roman numeral",p1:m||""}}}},"tex-math":{transitions:mhchemParser.createTransitions({empty:{"*":{action_:"output"}},"\\ce{(...)}":{"*":{action_:["output","ce"]}},"{...}|\\,|\\x{}{}|\\x{}|\\x":{"*":{action_:"o="}},else:{"*":{action_:"o="}}}),actions:{output:function(buffer){if(buffer.o){const ret={type_:"tex-math",p1:buffer.o};for(const p in buffer)delete buffer[p];return ret}}}},"tex-math tight":{transitions:mhchemParser.createTransitions({empty:{"*":{action_:"output"}},"\\ce{(...)}":{"*":{action_:["output","ce"]}},"{...}|\\,|\\x{}{}|\\x{}|\\x":{"*":{action_:"o="}},"-|+":{"*":{action_:"tight operator"}},else:{"*":{action_:"o="}}}),actions:{"tight operator":function(buffer,m){buffer.o=(buffer.o||"")+"{"+m+"}"},output:function(buffer){if(buffer.o){const ret={type_:"tex-math",p1:buffer.o};for(const p in buffer)delete buffer[p];return ret}}}},"9,9":{transitions:mhchemParser.createTransitions({empty:{"*":{}},",":{"*":{action_:"comma"}},else:{"*":{action_:"copy"}}}),actions:{comma:function(){return{type_:"commaDecimal"}}}},pu:{transitions:mhchemParser.createTransitions({empty:{"*":{action_:"output"}},space$:{"*":{action_:["output","space"]}},"{[(|)]}":{"0|a":{action_:"copy"}},"(-)(9)^(-9)":{0:{action_:"number^",nextState:"a"}},"(-)(9.,9)(e)(99)":{0:{action_:"enumber",nextState:"a"}},space:{"0|a":{}},"pm-operator":{"0|a":{action_:{type_:"operator",option:"\\pm"},nextState:"0"}},operator:{"0|a":{action_:"copy",nextState:"0"}},"//":{d:{action_:"o=",nextState:"/"}},"/":{d:{action_:"o=",nextState:"/"}},"{...}|else":{"0|d":{action_:"d=",nextState:"d"},a:{action_:["space","d="],nextState:"d"},"/|q":{action_:"q=",nextState:"q"}}}),actions:{enumber:function(buffer,m){const ret=[];return"+-"===m[0]||"+/-"===m[0]?ret.push("\\pm "):m[0]&&ret.push(m[0]),m[1]&&(mhchemParser.concatArray(ret,mhchemParser.go(m[1],"pu-9,9")),m[2]&&(m[2].match(/[,.]/)?mhchemParser.concatArray(ret,mhchemParser.go(m[2],"pu-9,9")):ret.push(m[2])),m[3]=m[4]||m[3],m[3]&&(m[3]=m[3].trim(),"e"===m[3]||"*"===m[3].substr(0,1)?ret.push({type_:"cdot"}):ret.push({type_:"times"}))),m[3]&&ret.push("10^{"+m[5]+"}"),ret},"number^":function(buffer,m){const ret=[];return"+-"===m[0]||"+/-"===m[0]?ret.push("\\pm "):m[0]&&ret.push(m[0]),mhchemParser.concatArray(ret,mhchemParser.go(m[1],"pu-9,9")),ret.push("^{"+m[2]+"}"),ret},operator:function(buffer,m,p1){return{type_:"operator",kind_:p1||m}},space:function(){return{type_:"pu-space-1"}},output:function(buffer){let ret;const md=mhchemParser.patterns.match_("{(...)}",buffer.d||"");md&&""===md.remainder&&(buffer.d=md.match_);const mq=mhchemParser.patterns.match_("{(...)}",buffer.q||"");if(mq&&""===mq.remainder&&(buffer.q=mq.match_),buffer.d&&(buffer.d=buffer.d.replace(/\u00B0C|\^oC|\^{o}C/g,"{}^{\\circ}C"),buffer.d=buffer.d.replace(/\u00B0F|\^oF|\^{o}F/g,"{}^{\\circ}F")),buffer.q){buffer.q=buffer.q.replace(/\u00B0C|\^oC|\^{o}C/g,"{}^{\\circ}C"),buffer.q=buffer.q.replace(/\u00B0F|\^oF|\^{o}F/g,"{}^{\\circ}F");const b5={d:mhchemParser.go(buffer.d,"pu"),q:mhchemParser.go(buffer.q,"pu")};"//"===buffer.o?ret={type_:"pu-frac",p1:b5.d,p2:b5.q}:(ret=b5.d,b5.d.length>1||b5.q.length>1?ret.push({type_:" / "}):ret.push({type_:"/"}),mhchemParser.concatArray(ret,b5.q))}else ret=mhchemParser.go(buffer.d,"pu-2");for(const p in buffer)delete buffer[p];return ret}}},"pu-2":{transitions:mhchemParser.createTransitions({empty:{"*":{action_:"output"}},"*":{"*":{action_:["output","cdot"],nextState:"0"}},"\\x":{"*":{action_:"rm="}},space:{"*":{action_:["output","space"],nextState:"0"}},"^{(...)}|^(-1)":{1:{action_:"^(-1)"}},"-9.,9":{0:{action_:"rm=",nextState:"0"},1:{action_:"^(-1)",nextState:"0"}},"{...}|else":{"*":{action_:"rm=",nextState:"1"}}}),actions:{cdot:function(){return{type_:"tight cdot"}},"^(-1)":function(buffer,m){buffer.rm+="^{"+m+"}"},space:function(){return{type_:"pu-space-2"}},output:function(buffer){let ret=[];if(buffer.rm){const mrm=mhchemParser.patterns.match_("{(...)}",buffer.rm||"");ret=mrm&&""===mrm.remainder?mhchemParser.go(mrm.match_,"pu"):{type_:"rm",p1:buffer.rm}}for(const p in buffer)delete buffer[p];return ret}}},"pu-9,9":{transitions:mhchemParser.createTransitions({empty:{0:{action_:"output-0"},o:{action_:"output-o"}},",":{0:{action_:["output-0","comma"],nextState:"o"}},".":{0:{action_:["output-0","copy"],nextState:"o"}},else:{"*":{action_:"text="}}}),actions:{comma:function(){return{type_:"commaDecimal"}},"output-0":function(buffer){const ret=[];if(buffer.text_=buffer.text_||"",buffer.text_.length>4){let a=buffer.text_.length%3;0===a&&(a=3);for(let i=buffer.text_.length-3;i>0;i-=3)ret.push(buffer.text_.substr(i,3)),ret.push({type_:"1000 separator"});ret.push(buffer.text_.substr(0,a)),ret.reverse()}else ret.push(buffer.text_);for(const p in buffer)delete buffer[p];return ret},"output-o":function(buffer){const ret=[];if(buffer.text_=buffer.text_||"",buffer.text_.length>4){const a=buffer.text_.length-3;for(var i=0;i<a;i+=3)ret.push(buffer.text_.substr(i,3)),ret.push({type_:"1000 separator"});ret.push(buffer.text_.substr(i))}else ret.push(buffer.text_);for(const p in buffer)delete buffer[p];return ret}}}};var texify={go:function(input,isInner){if(!input)return"";let res="",cee=!1;for(let i=0;i<input.length;i++){const inputi=input[i];"string"==typeof inputi?res+=inputi:(res+=texify._go2(inputi),"1st-level escape"===inputi.type_&&(cee=!0))}return isInner||cee||!res||(res="{"+res+"}"),res},_goInner:function(input){return input?texify.go(input,!0):input},_go2:function(buf){let res;switch(buf.type_){case"chemfive":res="";var b5={a:texify._goInner(buf.a),b:texify._goInner(buf.b),p:texify._goInner(buf.p),o:texify._goInner(buf.o),q:texify._goInner(buf.q),d:texify._goInner(buf.d)};b5.a&&(b5.a.match(/^[+\-]/)&&(b5.a="{"+b5.a+"}"),res+=b5.a+"\\,"),(b5.b||b5.p)&&(res+="{\\vphantom{X}}",res+="^{\\hphantom{"+(b5.b||"")+"}}_{\\hphantom{"+(b5.p||"")+"}}",res+="{\\vphantom{X}}",res+="^{\\smash[t]{\\vphantom{2}}\\mathllap{"+(b5.b||"")+"}}",res+="_{\\vphantom{2}\\mathllap{\\smash[t]{"+(b5.p||"")+"}}}"),b5.o&&(b5.o.match(/^[+\-]/)&&(b5.o="{"+b5.o+"}"),res+=b5.o),"kv"===buf.dType?((b5.d||b5.q)&&(res+="{\\vphantom{X}}"),b5.d&&(res+="^{"+b5.d+"}"),b5.q&&(res+="_{\\smash[t]{"+b5.q+"}}")):"oxidation"===buf.dType?(b5.d&&(res+="{\\vphantom{X}}",res+="^{"+b5.d+"}"),b5.q&&(res+="{\\vphantom{X}}",res+="_{\\smash[t]{"+b5.q+"}}")):(b5.q&&(res+="{\\vphantom{X}}",res+="_{\\smash[t]{"+b5.q+"}}"),b5.d&&(res+="{\\vphantom{X}}",res+="^{"+b5.d+"}"));break;case"rm":case"roman numeral":res="\\mathrm{"+buf.p1+"}";break;case"text":buf.p1.match(/[\^_]/)?(buf.p1=buf.p1.replace(" ","~").replace("-","\\text{-}"),res="\\mathrm{"+buf.p1+"}"):res="\\text{"+buf.p1+"}";break;case"state of aggregation":res="\\mskip2mu "+texify._goInner(buf.p1);break;case"state of aggregation subscript":res="\\mskip1mu "+texify._goInner(buf.p1);break;case"bond":if(res=texify._getBond(buf.kind_),!res)throw["MhchemErrorBond","mhchem Error. Unknown bond type ("+buf.kind_+")"];break;case"frac":var c="\\frac{"+buf.p1+"}{"+buf.p2+"}";res="\\mathchoice{\\textstyle"+c+"}{"+c+"}{"+c+"}{"+c+"}";break;case"pu-frac":var d="\\frac{"+texify._goInner(buf.p1)+"}{"+texify._goInner(buf.p2)+"}";res="\\mathchoice{\\textstyle"+d+"}{"+d+"}{"+d+"}{"+d+"}";break;case"tex-math":case"1st-level escape":res=buf.p1+" ";break;case"frac-ce":res="\\frac{"+texify._goInner(buf.p1)+"}{"+texify._goInner(buf.p2)+"}";break;case"overset":res="\\overset{"+texify._goInner(buf.p1)+"}{"+texify._goInner(buf.p2)+"}";break;case"underset":res="\\underset{"+texify._goInner(buf.p1)+"}{"+texify._goInner(buf.p2)+"}";break;case"underbrace":res="\\underbrace{"+texify._goInner(buf.p1)+"}_{"+texify._goInner(buf.p2)+"}";break;case"color":res="{\\color{"+buf.color1+"}{"+texify._goInner(buf.color2)+"}}";break;case"color0":res="\\color{"+buf.color+"}";break;case"arrow":var b6={rd:texify._goInner(buf.rd),rq:texify._goInner(buf.rq)},arrow="\\x"+texify._getArrow(buf.r);b6.rq&&(arrow+="[{"+b6.rq+"}]"),res=arrow+=b6.rd?"{"+b6.rd+"}":"{}";break;case"operator":res=texify._getOperator(buf.kind_);break;case"space":res=" ";break;case"entitySkip":case"pu-space-1":res="~";break;case"pu-space-2":res="\\mkern3mu ";break;case"1000 separator":res="\\mkern2mu ";break;case"commaDecimal":res="{,}";break;case"comma enumeration L":res="{"+buf.p1+"}\\mkern6mu ";break;case"comma enumeration M":res="{"+buf.p1+"}\\mkern3mu ";break;case"comma enumeration S":res="{"+buf.p1+"}\\mkern1mu ";break;case"hyphen":res="\\text{-}";break;case"addition compound":res="\\,{\\cdot}\\,";break;case"electron dot":res="\\mkern1mu \\bullet\\mkern1mu ";break;case"KV x":res="{\\times}";break;case"prime":res="\\prime ";break;case"cdot":res="\\cdot ";break;case"tight cdot":res="\\mkern1mu{\\cdot}\\mkern1mu ";break;case"times":res="\\times ";break;case"circa":res="{\\sim}";break;case"^":res="uparrow";break;case"v":res="downarrow";break;case"ellipsis":res="\\ldots ";break;case"/":res="/";break;case" / ":res="\\,/\\,";break;default:throw["MhchemBugT","mhchem bug T. Please report."]}return res},_getArrow:function(a){switch(a){case"->":case"→":case"⟶":return"rightarrow";case"<-":return"leftarrow";case"<->":return"leftrightarrow";case"<--\x3e":return"rightleftarrows";case"<=>":case"⇌":return"rightleftharpoons";case"<=>>":return"rightequilibrium";case"<<=>":return"leftequilibrium";default:throw["MhchemBugT","mhchem bug T. Please report."]}},_getBond:function(a){switch(a){case"-":case"1":return"{-}";case"=":case"2":return"{=}";case"#":case"3":return"{\\equiv}";case"~":return"{\\tripledash}";case"~-":return"{\\mathrlap{\\raisebox{-.1em}{$-$}}\\raisebox{.1em}{$\\tripledash$}}";case"~=":case"~--":return"{\\mathrlap{\\raisebox{-.2em}{$-$}}\\mathrlap{\\raisebox{.2em}{$\\tripledash$}}-}";case"-~-":return"{\\mathrlap{\\raisebox{-.2em}{$-$}}\\mathrlap{\\raisebox{.2em}{$-$}}\\tripledash}";case"...":return"{{\\cdot}{\\cdot}{\\cdot}}";case"....":return"{{\\cdot}{\\cdot}{\\cdot}{\\cdot}}";case"->":return"{\\rightarrow}";case"<-":return"{\\leftarrow}";case"<":return"{<}";case">":return"{>}";default:throw["MhchemBugT","mhchem bug T. Please report."]}},_getOperator:function(a){switch(a){case"+":return" {}+{} ";case"-":return" {}-{} ";case"=":return" {}={} ";case"<":return" {}<{} ";case">":return" {}>{} ";case"<<":return" {}\\ll{} ";case">>":return" {}\\gg{} ";case"\\pm":return" {}\\pm{} ";case"\\approx":case"$\\approx$":return" {}\\approx{} ";case"v":case"(v)":return" \\downarrow{} ";case"^":case"(^)":return" \\uparrow{} ";default:throw["MhchemBugT","mhchem bug T. Please report."]}}};katex_default().__defineMacro("\\ce",(function(context){return chemParse(context.consumeArgs(1)[0],"ce")})),katex_default().__defineMacro("\\pu",(function(context){return chemParse(context.consumeArgs(1)[0],"pu")})),katex_default().__defineMacro("\\tripledash","{\\vphantom{-}\\raisebox{2.56mu}{$\\mkern2mu\\tiny\\text{-}\\mkern1mu\\text{-}\\mkern1mu\\text{-}\\mkern2mu$}}");var react=__webpack_require__("./node_modules/react/index.js"),index_all=__webpack_require__("./node_modules/underscore/modules/index-all.js"),create_react_class=__webpack_require__("./node_modules/create-react-class/index.js"),create_react_class_default=__webpack_require__.n(create_react_class),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types);function _extends(){return _extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_extends.apply(this,arguments)}const drag_target=create_react_class_default()({displayName:"DragTarget",propTypes:{onDrop:prop_types_default().func.isRequired,component:prop_types_default().any,shouldDragHighlight:prop_types_default().func,style:prop_types_default().any},getDefaultProps:function(){return{component:"div",shouldDragHighlight:()=>!0}},getInitialState:function(){return{dragHover:!1}},handleDrop:function(e){e.stopPropagation(),e.preventDefault(),this.setState({dragHover:!1}),this.props.onDrop(e)},handleDragEnd:function(){this.setState({dragHover:!1})},handleDragOver:function(e){e.preventDefault()},handleDragLeave:function(){this.setState({dragHover:!1})},handleDragEnter:function(e){this.setState({dragHover:this.props.shouldDragHighlight(e)})},render:function(){const opacity=this.state.dragHover?{opacity:.3}:{},Component=this.props.component,forwardProps=Object.assign({},this.props);return delete forwardProps.component,delete forwardProps.shouldDragHighlight,react.createElement(Component,_extends({},forwardProps,{style:Object.assign({},this.props.style,opacity),onDrop:this.handleDrop,onDragEnd:this.handleDragEnd,onDragOver:this.handleDragOver,onDragEnter:this.handleDragEnter,onDragLeave:this.handleDragLeave}))}});var section_control_button=__webpack_require__("./packages/perseus-editor/src/components/section-control-button.tsx");function widget_editor_extends(){return widget_editor_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},widget_editor_extends.apply(this,arguments)}const{InlineIcon}=src.components,{iconChevronDown,iconChevronRight,iconTrash}=src.icons,_upgradeWidgetInfo=props=>{const filteredProps=index_all.ZP.omit(props,src.WJ);return src.Cu.upgradeWidgetInfoToLatestVersion(filteredProps)};class WidgetEditor extends react.Component{constructor(props){super(props),this.state={showWidget:!1,widgetInfo:_upgradeWidgetInfo(props)},this.widget=react.createRef()}UNSAFE_componentWillReceiveProps(nextProps){this.setState({widgetInfo:_upgradeWidgetInfo(nextProps)})}_toggleWidget=e=>{e.preventDefault(),this.setState({showWidget:!this.state.showWidget})};_handleWidgetChange=(newProps,cb,silent)=>{const newWidgetInfo={...this.state.widgetInfo,options:{...this.state.widgetInfo.options,...this.widget.current?.serialize()??{},...newProps}};this.props.onChange(newWidgetInfo,cb,silent)};_toggleStatic=e=>{e.preventDefault();const newWidgetInfo=Object.assign({},this.state.widgetInfo,{static:!this.state.widgetInfo.static});this.props.onChange(newWidgetInfo)};_handleAlignmentChange=e=>{const newAlignment=e.currentTarget.value,newWidgetInfo=Object.assign({},this.state.widgetInfo);newWidgetInfo.alignment=newAlignment,this.props.onChange(newWidgetInfo)};getSaveWarnings=()=>{const issuesFunc=this.widget.current?.getSaveWarnings;return issuesFunc?issuesFunc():[]};serialize=()=>{const widgetInfo=this.state.widgetInfo;return{type:widgetInfo.type,alignment:widgetInfo.alignment,static:widgetInfo.static,graded:widgetInfo.graded,options:this.widget.current.serialize(),version:widgetInfo.version}};render(){const widgetInfo=this.state.widgetInfo,Ed=src.Cu.getEditor(widgetInfo.type);let supportedAlignments;supportedAlignments=this.props.apiOptions.showAlignmentOptions?src.Cu.getSupportedAlignments(widgetInfo.type):["default"];const supportsStaticMode=src.Cu.supportsStaticMode(widgetInfo.type);return react.createElement("div",{className:"perseus-widget-editor"},react.createElement("div",{className:"perseus-widget-editor-title "+(this.state.showWidget?"open":"closed")},react.createElement("a",{className:"perseus-widget-editor-title-id",href:"#",onClick:this._toggleWidget},this.props.id,this.state.showWidget?react.createElement(InlineIcon,iconChevronDown):react.createElement(InlineIcon,iconChevronRight)),supportsStaticMode&&react.createElement("input",{type:"button",onClick:this._toggleStatic,className:"simple-button--small",value:widgetInfo.static?"Unset as static":"Set as static"}),supportedAlignments.length>1&&react.createElement("select",{className:"alignment",value:widgetInfo.alignment,onChange:this._handleAlignmentChange},supportedAlignments.map((alignment=>react.createElement("option",{key:alignment},alignment)))),react.createElement(section_control_button.Z,{icon:iconTrash,onClick:()=>{this.props.onRemove()},title:"Remove image widget"})),react.createElement("div",{className:"perseus-widget-editor-content "+(this.state.showWidget?"enter":"leave")},Ed&&react.createElement(Ed,widget_editor_extends({ref:this.widget,onChange:this._handleWidgetChange,static:widgetInfo.static,apiOptions:this.props.apiOptions},widgetInfo.options))))}}const widget_editor=WidgetEditor;try{WidgetEditor.displayName="WidgetEditor",WidgetEditor.__docgenInfo={description:"",displayName:"WidgetEditor",props:{id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(widgetInfo: PerseusWidget, cb?: (() => unknown) | undefined, silent?: boolean | undefined) => unknown"}},onRemove:{defaultValue:null,description:"",name:"onRemove",required:!0,type:{name:"() => unknown"}},apiOptions:{defaultValue:null,description:"",name:"apiOptions",required:!0,type:{name:"any"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"radio"'},{value:'"categorizer"'},{value:'"cs-program"'},{value:'"definition"'},{value:'"dropdown"'},{value:'"example-graphie-widget"'},{value:'"example-widget"'},{value:'"explanation"'},{value:'"expression"'},{value:'"graded-group-set"'},{value:'"graded-group"'},{value:'"grapher"'},{value:'"group"'},{value:'"iframe"'},{value:'"image"'},{value:'"input-number"'},{value:'"interaction"'},{value:'"interactive-graph"'},{value:'"label-image"'},{value:'"lights-puzzle"'},{value:'"matcher"'},{value:'"matrix"'},{value:'"measurer"'},{value:'"molecule-renderer"'},{value:'"number-line"'},{value:'"numeric-input"'},{value:'"orderer"'},{value:'"passage-ref"'},{value:'"passage"'},{value:'"plotter"'},{value:'"python-program"'},{value:'"reaction-diagtram"'},{value:'"passage-ref-target"'},{value:'"sequence"'},{value:'"simple-markdown-tester"'},{value:'"simulator"'},{value:'"sorter"'},{value:'"table"'},{value:'"unit-input"'},{value:'"video"'},{value:'"deprecated-standin"'}]}},static:{defaultValue:null,description:"",name:"static",required:!1,type:{name:"boolean"}},graded:{defaultValue:null,description:"",name:"graded",required:!1,type:{name:"boolean"}},alignment:{defaultValue:null,description:"",name:"alignment",required:!1,type:{name:"string"}},options:{defaultValue:null,description:"",name:"options",required:!0,type:{name:"any"}},key:{defaultValue:null,description:"",name:"key",required:!1,type:{name:"number"}},version:{defaultValue:null,description:"",name:"version",required:!1,type:{name:"Version"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/perseus-editor/src/components/widget-editor.tsx#WidgetEditor"]={docgenInfo:WidgetEditor.__docgenInfo,name:"WidgetEditor",path:"packages/perseus-editor/src/components/widget-editor.tsx#WidgetEditor"})}catch(__react_docgen_typescript_loader_error){}class WidgetSelect extends react.Component{shouldComponentUpdate(){return!1}handleChange=e=>{const widgetType=e.currentTarget.value;""!==widgetType&&this.props.onChange&&this.props.onChange(widgetType)};render(){const widgets=src.Cu.getPublicWidgets(),orderedWidgetNames=index_all.ZP.sortBy(index_all.ZP.keys(widgets),(name=>widgets[name].displayName));return react.createElement("select",{value:"",onChange:this.handleChange},react.createElement("option",{value:""},"Add a widget…"),react.createElement("option",{disabled:!0},"--"),index_all.ZP.map(orderedWidgetNames,(name=>react.createElement("option",{key:name,value:name},widgets[name].displayName))))}}const widget_select=WidgetSelect;try{WidgetSelect.displayName="WidgetSelect",WidgetSelect.__docgenInfo={description:"",displayName:"WidgetSelect",props:{onChange:{defaultValue:null,description:"",name:"onChange",required:!1,type:{name:"((widgetType: string) => unknown)"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/perseus-editor/src/components/widget-select.tsx#WidgetSelect"]={docgenInfo:WidgetSelect.__docgenInfo,name:"WidgetSelect",path:"packages/perseus-editor/src/components/widget-select.tsx#WidgetSelect"})}catch(__react_docgen_typescript_loader_error){}var tex_error_view=__webpack_require__("./packages/perseus-editor/src/tex-error-view.tsx");function editor_extends(){return editor_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},editor_extends.apply(this,arguments)}const rWidgetSplit=new RegExp("(\\[\\[☃ {id}\\]\\])".replace("{id}","[a-z-]+ [0-9]+"),"g"),shortcutRegexp=/^\[\[([a-z-]+)$/,ENDS_WITH_A_PARAGRAPH=/(?:\n{2,}|^\n*)$/,TRAILING_NEWLINES=/(\n*)$/,LEADING_NEWLINES=/^(\n*)/,commafyInteger=n=>{let str=n.toString();return str.length>=5&&(str=str.replace(/(\d)(?=(\d{3})+$)/g,"$1{,}")),str},IMAGE_REGEX=/!\[[^\]]*\]\(([^\s)]+)[^)]*\)/g;class Editor extends react.Component{underlay=react.createRef();textarea=react.createRef();static defaultProps={content:"",placeholder:"",widgets:{},images:{},disabled:!1,widgetEnabled:!0,immutableWidgets:!1,showWordCount:!1,warnNoPrompt:!1,warnNoWidgets:!1};state={textAreaValue:this.props.content};componentDidMount(){this.lastUserValue=null,this._sizeImages(this.props),jquery_default()(this.textarea.current).on("copy cut",this._maybeCopyWidgets).on("paste",this._maybePasteWidgets)}UNSAFE_componentWillReceiveProps(nextProps){this.props.content!==nextProps.content&&this.setState({textAreaValue:nextProps.content})}componentDidUpdate(prevProps){const textarea=this.textarea.current;null!=this.lastUserValue&&textarea&&(textarea.focus(),textarea.value=this.lastUserValue,textarea.selectionStart=0,textarea.setSelectionRange(0,prevProps.content.length),!1===document.execCommand("insertText",!1,this.props.content)&&(textarea.value=this.props.content),this.lastUserValue=null),this.props.content!==prevProps.content&&this._sizeImages(this.props)}componentWillUnmount(){clearTimeout(this.deferredChange)}getWidgetEditor(id,type){if(src.Cu.getEditor(type))return react.createElement(widget_editor,editor_extends({ref:id,id,onChange:this._handleWidgetEditorChange.bind(this,id),onRemove:this._handleWidgetEditorRemove.bind(this,id),apiOptions:this.props.apiOptions},this.props.widgets[id]))}_handleWidgetEditorChange=(id,newWidgetInfo,cb,silent)=>{const widgets=Object.assign({},this.props.widgets);widgets[id]=Object.assign({},widgets[id],newWidgetInfo),this.props.onChange({widgets},cb,silent)};_handleWidgetEditorRemove=id=>{if(!confirm("Are you sure you want to delete this item?"))return;const textarea=this.textarea.current,re=new RegExp("(\\[\\[☃ {id}\\]\\])".replace("{id}",id),"gm");this.props.onChange({content:textarea?.value.replace(re,"")})};_sizeImages=props=>{const imageUrls=(content=props.content,function(regex,str){const result=[];for(;;){const match=regex.exec(str);if(!match)break;result.push(match)}return result}(IMAGE_REGEX,content).map((capture=>capture[1])));var content;const images=index_all.ZP.pick(props.images,imageUrls),newImageUrls=index_all.ZP.filter(imageUrls,(url=>!images[url]));index_all.ZP.each(newImageUrls,(url=>{src.Util.getImageSize(url,((width,height)=>{images[url]={width,height},props.onChange({images:index_all.ZP.clone(images)},null,!0)}))}))};handleDrop=e=>{const{imageUploader}=this.props;let content=this.state.textAreaValue||"";const dataTransfer=e.dataTransfer;if(!dataTransfer||!imageUploader)return;const files=dataTransfer.files;if(0===files.length){const imageUrl=dataTransfer.getData("URL");if(imageUrl){const newContent=content+"\n\n![]("+imageUrl+")";this.lastUserValue=this.props.content,this.props.onChange({content:newContent})}return}const origContent=this.state.textAreaValue;(0,index_all.ZP)(files).chain().map((function(file){if(!file.type.match("image.*"))return null;const sentinel="☃ "+index_all.ZP.uniqueId("image_");return content+="\n\n![]("+sentinel+")",{file,sentinel}})).reject(index_all.ZP.isNull).tap((()=>{this.lastUserValue=origContent,this.props.onChange({content})})).each((fileAndSentinel=>{imageUploader(fileAndSentinel.file,(url=>{this.lastUserValue=origContent,this.props.onChange({content:this.state.textAreaValue.replace(fileAndSentinel.sentinel,url)})}))}))};handleChange=e=>{clearTimeout(this.deferredChange),this.setState({textAreaValue:e.currentTarget.value}),this.deferredChange=setTimeout((()=>{this.state.textAreaValue!==this.props.content&&this.props.onChange({content:this.state.textAreaValue})}),this.props.apiOptions.editorChangeDelay)};_handleKeyDown=e=>{if(e.stopPropagation(),"Tab"===e.key){const textarea=this.textarea.current,word=src.Util.textarea.getWordBeforeCursor(textarea),matches=word.string.toLowerCase().match(shortcutRegexp);if(null!=matches){const text=matches[1],widgets=src.Cu.getAllWidgetTypes(),matchingWidgets=index_all.ZP.filter(widgets,(name=>name.substring(0,text.length)===text));if(1===matchingWidgets.length){const widgetType=matchingWidgets[0];this._addWidgetToContent(this.props.content,[word.pos.start,word.pos.end+1],widgetType)}e.preventDefault()}}};_maybeCopyWidgets=e=>{const textarea=e.currentTarget,selectedText=textarea.value.substring(textarea.selectionStart,textarea.selectionEnd),widgetNames=index_all.ZP.map(selectedText.match(rWidgetSplit),(syntax=>src.Util.rWidgetParts.exec(syntax)[1])),widgetData=index_all.ZP.pick(this.serialize().widgets,widgetNames);localStorage.perseusLastCopiedText=selectedText,localStorage.perseusLastCopiedWidgets=JSON.stringify(widgetData),src.Zb.log(`Widgets copied: ${localStorage.perseusLastCopiedWidgets}`)};_maybePasteWidgets=e=>{const widgetJSON=localStorage.perseusLastCopiedWidgets,lastCopiedText=localStorage.perseusLastCopiedText,textToBePasted=e.originalEvent.clipboardData.getData("text");if(widgetJSON&&lastCopiedText===textToBePasted){e.preventDefault();const widgetData=JSON.parse(widgetJSON),safeWidgetMapping=this._safeWidgetNameMapping(widgetData),safeWidgetData={};for(const[key,data]of Object.entries(widgetData))safeWidgetData[safeWidgetMapping[key]]=data;const newWidgets=index_all.ZP.extend(safeWidgetData,this.props.widgets),safeText=lastCopiedText.replace(rWidgetSplit,(syntax=>{const match=src.Util.rWidgetParts.exec(syntax),completeWidget=match[0],widget=match[1];return completeWidget.replace(widget,safeWidgetMapping[widget])})),textarea=e.currentTarget,selectionStart=textarea.selectionStart,newContent=this.state.textAreaValue.substr(0,selectionStart)+safeText+this.state.textAreaValue.substr(textarea.selectionEnd);this.lastUserValue=this.state.textAreaValue,this.props.onChange({content:newContent,widgets:newWidgets},(()=>{const expectedCursorPosition=selectionStart+safeText.length;src.Util.textarea.moveCursor(textarea,expectedCursorPosition)}))}};_safeWidgetNameMapping=widgetData=>{const widgets=index_all.ZP.keys(widgetData).map((name=>name.split(" "))),widgetTypes=index_all.ZP.uniq(widgets.map((widget=>widget[0]))),existingWidgets=index_all.ZP.keys(this.props.widgets).map((name=>name.split(" "))),safeWidgetNums={};index_all.ZP.each(widgetTypes,(type=>{safeWidgetNums[type]=index_all.ZP.chain(existingWidgets).filter((existingWidget=>existingWidget[0]===type)).map((existingWidget=>+existingWidget[1]+1)).max().value(),safeWidgetNums[type]=Math.max(safeWidgetNums[type],1)}));const safeWidgetMapping={};return index_all.ZP.each(widgets,(widget=>{const widgetName=widget.join(" "),widgetType=widget[0];safeWidgetMapping[widgetName]=`${widgetType} ${safeWidgetNums[widgetType]}`,safeWidgetNums[widgetType]++})),safeWidgetMapping};_addWidgetToContent=(oldContent,cursorRange,widgetType)=>{const allWidgetIds=index_all.ZP.map(oldContent.match(rWidgetSplit),(syntax=>{const match=src.Util.rWidgetParts.exec(syntax);return[match[2],+match[3]]})),widgetNum=index_all.ZP.reduce(allWidgetIds,((currentNum,otherId)=>{const[otherType,otherNum]=otherId;return otherType===widgetType?Math.max(otherNum+1,currentNum):currentNum}),1),id=widgetType+" "+widgetNum,widgetContent="[[☃ {id}]]".replace("{id}",id),isBlock="block"===src.Cu.getDefaultAlignment(widgetType),prelude=oldContent.slice(0,cursorRange[0]),postlude=oldContent.slice(cursorRange[1]),newContent=(isBlock?(content=>{if(!ENDS_WITH_A_PARAGRAPH.test(content)){const match=TRAILING_NEWLINES.exec(content);if(match){const newlines=match[1];return content+"\n\n".slice(0,2-newlines.length)}}return content})(prelude):prelude)+widgetContent+(isBlock?(content=>{const match=LEADING_NEWLINES.exec(content);if(!match)return content;const newlines=match[1];return"\n\n".slice(0,2-newlines.length)+content})(postlude):postlude),newWidgets=index_all.ZP.clone(this.props.widgets);newWidgets[id]={options:src.Cu.getEditor(widgetType)?.defaultProps,type:widgetType,version:src.Cu.getVersion(widgetType)},this.lastUserValue=this.props.content,this.props.onChange({content:newContent,widgets:newWidgets},(()=>{this.textarea.current&&src.Util.textarea.moveCursor(this.textarea.current,newContent.length-postlude.length)}))};_addWidget=widgetType=>{const textarea=this.textarea.current;textarea&&(this._addWidgetToContent(this.props.content,[textarea.selectionStart,textarea.selectionEnd],widgetType),textarea.focus())};addTemplate=e=>{const templateType=e.currentTarget.value;if(""===templateType)return;e.currentTarget.value="";let template,oldContent=this.props.content;if(oldContent=oldContent.replace(/\n*$/,"\n\n"),"table"===templateType)template="header 1 | header 2 | header 3\n- | - | -\ndata 1 | data 2 | data 3\ndata 4 | data 5 | data 6\ndata 7 | data 8 | data 9";else if("titledTable"===templateType)template="|| **Table title** ||\nheader 1 | header 2 | header 3\n- | - | -\ndata 1 | data 2 | data 3\ndata 4 | data 5 | data 6\ndata 7 | data 8 | data 9";else if("alignment"===templateType)template="$\\begin{align} x+5 &= 30 \\\\\nx+5-5 &= 30-5 \\\\\nx &= 25 \\end{align}$";else if("piecewise"===templateType)template="$f(x) = \\begin{cases}\n7 & \\text{if }x=1 \\\\\nf(x-1)+5 & \\text{if }x > 1\n\\end{cases}$";else{if("allWidgets"!==templateType)throw new src.uI("Invalid template type: "+templateType,src.D1.InvalidInput,{metadata:{templateType}});template=src.Cu.getAllWidgetTypes().map((type=>`[[${src.Util.snowman} ${type} 1]]`)).join("\n\n")}const newContent=oldContent+template;this.lastUserValue=this.props.content,this.props.onChange({content:newContent},this.focusAndMoveToEnd)};getSaveWarnings=()=>{const widgetIds=index_all.ZP.intersection(this.widgetIds,index_all.ZP.keys(this.refs));return(0,index_all.ZP)(widgetIds).chain().map((id=>{const issuesFunc=this.refs[id].getSaveWarnings,issues=issuesFunc?issuesFunc():[];return index_all.ZP.map(issues,(issue=>id+": "+issue))})).flatten(!0).value()};focus=()=>{const textarea=this.textarea.current;textarea&&textarea.focus()};focusAndMoveToEnd=()=>{this.focus();const textarea=this.textarea.current;textarea&&(textarea.selectionStart=textarea.value.length,textarea.selectionEnd=textarea.value.length)};serialize=options=>{const widgets={},widgetIds=index_all.ZP.intersection(this.widgetIds,index_all.ZP.keys(this.refs));return index_all.ZP.each(widgetIds,(id=>{widgets[id]=this.refs[id].serialize()})),options&&options.keepDeletedWidgets&&index_all.ZP.chain(this.props.widgets).keys().reject((id=>index_all.ZP.contains(widgetIds,id))).each((id=>{widgets[id]=this.props.widgets[id]})),{replace:this.props.replace,content:this.props.content,images:this.props.images,widgets}};render(){let pieces,widgets,underlayPieces,widgetsDropDown,templatesDropDown,widgetsAndTemplates,wordCountDisplay;const katexErrorList=[];if(this.props.showWordCount){const numChars=src.ZU.characterCount(this.props.content),numWords=Math.floor(numChars/6);wordCountDisplay=react.createElement("span",{className:"perseus-editor-word-count",title:"~"+commafyInteger(numWords)+" words ("+commafyInteger(numChars)+" characters)"},commafyInteger(numWords))}if(this.props.widgetEnabled){pieces=src.Util.split(this.props.content,rWidgetSplit),widgets={},underlayPieces=[];for(let i=0;i<pieces.length;i++)if(i%2==0){underlayPieces.push(pieces[i]);const ast=src.ZU.parse(pieces[i]);src.ZU.traverseContent(ast,(node=>{if("math"===node.type||"blockMath"===node.type){const content=(0,src.F9)(node.content);try{katex_default().renderToString(content,{colorIsTextColor:!0})}catch(e){katexErrorList.push({math:content,message:e.message})}}}))}else{const match=src.Util.rWidgetParts.exec(pieces[i]);if(null!=match){const id=match[1],type=match[2],selected=!1,duplicate=id in widgets;widgets[id]=this.getWidgetEditor(id,type);const classes=(duplicate||!widgets[id]?"error ":"")+(selected?"selected ":""),key=duplicate?i:id;underlayPieces.push(react.createElement("b",{className:classes,key},pieces[i]))}}this.widgetIds=index_all.ZP.keys(widgets),widgetsDropDown=react.createElement(widget_select,{onChange:this._addWidget});const insertTemplateString="Insert template…";if(templatesDropDown=react.createElement("select",{onChange:this.addTemplate},react.createElement("option",{value:""},insertTemplateString),react.createElement("option",{disabled:!0},"--"),react.createElement("option",{value:"table"},"Table"),react.createElement("option",{value:"titledTable"},"Titled table"),react.createElement("option",{value:"alignment"},"Aligned equations"),react.createElement("option",{value:"piecewise"},"Piecewise function"),react.createElement("option",{disabled:!0},"--"),react.createElement("option",{value:"allWidgets"},"All widgets (for testing)")),!this.props.immutableWidgets){const widgetNodes=Object.values(widgets);widgetsAndTemplates=react.createElement("div",{className:"perseus-editor-widgets"},react.createElement("div",{className:"perseus-editor-widgets-selectors"},widgetsDropDown,templatesDropDown,wordCountDisplay),widgetNodes),wordCountDisplay=null}}else underlayPieces=[this.props.content];underlayPieces.push(react.createElement("br",{key:"end"}));const completeTextarea=[react.createElement("div",{className:"perseus-textarea-underlay",ref:this.underlay,key:"underlay"},underlayPieces),react.createElement("textarea",{ref:this.textarea,key:"textarea",onChange:this.handleChange,onKeyDown:this._handleKeyDown,placeholder:this.props.placeholder,disabled:this.props.disabled,value:this.state.textAreaValue})];let textareaWrapper;textareaWrapper=this.props.imageUploader?react.createElement(drag_target,{onDrop:this.handleDrop,className:"perseus-textarea-pair"},completeTextarea):react.createElement("div",{className:"perseus-textarea-pair"},completeTextarea);const noPrompt=0===this.props.content.replace(/\[\[\u2603 (([a-z-]+) ([0-9]+))\]\]/g,"").trim().length,noWidgets=!/\[\[\u2603 (([a-z-]+) ([0-9]+))\]\]/g.test(this.props.content),warningStyle={borderTop:"none",padding:4,backgroundColor:"pink"};return react.createElement("div",{className:"perseus-single-editor "+(this.props.className||"")},textareaWrapper,katexErrorList.length>0&&react.createElement(tex_error_view.Z,{errorList:katexErrorList}),this.props.warnNoPrompt&&noPrompt&&react.createElement("div",{style:warningStyle},"Graded Groups should contain a prompt"),this.props.warnNoWidgets&&noWidgets&&react.createElement("div",{style:warningStyle},"Graded Groups should contain at least one widget"),wordCountDisplay,widgetsAndTemplates)}}const editor=Editor;try{Editor.displayName="Editor",Editor.__docgenInfo={description:"",displayName:"Editor",props:{apiOptions:{defaultValue:null,description:"",name:"apiOptions",required:!0,type:{name:"any"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},content:{defaultValue:{value:""},description:"",name:"content",required:!1,type:{name:"string"}},replace:{defaultValue:null,description:"",name:"replace",required:!1,type:{name:"any"}},placeholder:{defaultValue:{value:""},description:"",name:"placeholder",required:!1,type:{name:"string"}},widgets:{defaultValue:{value:"{}"},description:"",name:"widgets",required:!1,type:{name:"{ [name: string]: PerseusWidget; }"}},images:{defaultValue:{value:"{}"},description:"",name:"images",required:!1,type:{name:"any"}},disabled:{defaultValue:{value:"false"},description:"",name:"disabled",required:!1,type:{name:"boolean"}},widgetEnabled:{defaultValue:{value:"true"},description:"",name:"widgetEnabled",required:!1,type:{name:"boolean"}},immutableWidgets:{defaultValue:{value:"false"},description:"",name:"immutableWidgets",required:!1,type:{name:"boolean"}},showWordCount:{defaultValue:{value:"false"},description:"",name:"showWordCount",required:!1,type:{name:"boolean"}},warnNoPrompt:{defaultValue:{value:"false"},description:"",name:"warnNoPrompt",required:!1,type:{name:"boolean"}},warnNoWidgets:{defaultValue:{value:"false"},description:"",name:"warnNoWidgets",required:!1,type:{name:"boolean"}},imageUploader:{defaultValue:null,description:"",name:"imageUploader",required:!1,type:{name:"((file: string, callback: (url: string) => unknown) => unknown)"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"ChangeHandler"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/perseus-editor/src/editor.tsx#Editor"]={docgenInfo:Editor.__docgenInfo,name:"Editor",path:"packages/perseus-editor/src/editor.tsx#Editor"})}catch(__react_docgen_typescript_loader_error){}},"./packages/perseus-editor/src/tex-error-view.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _khanacademy_wonder_blocks_core__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@khanacademy/wonder-blocks-core/dist/es/index.js"),_khanacademy_wonder_blocks_icon__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@khanacademy/wonder-blocks-icon/dist/es/index.js"),_phosphor_icons_core_bold_caret_right_bold_svg__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@phosphor-icons/core/assets/bold/caret-right-bold.svg"),aphrodite__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/aphrodite/lib/index.js"),react__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/react/index.js");class TexErrorView extends react__WEBPACK_IMPORTED_MODULE_4__.Component{state={showErrors:!1};handleToggleTexErrors=e=>{this.setState({showErrors:!this.state.showErrors})};render(){const{errorList}=this.props,{showErrors}=this.state,iconStyle=showErrors?styles.iconExpanded:styles.iconCollapsed;return react__WEBPACK_IMPORTED_MODULE_4__.createElement(_khanacademy_wonder_blocks_core__WEBPACK_IMPORTED_MODULE_0__.G7,{style:styles.errorContainer},react__WEBPACK_IMPORTED_MODULE_4__.createElement(_khanacademy_wonder_blocks_core__WEBPACK_IMPORTED_MODULE_0__.G7,{style:styles.title,onClick:this.handleToggleTexErrors},react__WEBPACK_IMPORTED_MODULE_4__.createElement(_khanacademy_wonder_blocks_icon__WEBPACK_IMPORTED_MODULE_1__.H,{icon:_phosphor_icons_core_bold_caret_right_bold_svg__WEBPACK_IMPORTED_MODULE_2__,style:iconStyle}),"  TeX Errors (",errorList.length,")"),showErrors&&react__WEBPACK_IMPORTED_MODULE_4__.createElement(_khanacademy_wonder_blocks_core__WEBPACK_IMPORTED_MODULE_0__.G7,{style:styles.errorExplanation},"If your math doesn't display correctly, these errors might help you troubleshoot. Message #content-kitchen for help."),showErrors&&errorList.map(((e,index)=>react__WEBPACK_IMPORTED_MODULE_4__.createElement(_khanacademy_wonder_blocks_core__WEBPACK_IMPORTED_MODULE_0__.G7,{style:styles.error,key:index},react__WEBPACK_IMPORTED_MODULE_4__.createElement(_khanacademy_wonder_blocks_core__WEBPACK_IMPORTED_MODULE_0__.G7,{style:{color:"red"}},e.math),react__WEBPACK_IMPORTED_MODULE_4__.createElement(_khanacademy_wonder_blocks_core__WEBPACK_IMPORTED_MODULE_0__.G7,null,e.message)))))}}const styles=aphrodite__WEBPACK_IMPORTED_MODULE_3__.StyleSheet.create({title:{backgroundColor:"#eee",fontSize:"1.25em",padding:"4px 10px",cursor:"pointer",display:"flex",flexDirection:"row",alignItems:"center"},errorContainer:{border:"1px solid #ddd",borderTop:"none"},errorExplanation:{padding:"4px 10px",backgroundColor:"pink"},error:{padding:"4px 10px"},iconCollapsed:{transition:".15s"},iconExpanded:{transform:"rotate(90deg)",transition:".15s"}}),__WEBPACK_DEFAULT_EXPORT__=TexErrorView;try{TexErrorView.displayName="TexErrorView",TexErrorView.__docgenInfo={description:"Displays a collapsable list of TeX rendering errors.",displayName:"TexErrorView",props:{errorList:{defaultValue:null,description:"",name:"errorList",required:!0,type:{name:"readonly { math: string; message: string; }[]"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/perseus-editor/src/tex-error-view.tsx#TexErrorView"]={docgenInfo:TexErrorView.__docgenInfo,name:"TexErrorView",path:"packages/perseus-editor/src/tex-error-view.tsx#TexErrorView"})}catch(__react_docgen_typescript_loader_error){}}}]);