import{a as ne}from"./version-akiLXZts.js";import{j as t,a as d}from"./jsx-runtime-5BUNAZ9W.js";import"./article-renderer-DMHSBl4b.js";import{_ as h}from"./index-default-4_ZsnO94.js";import"./util-hMu2nkBL.js";import{l as y}from"./unit-K_dyJfvU.js";import{P as z,E as V}from"./perseus-error-l3K_anoI.js";import"./dependencies-9B_Bv_mA.js";import{A as M}from"./perseus-api-7QXTiCE7.js";import{e as re,d as se}from"./multi-renderer-oODAFcAt.js";import"./hints-renderer-PPNjwn4r.js";import{i as ae,r as oe,a as ie,j as le}from"./renderer-rxpuJFu7.js";import"./base-radio-X-6wm8EV.js";import{c as J}from"./components-QksBwORD.js";import{I as $}from"./icon-paths-AuJwhOz7.js";import"./jquery-5v7aFUvu.js";import"./index-0C4KXdeC.js";import"./i18n-context-3gTlIcWM.js";import{r as v}from"./index-4g5l5LRQ.js";import{D as ce}from"./device-framer-AF8TDclz.js";import{I as de,J as G,H as pe,E as me,A as ue,a as he}from"./editor-page-uSeyg2Ne.js";import{S as P}from"./section-control-button-F262CvAm.js";import{E as K}from"./editor-QqqAMgqP.js";import"./viewport-resizer-ACG-ndQW.js";import{P as p}from"./index-k-0mNqHS.js";import{R as L,W as fe}from"./structured-item-diff-Q3g469kj.js";import"./button-group-KR3umc1e.js";import"./graph-xM0PpZck.js";import"./svg-image-sHK76CH4.js";import"./hud-CJYktPgf.js";import"./icon-TA3bBVIW.js";import"./info-tip-Xz6DLOQD.js";import"./inline-icon-QIU9thzn.js";import"./math-input-Ex6ZAAWO.js";import"./multi-button-group-AxfQn4Cq.js";import"./number-input-o7tSxJdU.js";import{c as Q}from"./prop-check-box--BUCUZsG.js";import"./range-input-sSz5zlV8.js";import"./text-input-Q1V0RBx1.js";import"./text-list-editor-vhSOgXmq.js";import{M as ye}from"./multi-items-C9Mn1B1A.js";import{l}from"./index-awljIyHI.js";import{R as ge}from"./index-jmm5gWkb.js";/* empty css                       */const ve="@khanacademy/perseus-editor",we="__lib_version__";ne(ve,we);const{HUD:Ce,InlineIcon:be}=J,{iconCircleArrowDown:ke,iconCircleArrowUp:Re,iconPlus:W,iconTrash:Se}=$,H=class H extends v.Component{constructor(){super(...arguments),this.state={highlightLint:!0},this._handleJsonChange=e=>{this.props.onChange({json:e})},this._handleEditorChange=(e,n)=>{const r=h.clone(this._sections());r[e]=h.extend({},r[e],n),this.props.onChange({json:r})}}componentDidMount(){this._updatePreviewFrames()}componentDidUpdate(){this._updatePreviewFrames()}_updatePreviewFrames(){this.props.mode==="preview"?this.refs["frame-all"].sendNewData({type:"article-all",data:this._sections().map((e,n)=>this._apiOptionsForSection(e,n))}):this.props.mode==="edit"&&this._sections().forEach((e,n)=>{this.refs["frame-"+n].sendNewData({type:"article",data:this._apiOptionsForSection(e,n)})})}_apiOptionsForSection(e,n){const r=this.refs[`editor${n}`];return{apiOptions:{...M.defaults,...this.props.apiOptions,showAlignmentOptions:!0,isArticle:!0},json:e,useNewStyles:this.props.useNewStyles,linterContext:{contentType:"article",highlightLint:this.state.highlightLint,paths:this.props.contentPaths},legacyPerseusLint:r?r.getSaveWarnings():[]}}_sections(){return Array.isArray(this.props.json)?this.props.json:[this.props.json]}_renderEditor(){const{imageUploader:e,sectionImageUploadGenerator:n}=this.props,r={...M.defaults,...this.props.apiOptions,showAlignmentOptions:!0,isArticle:!0},a=this._sections();return d("div",{className:"perseus-editor-table",children:[a.map((c,o)=>[d("div",{className:"perseus-editor-row",children:[d("div",{className:"perseus-editor-left-cell",children:[d("div",{className:"pod-title",children:["Section ",o+1,d("div",{style:{display:"inline-block",float:"right"},children:[n(o),t(P,{icon:W,onClick:()=>{this._handleAddSectionAfter(o)},title:"Add a new section after this one"}),o+1<a.length&&t(P,{icon:ke,onClick:()=>{this._handleMoveSectionLater(o)},title:"Move this section down"}),o>0&&t(P,{icon:Re,onClick:()=>{this._handleMoveSectionEarlier(o)},title:"Move this section up"}),t(P,{icon:Se,onClick:()=>{const m="Are you sure you want to delete section "+(o+1)+"?";confirm(m)&&this._handleRemoveSection(o)},title:"Delete this section"})]})]}),t(K,{...c,apiOptions:r,imageUploader:e,onChange:h.partial(this._handleEditorChange,o),placeholder:"Type your section text here...",ref:"editor"+o})]}),t("div",{className:"editor-preview",children:this._renderIframePreview(o,!0)})]},o)]),this._renderAddSection(),this._renderLinterHUD()]})}_renderAddSection(){return t("div",{className:"perseus-editor-row",children:t("div",{className:"perseus-editor-left-cell",children:d("a",{href:"#",className:"simple-button orange",onClick:()=>{this._handleAddSectionAfter(this._sections().length-1)},children:[t(be,{...W})," Add a section"]})})})}_renderLinterHUD(){return t(Ce,{message:"Style warnings",enabled:this.state.highlightLint,onClick:()=>{this.setState({highlightLint:!this.state.highlightLint})}})}_renderIframePreview(e,n){const r=this.props.screen==="phone"||this.props.screen==="tablet";return t(ce,{deviceType:this.props.screen,nochrome:n,children:t(de,{ref:"frame-"+e,datasetKey:"mobile",datasetValue:r,seamless:n,url:this.props.previewURL},this.props.screen)})}_renderPreviewMode(){return t("div",{className:"standalone-preview",children:this._renderIframePreview("all",!1)})}_handleMoveSectionEarlier(e){if(e===0)return;const n=h.clone(this._sections()),r=n[e];n.splice(e,1),n.splice(e-1,0,r),this.props.onChange({json:n})}_handleMoveSectionLater(e){const n=h.clone(this._sections());if(e+1===n.length)return;const r=n[e];n.splice(e,1),n.splice(e+1,0,r),this.props.onChange({json:n})}_handleAddSectionAfter(e){const n=h.clone(this.serialize()),r=e>=0?{widgets:n[e].widgets}:{};n.splice(e+1,0,r),this.props.onChange({json:n})}_handleRemoveSection(e){const n=h.clone(this._sections());n.splice(e,1),this.props.onChange({json:n})}serialize(){if(this.props.mode==="edit")return this._sections().map((e,n)=>this.refs["editor"+n].serialize());if(this.props.mode==="preview"||this.props.mode==="json")return this.props.json;throw new z("Could not serialize; mode "+this.props.mode+" not found",V.Internal)}getSaveWarnings(){if(this.props.mode!=="edit")throw new z("Can only get save warnings in edit mode.",V.NotAllowed);return this._sections().map((e,n)=>this.refs["editor"+n].getSaveWarnings())}render(){return d("div",{className:"framework-perseus perseus-article-editor",children:[this.props.mode==="edit"&&this._renderEditor(),this.props.mode==="preview"&&this._renderPreviewMode(),this.props.mode==="json"&&d("div",{className:"json-editor",children:[t("div",{className:"json-editor-warning",children:t("span",{children:"Warning: Editing in this mode can lead to broken articles!"})}),t(G,{multiLine:!0,onChange:this._handleJsonChange,value:this.props.json})]})]})}};H.defaultProps={contentPaths:[],json:[{}],mode:"edit",screen:"desktop",sectionImageUploadGenerator:()=>t("span",{}),useNewStyles:!1};let N=H;N.__docgenInfo={description:"",methods:[{name:"_updatePreviewFrames",docblock:null,modifiers:[],params:[],returns:null},{name:"_apiOptionsForSection",docblock:null,modifiers:[],params:[{name:"section",optional:!1,type:{name:"signature",type:"object",raw:`{
    content?: string;
    widgets?: any;
    images?: any;
}`,signature:{properties:[{key:"content",value:{name:"string",required:!1}},{key:"widgets",value:{name:"any",required:!1}},{key:"images",value:{name:"any",required:!1}}]},alias:"RendererProps"}},{name:"sectionIndex",optional:!1,type:{name:"number"}}],returns:{type:{name:"any"}}},{name:"_sections",docblock:null,modifiers:[],params:[],returns:{type:{name:"ReadonlyArray",elements:[{name:"signature",type:"object",raw:`{
    content?: string;
    widgets?: any;
    images?: any;
}`,signature:{properties:[{key:"content",value:{name:"string",required:!1}},{key:"widgets",value:{name:"any",required:!1}},{key:"images",value:{name:"any",required:!1}}]}}],raw:"ReadonlyArray<RendererProps>"}}},{name:"_renderEditor",docblock:null,modifiers:[],params:[],returns:{type:{name:"ReactReactElement",raw:'React.ReactElement<React.ComponentProps<"div">>',elements:[{name:"ReactComponentProps",raw:'React.ComponentProps<"div">',elements:[{name:"literal",value:'"div"'}]}]}}},{name:"_renderAddSection",docblock:null,modifiers:[],params:[],returns:{type:{name:"ReactReactElement",raw:'React.ReactElement<React.ComponentProps<"div">>',elements:[{name:"ReactComponentProps",raw:'React.ComponentProps<"div">',elements:[{name:"literal",value:'"div"'}]}]}}},{name:"_renderLinterHUD",docblock:null,modifiers:[],params:[],returns:{type:{name:"ReactReactElement",raw:"React.ReactElement<any>",elements:[{name:"any"}]}}},{name:"_renderIframePreview",docblock:null,modifiers:[],params:[{name:"i",optional:!1,type:{name:"union",raw:"number | string",elements:[{name:"number"},{name:"string"}]}},{name:"nochrome",optional:!1,type:{name:"boolean"}}],returns:{type:{name:"ReactReactElement",raw:"React.ReactElement<any>",elements:[{name:"any"}]}}},{name:"_renderPreviewMode",docblock:null,modifiers:[],params:[],returns:{type:{name:"ReactReactElement",raw:'React.ReactElement<React.ComponentProps<"div">>',elements:[{name:"ReactComponentProps",raw:'React.ComponentProps<"div">',elements:[{name:"literal",value:'"div"'}]}]}}},{name:"_handleJsonChange",docblock:null,modifiers:[],params:[{name:"newJson",optional:!1,type:null}],returns:null},{name:"_handleEditorChange",docblock:null,modifiers:[],params:[{name:"i",optional:!1,type:null},{name:"newProps",optional:!1,type:null}],returns:null},{name:"_handleMoveSectionEarlier",docblock:null,modifiers:[],params:[{name:"i",optional:!1,type:{name:"number"}}],returns:null},{name:"_handleMoveSectionLater",docblock:null,modifiers:[],params:[{name:"i",optional:!1,type:{name:"number"}}],returns:null},{name:"_handleAddSectionAfter",docblock:null,modifiers:[],params:[{name:"i",optional:!1,type:{name:"number"}}],returns:null},{name:"_handleRemoveSection",docblock:null,modifiers:[],params:[{name:"i",optional:!1,type:{name:"number"}}],returns:null},{name:"serialize",docblock:null,modifiers:[],params:[],returns:{type:{name:"union",raw:"RendererProps | ReadonlyArray<RendererProps>",elements:[{name:"signature",type:"object",raw:`{
    content?: string;
    widgets?: any;
    images?: any;
}`,signature:{properties:[{key:"content",value:{name:"string",required:!1}},{key:"widgets",value:{name:"any",required:!1}},{key:"images",value:{name:"any",required:!1}}]}},{name:"ReadonlyArray",elements:[{name:"signature",type:"object",raw:`{
    content?: string;
    widgets?: any;
    images?: any;
}`,signature:{properties:[{key:"content",value:{name:"string",required:!1}},{key:"widgets",value:{name:"any",required:!1}},{key:"images",value:{name:"any",required:!1}}]}}],raw:"ReadonlyArray<RendererProps>"}]}}},{name:"getSaveWarnings",docblock:`Returns an array, with one element be section.
Each element is an array of lint warnings present in that section.

This function can currently only be called in edit mode.`,modifiers:[],params:[],returns:{type:{name:"ReadonlyArray",elements:[{name:"signature",type:"object",raw:`{
    content?: string;
    widgets?: any;
    images?: any;
}`,signature:{properties:[{key:"content",value:{name:"string",required:!1}},{key:"widgets",value:{name:"any",required:!1}},{key:"images",value:{name:"any",required:!1}}]}}],raw:"ReadonlyArray<RendererProps>"}},description:`Returns an array, with one element be section.
Each element is an array of lint warnings present in that section.

This function can currently only be called in edit mode.`}],displayName:"ArticleEditor",props:{contentPaths:{required:!1,tsType:{name:"ReadonlyArray",elements:[{name:"string"}],raw:"ReadonlyArray<string>"},description:"",defaultValue:{value:"[]",computed:!1}},json:{required:!1,tsType:{name:"union",raw:"RendererProps | ReadonlyArray<RendererProps>",elements:[{name:"signature",type:"object",raw:`{
    content?: string;
    widgets?: any;
    images?: any;
}`,signature:{properties:[{key:"content",value:{name:"string",required:!1}},{key:"widgets",value:{name:"any",required:!1}},{key:"images",value:{name:"any",required:!1}}]}},{name:"ReadonlyArray",elements:[{name:"signature",type:"object",raw:`{
    content?: string;
    widgets?: any;
    images?: any;
}`,signature:{properties:[{key:"content",value:{name:"string",required:!1}},{key:"widgets",value:{name:"any",required:!1}},{key:"images",value:{name:"any",required:!1}}]}}],raw:"ReadonlyArray<RendererProps>"}]},description:"",defaultValue:{value:"[{}]",computed:!1}},mode:{required:!1,tsType:{name:"union",raw:'"diff" | "edit" | "json" | "preview"',elements:[{name:"literal",value:'"diff"'},{name:"literal",value:'"edit"'},{name:"literal",value:'"json"'},{name:"literal",value:'"preview"'}]},description:"",defaultValue:{value:'"edit"',computed:!1}},screen:{required:!1,tsType:{name:"union",raw:'"phone" | "tablet" | "desktop"',elements:[{name:"literal",value:'"phone"'},{name:"literal",value:'"tablet"'},{name:"literal",value:'"desktop"'}]},description:"",defaultValue:{value:'"desktop"',computed:!1}},sectionImageUploadGenerator:{required:!1,tsType:{name:"signature",type:"function",raw:`(
    i: number,
) => React.ReactElement<React.ComponentProps<"span">>`,signature:{arguments:[{type:{name:"number"},name:"i"}],return:{name:"ReactReactElement",raw:'React.ReactElement<React.ComponentProps<"span">>',elements:[{name:"ReactComponentProps",raw:'React.ComponentProps<"span">',elements:[{name:"literal",value:'"span"'}]}]}}},description:"",defaultValue:{value:"() => <span />",computed:!1}},useNewStyles:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},apiOptions:{required:!1,tsType:{name:"APIOptions"},description:""},imageUploader:{required:!1,tsType:{name:"signature",type:"function",raw:"(arg1: string, arg2: (arg1: string) => unknown) => unknown",signature:{arguments:[{type:{name:"string"},name:"arg1"},{type:{name:"signature",type:"function",raw:"(arg1: string) => unknown",signature:{arguments:[{type:{name:"string"},name:"arg1"}],return:{name:"unknown"}}},name:"arg2"}],return:{name:"unknown"}}},description:""},previewURL:{required:!0,tsType:{name:"string"},description:""}}};const A=p.shape({content:p.string,images:p.objectOf(p.any),widgets:p.objectOf(p.any)}),C=class C extends v.Component{constructor(){super(...arguments),this.state=C._stateFromProps(this.props)}UNSAFE_componentWillReceiveProps(e){this.setState(C._stateFromProps(e))}render(){const{before:e,after:n}=this.state,r=Math.max(e.length,n.length),a=h.times(r,c=>t(L,{before:c<e.length?e[c]:void 0,after:c<n.length?n[c]:void 0,title:`Section ${c+1}`,showAlignmentOptions:!0,showSeparator:c<r-1},c));return t("div",{className:"framework-perseus",children:a})}};C.propTypes={after:p.oneOfType([A,p.arrayOf(A)]).isRequired,before:p.oneOfType([A,p.arrayOf(A)]).isRequired},C._stateFromProps=e=>{const{before:n,after:r}=e;return{before:Array.isArray(n)?n:[n],after:Array.isArray(r)?r:[r]}};let j=C;j.__docgenInfo={description:"",methods:[{name:"_stateFromProps",docblock:null,modifiers:["static"],params:[{name:"props",optional:!1,type:null}],returns:null}],displayName:"ArticleDiff",props:{after:{description:"",type:{name:"union",value:[{name:"custom",raw:"rendererProps"},{name:"arrayOf",value:{name:"custom",raw:"rendererProps"}}]},required:!0},before:{description:"",type:{name:"union",value:[{name:"custom",raw:"rendererProps"},{name:"arrayOf",value:{name:"custom",raw:"rendererProps"}}]},required:!0}}};const F=p.shape({question:p.shape({}).isRequired,answerArea:p.shape({}).isRequired,hints:p.arrayOf(p.any).isRequired}),U=class U extends v.Component{render(){const{before:e,after:n}=this.props,r=Math.max(e.hints.length,n.hints.length),a=t(L,{before:e.question,after:n.question,title:"Question",showAlignmentOptions:!1,showSeparator:!0}),c=t(fe,{before:e.answerArea,after:n.answerArea,title:"Question extras"}),o=h.times(r,function(m){return t(L,{before:m<e.hints.length?e.hints[m]:void 0,after:m<n.hints.length?n.hints[m]:void 0,title:`Hint ${m+1}`,showAlignmentOptions:!1,showSeparator:m<r-1},m)});return d("div",{className:"framework-perseus",children:[a,c,o&&t("div",{className:"diff-separator"}),o]})}};U.propTypes={after:F.isRequired,before:F.isRequired};let O=U;O.__docgenInfo={description:"",methods:[],displayName:"ItemDiff",props:{after:{description:"",type:{name:"custom",raw:"itemProps.isRequired"},required:!1},before:{description:"",type:{name:"custom",raw:"itemProps.isRequired"},required:!1}}};const T=class T extends v.Component{render(){const{children:e,color:n,onClick:r,...a}=this.props;return t("div",{className:l.css(x.baseButton,n==="green"&&x.green,n==="orange"&&x.orange),onClick:r,...a,children:e})}};T.propTypes={children:p.node,color:p.oneOf(["orange","green"]),onClick:p.func},T.defaultProps={children:null,color:"green",onClick:()=>{}};let b=T;const x=l.StyleSheet.create({baseButton:{top:"0",fontSize:"11px",padding:"3px 10px",backgroundRepeat:"repeat-x",borderColor:`
             rgba(0, 0, 0, 0.1)
             rgba(0, 0, 0, 0.1)
             rgba(0, 0, 0, 0.25)
         `,color:"#ffffff",borderRadius:"3px",lineHeight:"15px",cursor:"pointer",transition:"box-shadow ease-in-out 0.15s",appearance:"none",textDecoration:"none",textAlign:"center",":hover":{boxShadow:`0 1px 1px rgba(0, 0, 0, 0.35),
                 inset 0 0 50px 5px rgba(255, 255, 255, 0.2)`}},green:{border:"1px solid #7fab07",backgroundColor:"#80ac07",backgroundImage:"linear-gradient(to bottom, #8aba08, #719807)",":hover":{borderBottomColor:"#547105",backgroundColor:"#719807"}},orange:{border:"1px solid #d45704",backgroundColor:"#d55704",backgroundImage:"linear-gradient(to bottom, #e35d04, #c04f03)",":hover":{borderBottomColor:"#983e03",backgroundColor:"#c04f03"}}});b.__docgenInfo={description:"",methods:[],displayName:"SimpleButton",props:{children:{defaultValue:{value:"null",computed:!1},description:"",type:{name:"node"},required:!1},color:{defaultValue:{value:'"green"',computed:!1},description:"",type:{name:"enum",value:[{value:'"orange"',computed:!1},{value:'"green"',computed:!1}]},required:!1},onClick:{defaultValue:{value:"() => {}",computed:!1},description:"",type:{name:"func"},required:!1}}};const{InlineIcon:q}=J,{iconChevronDown:B,iconTrash:Pe}=$,{MultiRenderer:Ae}=ye;class _ extends v.Component{constructor(){super(...arguments),this._handleSelectMode=e=>{if(this.props.onChange){const n=e.target.value;this.props.onChange(n)}}}render(){return d("label",{children:["Mode:"," ",d("select",{value:this.props.currentMode,onChange:this._handleSelectMode,children:[t("option",{value:"edit",children:"Edit"}),t("option",{value:"preview",children:"Preview"}),t("option",{value:"json",children:"Dev-only JSON"})]})]})}}function Y(s){return s.replace(/[A-Z]/g,e=>" "+e.toLowerCase())}function E(s){return s.charAt(0).toUpperCase()+s.slice(1).toLowerCase()}function Z(s){return s.charAt(s.length-1)==="s"?s.slice(0,-1):s}function g(s){return["_multi",...s]}const I=({depth:s,...e})=>{const r=`h${Math.min(s,5)+1}`;return t(r,{...e})},D=s=>{const{shape:e,data:n,path:r,actions:a,name:c,controls:o,...m}=s,f=c||Y(r[r.length-1]||""),k=t(Te,{...m,shape:e,data:n,path:r,actions:a}),R=r.join(".");return e.type==="array"?t(Ne,{name:f,controls:o,path:r,shape:e,actions:a,children:k},R):e.type==="object"?t(Ee,{name:f,controls:o,path:r,children:k},R):t(_e,{name:f,controls:o,path:r,shape:e,children:k},R)},_e=({name:s,controls:e,children:n,path:r,shape:a})=>{const o=(a.type==="content"||a.type==="hint")&&t("div",{className:l.css(i.containerHeader),children:t(I,{depth:r.length,className:l.css(i.containerTitle),children:E(s)})});return d("div",{className:l.css(i.container),children:[d("span",{className:l.css(i.row,i.rowHeading),children:[t("div",{className:l.css(i.columnLeft),children:d("div",{className:"pod-title "+l.css(i.containerHeader),children:[t("div",{className:l.css(i.containerTitle),children:E(s)}),e]})}),t("div",{className:l.css(i.columnRight),children:o})]}),n]})},Ne=s=>{const{name:e,controls:n,children:r,path:a,shape:c,actions:o}=s;return d("div",{className:l.css(i.container),children:[n&&t("div",{className:l.css(i.columnLeft,i.containerHeader),children:n}),t("div",{children:r}),t("div",{className:l.css(i.columnLeft),children:d("a",{href:"javascript:void 0",onClick:()=>o.addArrayElement(a,c.elementShape),children:["Add a ",Z(e)]})})]})},Ee=({name:s,controls:e,children:n,path:r})=>{const a=d("div",{className:l.css(i.containerHeader),children:[t(I,{depth:r.length,className:l.css(i.containerTitle),children:E(s)}),e]}),c=(s||e)&&t("div",{className:l.css(i.containerHeader,i.previewCollectionHeader),children:t(I,{depth:r.length,className:l.css(i.containerTitle),children:E(s)})}),o=a&&c;return d("div",{className:l.css(i.container),children:[o&&d("span",{className:l.css(i.row),children:[t("div",{className:l.css(i.columnLeft),children:a}),t("div",{className:l.css(i.columnRight),children:c})]}),t("div",{className:l.css(r.length>0&&i.contentIndent),children:n})]})},Te=s=>{const{shape:e,data:n,...r}=s;return e.type==="content"?t(xe,{shape:e,data:n,...r}):e.type==="hint"?t(qe,{shape:e,data:n,...r}):e.type==="tags"?t(Me,{shape:e,data:n,...r}):e.type==="array"?t(Le,{shape:e,data:n,...r}):e.type==="object"?t(je,{shape:e,data:n,...r}):null},X=s=>class extends v.Component{constructor(){super(...arguments),this.state={sticky:!1},this.updateStickiness=()=>{const r=ge.findDOMNode(this).offsetHeight,a=window.innerHeight,c=r>a;c!==this.state.sticky&&this.setState({sticky:c})}}componentDidMount(){this.stickynessTimer=setInterval(this.updateStickiness,1e3),this.updateStickiness()}componentWillUnmount(){clearInterval(this.stickynessTimer)}render(){return t(s,{...this.props,sticky:this.state.sticky})}},xe=X(s=>{const{data:e,path:n,actions:r,apiOptions:a,renderers:c,sticky:o}=s,m=t("div",{className:"framework-perseus",children:y(c).get(n)});return t("span",{children:d("div",{className:l.css(i.row),children:[t("div",{className:l.css(i.columnLeft),children:t("div",{className:l.css(o&&i.sticky),children:t(K,{...e,onChange:f=>r.mergeValueAtPath(n,f),apiOptions:a})})}),t("div",{className:l.css(i.columnRight),children:t("div",{className:l.css(o&&i.sticky),children:m})})]})})}),qe=X(s=>{const{data:e,path:n,actions:r,apiOptions:a,renderers:c,sticky:o}=s,m=t("div",{className:"framework-perseus",children:y(c).get(n)});return d("div",{className:l.css(i.row),children:[t("div",{className:l.css(i.columnLeft),children:t("div",{className:l.css(o&&i.sticky),children:t(pe,{...e,className:l.css(i.hintEditor),onChange:f=>r.mergeValueAtPath(n,f),apiOptions:a,showTitle:!1,showRemoveButton:!1,showMoveButtons:!1,onRemove:()=>{},onMove:f=>{},isFirst:!0,isLast:!0})})}),t("div",{className:l.css(i.columnRight),children:t("div",{className:l.css(o&&i.sticky),children:m})})]})}),Me=s=>{const{data:e,path:n,actions:r,apiOptions:a}=s,{GroupMetadataEditor:c}=a;return c==null?null:t("div",{className:l.css(i.columnLeft),children:t("div",{className:l.css(i.tagsEditor),children:t(c,{value:e,onChange:o=>r.setValueAtPath(n,o),showTitle:!1})})})},Le=s=>{const{shape:e,data:n,path:r,actions:a,...c}=s,o=Y(r[r.length-1]),m=Z(o),f=e.elementShape.type,k=f==="content"||f==="hint",R=n.map((ee,w)=>{const S=r.concat(w),te=[w>0&&t("div",{className:l.css(i.control),children:t(b,{color:"orange",title:"Move up",onClick:()=>a.moveArrayElementUp(S),children:t("div",{className:l.css(i.verticalFlip),children:t(q,{...B})})})},"moveArrayElementUp"),w<n.length-1&&t("div",{className:l.css(i.control),children:t(b,{color:"orange",title:"Move down",onClick:()=>a.moveArrayElementDown(S),children:t(q,{...B})})},"moveArrayElementDown"),t("div",{className:l.css(i.control),children:t(b,{color:"orange",title:"Delete",onClick:()=>a.removeArrayElement(S),children:t(q,{...Pe})})},"removeArrayElement")];return t("div",{className:l.css(i.arrayElement,!k&&i.arrayElementAndNotLeaf),children:v.createElement(D,{...c,key:w,shape:e.elementShape,data:ee,path:S,actions:a,name:`${m} ${w+1}`,controls:te})},w)});return t("div",{children:R})},je=s=>{const{shape:e,data:n,path:r,...a}=s,c=Object.keys(e.shape).map(o=>t("div",{className:l.css(i.objectElement),children:t(D,{...a,shape:e.shape[o],data:n[o],path:r.concat(o)})},o));return t("div",{children:c})};class Oe extends v.Component{constructor(){super(...arguments),this._renderLayout=()=>{const{Layout:e,apiOptions:n,item:r}=this.props;return t(e,{ref:a=>this.layout=a,item:r,apiOptions:n})},this._renderJson=()=>d("div",{children:[t(_,{currentMode:this.props.editorMode,onChange:e=>this.props.onChange({editorMode:e})}),t(G,{multiLine:!0,value:this.props.item,onChange:e=>this.props.onChange({item:e})})]}),this._renderPreview=()=>d("div",{children:[t(_,{currentMode:this.props.editorMode,onChange:e=>this.props.onChange({editorMode:e})}),this._renderLayout()]}),this.mergeValueAtPath=(e,n)=>{this.props.onChange({item:y(this.props.item).merge(g(e),n).freeze()})},this.setValueAtPath=(e,n)=>{this.props.onChange({item:y(this.props.item).set(g(e),n).freeze()})},this.addArrayElement=(e,n)=>{const r=y(this.props.item).get(g(e)).length,a=e.concat(r),c=re(n);this.props.onChange({item:y(this.props.item).set(g(a),c).freeze()})},this.removeArrayElement=e=>{this.props.onChange({item:y(this.props.item).del(g(e)).freeze()})},this.moveArrayElementDown=e=>{const r=e[e.length-1]+1,a=e.slice(0,-1).concat(r),c=y(this.props.item).get(g(e)),o=y(this.props.item).get(g(a));this.props.onChange({item:y(this.props.item).set(g(e),o).set(g(a),c).freeze()})},this.moveArrayElementUp=e=>{const n=e[e.length-1],r=e.slice(0,-1).concat(n-1);this.moveArrayElementDown(r)},this._renderEdit=()=>{const e={...M.defaults,...this.props.apiOptions},{item:n}=this.props,r=this.props.Layout.shape;return d("div",{className:"perseus-multirenderer-editor",children:[t(_,{currentMode:this.props.editorMode,onChange:a=>this.props.onChange({editorMode:a})}),t(Ae,{item:n,shape:r,apiOptions:e,dependencies:{analytics:{onAnalyticsEvent:async()=>{}}},children:({renderers:a})=>t(D,{shape:r,data:se(n),path:[],actions:this,apiOptions:e,renderers:a})})]})},this.score=()=>{if(this.layout)return this.layout.score()},this.getSerializedState=()=>{if(this.layout)return this.layout.getSerializedState()},this.restoreSerializedState=e=>{this.layout&&this.layout.restoreSerializedState(e)},this._renderContent=()=>{switch(this.props.editorMode){case"json":return this._renderJson();case"preview":return this._renderPreview();case"edit":return this._renderEdit();default:return t(_,{currentMode:this.props.editorMode,onChange:e=>this.props.onChange({editorMode:e})})}}}render(){return t("div",{id:"perseus",children:this._renderContent()})}}const i=l.StyleSheet.create({container:{},editor:{width:"100%"},treePreview:{position:"relative"},verticalFlip:{transform:"scaleY(-1)"},control:{marginLeft:12},containerHeader:{alignItems:"flex-end",display:"flex",flexDirection:"row"},previewCollectionHeader:{marginBottom:16},containerTitle:{flexGrow:1,margin:0},contentIndent:{marginLeft:8},hintEditor:{paddingBottom:0},arrayElement:{marginBottom:16},arrayElementAndNotLeaf:{borderBottom:"1px solid #ccc",":first-child":{borderTop:"1px solid #ccc",paddingTop:16}},objectElement:{marginBottom:16},tagsEditor:{border:"1px solid #ddd",padding:"5px 10px"},row:{display:"flex",position:"relative"},columnLeft:{width:360,marginRight:30,position:"relative"},columnRight:{flex:1,marginLeft:30,position:"relative"},sticky:{position:"sticky",top:33},rowHeading:{position:"sticky",backgroundColor:"white",width:"100%",zIndex:101,top:-1}});Oe.__docgenInfo={description:"",methods:[{name:"_renderLayout",docblock:null,modifiers:[],params:[],returns:null},{name:"_renderJson",docblock:null,modifiers:[],params:[],returns:null},{name:"_renderPreview",docblock:null,modifiers:[],params:[],returns:null},{name:"mergeValueAtPath",docblock:null,modifiers:[],params:[{name:"path",optional:!1,type:{name:"ReadonlyArray",elements:[{name:"any"}],raw:"ReadonlyArray<any>",alias:"Path"}},{name:"newValue",optional:!1,type:{name:"unknown"}}],returns:null},{name:"setValueAtPath",docblock:null,modifiers:[],params:[{name:"path",optional:!1,type:{name:"ReadonlyArray",elements:[{name:"any"}],raw:"ReadonlyArray<any>",alias:"Path"}},{name:"newValue",optional:!1,type:{name:"unknown"}}],returns:null},{name:"addArrayElement",docblock:null,modifiers:[],params:[{name:"path",optional:!1,type:{name:"ReadonlyArray",elements:[{name:"any"}],raw:"ReadonlyArray<any>",alias:"Path"}},{name:"shape",optional:!1,type:{name:"Shape",alias:"Shape"}}],returns:null},{name:"removeArrayElement",docblock:null,modifiers:[],params:[{name:"path",optional:!1,type:{name:"ReadonlyArray",elements:[{name:"any"}],raw:"ReadonlyArray<any>",alias:"Path"}}],returns:null},{name:"moveArrayElementDown",docblock:null,modifiers:[],params:[{name:"path",optional:!1,type:{name:"ReadonlyArray",elements:[{name:"any"}],raw:"ReadonlyArray<any>",alias:"Path"}}],returns:null},{name:"moveArrayElementUp",docblock:null,modifiers:[],params:[{name:"path",optional:!1,type:{name:"ReadonlyArray",elements:[{name:"any"}],raw:"ReadonlyArray<any>",alias:"Path"}}],returns:null},{name:"_renderEdit",docblock:null,modifiers:[],params:[],returns:null},{name:"score",docblock:null,modifiers:[],params:[],returns:null},{name:"getSerializedState",docblock:null,modifiers:[],params:[],returns:null},{name:"restoreSerializedState",docblock:null,modifiers:[],params:[{name:"state",optional:!1,type:{name:"any"}}],returns:null},{name:"_renderContent",docblock:null,modifiers:[],params:[],returns:null}],displayName:"MultiRendererEditor",props:{Layout:{required:!0,tsType:{name:"intersection",raw:"React.ComponentType<any> & LayoutStatics",elements:[{name:"ReactComponentType",raw:"React.ComponentType<any>",elements:[{name:"any"}]},{name:"LayoutStatics"}]},description:""},apiOptions:{required:!0,tsType:{name:"APIOptions"},description:""},item:{required:!0,tsType:{name:"Item"},description:""},editorMode:{required:!0,tsType:{name:"EditorMode"},description:""},onChange:{required:!0,tsType:{name:"ChangeHandler"},description:""}}};Q({displayName:"StatefulArticleEditor",getInitialState:function(){return h({}).extend(this.props,{mode:"edit",onChange:this.handleChange,ref:"editor",screen:"phone"})},componentDidMount:function(){this._isMounted=!0},UNSAFE_componentWillReceiveProps:function(s){this.setState(h(s).omit("onChange","ref"))},componentWillUnmount:function(){this._isMounted=!1},getSaveWarnings:function(){return this.refs.editor.getSaveWarnings()},serialize:function(){return this.refs.editor.serialize()},handleChange:function(s,e){this._isMounted&&this.setState(s,e)},scorePreview:function(){return this.refs.editor.scorePreview()},render:function(){const{mode:s,screen:e}=this.state;return d("div",{children:[d("div",{style:u.controlBar,children:[d("span",{style:u.controls,children:["Mode:"," ",t("span",{onClick:()=>this.setState({mode:"edit"}),style:s==="edit"?u.controlSelected:u.control,children:"EDIT"})," | ",t("span",{onClick:()=>this.setState({mode:"preview"}),style:s==="preview"?u.controlSelected:u.control,children:"PREVIEW"})," | ",t("span",{onClick:()=>this.setState({mode:"json"}),style:s==="json"?u.controlSelected:u.control,children:"JSON"})]}),d("span",{style:u.controls,children:["Screen:"," ",t("span",{onClick:()=>this.setState({screen:"phone"}),style:e==="phone"?u.controlSelected:u.control,children:"PHONE"})," | ",t("span",{onClick:()=>this.setState({screen:"tablet"}),style:e==="tablet"?u.controlSelected:u.control,children:"TABLET"})," | ",t("span",{onClick:()=>this.setState({screen:"desktop"}),style:e==="desktop"?u.controlSelected:u.control,children:"DESKTOP"})]})]}),t("div",{style:u.editor,children:t(N,{...this.state})})]})}});const u={controlBar:{marginBottom:25,marginTop:5},controls:{marginRight:10},controlSelected:{cursor:"default",fontWeight:700},control:{cursor:"pointer"},editor:{marginTop:-20}};Q({displayName:"StatefulEditorPage",propTypes:{componentClass:p.func},getDefaultProps:function(){return{componentClass:me}},render:function(){const s=this.props.componentClass;return t(s,{...this.state})},getInitialState:function(){return h({}).extend(h.omit(this.props,"componentClass"),{onChange:this.handleChange,ref:"editor"})},componentDidMount:function(){this._isMounted=!0},componentWillUnmount:function(){this._isMounted=!1},UNSAFE_componentWillReceiveProps:function(s){this.setState(h(s).pick("apiOptions","imageUploader","developerMode","problemNum","previewDevice","frameSource"))},getSaveWarnings:function(){return this.refs.editor.getSaveWarnings()},serialize:function(){return this.refs.editor.serialize()},handleChange:function(s,e){this._isMounted&&this.setState(s,e)},scorePreview:function(){return this.refs.editor.scorePreview()}});ae(he);oe(ue);ie();le();
