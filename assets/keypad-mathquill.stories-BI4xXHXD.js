import{r,j as s,b as O,c as b,I as $,V as y,n as C,d as W,s as l,e as R,f as k,g as V,h as H,x as U,i as q,H as G,B as Y,C as z,k as Q,l as w,m as J,o as X,p as Z}from"./iframe-BFBE40jw.js";import{T as ee,a as te}from"./index-kgn4GEct.js";import"./Popper-iHmo5qQ4.js";const ne={close:void 0,placement:"top"},E=r.createContext(ne);E.displayName="PopoverContext";class oe extends r.Component{componentDidMount(){const t=b.findDOMNode(this);t&&this.props.anchorRef(t)}render(){const{children:t,id:e,onClick:n,"aria-controls":o,"aria-expanded":a}=this.props,i={id:e,"aria-controls":o,"aria-expanded":a};if(typeof t=="function"){const d=t({open:n});return r.cloneElement(d,i)}else return r.cloneElement(t,{...t.props,...i,onClick:t.props.onClick?d=>{d.stopPropagation(),t.props.onClick(),n()}:n})}}class se extends r.Component{componentDidUpdate(t){t.placement!==this.props.placement&&this.props.onUpdate(this.props.placement)}render(){const{placement:t,children:e,id:n,isReferenceHidden:o,updateBubbleRef:a,updateTailRef:i,tailOffset:d,style:f,showTail:p,"aria-describedby":h,"aria-labelledby":u,"aria-label":g}=this.props,v=e.props.color;return s.jsx(r.Fragment,{children:s.jsxs(y,{"aria-label":g,"aria-describedby":h,"aria-labelledby":u,id:n,role:"dialog",ref:a,"data-placement":t,style:[o&&B.hide,B[`content-${t}`],f],children:[e,s.jsx(te,{show:p,color:v,updateRef:i,placement:t,offset:d})]})})}}const B=C.StyleSheet.create({hide:{pointerEvents:"none",opacity:0,backgroundColor:"transparent",color:"transparent"},"content-top":{flexDirection:"column"},"content-right":{flexDirection:"row-reverse"},"content-bottom":{flexDirection:"column-reverse"},"content-left":{flexDirection:"row"}}),j='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';function F(c){return Array.from(c.querySelectorAll(j))}function ie(c){return c.matches(j)}class re extends r.Component{componentDidMount(){window.addEventListener("keyup",this._handleKeyup),window.addEventListener("click",this._handleClick)}componentWillUnmount(){window.removeEventListener("keyup",this._handleKeyup),window.removeEventListener("click",this._handleClick)}render(){return null}constructor(...t){super(...t),this.state={isFirstClick:!0},this._handleKeyup=e=>{e.key==="Escape"&&(e.preventDefault(),e.stopPropagation(),this.props.onClose(!0))},this._handleClick=e=>{var o;if(this.state.isFirstClick){this.setState({isFirstClick:!1});return}const n=b.findDOMNode((o=this.props.contentRef)==null?void 0:o.current);if(n&&!n.contains(e.target)){e.preventDefault(),e.stopPropagation();const a=!ie(e.target);this.props.onClose(a)}}}}class D extends r.Component{componentDidMount(){const t=b.findDOMNode(this);t&&this.setInitialFocusableElement(t)}maybeGetInitialFocusElement(t){const{initialFocusId:e}=this.props;return e?t.querySelector(`#${e}`):null}maybeGetFirstFocusableElement(t){const e=F(t);return e.length?e[0]:null}render(){return this.props.children}constructor(...t){super(...t),this.setInitialFocusableElement=e=>{const n=this.maybeGetInitialFocusElement(e)||this.maybeGetFirstFocusableElement(e)||e;n===e&&(e.tabIndex=-1),setTimeout(()=>{n.focus()},this.props.delay||0)}}}class ae extends r.Component{componentDidMount(){this.addEventListeners()}componentDidUpdate(){this.removeEventListeners(),this.addEventListeners()}componentWillUnmount(){this.changeFocusabilityInsidePopover(!0),this.removeEventListeners()}removeEventListeners(){const{anchorElement:t}=this.props;t&&t.removeEventListener("keydown",this.handleKeydownPreviousFocusableElement),this.nextElementAfterPopover||window.removeEventListener("blur",()=>{this.changeFocusabilityInsidePopover(!0)}),this.firstFocusableElementInPopover&&this.firstFocusableElementInPopover.removeEventListener("keydown",this.handleKeydownFirstFocusableElement),this.lastFocusableElementInPopover&&this.lastFocusableElementInPopover.removeEventListener("keydown",this.handleKeydownLastFocusableElement),this.nextElementAfterPopover&&this.nextElementAfterPopover.removeEventListener("keydown",this.handleKeydownNextFocusableElement)}render(){const{children:t}=this.props;return s.jsx("div",{ref:this.getComponentRootNode,onClick:()=>{this.changeFocusabilityInsidePopover(!0)},onFocus:()=>{this.changeFocusabilityInsidePopover(!0)},onBlur:()=>{this.changeFocusabilityInsidePopover(!1)},children:s.jsx(D,{initialFocusId:this.props.initialFocusId,delay:this.props.initialFocusDelay,children:t})})}constructor(...t){super(...t),this.elementsThatCanBeFocusableInsidePopover=[],this.firstFocusableElementInPopover=null,this.lastFocusableElementInPopover=null,this.addEventListeners=()=>{const{anchorElement:e}=this.props;e&&e.addEventListener("keydown",this.handleKeydownPreviousFocusableElement),this.rootNode&&(this.elementsThatCanBeFocusableInsidePopover=F(this.rootNode),this.firstFocusableElementInPopover=this.elementsThatCanBeFocusableInsidePopover[0],this.lastFocusableElementInPopover=this.elementsThatCanBeFocusableInsidePopover[this.elementsThatCanBeFocusableInsidePopover.length-1]),this.nextElementAfterPopover=this.getNextFocusableElement(),this.nextElementAfterPopover||window.addEventListener("blur",()=>{this.changeFocusabilityInsidePopover(!0)}),this.firstFocusableElementInPopover&&this.firstFocusableElementInPopover.addEventListener("keydown",this.handleKeydownFirstFocusableElement),this.lastFocusableElementInPopover&&this.lastFocusableElementInPopover.addEventListener("keydown",this.handleKeydownLastFocusableElement),this.nextElementAfterPopover&&this.nextElementAfterPopover.addEventListener("keydown",this.handleKeydownNextFocusableElement)},this.handleKeydownFirstFocusableElement=e=>{var n;e.key==="Tab"&&e.shiftKey&&(e.preventDefault(),(n=this.props.anchorElement)==null||n.focus())},this.handleKeydownLastFocusableElement=e=>{var n;this.nextElementAfterPopover&&e.key==="Tab"&&!e.shiftKey&&(e.preventDefault(),(n=this.nextElementAfterPopover)==null||n.focus())},this.getNextFocusableElement=()=>{const{anchorElement:e}=this.props;if(!e)return;const o=F(document).filter(i=>this.elementsThatCanBeFocusableInsidePopover.indexOf(i)<0),a=o.indexOf(e);if(a>=0&&a!==o.length-1){const i=a<o.length-1?a+1:0;return o[i]}},this.getComponentRootNode=e=>{if(!e)return;const n=b.findDOMNode(e);if(!n)throw new Error("Assertion error: root node should exist after mount");this.rootNode=n},this.handleFocusPreviousFocusableElement=()=>{this.props.anchorElement&&this.props.anchorElement.focus()},this.changeFocusabilityInsidePopover=(e=!0)=>{const n=e?"0":"-1";this.elementsThatCanBeFocusableInsidePopover.forEach(o=>{o.setAttribute("tabIndex",n)})},this.handleFocusNextFocusableElement=()=>{this.nextElementAfterPopover&&this.nextElementAfterPopover.focus()},this.handleKeydownPreviousFocusableElement=e=>{var n;e.key==="Tab"&&!e.shiftKey&&(e.preventDefault(),(n=this.firstFocusableElementInPopover)==null||n.focus())},this.handleKeydownNextFocusableElement=e=>{var n;e.key==="Tab"&&e.shiftKey&&(e.preventDefault(),(n=this.lastFocusableElementInPopover)==null||n.focus())}}}class _ extends r.Component{static getDerivedStateFromProps(t,e){return{opened:typeof t.opened=="boolean"?t.opened:e.opened}}renderContent(t){const{content:e}=this.props,n=typeof e=="function"?e({close:this.handleClose}):e;return r.cloneElement(n,{ref:this.contentRef,uniqueId:t})}renderPopper(t){const{initialFocusId:e,placement:n,showTail:o,portal:a,"aria-label":i,"aria-describedby":d,rootBoundary:f,viewportPadding:p,initialFocusDelay:h}=this.props,{anchorElement:u}=this.state,g=d||`${t}-content`,I=i?void 0:`${t}-title`,v=s.jsx(ee,{anchorElement:u,placement:n,rootBoundary:f,viewportPadding:p,children:N=>s.jsx(se,{...N,"aria-label":i,"aria-describedby":g,"aria-labelledby":I,id:t,onUpdate:A=>this.setState({placement:A}),showTail:o,children:this.renderContent(t)})});return a?s.jsx(ae,{anchorElement:u,initialFocusId:e,initialFocusDelay:h,children:v}):s.jsx(D,{initialFocusId:e,delay:h,children:v})}getHost(){return O(this.state.anchorElement)||document.body}renderPortal(t,e){if(!e)return null;const{portal:n}=this.props,o=this.getHost();return n&&o?b.createPortal(this.renderPopper(t),o):this.renderPopper(t)}render(){const{children:t,dismissEnabled:e,id:n}=this.props,{opened:o,placement:a}=this.state;return s.jsxs(E.Provider,{value:{close:this.handleClose,placement:a},children:[s.jsx($,{id:n,children:i=>s.jsxs(r.Fragment,{children:[s.jsx(oe,{anchorRef:this.updateRef,id:`${i}-anchor`,"aria-controls":i,"aria-expanded":o?"true":"false",onClick:this.handleOpen,children:t}),this.renderPortal(i,o)]})}),e&&o&&s.jsx(re,{onClose:this.handleClose,contentRef:this.contentRef})]})}constructor(...t){super(...t),this.state={opened:!!this.props.opened,placement:this.props.placement},this.contentRef=r.createRef(),this.maybeReturnFocus=()=>{const{anchorElement:e}=this.state,{closedFocusId:n}=this.props;if(n){const o=b.findDOMNode(document.getElementById(n));o==null||o.focus();return}e&&e.focus()},this.handleClose=(e=!0)=>{this.setState({opened:!1},()=>{var n,o;(o=(n=this.props).onClose)==null||o.call(n),e&&this.maybeReturnFocus()})},this.handleOpen=()=>{this.props.dismissEnabled&&this.state.opened?this.handleClose(!0):this.setState({opened:!0})},this.updateRef=e=>{e&&this.state.anchorElement!==e&&this.setState({anchorElement:e})}}}_.defaultProps={placement:"top",showTail:!0,portal:!0,rootBoundary:"viewport"};class M extends r.Component{render(){const{"aria-label":t,style:e,testId:n}=this.props;return s.jsx(E.Consumer,{children:({close:o})=>s.jsx(H,{icon:U,"aria-label":t,onClick:o,kind:"tertiary",actionType:"neutral",style:e,testId:n})})}}M.defaultProps={"aria-label":"Close Popover"};class P extends r.Component{render(){const{"aria-label":t,children:e,closeButtonLight:n,closeButtonLabel:o,closeButtonVisible:a,style:i,testId:d}=this.props;return s.jsxs(y,{testId:d,style:[S.content,i],"aria-label":t,children:[a&&s.jsx(M,{"aria-label":o,style:[S.closeButton,n&&W.inverse],testId:`${d||"popover"}-close-btn`}),e]})}}P.defaultProps={closeButtonLight:!1,closeButtonVisible:!1};const S=C.StyleSheet.create({content:{borderRadius:V.radius.radius_040,border:`solid 1px ${k.core.border.neutral.subtle}`,backgroundColor:k.surface.primary,boxShadow:`0 ${l.xSmall_8}px ${l.xSmall_8}px 0 ${R.offBlack8}`,margin:0,maxWidth:l.medium_16*18,padding:l.large_24,overflow:"hidden",justifyContent:"center"},closeButton:{margin:0,position:"absolute",right:l.xxxSmall_4,top:l.xxxSmall_4,zIndex:1}}),le=q("img");class ce extends r.Component{componentDidMount(){const{icon:t,image:e}=this.props;if(e&&t)throw new Error("'image' and 'icon' cannot be used at the same time. You can fix this by either removing 'image' or 'icon' from your instance.")}validateProps({placement:t}){if(this.props.image&&(t==="left"||t==="right"))throw new Error("'image' can only be vertically placed. You can fix this by either changing `placement` to `top` or `bottom` or removing the `image` prop inside `content`.")}render(){const{closeButtonLabel:t,closeButtonVisible:e,content:n,icon:o,image:a,style:i,title:d,testId:f,uniqueId:p}=this.props;return s.jsx(E.Consumer,{children:({close:h,placement:u})=>(this.validateProps({close:h,placement:u}),s.jsxs(P,{closeButtonLight:a&&u==="top",closeButtonLabel:t,closeButtonVisible:e,style:i,testId:f,children:[s.jsxs(y,{style:!!o&&m.withIcon,children:[this.maybeRenderImage({placement:u}),this.maybeRenderIcon(),s.jsxs(y,{style:m.text,children:[s.jsx(G,{id:`${p}-title`,style:m.title,children:d}),s.jsx(Y,{id:`${p}-content`,children:n})]})]}),this.maybeRenderActions(h)]}))})}constructor(...t){super(...t),this.maybeRenderImage=({placement:e})=>{const{image:n}=this.props;return n?s.jsx(y,{style:[m.image,e==="bottom"&&m.imageToBottom],children:n}):null},this.maybeRenderIcon=()=>{const{icon:e,iconAlt:n}=this.props;return e?s.jsx(y,{style:m.iconContainer,children:typeof e!="string"?e:s.jsx(le,{src:e,style:m.icon,alt:n||""})}):null},this.maybeRenderActions=e=>{const{actions:n}=this.props;return n?s.jsx(y,{style:m.actions,children:typeof n=="function"?n({close:e}):n}):null}}}ce.defaultProps={closeButtonVisible:!1};const m=C.StyleSheet.create({actions:{marginTop:l.large_24,flexDirection:"row",alignItems:"center",justifyContent:"flex-end"},text:{justifyContent:"center"},title:{marginBottom:l.xSmall_8},iconContainer:{alignItems:"center",justifyContent:"center",height:l.xxxLarge_64,width:l.xxxLarge_64,minWidth:l.xxxLarge_64,marginRight:l.medium_16,overflow:"hidden"},icon:{width:"100%"},withIcon:{flexDirection:"row"},image:{marginBottom:l.large_24,marginLeft:-l.large_24,marginRight:-l.large_24,marginTop:-l.large_24,width:`calc(100% + ${l.large_24*2}px)`},imageToBottom:{marginBottom:-l.large_24,marginTop:l.large_24,order:1}}),ue={title:"math-input/components/v2 Keypad With Mathquill"};function x(){const c=r.useRef(null),[t,e]=r.useState(),[n,o]=r.useState(!0),[a,i]=r.useState(z.NONE);r.useEffect(()=>{if(!t&&c.current){const p=Q(c.current,"en",J,h=>({...h,handlers:{edit:u=>{i(w(u))}}}));e(p)}},[t]);const d=X("en",{sin:"sin",cos:"cos",tan:"tan"});function f(p){if(!t)return;p==="DISMISS"&&o(!1);const h=d[p];h?(h(t,p),i(w(t))):console.warn(`No translation to Mathquill for: ${p}`)}return s.jsxs("div",{style:{maxWidth:"400px",margin:"2em"},children:[s.jsx(_,{content:s.jsx(P,{style:{padding:0,paddingBottom:l.xxSmall_6,maxWidth:"initial"},children:s.jsx(Z,{extraKeys:["x","y","PI","THETA"],onClickKey:f,cursorContext:a,advancedRelations:!0,basicRelations:!0,divisionKey:!0,logarithms:!0,convertDotToTimes:!0,preAlgebra:!0,trigonometry:!0,onAnalyticsEvent:async()=>{},showDismiss:!0})}),dismissEnabled:!0,opened:n,children:s.jsx("div",{style:{width:"100%",marginBottom:"1em",border:`1px solid ${R.offBlack16}`},ref:c})}),s.jsx("button",{onClick:()=>o(!n),children:n?"close keypad":"open keypad"})]})}x.__docgenInfo={description:"",methods:[],displayName:"V2KeypadWithMathquill"};var T,L,K;x.parameters={...x.parameters,docs:{...(T=x.parameters)==null?void 0:T.docs,source:{originalSource:`function V2KeypadWithMathquill() {
  const mathFieldWrapperRef = React.useRef<HTMLDivElement>(null);
  const [mathField, setMathField] = React.useState<MathFieldInterface>();
  const [keypadOpen, setKeypadOpen] = React.useState<boolean>(true);
  const [cursorContext, setCursorContext] = React.useState<(typeof CursorContext)[keyof typeof CursorContext]>(CursorContext.NONE);
  React.useEffect(() => {
    if (!mathField && mathFieldWrapperRef.current) {
      const mathFieldInstance = createMathField(mathFieldWrapperRef.current, "en", mockStrings,
      // TODO(LEMS-2656): remove TS suppression
      // @ts-expect-error: Type 'EditableMathQuill' is not assignable to type 'MathFieldInterface'.
      baseConfig => ({
        ...baseConfig,
        handlers: {
          edit: (_mathField: MathFieldInterface) => {
            setCursorContext(getCursorContext(_mathField));
          }
        }
      }));
      setMathField(mathFieldInstance);
    }
  }, [mathField]);
  const keyTranslator = getKeyTranslator("en", {
    sin: "sin",
    cos: "cos",
    tan: "tan"
  });
  function handleClickKey(key: KeypadKey) {
    if (!mathField) {
      return;
    }
    if (key === "DISMISS") {
      setKeypadOpen(false);
    }
    const mathFieldCallback = keyTranslator[key];
    // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions
    if (mathFieldCallback) {
      mathFieldCallback(mathField, key);
      setCursorContext(getCursorContext(mathField));
    } else {
      // eslint-disable-next-line no-console
      console.warn(\`No translation to Mathquill for: \${key}\`);
    }
  }
  return <div style={{
    maxWidth: "400px",
    margin: "2em"
  }}>
            <Popover content={<PopoverContentCore style={{
      padding: 0,
      paddingBottom: spacing.xxSmall_6,
      maxWidth: "initial"
    }}>
                        <Keypad extraKeys={["x", "y", "PI", "THETA"]} onClickKey={handleClickKey} cursorContext={cursorContext} advancedRelations basicRelations divisionKey logarithms convertDotToTimes preAlgebra trigonometry onAnalyticsEvent={async () => {}} showDismiss />
                    </PopoverContentCore>} dismissEnabled opened={keypadOpen}>
                <div style={{
        width: "100%",
        marginBottom: "1em",
        border: \`1px solid \${color.offBlack16}\`
      }} ref={mathFieldWrapperRef} />
            </Popover>
            <button onClick={() => setKeypadOpen(!keypadOpen)}>
                {keypadOpen ? "close keypad" : "open keypad"}
            </button>
        </div>;
}`,...(K=(L=x.parameters)==null?void 0:L.docs)==null?void 0:K.source}}};const me=["V2KeypadWithMathquill"];export{x as V2KeypadWithMathquill,me as __namedExportsOrder,ue as default};
