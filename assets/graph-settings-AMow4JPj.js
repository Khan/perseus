import{j as t,a as o}from"./jsx-runtime-BGVbfQ2Z.js";import"./article-renderer-vMRtAXx5.js";import{p as v,c as T}from"./unit-tpB2tohZ.js";import"./index-eZ2N530f.js";import"./index-V35CFGao.js";import"./index-qhcEwEpg.js";import"./fixed-to-responsive-X0KGwmEJ.js";import{g as k}from"./dependencies-fnqF3NiV.js";import"./video-transcript-link-ZVuMBlt5.js";import{_ as i}from"./index-default-4_ZsnO94.js";import"./perseus-api-Ly41NhN4.js";import"./multi-renderer-EYoqxMys.js";import"./hints-renderer-gHUQzNmX.js";import"./renderer-kLXXIAmW.js";import"./base-radio-YjOuhPVd.js";import{c as w}from"./components-NtPXL24S.js";import{U as g,K as f}from"./util-1QHV8SS2.js";import{i as x}from"./constants-5iWyYZaE.js";import{P as n}from"./index-tvtfaFq4.js";import{c as y}from"./prop-check-box-Msevz2ZD.js";import{R as N}from"./index-E09jvG0x.js";const{ButtonGroup:R,InfoTip:G,PropCheckBox:m,RangeInput:u}=w,I={url:null,width:0,height:0};function C(e,s){return Math.floor((e[1]-e[0])/s)}const F=y({displayName:"GraphSettings",propTypes:{...v,editableSettings:n.arrayOf(n.oneOf(["canvas","graph","snap","image","measure"])),box:n.arrayOf(n.number),labels:n.arrayOf(n.string),range:n.arrayOf(n.arrayOf(n.number)),step:n.arrayOf(n.number),gridStep:n.arrayOf(n.number),snapStep:n.arrayOf(n.number),valid:n.oneOfType([n.bool,n.string]),backgroundImage:n.object,markings:n.oneOf(["graph","grid","none"]),showProtractor:n.bool,showRuler:n.bool,showTooltips:n.bool,rulerLabel:n.string,rulerTicks:n.number},getDefaultProps:function(){return{editableSettings:["graph","snap","image","measure"],box:[x.defaultBoxSizeSmall,x.defaultBoxSizeSmall],labels:["x","y"],range:[[-10,10],[-10,10]],step:[1,1],gridStep:[1,1],snapStep:[1,1],valid:!0,backgroundImage:I,markings:"graph",showProtractor:!1,showRuler:!1,showTooltips:!1,rulerLabel:"",rulerTicks:10}},getInitialState:function(){return this.stateFromProps(this.props)},componentDidMount:function(){this._isMounted=!0,this.changeGraph=i.debounce(this.changeGraph,300)},UNSAFE_componentWillReceiveProps:function(e){(!i.isEqual(this.props.labels,e.labels)||!i.isEqual(this.props.gridStep,e.gridStep)||!i.isEqual(this.props.snapStep,e.snapStep)||!i.isEqual(this.props.step,e.step)||!i.isEqual(this.props.range,e.range)||!i.isEqual(this.props.backgroundImage,e.backgroundImage))&&this.setState(this.stateFromProps(e))},componentWillUnmount:function(){this._isMounted=!1},stateFromProps:function(e){return{labelsTextbox:e.labels,gridStepTextbox:e.gridStep,snapStepTextbox:e.snapStep,stepTextbox:e.step,rangeTextbox:e.range,backgroundImage:i.clone(e.backgroundImage)}},change(...e){return T.apply(this,e)},changeRulerLabel:function(e){this.change({rulerLabel:e.target.value})},changeRulerTicks:function(e){this.change({rulerTicks:+e.target.value})},changeBackgroundUrl:function(e){if(e.type==="keypress"&&e.key!=="Enter")return;const s=(l,c,h)=>{const r=i.clone(this.props.backgroundImage);r.url=l,r.width=c,r.height=h,this.setState({backgroundImage:r},this.changeGraph)},a=N.findDOMNode(this.refs["bg-url"]).value;a?g.getImageSize(a,(l,c)=>{this._isMounted&&s(a,l,c)}):s(null,0,0)},renderLabelChoices:function(e){return i.map(e,function(s){return t("option",{value:s[1],children:s[0]})})},validRange:function(e){return i.every(e,function(a){return i.isFinite(a)})?e[0]>=e[1]?"Range must have a higher number on the right":!0:"Range must be a valid number"},validateStepValue:function(e){const{step:s,range:a,name:l,minTicks:c,maxTicks:h}=e;if(!i.isFinite(s))return l+" must be a valid number";const r=C(a,s);return r<c?l+" is too large, there must be at least "+c+" ticks.":r>h?l+" is too small, there can be at most "+h+" ticks.":!0},validSnapStep:function(e,s){return this.validateStepValue({step:e,range:s,name:"Snap step",minTicks:5,maxTicks:60})},validGridStep:function(e,s){return this.validateStepValue({step:e,range:s,name:"Grid step",minTicks:3,maxTicks:60})},validStep:function(e,s){return this.validateStepValue({step:e,range:s,name:"Step",minTicks:3,maxTicks:20})},validBackgroundImageSize:function(e){return e.url?e.width<=450&&e.height<=450?!0:"Image must be smaller than 450px x 450px.":!0},validateGraphSettings:function(e,s,a,l,c){const h=this;let r;if(!i.every(e,function(p){return r=h.validRange(p),r===!0})||!i.every(s,function(p,d){return r=h.validStep(p,e[d]),r===!0})||!i.every(a,function(p,d){return r=h.validGridStep(p,e[d]),r===!0})||!i.every(l,function(p,d){return r=h.validSnapStep(p,e[d]),r===!0}))return r;const S=this.validBackgroundImageSize(c);return S!==!0?(r=S,r):!0},changeLabel:function(e,s){const a=s.target.value,l=this.state.labelsTextbox.slice();l[e]=a,this.setState({labelsTextbox:l},this.changeGraph)},changeRange:function(e,s){const a=this.state.rangeTextbox.slice();a[e]=s;const l=this.state.stepTextbox.slice(),c=this.state.gridStepTextbox.slice(),h=this.state.snapStepTextbox.slice(),r=g.scaleFromExtent(a[e],this.props.box[e]);this.validRange(a[e])===!0&&(l[e]=g.tickStepFromExtent(a[e],this.props.box[e]),c[e]=g.gridStepFromTickStep(l[e],r),h[e]=c[e]/2),this.setState({stepTextbox:l,gridStepTextbox:c,snapStepTextbox:h,rangeTextbox:a},this.changeGraph)},changeStep:function(e){this.setState({stepTextbox:e},this.changeGraph)},changeSnapStep:function(e){this.setState({snapStepTextbox:e},this.changeGraph)},changeGridStep:function(e){this.setState({gridStepTextbox:e,snapStepTextbox:i.map(e,function(s){return s/2})},this.changeGraph)},changeGraph:function(){const e=this.state.labelsTextbox,s=i.map(this.state.rangeTextbox,function(b){return i.map(b,Number)}),a=i.map(this.state.stepTextbox,Number),l=this.state.gridStepTextbox,c=this.state.snapStepTextbox,h=this.state.backgroundImage,r=this.validateGraphSettings(s,a,l,c,h);r===!0?this.change({valid:!0,labels:e,range:s,step:a,gridStep:l,snapStep:c,backgroundImage:h}):this.change({valid:r})},render:function(){const e=[f.roundTo(2,g.scaleFromExtent(this.props.range[0],this.props.box[0])),f.roundTo(2,g.scaleFromExtent(this.props.range[1],this.props.box[1]))],{TeX:s}=k();return o("div",{children:[i.contains(this.props.editableSettings,"canvas")&&o("div",{className:"graph-settings",children:[o("div",{className:"perseus-widget-row",children:[t("label",{htmlFor:"canvas-size",children:"Canvas size (x,y pixels)"}),t(u,{id:"canvas-size",value:this.props.box,onChange:a=>{this.change({box:a})}})]}),o("div",{className:"perseus-widget-row",children:["Scale (px per div):"," ",t(s,{children:"("+e[0]+", "+e[1]+")"})]})]}),i.contains(this.props.editableSettings,"graph")&&o("div",{className:"graph-settings",children:[o("div",{className:"perseus-widget-row",children:[o("div",{className:"perseus-widget-left-col",children:[t("label",{htmlFor:"labels-x",children:"x Label"}),t("input",{id:"labels-x",type:"text",className:"graph-settings-axis-label",ref:"labels-0",onChange:a=>this.changeLabel(0,a),value:this.state.labelsTextbox[0]||""})]}),o("div",{className:"perseus-widget-right-col",children:[t("label",{htmlFor:"labels-y",children:"y Label"}),t("input",{id:"labels-y",type:"text",className:"graph-settings-axis-label",ref:"labels-1",onChange:a=>this.changeLabel(1,a),value:this.state.labelsTextbox[1]||""})]})]}),o("div",{className:"perseus-widget-row",children:[o("div",{className:"perseus-widget-left-col",children:[t("label",{htmlFor:"range-x",children:"x Range"}),t(u,{id:"range-x",value:this.state.rangeTextbox[0],onChange:a=>this.changeRange(0,a)})]}),o("div",{className:"perseus-widget-right-col",children:[t("label",{htmlFor:"range-y",children:"y Range"}),t(u,{id:"range-y",value:this.state.rangeTextbox[1],onChange:a=>this.changeRange(1,a)})]})]}),o("div",{className:"perseus-widget-row",children:[o("div",{className:"perseus-widget-left-col",children:[t("label",{htmlFor:"tick-step",children:"Tick Step"}),t(u,{id:"tick-step",value:this.state.stepTextbox,onChange:this.changeStep})]}),o("div",{className:"perseus-widget-right-col",children:[t("label",{htmlFor:"grid-step",children:"Grid Step"}),t(u,{id:"grid-step",value:this.state.gridStepTextbox,onChange:this.changeGridStep})]})]}),i.contains(this.props.editableSettings,"snap")&&t("div",{className:"perseus-widget-row",children:o("div",{className:"perseus-widget-left-col",children:[t("label",{htmlFor:"snap-step",children:"Snap Step"}),t(u,{id:"snap-step",value:this.state.snapStepTextbox,onChange:this.changeSnapStep})]})}),o("div",{className:"perseus-widget-row",children:[t("label",{children:"Markings: "}),t(R,{value:this.props.markings,allowEmpty:!1,buttons:[{value:"graph",content:"Graph"},{value:"grid",content:"Grid"},{value:"none",content:"None"}],onChange:this.change("markings")})]}),t("div",{className:"perseus-widget-left-col",children:t(m,{label:"Show tooltips",showTooltips:this.props.showTooltips,onChange:this.change})})]}),i.contains(this.props.editableSettings,"image")&&o("div",{className:"image-settings",children:[t("div",{children:"Background image:"}),o("div",{children:[t("label",{htmlFor:"bg-url",children:"Url:"}),t("input",{id:"bg-url",type:"text",className:"graph-settings-background-url",ref:"bg-url",value:this.state.backgroundImage.url||"",onChange:a=>{const l=i.clone(this.props.backgroundImage);l.url=a.target.value,this.setState({backgroundImage:l})},onKeyPress:this.changeBackgroundUrl,onBlur:this.changeBackgroundUrl}),t(G,{children:t("p",{children:'Create an image in graphie, or use the "Add image" function to create a background.'})})]})]}),i.contains(this.props.editableSettings,"measure")&&o("div",{className:"misc-settings",children:[o("div",{className:"perseus-widget-row",children:[t("div",{className:"perseus-widget-left-col",children:t(m,{label:"Show ruler",showRuler:this.props.showRuler,onChange:this.change})}),t("div",{className:"perseus-widget-right-col",children:t(m,{label:"Show protractor",showProtractor:this.props.showProtractor,onChange:this.change})})]}),this.props.showRuler&&o("div",{children:[t("div",{children:o("label",{children:[" ","Ruler label:"," ",o("select",{onChange:this.changeRulerLabel,value:this.props.rulerLabel,children:[t("option",{value:"",children:"None"}),t("optgroup",{label:"Metric",children:this.renderLabelChoices([["milimeters","mm"],["centimeters","cm"],["meters","m"],["kilometers","km"]])}),t("optgroup",{label:"Imperial",children:this.renderLabelChoices([["inches","in"],["feet","ft"],["yards","yd"],["miles","mi"]])})]})]})}),t("div",{children:o("label",{children:[" ","Ruler ticks:"," ",t("select",{onChange:this.changeRulerTicks,value:this.props.rulerTicks,children:i.map([1,2,4,8,10,16],function(a){return t("option",{value:a,children:a})})})]})})]})]})]})}}),te=F;export{te as G};
