var he=Object.defineProperty;var ge=(t,e,s)=>e in t?he(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var g=(t,e,s)=>ge(t,typeof e!="symbol"?e+"":e,s);import{ba as ve,_ as m,r as w,a7 as d,j as a,x as j,bR as ye,bS as xe,bT as be,bb as we,bc as je,bU as qe,bV as Ne}from"./iframe-CARR3CRw.js";import"./article-editor-QVc2YAGm.js";import"./icon-paths-EzJJVk3X.js";import"./content-preview-DTzhfUzk.js";import"./item-version-jpbmxoyV.js";import"./article-renderer-DIfYlISB.js";import"./server-item-renderer-CMrkfZ4J.js";import"./hints-renderer-CKEH7T-_.js";import{c as Z}from"./components-C7O69W5k.js";import"./editor-page-C2ykGQ7v.js";import{A as Re}from"./register-all-widgets-and-editors-for-testing-Bsr0TZ-9.js";/* empty css                       */const ke="@khanacademy/perseus-editor",Ce="__lib_version__";ve(ke,Ce);function H(t){return{newPos:t.newPos,components:t.components.slice(0)}}function ee(t){for(var e=[],s=0;s<t.length;s++)t[s]&&e.push(t[s]);return e}function Oe(t){var e=t;return e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/"/g,"&quot;"),e}var q=function(t){this.ignoreWhitespace=t};q.prototype={diff:function(t,e){if(e===t)return[{value:e}];if(!e)return[{value:t,removed:!0}];if(!t)return[{value:e,added:!0}];e=this.tokenize(e),t=this.tokenize(t);var s=e.length,n=t.length,i=s+n,o=[{newPos:-1,components:[]}],r=this.extractCommon(o[0],e,t,0);if(o[0].newPos+1>=s&&r+1>=n)return o[0].components;for(var p=1;p<=i;p++)for(var f=-1*p;f<=p;f+=2){var l,c=o[f-1],u=o[f+1];r=(u?u.newPos:0)-f,c&&(o[f-1]=void 0);var h=c&&c.newPos+1<s,v=u&&0<=r&&r<n;if(!h&&!v){o[f]=void 0;continue}!h||v&&c.newPos<u.newPos?(l=H(u),this.pushComponent(l.components,t[r],void 0,!0)):(l=H(c),l.newPos++,this.pushComponent(l.components,e[l.newPos],!0,void 0));var r=this.extractCommon(l,e,t,f);if(l.newPos+1>=s&&r+1>=n)return l.components;o[f]=l}},pushComponent:function(t,e,s,n){var i=t[t.length-1];i&&i.added===s&&i.removed===n?t[t.length-1]={value:this.join(i.value,e),added:s,removed:n}:t.push({value:e,added:s,removed:n})},extractCommon:function(t,e,s,n){for(var i=e.length,o=s.length,r=t.newPos,p=r-n;r+1<i&&p+1<o&&this.equals(e[r+1],s[p+1]);)r++,p++,this.pushComponent(t.components,e[r],void 0,void 0);return t.newPos=r,p},equals:function(t,e){var s=/\S/;return this.ignoreWhitespace&&!s.test(t)&&!s.test(e)?!0:t===e},join:function(t,e){return t+e},tokenize:function(t){return t}};var Ee=new q,se=new q(!0),te=new q;se.tokenize=te.tokenize=function(t){return ee(t.split(/(\s+|\b)/))};var ne=new q(!0);ne.tokenize=function(t){return ee(t.split(/([{}:;,]|\s+)/))};var V=new q;V.tokenize=function(t){for(var e=[],s=t.split(/^/m),n=0;n<s.length;n++){var i=s[n],o=s[n-1];i==`
`&&o&&o[o.length-1]==="\r"?e[e.length-1]+=`
`:i&&e.push(i)}return e};const re={Diff:q,diffChars:function(t,e){return Ee.diff(t,e)},diffWords:function(t,e){return se.diff(t,e)},diffWordsWithSpace:function(t,e){return te.diff(t,e)},diffLines:function(t,e){return V.diff(t,e)},diffCss:function(t,e){return ne.diff(t,e)},createPatch:function(t,e,s,n,i){var o=[];o.push("Index: "+t),o.push("==================================================================="),o.push("--- "+t+(typeof n>"u"?"":"	"+n)),o.push("+++ "+t+(typeof i>"u"?"":"	"+i));var r=V.diff(e,s);r[r.length-1].value||r.pop(),r.push({value:"",lines:[]});function p(R){return R.map(function(E){return" "+E})}function f(R,E,I){var G=r[r.length-2],ce=E===r.length-2,me=E===r.length-3&&(I.added!==G.added||I.removed!==G.removed);!/\n$/.test(I.value)&&(ce||me)&&R.push("\\ No newline at end of file")}for(var l=0,c=0,u=[],h=1,v=1,y=0;y<r.length;y++){var x=r[y],b=x.lines||x.value.replace(/\n$/,"").split(`
`);if(x.lines=b,x.added||x.removed){if(!l){var U=r[y-1];l=h,c=v,U&&(u=p(U.lines.slice(-4)),l-=u.length,c-=u.length)}u.push.apply(u,b.map(function(R){return(x.added?"+":"-")+R})),f(u,y,x),x.added?v+=b.length:h+=b.length}else{if(l)if(b.length<=8&&y<r.length-2)u.push.apply(u,p(b));else{var W=Math.min(b.length,4);o.push("@@ -"+l+","+(h-l+W)+" +"+c+","+(v-c+W)+" @@"),o.push.apply(o,u),o.push.apply(o,p(b.slice(0,W))),b.length<=4&&f(o,y,x),l=0,c=0,u=[]}h+=b.length,v+=b.length}}return o.join(`
`)+`
`},applyPatch:function(t,e){for(var s=e.split(`
`),n=[],i=!1,o=!1,r=s[0][0]==="I"?4:0;r<s.length;r++)if(s[r][0]==="@"){var p=s[r].split(/@@ -(\d+),(\d+) \+(\d+),(\d+) @@/);n.unshift({start:p[3],oldlength:p[2],oldlines:[],newlength:p[4],newlines:[]})}else s[r][0]==="+"?n[0].newlines.push(s[r].substr(1)):s[r][0]==="-"?n[0].oldlines.push(s[r].substr(1)):s[r][0]===" "?(n[0].newlines.push(s[r].substr(1)),n[0].oldlines.push(s[r].substr(1))):s[r][0]==="\\"&&(s[r-1][0]==="+"?i=!0:s[r-1][0]==="-"&&(o=!0));for(var f=t.split(`
`),r=n.length-1;r>=0;r--){for(var l=n[r],c=0;c<l.oldlength;c++)if(f[l.start-1+c]!==l.oldlines[c])return!1;Array.prototype.splice.apply(f,[l.start-1,+l.oldlength].concat(l.newlines))}if(i)for(;!f[f.length-1];)f.pop();else o&&f.push("");return f.join(`
`)},convertChangesToXML:function(t){for(var e=[],s=0;s<t.length;s++){var n=t[s];n.added?e.push("<ins>"):n.removed&&e.push("<del>"),e.push(Oe(n.value)),n.added?e.push("</ins>"):n.removed&&e.push("</del>")}return e.join("")},convertChangesToDMP:function(t){for(var e=[],s,n=0;n<t.length;n++)s=t[n],e.push([s.added?1:s.removed?-1:0,s.value]);return e}},Pe=function(t){const e=[];let s=[];return m.each(t,n=>{const i=n.value.split(`
`);m.each(i,(o,r)=>{r>0&&(e.push(s),s=[]);const f=m.extend({},n,{value:o});s.push(f)})}),s.length&&e.push(s),e},Te=function(t){return t.added?"added":t.removed?"removed":"unchanged"},Ae=t=>m.map(t.value,e=>({value:e,status:Te(t)})),De=function(t,e){return m.flatten(m.map(t,e),!0)},L=new re.Diff;L.tokenize=t=>m.map(t,e=>[e]);L.join=(t,e)=>t.concat(e);L.equals=m.isEqual;const Le=t=>De(t,Ae),We=function(t,e){const s=L.diff(t,e),n=Le(s);return{before:m.filter(n,i=>i.status!=="added"),after:m.filter(n,i=>i.status!=="removed")}},{SvgImage:Ie}=Z,_="before",F="after",_e=/http.*?\.png|web\+graphie[^)]*/g,J=function(t){return t.match(_e)||[]},B=function(t,e,s){return t.added?e:t.removed?s:""};class ie extends w.Component{render(){return a.jsx("div",{children:m.map(this.props.images,(e,s)=>{const n=j({image:!0,"image-unchanged":e.status==="unchanged","image-added":e.status==="added","image-removed":e.status==="removed"});return a.jsx("div",{children:a.jsx("div",{className:n,children:a.jsx(Ie,{src:e.value,title:e.value})})},s)})})}}g(ie,"propTypes",{images:d.arrayOf(d.shape({})).isRequired});class T extends w.Component{constructor(){super(...arguments);g(this,"state",{collapsed:this.props.before===this.props.after});g(this,"handleExpand",()=>{this.setState({collapsed:!1})})}UNSAFE_componentWillReceiveProps(s){this.setState({collapsed:s.before===s.after})}render(){const s=re.diffWords(this.props.before,this.props.after),n=Pe(s),i=J(this.props.before),o=J(this.props.after),r=We(i,o),p=m.map(n,l=>{const c={};return c.before=m(l).map(function(u,h){return a.jsx("span",{className:B(u,"not-present","removed dark"),children:u.value},h)}),c.after=m(l).map(function(u,h){return a.jsx("span",{className:B(u,"added dark","not-present"),children:u.value},h)}),c}),f=j({"diff-row":!0,collapsed:this.state.collapsed});return a.jsxs("div",{children:[a.jsx("div",{className:"diff-header",children:this.props.title}),a.jsx("div",{className:"diff-header",children:this.props.title}),a.jsx("div",{className:"diff-body ui-helper-clearfix",children:m.map([_,F],(l,c)=>a.jsxs("div",{className:"diff-row "+l,children:[!this.state.collapsed&&m.map(p,(u,h)=>{const v=u[l].length>1,y=j({"diff-line":!0,added:l===F&&v,removed:l===_&&v});return a.jsx("div",{className:y,children:u[l]},h)}),!this.state.collapsed&&a.jsx(ie,{images:r[l]})]},c))}),m.map([_,F],(l,c)=>a.jsx("div",{className:f+" "+l,onClick:this.handleExpand,children:this.state.collapsed&&a.jsx("span",{children:a.jsxs("span",{className:"expand-button",children:[" ","[ show unmodified ]"," "]})})},c))]})}}g(T,"propTypes",{after:d.string,before:d.string,title:d.string.isRequired}),g(T,"defaultProps",{after:"",before:""});T.__docgenInfo={description:"",methods:[{name:"handleExpand",docblock:null,modifiers:[],params:[],returns:null}],displayName:"TextDiff",props:{after:{defaultValue:{value:'""',computed:!1},description:"",type:{name:"string"},required:!1},before:{defaultValue:{value:'""',computed:!1},description:"",type:{name:"string"},required:!1},title:{description:"",type:{name:"string"},required:!0}}};const K="unchanged",ae="changed",oe="added",de="removed",Fe=function(t,e,s){let n;return t===e?n=K:t===void 0?n=oe:e===void 0?n=de:n=ae,{after:JSON.stringify(e),before:JSON.stringify(t),children:[],key:s,status:n}},Ve=function(t,e,s){const n=m.isObject(t)?m(t).keys():[],i=m.isObject(e)?m(e).keys():[],o=m.union(n,i),r=m.map(o,function(f){return le((t||{})[f],(e||{})[f],f)});let p;return t===void 0?p=oe:e===void 0?p=de:p=m.any(r,function(l){return l.status!==K})?ae:K,{after:"",before:"",children:r,key:s,status:p}},le=function(t,e,s){return typeof t=="object"||typeof e=="object"?Ve(t,e,s):Fe(t,e,s)},{SvgImage:Q}=Z,pe=function(t){return(t-1)*20},A="before",D="after",Ke="unchanged";class M extends w.Component{render(){const e=j(this.props.className,{"diff-row":!0,before:this.props.side===A,after:this.props.side===D});return a.jsx("div",{className:e,children:a.jsxs("div",{style:{paddingLeft:pe(this.props.depth)},children:[this.props.showKey&&this.props.propKey+": ",a.jsx("span",{className:"inner-value dark "+this.props.className,children:this.props.value})]})})}}g(M,"propTypes",{className:d.string.isRequired,depth:d.number.isRequired,propKey:d.string.isRequired,showKey:d.bool.isRequired,side:d.oneOf([A,D]).isRequired,value:d.string});class S extends w.Component{render(){const e=this;return a.jsx("div",{onClick:e.props.onClick,style:{clear:"both"},children:m.map([A,D],function(s){return a.jsx("div",{className:"diff-row collapsed "+s,children:a.jsx("div",{style:{paddingLeft:pe(e.props.depth)},children:a.jsx("span",{children:" [ show unmodified ] "})})},s)})})}}g(S,"propTypes",{depth:d.number,onClick:d.func.isRequired}),g(S,"defaultProps",{depth:0});const k=class k extends w.Component{constructor(){super(...arguments);g(this,"state",{expanded:this.props.expanded});g(this,"expand",()=>{this.setState({expanded:!0})})}render(){const s=this.props.entry,n=s.status==="removed",i=s.status==="added",o=s.status==="changed",r=s.children.length>0,p=j({removed:n||o&&!r,dark:n,"blank-space":i}),f=j({added:i||o&&!r,dark:i,"blank-space":n});let l;this.state.expanded?l=s.children:l=m(s.children).select(function(h){return h.status!==Ke});let c=l.length<s.children.length;s.children.length===l.length+1&&(l=s.children,c=!1);const u=this;return a.jsxs("div",{children:[s.key&&a.jsxs("div",{style:{clear:"both"},children:[a.jsx(M,{side:A,className:p,depth:this.props.depth,propKey:s.key,showKey:!i,value:s.before}),a.jsx(M,{side:D,className:f,depth:this.props.depth,propKey:s.key,showKey:!n,value:s.after})]}),m.map(l,function(h){return a.jsx(k,{depth:u.props.depth+1,entry:h,expanded:u.state.expanded},h.key)}),c&&a.jsx(S,{depth:this.props.depth+1,onClick:this.expand})]})}};g(k,"propTypes",{depth:d.number,entry:d.shape({after:d.string,before:d.string,children:d.arrayOf(d.any),key:d.string}),expanded:d.bool}),g(k,"defaultProps",{depth:0});let $=k;class ue extends w.Component{render(){const{before:e,after:s}=this.props,n=e.options&&e.options.backgroundImage?e.options.backgroundImage.url:"",i=s.options&&s.options.backgroundImage?s.options.backgroundImage.url:"";return a.jsxs("div",{children:[a.jsx("div",{className:"diff-row before",children:n&&a.jsx("div",{className:j({image:!0,"image-unchanged":n===i,"image-removed":n!==i}),children:a.jsx(Q,{src:n,title:n})})}),a.jsx("div",{className:"diff-row after",children:i&&a.jsx("div",{className:j({image:!0,"image-unchanged":n===i,"image-added":n!==i}),children:a.jsx(Q,{src:i,title:i})})})]})}}g(ue,"propTypes",{after:d.shape({options:d.objectOf(d.any)}).isRequired,before:d.shape({options:d.objectOf(d.any)}).isRequired});class C extends w.Component{render(){const{after:e,before:s,title:n,type:i}=this.props,o=le(s,e);return a.jsxs("div",{children:[a.jsx("div",{className:"diff-header",children:n}),a.jsx("div",{className:"diff-header",children:n}),a.jsxs("div",{className:"diff-body ui-helper-clearfix",children:[i==="image"&&a.jsx(ue,{before:s,after:e}),a.jsx($,{entry:o})]})]})}}g(C,"propTypes",{after:d.shape({options:d.objectOf(d.any)}),before:d.shape({options:d.objectOf(d.any)}),title:d.string.isRequired,type:d.string}),g(C,"defaultProps",{after:{},before:{},type:""});C.__docgenInfo={description:"",methods:[],displayName:"WidgetDiff",props:{after:{defaultValue:{value:"{}",computed:!1},description:"",type:{name:"shape",value:{options:{name:"objectOf",value:{name:"any"},required:!1}}},required:!1},before:{defaultValue:{value:"{}",computed:!1},description:"",type:{name:"shape",value:{options:{name:"objectOf",value:{name:"any"},required:!1}}},required:!1},type:{defaultValue:{value:'""',computed:!1},description:"",type:{name:"string"},required:!1},title:{description:"",type:{name:"string"},required:!0}}};const X=function(t,e){const{alignment:s,graded:n,options:i,type:o}=t||{},r={options:i};return e&&ye(o).length>1&&(r.alignment=s),o==="transformer"&&(r.graded=n),xe(o)&&(r.static=(t==null?void 0:t.static)??void 0),r};class O extends w.Component{render(){const{after:e,before:s,showAlignmentOptions:n,showSeparator:i,title:o}=this.props;let r,p;(s.content||e.content)&&(r=a.jsx(T,{before:s.content,after:e.content,title:o}));const f=Object.keys(s.widgets??{}).filter(c=>s.content.includes(c)),l=Object.keys(e.widgets??{}).filter(c=>e.content.includes(c));return(f.length||l.length)&&(p=m.union(f,l).map(u=>{var h,v,y,x;return a.jsx(C,{before:X((h=s.widgets)==null?void 0:h[u],n),after:X((v=e.widgets)==null?void 0:v[u],n),title:u,type:(((y=s.widgets)==null?void 0:y[u])??{}).type||(((x=e.widgets)==null?void 0:x[u])??{}).type},u)})),a.jsxs("div",{children:[r,p,i&&a.jsx("div",{className:"diff-separator"})]})}}g(O,"defaultProps",{after:{content:"",images:{},widgets:{}},before:{content:"",images:{},widgets:{}},showAlignmentOptions:!1,showSeparator:!1});O.__docgenInfo={description:"",methods:[],displayName:"RendererDiff",props:{after:{required:!1,tsType:{name:"signature",type:"object",raw:`{
    content: string;
    // NOTE: images and widgets may not be set for some items hints,
    // specifically in old revisions, which may only be loaded for diffing.
    widgets: PerseusRenderer["widgets"] | null | undefined;
    images: PerseusRenderer["images"] | null | undefined;
}`,signature:{properties:[{key:"content",value:{name:"string",required:!0}},{key:"widgets",value:{name:"union",raw:'PerseusRenderer["widgets"] | null | undefined',elements:[{name:"signature",raw:'PerseusRenderer["widgets"]'},{name:"null"},{name:"undefined"}],required:!0}},{key:"images",value:{name:"union",raw:'PerseusRenderer["images"] | null | undefined',elements:[{name:"signature",raw:'PerseusRenderer["images"]'},{name:"null"},{name:"undefined"}],required:!0}}]}},description:"",defaultValue:{value:`{
    content: "",
    images: {},
    widgets: {},
}`,computed:!1}},before:{required:!1,tsType:{name:"signature",type:"object",raw:`{
    content: string;
    // NOTE: images and widgets may not be set for some items hints,
    // specifically in old revisions, which may only be loaded for diffing.
    widgets: PerseusRenderer["widgets"] | null | undefined;
    images: PerseusRenderer["images"] | null | undefined;
}`,signature:{properties:[{key:"content",value:{name:"string",required:!0}},{key:"widgets",value:{name:"union",raw:'PerseusRenderer["widgets"] | null | undefined',elements:[{name:"signature",raw:'PerseusRenderer["widgets"]'},{name:"null"},{name:"undefined"}],required:!0}},{key:"images",value:{name:"union",raw:'PerseusRenderer["images"] | null | undefined',elements:[{name:"signature",raw:'PerseusRenderer["images"]'},{name:"null"},{name:"undefined"}],required:!0}}]}},description:"",defaultValue:{value:`{
    content: "",
    images: {},
    widgets: {},
}`,computed:!1}},showAlignmentOptions:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},showSeparator:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},title:{required:!0,tsType:{name:"string"},description:""}}};const P=d.shape({content:d.string,images:d.objectOf(d.any),widgets:d.objectOf(d.any)}),N=class N extends w.Component{constructor(){super(...arguments);g(this,"state",N._stateFromProps(this.props))}UNSAFE_componentWillReceiveProps(s){this.setState(N._stateFromProps(s))}render(){const{before:s,after:n}=this.state,i=Math.max(s.length,n.length),o=m.times(i,r=>a.jsx(O,{before:r<s.length?s[r]:void 0,after:r<n.length?n[r]:void 0,title:`Section ${r+1}`,showAlignmentOptions:!0,showSeparator:r<i-1},r));return a.jsx("div",{className:"framework-perseus",children:o})}};g(N,"propTypes",{after:d.oneOfType([P,d.arrayOf(P)]).isRequired,before:d.oneOfType([P,d.arrayOf(P)]).isRequired}),g(N,"_stateFromProps",s=>{const{before:n,after:i}=s;return{before:Array.isArray(n)?n:[n],after:Array.isArray(i)?i:[i]}});let z=N;z.__docgenInfo={description:"",methods:[{name:"_stateFromProps",docblock:null,modifiers:["static"],params:[{name:"props",optional:!1,type:null}],returns:null}],displayName:"ArticleDiff",props:{after:{description:"",type:{name:"union",value:[{name:"custom",raw:"rendererProps"},{name:"arrayOf",value:{name:"custom",raw:"rendererProps"}}]},required:!0},before:{description:"",type:{name:"union",value:[{name:"custom",raw:"rendererProps"},{name:"arrayOf",value:{name:"custom",raw:"rendererProps"}}]},required:!0}}};const Y=d.shape({question:d.shape({}).isRequired,answerArea:d.shape({}).isRequired,hints:d.arrayOf(d.any).isRequired});class fe extends w.Component{render(){const{before:e,after:s}=this.props,n=Math.max(e.hints.length,s.hints.length),i=a.jsx(O,{before:e.question,after:s.question,title:"Question",showAlignmentOptions:!1,showSeparator:!0}),o=a.jsx(C,{before:e.answerArea,after:s.answerArea,title:"Question extras"}),r=m.times(n,function(p){return a.jsx(O,{before:p<e.hints.length?e.hints[p]:void 0,after:p<s.hints.length?s.hints[p]:void 0,title:`Hint ${p+1}`,showAlignmentOptions:!1,showSeparator:p<n-1},p)});return a.jsxs("div",{className:"framework-perseus",children:[i,o,r&&a.jsx("div",{className:"diff-separator"}),r]})}}g(fe,"propTypes",{after:Y.isRequired,before:Y.isRequired});fe.__docgenInfo={description:"",methods:[],displayName:"ItemDiff",props:{after:{description:"",type:{name:"custom",raw:"itemProps.isRequired"},required:!1},before:{description:"",type:{name:"custom",raw:"itemProps.isRequired"},required:!1}}};be(Re);we(je);qe();Ne();
