var C=Object.defineProperty;var I=(f,p,e)=>p in f?C(f,p,{enumerable:!0,configurable:!0,writable:!0,value:e}):f[p]=e;var d=(f,p,e)=>(I(f,typeof p!="symbol"?p+"":p,e),e);import{j as h}from"./jsx-runtime-BT65X5dW.js";import{l as A,p as P,R as U}from"./renderer-DTCW_hQD.js";import{C as D}from"./index-DD9muzfp.js";import{n as x}from"./no-important-DlFk8a1I.js";import{$ as c}from"./jquery-CkHB0_Mt.js";import{r as S}from"./index-C6mWTJJr.js";import{h as v}from"./index-B1Gws05u.js";import{_ as a}from"./index-default-BcKQpA1a.js";import{g as j}from"./dependencies-BsVPGK1s.js";import{U as w}from"./util-Cnd0Ukpp.js";import{a as O}from"./i18n-context-bNNtSo4z.js";const T=(f,p)=>{const e=f.offsetParent();return{top:p.top+e.scrollTop(),left:p.left+e.scrollLeft()}};class F extends S.Component{render(){const{layout:p}=this.props,e=x.css(g.card,g.placeholder,p==="horizontal"&&g.horizontalCard),t={width:this.props.width,height:this.props.height};return this.props.margin!=null&&(t.margin=this.props.margin),h.jsx("li",{className:e,style:t})}}class q extends S.Component{constructor(){super(...arguments);d(this,"animationFrameRequest",null);d(this,"isMouseMoveUpBound");d(this,"_mounted");d(this,"state",{startPosition:{left:0,top:0},startMouse:{left:0,top:0},mouse:{left:0,top:0},dragging:!1});d(this,"getCurrentPosition",()=>({left:this.state.startPosition.left+this.state.mouse.left-this.state.startMouse.left,top:this.state.startPosition.top+this.state.mouse.top-this.state.startMouse.top}));d(this,"bindMouseMoveUp",()=>{this.isMouseMoveUpBound=!0,c(document).on("mousemove",this.onMouseMove),c(document).on("mouseup",this.onMouseUp)});d(this,"unbindMouseMoveUp",()=>{this.isMouseMoveUpBound=!1,c(document).off("mousemove",this.onMouseMove),c(document).off("mouseup",this.onMouseUp)});d(this,"onMouseDown",e=>{if(this.props.state!=="static"||!(e.button===0||e.touches!=null&&e.touches.length===1))return;e.preventDefault();const t=w.extractPointerLocation(e);this.animationFrameRequest=requestAnimationFrame(()=>{const n=c(v.findDOMNode(this)),r=n.position(),s=T(n,r);t&&this._mounted&&this.setState({startPosition:s,startMouse:t,mouse:t,dragging:!0},function(){this.bindMouseMoveUp(),this.props.onMouseDown()})})});d(this,"onMouseMove",e=>{if(this.props.state!=="dragging"||!this.state.dragging)return;e.preventDefault();const n=w.extractPointerLocation(e);n&&(this.animationFrameRequest=requestAnimationFrame(()=>{this.setState({mouse:n},this.props.onMouseMove)}))});d(this,"onMouseUp",e=>{if(this.props.state!=="dragging"||!this.state.dragging)return;e.preventDefault(),w.extractPointerLocation(e)&&(this.setState({dragging:!1}),this.unbindMouseMoveUp(),this.props.onMouseUp())})}componentDidMount(){this._mounted=!0,this.isMouseMoveUpBound=!1,document.addEventListener("touchmove",this.onMouseMove,w.supportsPassiveEvents()?{passive:!1}:!1)}componentDidUpdate(e){if(this.props.state!==e.state)if(this.props.state==="animating"&&this.props.endPosition){const t=this.getCurrentPosition(),n=15*Math.sqrt(Math.sqrt(Math.pow(this.props.endPosition.left-t.left,2)+Math.pow(this.props.endPosition.top-t.top,2)));c(v.findDOMNode(this)).animate(this.props.endPosition,{duration:Math.max(n,1),complete:this.props.onAnimationEnd})}else this.props.state==="static"&&c(v.findDOMNode(this)).finish()}componentWillUnmount(){this._mounted=!1,this.isMouseMoveUpBound&&this.unbindMouseMoveUp(),this.animationFrameRequest&&cancelAnimationFrame(this.animationFrameRequest),document.removeEventListener("touchmove",this.onMouseMove)}render(){const{includePadding:e,layout:t,state:n}=this.props;let r=x.css(g.card,g.draggable,t==="horizontal"&&g.horizontalCard,t==="vertical"&&g.verticalCard,n==="dragging"&&g.dragging,n==="disabled"&&g.disabled,!e&&g.unpaddedCard)+" perseus-sortable-draggable";e||(r+=" perseus-sortable-draggable-unpadded");const s={position:"static"};return(this.props.state==="dragging"||this.props.state==="animating")&&a.extend(s,{position:"absolute"},this.getCurrentPosition()),this.props.width&&(s.width=this.props.width+1),this.props.height&&(s.height=this.props.height),this.props.margin!=null&&(s.margin=this.props.margin),h.jsx("li",{className:r,style:s,onMouseDown:this.onMouseDown,onTouchStart:this.onMouseDown,onTouchMove:this.onMouseMove,onTouchEnd:this.onMouseUp,onTouchCancel:this.onMouseUp,children:h.jsx(U,{content:this.props.content,linterContext:P(this.props.linterContext,"draggable"),onRender:this.props.onRender,strings:this.context.strings})})}}d(q,"contextType",O),d(q,"defaultProps",{includePadding:!0,type:"static",linterContext:A});const b=class b extends S.Component{constructor(e){super(e);d(this,"remeasureItems",a.debounce(()=>{this.setState({items:b.clearItemMeasurements(this.state.items)})},20));this.state={items:b.itemsFromProps(this.props),texRendererLoaded:!1}}static itemsFromProps(e){const t=e.disabled?"disabled":"static";return e.options.map((n,r)=>({option:n,key:r,state:t,width:0,height:0}))}static clearItemMeasurements(e){return e.map(t=>({...t,width:0,height:0}))}UNSAFE_componentWillReceiveProps(e){const t=this.props;a.isEqual(e.options,t.options)?(e.layout!==t.layout||e.padding!==t.padding||e.disabled!==t.disabled||!a.isEqual(e.constraints,t.constraints))&&this.setState({items:b.clearItemMeasurements(this.state.items)}):this.setState({items:b.itemsFromProps(e)})}componentDidUpdate(){this.state.items.length&&!this.state.items[0].width&&!this.state.items[0].height&&setTimeout(()=>{this.measureItems()},0)}measureItems(){let e=[...this.state.items];const t=a.map(e,function(i){return c(v.findDOMNode(this.refs[i.key]))},this),n=a.invoke(t,"outerWidth"),r=a.invoke(t,"outerHeight"),{constraints:s,layout:u}=this.props;let l=null;s!=null&&s.width?l=a.max(n.concat(s.width)):u==="vertical"&&(l=a.max(n));let o=null;s!=null&&s.height?o=a.max(r.concat(s.height)):u==="horizontal"&&(o=a.max(r)),e=a.map(e,function(i,m){return i.width=l||n[m],i.height=o||r[m],i}),this.setState({items:e},()=>{var i,m;(m=(i=this.props).onMeasure)==null||m.call(i,{widths:n,heights:r})})}onMouseDown(e){const t=a.map(this.state.items,function(n){return n.key===e&&(n.state="dragging"),n});this.setState({items:t})}moveOptionToIndex(e,t){var l,o;const{items:n}=this.state;if(t<0||t>n.length)throw new Error(`index ${t} out of bounds`);const r=a.clone(n),s=n.filter(i=>i.option===e)[0];if(s==null)throw new Error(`option ${e} not found`);const u=n.findIndex(i=>i.key===s.key);r.splice(u,1),r.splice(t,0,s),this.setState({items:r}),(o=(l=this.props).onChange)==null||o.call(l,{})}onMouseMove(e){const t=c(v.findDOMNode(this.refs[e])),n=c(v.findDOMNode(this)),r=a.clone(this.state.items),s=a.findWhere(this.state.items,{key:e}),u=this.props.margin||0,l=a.indexOf(r,s);let o=0;if(r.splice(l,1),this.props.layout==="horizontal"){const i=t.offset().left-n.offset().left;let m=0,y;a.each(r,function(M){y=M.width,i>m+y/2&&(o+=1),m+=y+u})}else{const i=t.offset().top-n.offset().top;let m=0,y;a.each(r,function(M){y=M.height,i>m+y/2&&(o+=1),m+=y+u})}o!==l&&(r.splice(o,0,s),this.setState({items:r}))}onMouseUp(e){const t=requestAnimationFrame(()=>{var r,s;const n=a.map(this.state.items,function(u){if(u.key===e){u.state="animating";const l=c(v.findDOMNode(this.refs["placeholder_"+e])),o=l.position(),i=T(l,o);u.endPosition=i}return u},this);this.setState({items:n}),(s=(r=this.props).onChange)==null||s.call(r,{})});this.animationFrameRequest=t}onAnimationEnd(e){const t=a.map(this.state.items,function(n){return n.key===e&&(n.state="static"),n});this.setState({items:t})}getOptions(){return a.pluck(this.state.items,"option")}render(){var u,l;if(this.props.waitForTexRendererToLoad&&!this.state.texRendererLoaded){const{TeX:o}=j();return h.jsxs(h.Fragment,{children:[h.jsx(D,{}),h.jsx("div",{style:{display:"none"},children:h.jsx(o,{onRender:()=>this.setState({texRendererLoaded:!0}),children:"1"})})]})}const e=[],{layout:t}=this.props,n=x.css(g.sortable)+" perseus-sortable",r=((u=this.props.constraints)==null?void 0:u.width)||t==="vertical",s=((l=this.props.constraints)==null?void 0:l.height)||t==="horizontal";return a.each(this.state.items,function(o,i,m){const y=i===m.length-1,M=o.state==="static"||o.state==="disabled";let k;this.props.layout==="horizontal"?k="0 "+this.props.margin+"px 0 0":this.props.layout==="vertical"&&(k="0 0 "+this.props.margin+"px 0"),e.push(h.jsx(q,{content:o.option,state:o.state,ref:o.key,width:r?o.width:void 0,height:s?o.height:void 0,layout:t,includePadding:this.props.padding,margin:y&&M?0:k,endPosition:o.endPosition,linterContext:P(this.props.linterContext,"sortable"),onRender:this.remeasureItems,onMouseDown:this.onMouseDown.bind(this,o.key),onMouseMove:this.onMouseMove.bind(this,o.key),onMouseUp:this.onMouseUp.bind(this,o.key),onTouchMove:this.onMouseMove.bind(this,o.key),onTouchEnd:this.onMouseUp.bind(this,o.key),onTouchCancel:this.onMouseUp.bind(this,o.key),onAnimationEnd:this.onAnimationEnd.bind(this,o.key)},o.key)),(o.state==="dragging"||o.state==="animating")&&e.push(h.jsx(F,{ref:"placeholder_"+o.key,width:o.width,height:o.height,layout:t,margin:y?0:k},"placeholder_"+o.key))},this),h.jsx("ul",{className:n,children:e})}};d(b,"defaultProps",{layout:"horizontal",padding:!0,disabled:!1,constraints:{},onMeasure:function(){},margin:5,onChange:function(){},linterContext:A,waitForTexRendererToLoad:!0});let R=b;const g=x.StyleSheet.create({sortable:{boxSizing:"border-box",float:"left",padding:0,margin:0},card:{boxSizing:"border-box",background:"#fff",border:"1px solid #ddd",borderRadius:4,cursor:"pointer",minWidth:25,minHeight:44,padding:10,listStyleType:"none",userSelect:"none",touchAction:"none"},placeholder:{background:"#ddd",border:"1px solid #ccc"},draggable:{textAlign:"center"},horizontalCard:{float:"left",cursor:"ew-resize"},verticalCard:{maxWidth:"100%",cursor:"ns-resize"},unpaddedCard:{padding:0},dragging:{background:"#ffedcd",opacity:.8},disabled:{backgroundColor:"inherit",border:"1px solid transparent",cursor:"default"}});R.__docgenInfo={description:"",methods:[{name:"itemsFromProps",docblock:null,modifiers:["static"],params:[{name:"props",optional:!1,type:{name:"signature",type:"object",raw:`{
    disabled: boolean;
    options: ReadonlyArray<SortableOption>;
}`,signature:{properties:[{key:"disabled",value:{name:"boolean",required:!0}},{key:"options",value:{name:"ReadonlyArray",elements:[{name:"string"}],raw:"ReadonlyArray<SortableOption>",required:!0}}]}}}],returns:{type:{name:"ReadonlyArray",elements:[{name:"signature",type:"object",raw:`{
    option: SortableOption;
    key: number;
    state: ItemState;
    endPosition?: Position;
    width: number;
    height: number;
}`,signature:{properties:[{key:"option",value:{name:"string",required:!0}},{key:"key",value:{name:"number",required:!0}},{key:"state",value:{name:"ItemState",required:!0}},{key:"endPosition",value:{name:"signature",type:"object",raw:`{
    top: number;
    left: number;
}`,signature:{properties:[{key:"top",value:{name:"number",required:!0}},{key:"left",value:{name:"number",required:!0}}]},required:!1}},{key:"width",value:{name:"number",required:!0}},{key:"height",value:{name:"number",required:!0}}]}}],raw:"ReadonlyArray<SortableItem>"}}},{name:"clearItemMeasurements",docblock:null,modifiers:["static"],params:[{name:"items",optional:!1,type:{name:"ReadonlyArray",elements:[{name:"signature",type:"object",raw:`{
    option: SortableOption;
    key: number;
    state: ItemState;
    endPosition?: Position;
    width: number;
    height: number;
}`,signature:{properties:[{key:"option",value:{name:"string",required:!0}},{key:"key",value:{name:"number",required:!0}},{key:"state",value:{name:"ItemState",required:!0}},{key:"endPosition",value:{name:"signature",type:"object",raw:`{
    top: number;
    left: number;
}`,signature:{properties:[{key:"top",value:{name:"number",required:!0}},{key:"left",value:{name:"number",required:!0}}]},required:!1}},{key:"width",value:{name:"number",required:!0}},{key:"height",value:{name:"number",required:!0}}]}}],raw:"ReadonlyArray<SortableItem>",alias:"ReadonlyArray"}}],returns:{type:{name:"ReadonlyArray",elements:[{name:"signature",type:"object",raw:`{
    option: SortableOption;
    key: number;
    state: ItemState;
    endPosition?: Position;
    width: number;
    height: number;
}`,signature:{properties:[{key:"option",value:{name:"string",required:!0}},{key:"key",value:{name:"number",required:!0}},{key:"state",value:{name:"ItemState",required:!0}},{key:"endPosition",value:{name:"signature",type:"object",raw:`{
    top: number;
    left: number;
}`,signature:{properties:[{key:"top",value:{name:"number",required:!0}},{key:"left",value:{name:"number",required:!0}}]},required:!1}},{key:"width",value:{name:"number",required:!0}},{key:"height",value:{name:"number",required:!0}}]}}],raw:"ReadonlyArray<SortableItem>"}}},{name:"measureItems",docblock:null,modifiers:[],params:[],returns:null},{name:"onMouseDown",docblock:null,modifiers:[],params:[{name:"key",optional:!1,type:{name:"number",raw:'SortableItem["key"]'}}],returns:null},{name:"moveOptionToIndex",docblock:null,modifiers:[],params:[{name:"option",optional:!1,type:{name:"string",alias:"SortableOption"}},{name:"index",optional:!1,type:{name:"number"}}],returns:null},{name:"onMouseMove",docblock:null,modifiers:[],params:[{name:"key",optional:!1,type:{name:"number",raw:'SortableItem["key"]'}}],returns:null},{name:"onMouseUp",docblock:null,modifiers:[],params:[{name:"key",optional:!1,type:{name:"number",raw:'SortableItem["key"]'}}],returns:null},{name:"onAnimationEnd",docblock:null,modifiers:[],params:[{name:"key",optional:!1,type:{name:"number",raw:'SortableItem["key"]'}}],returns:null},{name:"getOptions",docblock:null,modifiers:[],params:[],returns:{type:{name:"ReadonlyArray",elements:[{name:"string"}],raw:"ReadonlyArray<SortableOption>"}}}],displayName:"Sortable",props:{constraints:{required:!1,tsType:{name:"union",raw:`| {
      width: number;
      height: number;
  }
| Record<any, any>`,elements:[{name:"signature",type:"object",raw:`{
    width: number;
    height: number;
}`,signature:{properties:[{key:"width",value:{name:"number",required:!0}},{key:"height",value:{name:"number",required:!0}}]}},{name:"Record",elements:[{name:"any"},{name:"any"}],raw:"Record<any, any>"}]},description:"",defaultValue:{value:"{}",computed:!1}},disabled:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},layout:{required:!1,tsType:{name:"union",raw:'"horizontal" | "vertical"',elements:[{name:"literal",value:'"horizontal"'},{name:"literal",value:'"vertical"'}]},description:"",defaultValue:{value:'"horizontal"',computed:!1}},margin:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"5",computed:!1}},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(arg1: any) => void",signature:{arguments:[{type:{name:"any"},name:"arg1"}],return:{name:"void"}}},description:"",defaultValue:{value:"function () {}",computed:!1}},onMeasure:{required:!1,tsType:{name:"signature",type:"function",raw:`(arg1: {
    widths: ReadonlyArray<number>;
    heights: ReadonlyArray<number>;
}) => void`,signature:{arguments:[{type:{name:"signature",type:"object",raw:`{
    widths: ReadonlyArray<number>;
    heights: ReadonlyArray<number>;
}`,signature:{properties:[{key:"widths",value:{name:"ReadonlyArray",elements:[{name:"number"}],raw:"ReadonlyArray<number>",required:!0}},{key:"heights",value:{name:"ReadonlyArray",elements:[{name:"number"}],raw:"ReadonlyArray<number>",required:!0}}]}},name:"arg1"}],return:{name:"void"}}},description:"",defaultValue:{value:"function () {}",computed:!1}},padding:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},linterContext:{required:!1,tsType:{name:"signature",type:"object",raw:`{
    contentType: string;
    highlightLint: boolean;
    paths: ReadonlyArray<string>;
    stack: ReadonlyArray<string>;
    // additional properties can be added to the context by widgets
}`,signature:{properties:[{key:"contentType",value:{name:"string",required:!0}},{key:"highlightLint",value:{name:"boolean",required:!0}},{key:"paths",value:{name:"ReadonlyArray",elements:[{name:"string"}],raw:"ReadonlyArray<string>",required:!0}},{key:"stack",value:{name:"ReadonlyArray",elements:[{name:"string"}],raw:"ReadonlyArray<string>",required:!0}}]}},description:"",defaultValue:{value:`{
    contentType: "",
    highlightLint: false,
    paths: [] as ReadonlyArray<any>,
    stack: [] as ReadonlyArray<any>,
}`,computed:!1}},options:{required:!0,tsType:{name:"ReadonlyArray",elements:[{name:"string"}],raw:"ReadonlyArray<SortableOption>"},description:""},waitForTexRendererToLoad:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}}}};export{R as S};
