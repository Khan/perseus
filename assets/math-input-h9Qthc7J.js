import{j as r,a as C}from"./jsx-runtime-5BUNAZ9W.js";import"./prop-types-YsygvcjT.js";import{a as y,c as T,g as d,m as w}from"./key-translator-j0G40g1J.js";import{C as R,K as S}from"./mobile-keypad-IrtOMiuu.js";import{M as K,c as q}from"./button-assets-W0P3gTHH.js";import{C as F}from"./index-AFG5vh6r.js";import{V as k}from"./index-e4P84RkC.js";import{P as _,a as B}from"./index-uYl2mQzu.js";import{c as o,s as b}from"./index-lUErx3pE.js";import{l as A}from"./index-awljIyHI.js";import{c as W}from"./index-dnMhQZ-1.js";import{$ as E}from"./jquery-5v7aFUvu.js";import{r as u}from"./index-4g5l5LRQ.js";import{_ as O}from"./index-default-4_ZsnO94.js";import{P}from"./i18n-context-3gTlIcWM.js";const V=(l,e)=>{let t=null;return(...s)=>{t&&clearTimeout(t),t=window.setTimeout(()=>{l(...s)},e)}},p=class p extends u.Component{constructor(){super(...arguments),this.__mathFieldWrapperRef=null,this.__mathField=null,this.state={focused:!1,keypadOpen:this.props.buttonsVisible==="always",cursorContext:R.NONE},this.insert=e=>{const t=this.mathField(),{locale:s}=this.context,i={...y(s),FRAC:c=>{const x=c.latex();c.typedText("/"),c.latex()===x&&c.cmd("\\frac")}}[e];if(i){i(t,e),t==null||t.focus();return}O(e).isFunction()?e(t):e[0]==="\\"?t==null||t.cmd(e).focus():t==null||t.write(e).focus(),t==null||t.focus()},this.mathField=()=>{if(!this.__mathField&&this.__mathFieldWrapperRef){const{locale:e}=this.context;this.__mathField=T(this.__mathFieldWrapperRef,e,this.props.mathInputStrings,t=>({...t,handlers:{edit:V(s=>{let a=s.latex();if(a=a.replace(/<>/g,"\\ne"),q(e,this.props.convertDotToTimes)){a=a.replace(/\\cdot/g,"\\times");const i=s.cursor()[w.L];i&&i.ctrlSeq==="\\cdot "&&(s.controller().backspace(),s.cmd("\\times"))}else a=a.replace(/\\times/g,"\\cdot");this.props.value!==a&&this.props.onChange(a),this.setState({cursorContext:d(s)})},100),enter:()=>{this.__mathFieldWrapperRef&&E(this.__mathFieldWrapperRef).submit()},upOutOf:s=>{s.typedText("^")}}}))}return this.__mathField},this.focus=()=>{var e;(e=this.mathField())==null||e.focus(),this.setState({focused:!0})},this.blur=()=>this.setState({focused:!1}),this.handleKeypadPress=(e,t)=>{const{locale:s}=this.context,a=y(s)[e],i=this.mathField();i&&(a&&a(i,e),this.setState({cursorContext:d(i)})),t.type==="click"&&this.focus()}}componentDidMount(){var e;(e=this.mathField())==null||e.latex(this.props.value)}openKeypad(){this.props.buttonsVisible!=="never"&&this.setState({keypadOpen:!0})}closeKeypad(){this.setState({keypadOpen:!1})}render(){let e=W({"perseus-math-input":!0,"mq-editable-field":!0,"mq-math-mode":!0});return this.props.className&&(e=e+" "+this.props.className),r(k,{style:[n.outerWrapper,this.state.focused&&n.wrapperFocused,this.props.hasError&&n.wrapperError],children:C("div",{style:{display:"flex",padding:1},onClick:t=>{t.stopPropagation();const s=this.mathField();s&&this.setState({cursorContext:d(s)})},children:[r("span",{className:e,ref:t=>this.__mathFieldWrapperRef=t,"aria-label":this.props.labelText,onFocus:()=>this.focus(),onBlur:()=>this.blur()}),r(_,{opened:this.state.keypadOpen,onClose:()=>this.closeKeypad(),dismissEnabled:!0,content:()=>{var t;return r(B,{closeButtonVisible:!0,style:n.popoverContent,children:r(S,{onAnalyticsEvent:this.props.analytics.onAnalyticsEvent,extraKeys:this.props.extraKeys,onClickKey:this.handleKeypadPress,cursorContext:this.state.cursorContext,convertDotToTimes:this.props.convertDotToTimes,...this.props.keypadButtonSets??D((t=this.props)==null?void 0:t.buttonSets)})})},children:this.props.buttonsVisible==="never"?r(g,{hovered:!1,focused:!1,active:!1}):r(F,{"aria-label":this.state.keypadOpen?this.context.strings.closeKeypad:this.context.strings.openKeypad,role:"button",onClick:()=>this.state.keypadOpen?this.closeKeypad():this.openKeypad(),children:t=>r(g,{active:this.state.keypadOpen,...t})})})]})})}};p.contextType=P,p.defaultProps={value:"",convertDotToTimes:!1};let m=p;const f=class f extends u.Component{constructor(){super(...arguments),this.inputRef=u.createRef()}blur(){var e;(e=this.inputRef.current)==null||e.blur()}focus(){var e;(e=this.inputRef.current)==null||e.focus()}insert(e){var t;(t=this.inputRef.current)==null||t.insert(e)}render(){return r(m,{...this.props,ref:this.inputRef,mathInputStrings:this.context.strings})}};f.contextType=K;let h=f;const g=({hovered:l,focused:e,active:t})=>{let s;switch(!0){case(e||t):s=o.white;break;case l:s=o.blue;break;default:s=o.offBlack;break}const a=t||e?n.iconActive:n.iconInactive;return r(k,{style:[n.iconContainer,a],children:r("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:s,viewBox:"0 0 256 256",children:r("path",{d:"M112,72a8,8,0,0,1-8,8H40a8,8,0,0,1,0-16h64A8,8,0,0,1,112,72Zm-8,104H80V152a8,8,0,0,0-16,0v24H40a8,8,0,0,0,0,16H64v24a8,8,0,0,0,16,0V192h24a8,8,0,0,0,0-16Zm48,0h64a8,8,0,0,0,0-16H152a8,8,0,0,0,0,16Zm64,16H152a8,8,0,0,0,0,16h64a8,8,0,0,0,0-16Zm-61.66-90.34a8,8,0,0,0,11.32,0L184,83.31l18.34,18.35a8,8,0,0,0,11.32-11.32L195.31,72l18.35-18.34a8,8,0,0,0-11.32-11.32L184,60.69,165.66,42.34a8,8,0,0,0-11.32,11.32L172.69,72,154.34,90.34A8,8,0,0,0,154.34,101.66Z"})})})},D=l=>{const e={};return l&&l.forEach(t=>{switch(t){case"advanced relations":e.advancedRelations=!0;break;case"basic relations":e.basicRelations=!0;break;case"basic+div":e.divisionKey=!0;break;case"logarithms":e.logarithms=!0;break;case"prealgebra":e.preAlgebra=!0;break;case"trig":e.trigonometry=!0;break}}),e},v={borderWidth:2,borderColor:o.blue,margin:-1},n=A.StyleSheet.create({iconContainer:{display:"flex",justifyContent:"center",height:"100%",padding:b.xxxSmall_4,borderRadius:1},iconInactive:{backgroundColor:o.offBlack8},iconActive:{backgroundColor:o.offBlack64},outerWrapper:{display:"inline-block",borderStyle:"solid",borderWidth:1,borderColor:o.offBlack50,borderRadius:3,background:o.white,":hover":v},wrapperFocused:v,wrapperError:{borderColor:o.red,background:o.fadedRed8,":hover":{borderColor:o.red}},popoverContent:{padding:0,paddingBottom:b.xxSmall_6,maxWidth:"initial"}});h.__docgenInfo={description:"",methods:[{name:"blur",docblock:null,modifiers:[],params:[],returns:null},{name:"focus",docblock:null,modifiers:[],params:[],returns:null},{name:"insert",docblock:null,modifiers:[],params:[{name:"value",optional:!1,type:{name:"any"}}],returns:null}],displayName:"MathInput",props:{className:{required:!1,tsType:{name:"string"},description:""},value:{required:!0,tsType:{name:"string"},description:""},onChange:{required:!0,tsType:{name:"any"},description:""},convertDotToTimes:{required:!0,tsType:{name:"boolean"},description:""},buttonSets:{required:!1,tsType:{name:"ReadonlyArray",elements:[{name:"union",raw:`| "basic"
| "basic+div"
| "trig"
| "prealgebra"
| "logarithms"
| "basic relations"
| "advanced relations"`,elements:[{name:"literal",value:'"basic"'},{name:"literal",value:'"basic+div"'},{name:"literal",value:'"trig"'},{name:"literal",value:'"prealgebra"'},{name:"literal",value:'"logarithms"'},{name:"literal",value:'"basic relations"'},{name:"literal",value:'"advanced relations"'}]}],raw:`ReadonlyArray<
    | "basic"
    | "basic+div"
    | "trig"
    | "prealgebra"
    | "logarithms"
    | "basic relations"
    | "advanced relations"
>`},description:"@deprecated Use `keypadButtonSets` instead. Maps to `keypadButtonSets`.\n@see keypadButtonSets"},keypadButtonSets:{required:!1,tsType:{name:"signature",type:"object",raw:`{
    advancedRelations?: boolean;
    basicRelations?: boolean;
    divisionKey?: boolean;
    logarithms?: boolean;
    preAlgebra?: boolean;
    trigonometry?: boolean;
}`,signature:{properties:[{key:"advancedRelations",value:{name:"boolean",required:!1}},{key:"basicRelations",value:{name:"boolean",required:!1}},{key:"divisionKey",value:{name:"boolean",required:!1}},{key:"logarithms",value:{name:"boolean",required:!1}},{key:"preAlgebra",value:{name:"boolean",required:!1}},{key:"trigonometry",value:{name:"boolean",required:!1}}]}},description:"Overrides deprecated `buttonSets` prop."},labelText:{required:!1,tsType:{name:"string"},description:""},onFocus:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onBlur:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},hasError:{required:!1,tsType:{name:"boolean"},description:""},extraKeys:{required:!1,tsType:{name:"ReadonlyArray",elements:[{name:"Keys"}],raw:"ReadonlyArray<Keys>"},description:""},buttonsVisible:{required:!1,tsType:{name:"union",raw:'"always" | "never" | "focused"',elements:[{name:"literal",value:'"always"'},{name:"literal",value:'"never"'},{name:"literal",value:'"focused"'}]},description:"Whether to show the keypad buttons.\nThe strings now misleading, but we keep them for backwards compatibility.\n- `focused` means that the keypad **appears on toggle, *off* by default**.\n- `always` means that the keypad **appears on toggle, *on* by default.**\n- `never` means that the keypad is **never shown**."},analytics:{required:!0,tsType:{name:"signature",raw:'PerseusDependenciesV2["analytics"]'},description:""}}};export{h as M};
