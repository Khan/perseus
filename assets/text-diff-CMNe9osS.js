var J=Object.defineProperty;var K=(e,s,t)=>s in e?J(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t;var j=(e,s,t)=>(K(e,typeof s!="symbol"?s+"":s,t),t);import{_ as p,r as M,E,j as c,F as b}from"./iframe-CtkVBj09.js";import"./item-version-unCQtfPQ.js";import"./article-renderer-BH831tcc.js";import"./server-item-renderer-YruOpBiY.js";import"./hints-renderer-BQQsw2Qv.js";import{c as Q}from"./components-D60z2x1D.js";function I(e){return{newPos:e.newPos,components:e.components.slice(0)}}function O(e){for(var s=[],t=0;t<e.length;t++)e[t]&&s.push(e[t]);return s}function Y(e){var s=e;return s=s.replace(/&/g,"&amp;"),s=s.replace(/</g,"&lt;"),s=s.replace(/>/g,"&gt;"),s=s.replace(/"/g,"&quot;"),s}var w=function(e){this.ignoreWhitespace=e};w.prototype={diff:function(e,s){if(s===e)return[{value:s}];if(!s)return[{value:e,removed:!0}];if(!e)return[{value:s,added:!0}];s=this.tokenize(s),e=this.tokenize(e);var t=s.length,r=e.length,f=t+r,i=[{newPos:-1,components:[]}],n=this.extractCommon(i[0],s,e,0);if(i[0].newPos+1>=t&&n+1>=r)return i[0].components;for(var d=1;d<=f;d++)for(var l=-1*d;l<=d;l+=2){var o,u=i[l-1],a=i[l+1];n=(a?a.newPos:0)-l,u&&(i[l-1]=void 0);var h=u&&u.newPos+1<t,m=a&&0<=n&&n<r;if(!h&&!m){i[l]=void 0;continue}!h||m&&u.newPos<a.newPos?(o=I(a),this.pushComponent(o.components,e[n],void 0,!0)):(o=I(u),o.newPos++,this.pushComponent(o.components,s[o.newPos],!0,void 0));var n=this.extractCommon(o,s,e,l);if(o.newPos+1>=t&&n+1>=r)return o.components;i[l]=o}},pushComponent:function(e,s,t,r){var f=e[e.length-1];f&&f.added===t&&f.removed===r?e[e.length-1]={value:this.join(f.value,s),added:t,removed:r}:e.push({value:s,added:t,removed:r})},extractCommon:function(e,s,t,r){for(var f=s.length,i=t.length,n=e.newPos,d=n-r;n+1<f&&d+1<i&&this.equals(s[n+1],t[d+1]);)n++,d++,this.pushComponent(e.components,s[n],void 0,void 0);return e.newPos=n,d},equals:function(e,s){var t=/\S/;return this.ignoreWhitespace&&!t.test(e)&&!t.test(s)?!0:e===s},join:function(e,s){return e+s},tokenize:function(e){return e}};var Z=new w,_=new w(!0),G=new w;_.tokenize=G.tokenize=function(e){return O(e.split(/(\s+|\b)/))};var U=new w(!0);U.tokenize=function(e){return O(e.split(/([{}:;,]|\s+)/))};var q=new w;q.tokenize=function(e){for(var s=[],t=e.split(/^/m),r=0;r<t.length;r++){var f=t[r],i=t[r-1];f==`
`&&i&&i[i.length-1]==="\r"?s[s.length-1]+=`
`:f&&s.push(f)}return s};const V={Diff:w,diffChars:function(e,s){return Z.diff(e,s)},diffWords:function(e,s){return _.diff(e,s)},diffWordsWithSpace:function(e,s){return G.diff(e,s)},diffLines:function(e,s){return q.diff(e,s)},diffCss:function(e,s){return U.diff(e,s)},createPatch:function(e,s,t,r,f){var i=[];i.push("Index: "+e),i.push("==================================================================="),i.push("--- "+e+(typeof r>"u"?"":"	"+r)),i.push("+++ "+e+(typeof f>"u"?"":"	"+f));var n=q.diff(s,t);n[n.length-1].value||n.pop(),n.push({value:"",lines:[]});function d(C){return C.map(function(N){return" "+N})}function l(C,N,D){var F=n[n.length-2],$=N===n.length-2,B=N===n.length-3&&(D.added!==F.added||D.removed!==F.removed);!/\n$/.test(D.value)&&($||B)&&C.push("\\ No newline at end of file")}for(var o=0,u=0,a=[],h=1,m=1,g=0;g<n.length;g++){var x=n[g],v=x.lines||x.value.replace(/\n$/,"").split(`
`);if(x.lines=v,x.added||x.removed){if(!o){var T=n[g-1];o=h,u=m,T&&(a=d(T.lines.slice(-4)),o-=a.length,u-=a.length)}a.push.apply(a,v.map(function(C){return(x.added?"+":"-")+C})),l(a,g,x),x.added?m+=v.length:h+=v.length}else{if(o)if(v.length<=8&&g<n.length-2)a.push.apply(a,d(v));else{var L=Math.min(v.length,4);i.push("@@ -"+o+","+(h-o+L)+" +"+u+","+(m-u+L)+" @@"),i.push.apply(i,a),i.push.apply(i,d(v.slice(0,L))),v.length<=4&&l(i,g,x),o=0,u=0,a=[]}h+=v.length,m+=v.length}}return i.join(`
`)+`
`},applyPatch:function(e,s){for(var t=s.split(`
`),r=[],f=!1,i=!1,n=t[0][0]==="I"?4:0;n<t.length;n++)if(t[n][0]==="@"){var d=t[n].split(/@@ -(\d+),(\d+) \+(\d+),(\d+) @@/);r.unshift({start:d[3],oldlength:d[2],oldlines:[],newlength:d[4],newlines:[]})}else t[n][0]==="+"?r[0].newlines.push(t[n].substr(1)):t[n][0]==="-"?r[0].oldlines.push(t[n].substr(1)):t[n][0]===" "?(r[0].newlines.push(t[n].substr(1)),r[0].oldlines.push(t[n].substr(1))):t[n][0]==="\\"&&(t[n-1][0]==="+"?f=!0:t[n-1][0]==="-"&&(i=!0));for(var l=e.split(`
`),n=r.length-1;n>=0;n--){for(var o=r[n],u=0;u<o.oldlength;u++)if(l[o.start-1+u]!==o.oldlines[u])return!1;Array.prototype.splice.apply(l,[o.start-1,+o.oldlength].concat(o.newlines))}if(f)for(;!l[l.length-1];)l.pop();else i&&l.push("");return l.join(`
`)},convertChangesToXML:function(e){for(var s=[],t=0;t<e.length;t++){var r=e[t];r.added?s.push("<ins>"):r.removed&&s.push("<del>"),s.push(Y(r.value)),r.added?s.push("</ins>"):r.removed&&s.push("</del>")}return s.join("")},convertChangesToDMP:function(e){for(var s=[],t,r=0;r<e.length;r++)t=e[r],s.push([t.added?1:t.removed?-1:0,t.value]);return s}},H=function(e){const s=[];let t=[];return p.each(e,r=>{const f=r.value.split(`
`);p.each(f,(i,n)=>{n>0&&(s.push(t),t=[]);const l=p.extend({},r,{value:i});t.push(l)})}),t.length&&s.push(t),s},P=function(e){return e.added?"added":e.removed?"removed":"unchanged"},S=e=>p.map(e.value,s=>({value:s,status:P(e)})),ee=function(e,s){return p.flatten(p.map(e,s),!0)},y=new V.Diff;y.tokenize=e=>p.map(e,s=>[s]);y.join=(e,s)=>e.concat(s);y.equals=p.isEqual;const se=e=>ee(e,S),te=function(e,s){const t=y.diff(e,s),r=se(t);return{before:p.filter(r,f=>f.status!=="added"),after:p.filter(r,f=>f.status!=="removed")}},{SvgImage:ne}=Q,k="before",W="after",re=/http.*?\.png|web\+graphie[^)]*/g,z=function(e){return e.match(re)||[]},A=function(e,s,t){return e.added?s:e.removed?t:""};class X extends M.Component{render(){return c.jsx("div",{children:p.map(this.props.images,(s,t)=>{const r=b({image:!0,"image-unchanged":s.status==="unchanged","image-added":s.status==="added","image-removed":s.status==="removed"});return c.jsx("div",{children:c.jsx("div",{className:r,children:c.jsx(ne,{src:s.value,title:s.value})})},t)})})}}j(X,"propTypes",{images:E.arrayOf(E.shape({})).isRequired});class R extends M.Component{constructor(){super(...arguments);j(this,"state",{collapsed:this.props.before===this.props.after});j(this,"handleExpand",()=>{this.setState({collapsed:!1})})}UNSAFE_componentWillReceiveProps(t){this.setState({collapsed:t.before===t.after})}render(){const t=V.diffWords(this.props.before,this.props.after),r=H(t),f=z(this.props.before),i=z(this.props.after),n=te(f,i),d=p.map(r,o=>{const u={};return u.before=p(o).map(function(a,h){return c.jsx("span",{className:A(a,"not-present","removed dark"),children:a.value},h)}),u.after=p(o).map(function(a,h){return c.jsx("span",{className:A(a,"added dark","not-present"),children:a.value},h)}),u}),l=b({"diff-row":!0,collapsed:this.state.collapsed});return c.jsxs("div",{children:[c.jsx("div",{className:"diff-header",children:this.props.title}),c.jsx("div",{className:"diff-header",children:this.props.title}),c.jsx("div",{className:"diff-body ui-helper-clearfix",children:p.map([k,W],(o,u)=>c.jsxs("div",{className:"diff-row "+o,children:[!this.state.collapsed&&p.map(d,(a,h)=>{const m=a[o].length>1,g=b({"diff-line":!0,added:o===W&&m,removed:o===k&&m});return c.jsx("div",{className:g,children:a[o]},h)}),!this.state.collapsed&&c.jsx(X,{images:n[o]})]},u))}),p.map([k,W],(o,u)=>c.jsx("div",{className:l+" "+o,onClick:this.handleExpand,children:this.state.collapsed&&c.jsx("span",{children:c.jsxs("span",{className:"expand-button",children:[" ","[ show unmodified ]"," "]})})},u))]})}}j(R,"propTypes",{after:E.string,before:E.string,title:E.string.isRequired}),j(R,"defaultProps",{after:"",before:""});R.__docgenInfo={description:"",methods:[{name:"handleExpand",docblock:null,modifiers:[],params:[],returns:null}],displayName:"TextDiff",props:{after:{defaultValue:{value:'""',computed:!1},description:"",type:{name:"string"},required:!1},before:{defaultValue:{value:'""',computed:!1},description:"",type:{name:"string"},required:!1},title:{description:"",type:{name:"string"},required:!0}}};export{R as T};
