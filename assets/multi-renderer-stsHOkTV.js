import{a as K}from"./version-akiLXZts.js";import{w as J}from"./article-renderer-rwiqiy8m.js";import{r as Q,i as X,l as Y,R as U,p as H}from"./renderer-Y-r37Tvv.js";import{j as a,a as f}from"./jsx-runtime-BGVbfQ2Z.js";import{l as k}from"./index-awljIyHI.js";import{r as c}from"./index-qhcEwEpg.js";import{_ as v}from"./index-default-4_ZsnO94.js";import{c as Z}from"./asset-context-pmjKTqqL.js";import{D as L}from"./dependencies-fnqF3NiV.js";import{H as D}from"./hints-renderer-UyFELJb0.js";import{o as ee,K as u}from"./svg-image-O4Zh6lWM.js";import{A as te}from"./perseus-api-Ly41NhN4.js";import{U as g}from"./util-G-g1AweO.js";import{B as T}from"./button-group-eBTrRsKy.js";import{I as y}from"./inline-icon-MJBS_-2U.js";import{c as ne,d as re,e as se,f as ie,i as ae}from"./icon-paths-fAaGW1jp.js";import{$ as oe}from"./index-V35CFGao.js";import{l as C}from"./unit-tpB2tohZ.js";import{P as m,E as p,L as le}from"./perseus-error-OpXxk17X.js";const ue="@khanacademy/perseus",de="__lib_version__";K(ue,de);const pe={major:0,minor:1};Q(J);const ce=X();ce["::renderer::"]=pe;const he={onRendered:s=>{}},me=c.createContext(he),{mapObject:fe}=ee,x=class x extends c.Component{constructor(e){super(e),this._handleFocusChange=(t,r)=>{var n,i;t!=null?(this._setCurrentFocus(t),(i=(n=this.props.apiOptions)==null?void 0:n.interactionCallback)==null||i.call(n,this.questionRenderer.getUserInputForWidgets())):this._onRendererBlur(r)},this.handleInteractWithWidget=t=>{var n,i;const r=v.difference(this.state.questionHighlightedWidgets,[t]);this.setState({questionCompleted:!1,questionHighlightedWidgets:r}),(i=(n=this.props.apiOptions)==null?void 0:n.interactionCallback)==null||i.call(n,this.questionRenderer.getUserInputForWidgets())},this.setAssetStatus=(t,r)=>{const n={...this.state.assetStatuses,[t]:r};this.setState({assetStatuses:n})},this.state={questionCompleted:!1,questionHighlightedWidgets:[],assetStatuses:{}},this._fullyRendered=!1}componentDidMount(){this._currentFocus=null,this._fullyRendered=!1}UNSAFE_componentWillReceiveProps(e){this.setState({questionHighlightedWidgets:[]})}componentDidUpdate(e,t){if(this.props.apiOptions.answerableCallback){const r=this.questionRenderer.emptyWidgets().length===0,{answerableCallback:n}=this.props.apiOptions;n&&n(r)}this._fullyRendered||Object.values(this.state.assetStatuses).every(Boolean)&&(this._fullyRendered=!0,this.props.onRendered(!0))}componentWillUnmount(){this.blurTimeoutID!=null&&(clearTimeout(this.blurTimeoutID),this.blurTimeoutID=null)}_setCurrentFocus(e){const{apiOptions:{isMobile:t,onFocusChange:r},keypadElement:n}=this.props,i=this._currentFocus;this._currentFocus=e;const l=this.getInputPaths(),o=this._currentFocus&&l.some(d=>g.inputPathsEqual(d,this._currentFocus));r!=null&&setTimeout(()=>{const d=n==null?void 0:n.getDOMNode(),b=d&&o?d.getBoundingClientRect().height:0;r(this._currentFocus,i,b,o&&this.questionRenderer.getDOMNodeForPath(e))},0),n&&t&&(o?n.activate():n.dismiss())}_onRendererBlur(e){const t=this._currentFocus;v.isEqual(e,t)&&(this.blurTimeoutID=setTimeout(()=>{v.isEqual(this._currentFocus,t)&&this._setCurrentFocus(null)},0))}_setWidgetProps(e,t,r){this.questionRenderer._setWidgetProps(e,t,r)}setInputValue(e,t,r){return this.questionRenderer.setInputValue(e,t,r)}focusPath(e){return this.questionRenderer.focusPath(e)}blurPath(e){return this.questionRenderer.blurPath(e)}getDOMNodeForPath(e){return this.questionRenderer.getDOMNodeForPath(e)}getGrammarTypeForPath(e){return this.questionRenderer.getGrammarTypeForPath(e)}getInputPaths(){return this.questionRenderer.getInputPaths()}focus(){return this.questionRenderer.focus()}blur(){this._currentFocus&&this.blurPath(this._currentFocus)}getNumHints(){return this.props.item.hints.length}scoreInput(){const e=this.questionRenderer.guessAndScore(),t=e[0],r=e[1],n=[t,[]],i=g.keScoreFromPerseusScore(r,n,this.questionRenderer.getSerializedState()),l=this.questionRenderer.emptyWidgets();return this.setState({questionCompleted:i.correct,questionHighlightedWidgets:l}),i}getWidgetIds(){return this.questionRenderer.getWidgetIds()}scoreWidgets(){const e=this.questionRenderer.scoreWidgets(),t=this.questionRenderer.getUserInputForWidgets(),r=this.questionRenderer.getSerializedState();return fe(e,(n,i)=>g.keScoreFromPerseusScore(n,t[i],r))}getSerializedState(){return{question:this.questionRenderer.getSerializedState(),hints:this.hintsRenderer.getSerializedState()}}restoreSerializedState(e,t){let r=2;const n=()=>{--r,t&&r===0&&t()};this.questionRenderer.restoreSerializedState(e.question,n),this.hintsRenderer.restoreSerializedState(e.hints,n)}showRationalesForCurrentlySelectedChoices(){this.questionRenderer.showRationalesForCurrentlySelectedChoices()}deselectIncorrectSelectedChoices(){this.questionRenderer.deselectIncorrectSelectedChoices()}render(){const e={...te.defaults,...this.props.apiOptions,onFocusChange:this._handleFocusChange},t={assetStatuses:this.state.assetStatuses,setAssetStatus:this.setAssetStatus},r=a(Z.Provider,{value:t,children:a(U,{keypadElement:this.props.keypadElement,problemNum:this.props.problemNum,onInteractWithWidget:this.handleInteractWithWidget,highlightedWidgets:this.state.questionHighlightedWidgets,apiOptions:e,questionCompleted:this.state.questionCompleted,reviewMode:this.props.reviewMode,ref:i=>{i!=null&&(this.questionRenderer=i)},content:this.props.item.question.content,widgets:this.props.item.question.widgets,images:this.props.item.question.images,linterContext:H(this.props.linterContext,"question"),...this.props.dependencies})}),n=a(D,{hints:this.props.item.hints,hintsVisible:this.props.hintsVisible,apiOptions:e,ref:i=>this.hintsRenderer=i,linterContext:H(this.props.linterContext,"hints")});return a(L.Provider,{value:this.props.dependencies,children:f("div",{children:[a("div",{children:r}),a("div",{className:e.isMobile?void 0:k.css(ge.hintsContainer),children:n})]})})}};x.defaultProps={apiOptions:{},linterContext:Y,onRendered:e=>{}};let R=x;const ge=k.StyleSheet.create({hintsContainer:{marginLeft:50}}),Le=c.forwardRef((s,e)=>a(me.Consumer,{children:({onRendered:t})=>a(R,{...s,onRendered:t,ref:e})}));try{R.displayName="ServerItemRenderer",R.__docgenInfo={description:"",displayName:"ServerItemRenderer",props:{apiOptions:{defaultValue:{value:"{} as any"},description:"",name:"apiOptions",required:!1,type:{name:"Readonly<{ isArticle?: boolean; onInputError?: ((widgetId: any, value: string, message?: string | null) => unknown) | undefined; onFocusChange?: ((newFocusPath: FocusPath, oldFocusPath: FocusPath, keypadHeight?: number | undefined, focusedElement?: HTMLElement | undefined) => unknown) | undef..."}},hintsVisible:{defaultValue:null,description:"",name:"hintsVisible",required:!1,type:{name:"number"}},item:{defaultValue:null,description:"",name:"item",required:!0,type:{name:"PerseusItem"}},linterContext:{defaultValue:{value:"PerseusLinter.linterContextDefault"},description:"",name:"linterContext",required:!1,type:{name:"LinterContextProps"}},problemNum:{defaultValue:null,description:"",name:"problemNum",required:!1,type:{name:"number"}},reviewMode:{defaultValue:null,description:"",name:"reviewMode",required:!1,type:{name:"boolean"}},keypadElement:{defaultValue:null,description:"",name:"keypadElement",required:!1,type:{name:"KeypadAPI | null"}},dependencies:{defaultValue:null,description:"",name:"dependencies",required:!0,type:{name:"PerseusDependenciesV2"}},onRendered:{defaultValue:{value:"(isRendered: boolean) => {}"},description:"",name:"onRendered",required:!1,type:{name:"(isRendered: boolean) => void"}}}}}catch{}try{serveritemrenderer.displayName="serveritemrenderer",serveritemrenderer.__docgenInfo={description:"",displayName:"serveritemrenderer",props:{apiOptions:{defaultValue:null,description:"",name:"apiOptions",required:!1,type:{name:"Readonly<{ isArticle?: boolean; onInputError?: ((widgetId: any, value: string, message?: string | null) => unknown) | undefined; onFocusChange?: ((newFocusPath: FocusPath, oldFocusPath: FocusPath, keypadHeight?: number | undefined, focusedElement?: HTMLElement | undefined) => unknown) | undef..."}},problemNum:{defaultValue:null,description:"",name:"problemNum",required:!1,type:{name:"number"}},keypadElement:{defaultValue:null,description:"",name:"keypadElement",required:!1,type:{name:"KeypadAPI | null"}},linterContext:{defaultValue:null,description:"",name:"linterContext",required:!1,type:{name:"LinterContextProps"}},reviewMode:{defaultValue:null,description:"",name:"reviewMode",required:!1,type:{name:"boolean"}},item:{defaultValue:null,description:"",name:"item",required:!0,type:{name:"PerseusItem"}},hintsVisible:{defaultValue:null,description:"",name:"hintsVisible",required:!1,type:{name:"number"}},dependencies:{defaultValue:null,description:"",name:"dependencies",required:!0,type:{name:"PerseusDependenciesV2"}}}}}catch{}const W=class W extends c.Component{render(){return a(T,{value:this.props.value,allowEmpty:!1,buttons:[{value:"",content:a("span",{children:"—"})},{value:"->",content:a("span",{children:"→"})}],onChange:this.props.onChange})}};W.defaultProps={value:""};let I=W;try{I.displayName="ArrowPicker",I.__docgenInfo={description:"",displayName:"ArrowPicker",props:{value:{defaultValue:{value:""},description:"",name:"value",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(values: { [key: string]: any; }, callback?: (() => unknown) | null | undefined, silent?: boolean | undefined) => unknown"}}}}}catch{}const ye=[u.BLACK,u.BLUE,u.GREEN,u.PINK,u.PURPLE,u.RED,u.GRAY],_e=[u.LIGHT_BLUE,u.LIGHT_ORANGE,u.LIGHT_PINK,u.LIGHT_GREEN,u.LIGHT_PURPLE,u.LIGHT_RED,"#fff"],A=class A extends c.Component{render(){const e=this.props.lightColors?_e:ye;return a(T,{value:this.props.value,allowEmpty:!1,buttons:v.map(e,t=>({value:t,content:f("span",{children:[a("span",{className:"colorpicker-circle",style:{background:t}})," "]})})),onChange:this.props.onChange})}};A.defaultProps={value:u.BLACK,lightColors:!1};let w=A;try{w.displayName="ColorPicker",w.__docgenInfo={description:"",displayName:"ColorPicker",props:{lightColors:{defaultValue:{value:"false"},description:"",name:"lightColors",required:!1,type:{name:"boolean"}},value:{defaultValue:{value:"black"},description:"",name:"value",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(values: { [key: string]: any; }, callback?: (() => unknown) | null | undefined, silent?: boolean | undefined) => unknown"}}}}}catch{}const O=class O extends c.Component{render(){return a(T,{value:this.props.value,allowEmpty:!1,buttons:[{value:"",content:a("span",{children:"—"})},{value:"-",content:a("span",{children:"–––"})},{value:"- ",content:a("span",{children:"–  –"})},{value:".",content:a("span",{children:"····"})},{value:". ",content:a("span",{children:"· · ·"})}],onChange:this.props.onChange})}};O.defaultProps={value:""};let P=O;try{P.displayName="DashPicker",P.__docgenInfo={description:"",displayName:"DashPicker",props:{value:{defaultValue:{value:""},description:"",name:"value",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(values: { [key: string]: any; }, callback?: (() => unknown) | null | undefined, silent?: boolean | undefined) => unknown"}}}}}catch{}const z=class z extends c.Component{constructor(e){super(e),this.toggle=t=>{t.preventDefault(),this.setState({show:!this.state.show})},this.state={show:e.initiallyVisible}}render(){return f("div",{className:"perseus-interaction-element",children:[f("a",{href:"#",className:"perseus-interaction-element-title "+(this.state.show?"open":"closed"),onClick:this.toggle,children:[this.state.show?a(y,{...ne}):a(y,{...re}),this.props.title]}),f("div",{className:"perseus-interaction-element-content "+(this.state.show?"enter":"leave"),children:[this.props.children,(this.props.onUp!=null||this.props.onDown!=null||this.props.onDelete!=null)&&f("div",{className:"edit-controls",children:[this.props.onUp!=null&&a("button",{onClick:this.props.onUp,children:a(y,{...se})}),this.props.onDown!=null&&a("button",{onClick:this.props.onDown,children:a(y,{...ie})}),this.props.onDelete!=null&&a("button",{onClick:this.props.onDelete,children:a(y,{...ae})})]})]})]})}};z.defaultProps={initiallyVisible:!1,title:"More"};let V=z;try{V.displayName="ElementContainer",V.__docgenInfo={description:"",displayName:"ElementContainer",props:{initiallyVisible:{defaultValue:{value:"false"},description:"",name:"initiallyVisible",required:!1,type:{name:"boolean"}},onDelete:{defaultValue:null,description:"",name:"onDelete",required:!1,type:{name:"(() => void | null)"}},onDown:{defaultValue:null,description:"",name:"onDown",required:!1,type:{name:"(() => void | null)"}},onUp:{defaultValue:null,description:"",name:"onUp",required:!1,type:{name:"(() => void | null)"}},title:{defaultValue:{value:"More"},description:"",name:"title",required:!1,type:{name:"string | ReactElement<any, string | JSXElementConstructor<any>>"}}}}}catch{}const Se={type:"content"},G={type:"hint"},Re={type:"tags"},$=s=>({type:"array",elementShape:s}),be=s=>({type:"object",shape:s}),Ce=$(G),h={content:Se,hint:G,hints:Ce,tags:Re,arrayOf:$,shape:be};class _{constructor(e,t,r){this.content=e,this.hint=t,this.tags=r,this.array=q}setContentMapper(e){return new _(e,this.hint,this.tags)}setHintMapper(e){return new _(this.content,e,this.tags)}setTagsMapper(e){return new _(this.content,this.hint,e)}setArrayMapper(e){return new M(this.content,this.hint,this.tags,e)}mapTree(e,t){return E(e,t,[],this)}}class M{constructor(e,t,r,n){this.content=e,this.hint=t,this.tags=r,this.array=n}setArrayMapper(e){return new M(this.content,this.hint,this.tags,e)}mapTree(e,t){return E(e,t,[],this)}}function q(s){return s}function S(){return new _(q,q,q)}function E(s,e,t,r){if(e.type==="content"){const n=s;return r.content(n,e,t)}if(e.type==="hint"){const n=s;return r.hint(n,e,t)}if(e.type==="tags"){const n=s;return r.tags(n,e,t)}if(e.type==="array"){const n=s;if(!Array.isArray(n))throw new m(`Invalid object of type "${typeof n}" found at path ${["<root>"].concat(t).join(".")}. Expected array.`,p.Internal);const i=e.elementShape,l=n.map((o,d)=>E(o,i,t.concat(d),r));return r.array(l,n,e,t)}if(e.type==="object"){const n=s;if(n&&typeof n!="object")throw new m(`Invalid object of type "${typeof n}" found at path ${["<root>"].concat(t).join(".")}. Expected "object" type.`,p.InvalidInput);const i=e.shape;if(!i)throw new m(`Unexpected shape ${JSON.stringify(e)} at path ${["<root>"].concat(t).join(".")}.`,p.InvalidInput);const l={};return Object.keys(i).forEach(o=>{if(!(o in n))throw new m(`Key "${o}" is missing from shape at path ${["<root>"].concat(t).join(".")}.`,p.InvalidInput);l[o]=E(n[o],i[o],t.concat(o),r)}),l}throw new m(`unexpected shape type ${e.type}`,p.InvalidInput)}function B(s){if(s.type==="content")return{__type:"content",content:"",images:{},widgets:{}};if(s.type==="hint")return{__type:"hint",replace:!1,content:"",images:{},widgets:{}};if(s.type==="tags")return[];if(s.type==="array")return[];if(s.type==="object"){const e=s.shape,t={};return Object.keys(e).forEach(r=>{t[r]=B(e[r])}),t}throw new m(`unexpected shape type ${s.type}`,p.InvalidInput)}function Ge(s){return ve(B(s))}function $e(s,e,t){const r=F(s);S().setContentMapper(t).mapTree(r,e)}function Be(s,e,t){const r=F(s);S().setHintMapper(t).mapTree(r,e)}function Ke(s){const e=F(s);return N(e)}function N(s){if(Array.isArray(s))return s.length?typeof s[0]=="string"?h.tags:h.arrayOf(N(s[0])):h.arrayOf(h.content);if(typeof s=="object"&&(s.__type==="content"||s.__type==="item"))return h.content;if(typeof s=="object"&&s.__type==="hint")return h.hint;if(typeof s=="object"){const e={};return Object.keys(s).forEach(t=>{e[t]=N(s[t])}),h.shape(e)}throw new m(`unexpected multi-item node ${JSON.stringify(s)}`,p.InvalidInput)}function F(s){return s._multi}function ve(s){return{_multi:s}}class j extends c.Component{constructor(e){super(e),this._handleSerializedStateUpdated=(t,r)=>{const{onSerializedStateUpdated:n}=this.props;if(n){const i=this._getSerializedState(this.props.serializedState);n(C(i).set(t,r).freeze())}},this.rendererDataTreeMapper=S().setContentMapper((t,r,n)=>this._makeContentRendererData(t,n)).setHintMapper(t=>this._makeHintRendererData(t)).setTagsMapper(t=>null),this.getRenderersMapper=S().setContentMapper(t=>t.makeRenderer()).setHintMapper(t=>t.makeRenderer()).setArrayMapper((t,r,n)=>this._annotateRendererArray(t,r,n)),this.state=this._tryMakeRendererState(this.props)}UNSAFE_componentWillReceiveProps(e){e.item!==this.props.item&&this.setState(this._tryMakeRendererState(e))}_tryMakeRendererState(e){try{return{rendererDataTree:this._makeRendererDataTree(e.item,e.shape),renderError:null}}catch(t){return le.error("Error building tree state",p.Internal,{cause:t}),{rendererDataTree:null,renderError:t}}}_getRendererProps(){const{item:e,children:t,shape:r,serializedState:n,onSerializedStateUpdated:i,...l}=this.props;return l}_makeContentRendererData(e,t){const r={ref:null,makeRenderer:null},n=o=>r.ref=o,i=o=>this._findWidgets(r,o),l=o=>this._handleSerializedStateUpdated(t,o);return r.makeRenderer=()=>a(U,{...this._getRendererProps(),...e,ref:n,findExternalWidgets:i,serializedState:this.props.serializedState?C(this.props.serializedState).get(t):null,onSerializedStateUpdated:l}),r}_makeHintRendererData(e){const t=r=>this._findWidgets({},r);return{hint:e,findExternalWidgets:t,ref:null,makeRenderer:()=>a(D,{...this._getRendererProps(),findExternalWidgets:t,hints:[e]})}}_makeRendererDataTree(e,t){const r=F(e);return this.rendererDataTreeMapper.mapTree(r,t)}_findWidgets(e,t){const r=[];return this._mapRenderers(n=>{e!==n&&n.ref&&r.push(...n.ref.findInternalWidgets(t))}),r}_mapRenderers(e){const{rendererDataTree:t}=this.state;return t?S().setContentMapper(e).setHintMapper(e).mapTree(t,this.props.shape):null}_scoreFromRef(e){if(!e)return null;const[t,r]=e.guessAndScore();let n;return e.getSerializedState&&(n=e.getSerializedState()),g.keScoreFromPerseusScore(r,t,n)}getScores(){return this._mapRenderers(e=>this._scoreFromRef(e.ref))}score(){const e=[],t=[],r=this._mapRenderers(i=>{var l;return i.ref?(i.ref.getSerializedState&&t.push(i.ref.getSerializedState()),e.push(i.ref.score()),(l=i.ref)==null?void 0:l.getUserInput()):null}),n=e.reduce(g.combineScores);return g.keScoreFromPerseusScore(n,r,t)}_getSerializedState(e){return this._mapRenderers((t,r,n)=>t.ref?t.ref.getSerializedState():e?C(e).get(n):null)}restoreSerializedState(e,t){let r=0;const n=()=>{r--,t&&r===0&&t()};this._mapRenderers((i,l,o)=>{var b;if(!i.ref)return;const d=C(e).get(o);d&&(r++,(b=i.ref)==null||b.restoreSerializedState(d,n))})}_annotateRendererArray(e,t,r){if(r.elementShape.type==="hint"){const n=t;e=[...e],e.firstN=i=>a(D,{...this._getRendererProps(),findExternalWidgets:n[0]?n[0].findExternalWidgets:void 0,hints:n.map(l=>l.hint),hintsVisible:i})}return e}_getRenderers(){return this.getRenderersMapper.mapTree(this.state.rendererDataTree,this.props.shape)}render(){return this.state.renderError?a("div",{className:k.css(qe.error),children:oe("Error rendering: %(error)s",{error:String(this.state.renderError)})}):a(L.Provider,{value:this.props.dependencies,children:this.props.children({renderers:this._getRenderers()})})}}const qe=k.StyleSheet.create({error:{color:"red"}});try{j.displayName="MultiRenderer",j.__docgenInfo={description:"",displayName:"MultiRenderer",props:{item:{defaultValue:null,description:"",name:"item",required:!0,type:{name:"Item"}},shape:{defaultValue:null,description:"",name:"shape",required:!0,type:{name:"Shape"}},serializedState:{defaultValue:null,description:"",name:"serializedState",required:!1,type:{name:"any"}},onSerializedStateUpdated:{defaultValue:null,description:"",name:"onSerializedStateUpdated",required:!1,type:{name:"((state: any) => void)"}},onInteractWithWidget:{defaultValue:null,description:"",name:"onInteractWithWidget",required:!1,type:{name:"((id: string) => void)"}},apiOptions:{defaultValue:null,description:"",name:"apiOptions",required:!1,type:{name:"Readonly<{ isArticle?: boolean; onInputError?: ((widgetId: any, value: string, message?: string | null) => unknown) | undefined; onFocusChange?: ((newFocusPath: FocusPath, oldFocusPath: FocusPath, keypadHeight?: number | undefined, focusedElement?: HTMLElement | undefined) => unknown) | undef..."}},reviewMode:{defaultValue:null,description:"",name:"reviewMode",required:!1,type:{name:"boolean | null"}},dependencies:{defaultValue:null,description:"",name:"dependencies",required:!0,type:{name:"PerseusDependenciesV2"}}}}}catch{}export{I as A,w as C,P as D,V as E,j as M,R as S,Be as a,Ge as b,S as c,F as d,B as e,$e as f,pe as g,Ke as i,Le as r,h as s};
