var _=Object.defineProperty;var R=(a,n,e)=>n in a?_(a,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[n]=e;var p=(a,n,e)=>(R(a,typeof n!="symbol"?n+"":n,e),e);import{j as d}from"./jsx-runtime-BT65X5dW.js";import{r as t}from"./index-C6mWTJJr.js";import{n as k}from"./no-important-DlFk8a1I.js";import{I as S,x as F}from"./index-2_3bnrsb.js";import{B as W}from"./index-B2p7Pm9a.js";import{V as l}from"./index-DBQpxcp6.js";import{P as B}from"./index-CInKp-nD.js";import{L as E}from"./index-BDrftSRB.js";import{a as b,b as A,s as r,f as j}from"./index-Ds5N5m2R.js";import{b as T}from"./index-CltwzEvY.js";import{a as U}from"./i18n-context-3AkWzTTj.js";import{g as O}from"./dependencies-BsVPGK1s.js";import{l as z}from"./constants-BIpV3g0K.js";const D=(a,n="")=>({type:a,isSupported:!1,message:n}),N=""+new URL("info-C9QkPWf7.svg",import.meta.url).href,M=""+new URL("smiley-DF1jp_kf.svg",import.meta.url).href,q=""+new URL("warning-By3DoRa6.svg",import.meta.url).href,J=""+new URL("warning-circle-6sErWO7z.svg",import.meta.url).href,V=a=>{switch(a){case"success":return{color:b.status.success.foreground,icon:M,role:"status"};case"warning":return{color:b.status.warning.foreground,icon:q,role:"alert",ariaLive:"polite"};case"critical":return{color:b.status.critical.foreground,icon:J,role:"alert"};default:return{color:b.status.notice.foreground,icon:N,role:"status"}}},H=a=>{const{actions:n,"aria-label":e,dismissAriaLabel:s="Dismiss banner.",onDismiss:c,kind:m="info",layout:u,text:h,testId:y,icon:x}=a,g=()=>n==null?void 0:n.filter(Boolean).map((i,P)=>{if(i.type==="custom")return t.createElement(l,{style:o.action,key:`custom-action-${P}`},i.node);const v=i.onClick;if(i.type==="link"){var I;return t.createElement(l,{style:o.action,key:i.title},t.createElement(E,{href:i.href,onClick:v,"aria-label":(I=i.ariaLabel)!=null?I:i.title,style:o.link},i.title))}else{var L;return t.createElement(l,{style:o.action,key:i.title},t.createElement(W,{kind:"tertiary",size:"small","aria-label":(L=i.ariaLabel)!=null?L:i.title,onClick:v},i.title))}}),w=V(m);return t.createElement(l,{style:[o.containerOuter,u==="floating"&&o.floatingBorder,{borderInlineStartColor:w.color}],role:w.role,"aria-label":e,"aria-live":w.ariaLive,testId:y},t.createElement(l,{style:[o.backgroundColor,{backgroundColor:w.color}]}),t.createElement(l,{style:o.containerInner},t.createElement(B,{icon:x||w.icon,size:"medium",style:o.icon,"aria-label":m,testId:"banner-kind-icon",role:"img"}),t.createElement(l,{style:o.labelAndButtonsContainer},t.createElement(l,{style:o.labelContainer},t.createElement(T,null,h)),n&&t.createElement(l,{style:o.actionsContainer},g())),c?t.createElement(l,{style:o.dismissContainer},t.createElement(S,{icon:F,kind:"tertiary",actionType:"neutral",onClick:c,style:o.dismiss,"aria-label":s})):null))},o=k.StyleSheet.create({backgroundColor:{position:"absolute",top:0,bottom:0,left:0,right:0,opacity:.08},containerOuter:{borderInlineStartWidth:r.xxSmall_6,width:"100%",backgroundColor:b.surface.primary},containerInner:{flexDirection:"row",padding:r.xSmall_8},icon:{marginTop:r.xSmall_8,marginBottom:r.xSmall_8,marginInlineStart:r.xxxxSmall_2,marginInlineEnd:r.xSmall_8,alignSelf:"flex-start",color:b.icon.primary},labelAndButtonsContainer:{flex:1,flexDirection:"row",alignItems:"center",alignContent:"center",flexWrap:"wrap",justifyContent:"space-between"},labelContainer:{flexShrink:1,margin:r.xSmall_8,textAlign:"start",overflowWrap:"break-word"},actionsContainer:{flexDirection:"row",justifyContent:"flex-start",marginTop:r.xSmall_8,marginBottom:r.xSmall_8,height:18,alignItems:"center"},action:{marginLeft:r.xSmall_8,marginRight:r.xSmall_8,justifyContent:"center"},link:{fontSize:j.size.small},dismiss:{flexShrink:1},dismissContainer:{height:40,width:40,justifyContent:"center",alignItems:"center",marginLeft:r.xSmall_8,marginRight:r.xSmall_8},floatingBorder:{borderRadius:A.radius.radius_040,overflow:"hidden"}}),K=""+new URL("corners-out-Blw9vUtj.svg",import.meta.url).href,$=()=>D("phet-simulation"),G=66;class C extends t.Component{constructor(e){super(e);p(this,"iframeRef",t.createRef());p(this,"locale");p(this,"isWidget",!0);p(this,"state",{url:null,banner:null,isFullScreen:!1});p(this,"getPhetCompatibleLocale",e=>{switch(e){case"pt-pt":return"pt";case"zh-hans":return"zh_CN";case"zh-hant":return"zh_TW";case"fa-af":return"fa_DA";default:return e}});p(this,"displayLoadFailure",()=>{this.setState({url:null,banner:{message:this.context.strings.simulationLoadFail,kind:"critical"}})});p(this,"toggleFullScreen",()=>{this.setState(e=>({isFullScreen:!e.isFullScreen}))});this.locale=this.getPhetCompatibleLocale(O().kaLocale)}async componentDidMount(){await this.updateSimState(this.props.url)}async componentDidUpdate(e){e.url!==this.props.url&&await this.updateSimState(this.props.url)}getPromptJSON(){return $()}async updateSimState(e){const s=Q(e,this.locale);if(s===null){this.displayLoadFailure();return}if(!(await fetch(s)).ok){this.displayLoadFailure();return}const m=await this.showLocaleWarning(s);this.setState({url:s,banner:m?{message:this.context.strings.simulationLocaleWarning,kind:"warning"}:null})}async showLocaleWarning(e){if(!e)return!1;const c=/https:\/\/phet\.colorado\.edu\/sims\/html\/([a-zA-Z0-9-]+)\/.*/g.exec(e.toString());if(c===null)return!1;const m=c[1],u=await fetch(`https://phet.colorado.edu/sims/html/${m}/latest/string-map.json`);if(!u.ok)return!1;let h;try{h=await u.json()}catch{return!1}const y=Object.keys(h),x=this.locale.split("_")[0];for(const g of y)if(x===g.split("_")[0])return!1;return!0}render(){const{isFullScreen:e,banner:s,url:c}=this.state,{isMobileApp:m}=this.props.apiOptions,u=e&&m,h=u?{...f.appFullScreenWidgetContainer}:f.widgetContainer,y=u?f.appFullScreenIframeContainer:f.iframeContainer;return d.jsxs(l,{style:h,children:[s!==null&&d.jsx(l,{style:{marginBottom:z},children:d.jsx(H,{layout:"floating",kind:s.kind,text:s.message})}),u&&d.jsx(l,{style:f.closeButtonContainer,children:d.jsx(S,{icon:F,onClick:this.toggleFullScreen,kind:"tertiary",actionType:"neutral","aria-label":"Exit fullscreen",style:f.closeButton})}),d.jsx(l,{style:y,children:d.jsx("iframe",{ref:this.iframeRef,title:this.props.description,sandbox:"allow-same-origin allow-scripts",className:k.css(f.iframeResponsive),src:c==null?void 0:c.toString(),allow:"fullscreen"})}),c!==null&&!u&&d.jsx(S,{icon:K,onClick:m?this.toggleFullScreen:()=>{var g;(g=this.iframeRef.current)==null||g.requestFullscreen()},kind:"tertiary",actionType:"neutral","aria-label":"Fullscreen",style:{marginTop:5,marginBottom:5,alignSelf:"flex-end"}})]})}}p(C,"contextType",U);const Q=(a,n)=>{if(!URL.canParse(a))return null;const e=new URL(a);return e.origin!=="https://phet.colorado.edu"?null:(e.searchParams.set("locale",n),e)},f=k.StyleSheet.create({widgetContainer:{borderRadius:6,borderWidth:1,borderColor:"#CCC",padding:r.medium_16,paddingBottom:0},iframeContainer:{position:"relative",overflow:"hidden",width:"100%",paddingTop:"56.25%"},iframeResponsive:{borderWidth:0,position:"absolute",top:0,left:0,bottom:0,right:0,width:"100%",height:"100%"},appFullScreenWidgetContainer:{position:"fixed",top:0,left:0,right:0,bottom:G,width:"100%",height:"auto",zIndex:1e3,backgroundColor:"white",display:"flex",flexDirection:"column"},appFullScreenIframeContainer:{position:"relative",overflow:"hidden",width:"100%",flex:1},closeButtonContainer:{position:"absolute",top:r.xSmall_8,right:r.xSmall_8,zIndex:1001},closeButton:{backgroundColor:"rgba(255, 255, 255, 0.8)",borderRadius:"50%"}}),ue={name:"phet-simulation",displayName:"PhET Simulation",widget:C,isLintable:!0};C.__docgenInfo={description:"",methods:[{name:"getPhetCompatibleLocale",docblock:null,modifiers:[],params:[{name:"kaLocale",optional:!1,type:null}],returns:null},{name:"getPromptJSON",docblock:null,modifiers:[],params:[],returns:{type:{name:"signature",type:"object",raw:`{
    type: UnsupportedWidget;
    message?: string;
    isSupported: boolean;
}`,signature:{properties:[{key:"type",value:{name:"union",raw:`| "cs-program"
| "iframe"
| "interaction"
| "interactive-graph-unsupported"
| "measurer"
| "phet-simulation"
| "plotter"
| "python-program"
| "video"`,elements:[{name:"literal",value:'"cs-program"'},{name:"literal",value:'"iframe"'},{name:"literal",value:'"interaction"'},{name:"literal",value:'"interactive-graph-unsupported"'},{name:"literal",value:'"measurer"'},{name:"literal",value:'"phet-simulation"'},{name:"literal",value:'"plotter"'},{name:"literal",value:'"python-program"'},{name:"literal",value:'"video"'}],required:!0}},{key:"message",value:{name:"string",required:!1}},{key:"isSupported",value:{name:"boolean",required:!0}}]}}}},{name:"displayLoadFailure",docblock:null,modifiers:[],params:[],returns:null},{name:"updateSimState",docblock:null,modifiers:["async"],params:[{name:"urlString",optional:!1,type:{name:"string"}}],returns:null},{name:"showLocaleWarning",docblock:null,modifiers:["async"],params:[{name:"url",optional:!1,type:{name:"URL",alias:"URL"}}],returns:{type:{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>"}}},{name:"toggleFullScreen",docblock:`Mobile App Fullscreen Implementation

The mobile app environment doesn't support the standard browser fullscreen API.
Instead, we implement a "fake" fullscreen mode with the following approach:

1. When fullscreen is toggled, we use a fixed position container that covers
   almost the entire viewport (appFullScreenWidgetContainer)
2. We leave space at the bottom for the mobile app's Check Answer bar (66px)
3. We position a close button in the top-right corner for exiting fullscreen
4. The iframe container expands to fill the available space

This differs from the web implementation which uses the browser's
native Fullscreen API via requestFullscreen().

Note: Unfortunately, full screen is not supported in iOS mobile web due to
the lack of support for the Fullscreen API.`,modifiers:[],params:[],returns:null,description:`Mobile App Fullscreen Implementation

The mobile app environment doesn't support the standard browser fullscreen API.
Instead, we implement a "fake" fullscreen mode with the following approach:

1. When fullscreen is toggled, we use a fixed position container that covers
   almost the entire viewport (appFullScreenWidgetContainer)
2. We leave space at the bottom for the mobile app's Check Answer bar (66px)
3. We position a close button in the top-right corner for exiting fullscreen
4. The iframe container expands to fill the available space

This differs from the web implementation which uses the browser's
native Fullscreen API via requestFullscreen().

Note: Unfortunately, full screen is not supported in iOS mobile web due to
the lack of support for the Fullscreen API.`}],displayName:"PhetSimulation"};export{H as B,C as P,ue as a,D as g,Q as m};
