import"./all-widgets-Ca9adxvK.js";import"./phet-simulation-DOXsIrrc.js";import{_ as c}from"./underscore-U-AHniOr.js";import"./core-widget-registry-2tCIH_GM.js";import"./dependencies-BsVPGK1s.js";import"./perseus-api-DmwU2RjF.js";import"./server-item-renderer-CQq1KA-1.js";import"./article-renderer-XuVFlMX9.js";import"./hints-renderer-Bgu9Wu6L.js";import"./renderer-Doy-sv_3.js";import"./base-radio-kaSH4GDV.js";import{c as J}from"./components-D1UvVBvr.js";import"./i18n-context-glBZFVwC.js";import"./util-Cjm22Ttl.js";import"./svg-image-fTqFFTIk.js";import"./jquery-CkHB0_Mt.js";import"./index-Dd-cahjY.js";import{c as D}from"./index-D7h-teXI.js";import{P as C}from"./index-CrGd2QqM.js";import{r as d}from"./index-C6mWTJJr.js";function M(t){return{newPos:t.newPos,components:t.components.slice(0)}}function G(t){for(var e=[],n=0;n<t.length;n++)t[n]&&e.push(t[n]);return e}function K(t){var e=t;return e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/"/g,"&quot;"),e}var w=function(t){this.ignoreWhitespace=t};w.prototype={diff:function(t,e){if(e===t)return[{value:e}];if(!e)return[{value:t,removed:!0}];if(!t)return[{value:e,added:!0}];e=this.tokenize(e),t=this.tokenize(t);var n=e.length,r=t.length,f=n+r,a=[{newPos:-1,components:[]}],s=this.extractCommon(a[0],e,t,0);if(a[0].newPos+1>=n&&s+1>=r)return a[0].components;for(var p=1;p<=f;p++)for(var o=-1*p;o<=p;o+=2){var i,l=a[o-1],u=a[o+1];s=(u?u.newPos:0)-o,l&&(a[o-1]=void 0);var h=l&&l.newPos+1<n,v=u&&0<=s&&s<r;if(!h&&!v){a[o]=void 0;continue}!h||v&&l.newPos<u.newPos?(i=M(u),this.pushComponent(i.components,t[s],void 0,!0)):(i=M(l),i.newPos++,this.pushComponent(i.components,e[i.newPos],!0,void 0));var s=this.extractCommon(i,e,t,o);if(i.newPos+1>=n&&s+1>=r)return i.components;a[o]=i}},pushComponent:function(t,e,n,r){var f=t[t.length-1];f&&f.added===n&&f.removed===r?t[t.length-1]={value:this.join(f.value,e),added:n,removed:r}:t.push({value:e,added:n,removed:r})},extractCommon:function(t,e,n,r){for(var f=e.length,a=n.length,s=t.newPos,p=s-r;s+1<f&&p+1<a&&this.equals(e[s+1],n[p+1]);)s++,p++,this.pushComponent(t.components,e[s],void 0,void 0);return t.newPos=s,p},equals:function(t,e){var n=/\S/;return this.ignoreWhitespace&&!n.test(t)&&!n.test(e)?!0:t===e},join:function(t,e){return t+e},tokenize:function(t){return t}};var Q=new w,U=new w(!0),V=new w;U.tokenize=V.tokenize=function(t){return G(t.split(/(\s+|\b)/))};var X=new w(!0);X.tokenize=function(t){return G(t.split(/([{}:;,]|\s+)/))};var R=new w;R.tokenize=function(t){for(var e=[],n=t.split(/^/m),r=0;r<n.length;r++){var f=n[r],a=n[r-1];f==`
`&&a&&a[a.length-1]==="\r"?e[e.length-1]+=`
`:f&&e.push(f)}return e};const _={Diff:w,diffChars:function(t,e){return Q.diff(t,e)},diffWords:function(t,e){return U.diff(t,e)},diffWordsWithSpace:function(t,e){return V.diff(t,e)},diffLines:function(t,e){return R.diff(t,e)},diffCss:function(t,e){return X.diff(t,e)},createPatch:function(t,e,n,r,f){var a=[];a.push("Index: "+t),a.push("==================================================================="),a.push("--- "+t+(typeof r>"u"?"":"	"+r)),a.push("+++ "+t+(typeof f>"u"?"":"	"+f));var s=R.diff(e,n);s[s.length-1].value||s.pop(),s.push({value:"",lines:[]});function p(y){return y.map(function(k){return" "+k})}function o(y,k,W){var A=s[s.length-2],$=k===s.length-2,B=k===s.length-3&&(W.added!==A.added||W.removed!==A.removed);!/\n$/.test(W.value)&&($||B)&&y.push("\\ No newline at end of file")}for(var i=0,l=0,u=[],h=1,v=1,E=0;E<s.length;E++){var g=s[E],m=g.lines||g.value.replace(/\n$/,"").split(`
`);if(g.lines=m,g.added||g.removed){if(!i){var I=s[E-1];i=h,l=v,I&&(u=p(I.lines.slice(-4)),i-=u.length,l-=u.length)}u.push.apply(u,m.map(function(y){return(g.added?"+":"-")+y})),o(u,E,g),g.added?v+=m.length:h+=m.length}else{if(i)if(m.length<=8&&E<s.length-2)u.push.apply(u,p(m));else{var x=Math.min(m.length,4);a.push("@@ -"+i+","+(h-i+x)+" +"+l+","+(v-l+x)+" @@"),a.push.apply(a,u),a.push.apply(a,p(m.slice(0,x))),m.length<=4&&o(a,E,g),i=0,l=0,u=[]}h+=m.length,v+=m.length}}return a.join(`
`)+`
`},applyPatch:function(t,e){for(var n=e.split(`
`),r=[],f=!1,a=!1,s=n[0][0]==="I"?4:0;s<n.length;s++)if(n[s][0]==="@"){var p=n[s].split(/@@ -(\d+),(\d+) \+(\d+),(\d+) @@/);r.unshift({start:p[3],oldlength:p[2],oldlines:[],newlength:p[4],newlines:[]})}else n[s][0]==="+"?r[0].newlines.push(n[s].substr(1)):n[s][0]==="-"?r[0].oldlines.push(n[s].substr(1)):n[s][0]===" "?(r[0].newlines.push(n[s].substr(1)),r[0].oldlines.push(n[s].substr(1))):n[s][0]==="\\"&&(n[s-1][0]==="+"?f=!0:n[s-1][0]==="-"&&(a=!0));for(var o=t.split(`
`),s=r.length-1;s>=0;s--){for(var i=r[s],l=0;l<i.oldlength;l++)if(o[i.start-1+l]!==i.oldlines[l])return!1;Array.prototype.splice.apply(o,[i.start-1,+i.oldlength].concat(i.newlines))}if(f)for(;!o[o.length-1];)o.pop();else a&&o.push("");return o.join(`
`)},convertChangesToXML:function(t){for(var e=[],n=0;n<t.length;n++){var r=t[n];r.added?e.push("<ins>"):r.removed&&e.push("<del>"),e.push(K(r.value)),r.added?e.push("</ins>"):r.removed&&e.push("</del>")}return e.join("")},convertChangesToDMP:function(t){for(var e=[],n,r=0;r<t.length;r++)n=t[r],e.push([n.added?1:n.removed?-1:0,n.value]);return e}},Y=function(t){const e=[];let n=[];return c.each(t,r=>{const f=r.value.split(`
`);c.each(f,(a,s)=>{s>0&&(e.push(n),n=[]);const o=c.extend({},r,{value:a});n.push(o)})}),n.length&&e.push(n),e},Z=function(t){return t.added?"added":t.removed?"removed":"unchanged"},H=t=>c.map(t.value,e=>({value:e,status:Z(t)})),P=function(t,e){return c.flatten(c.map(t,e),!0)},L=new _.Diff;L.tokenize=t=>c.map(t,e=>[e]);L.join=(t,e)=>t.concat(e);L.equals=c.isEqual;const S=t=>P(t,H),ee=function(t,e){const n=L.diff(t,e),r=S(n);return{before:c.filter(r,f=>f.status!=="added"),after:c.filter(r,f=>f.status!=="removed")}},{SvgImage:te}=J,b="before",q="after",ne=/http.*?\.png|web\+graphie[^)]*/g,O=function(t){return t.match(ne)||[]},j=function(t,e,n){return t.added?e:t.removed?n:""},z=class z extends d.Component{render(){return d.createElement("div",null,c.map(this.props.images,(e,n)=>{const r=D({image:!0,"image-unchanged":e.status==="unchanged","image-added":e.status==="added","image-removed":e.status==="removed"});return d.createElement("div",{key:n},d.createElement("div",{className:r},d.createElement(te,{src:e.value,title:e.value})))}))}};z.propTypes={images:C.arrayOf(C.shape({})).isRequired};let F=z;const N=class N extends d.Component{constructor(){super(...arguments),this.state={collapsed:this.props.before===this.props.after},this.handleExpand=()=>{this.setState({collapsed:!1})}}UNSAFE_componentWillReceiveProps(e){this.setState({collapsed:e.before===e.after})}render(){const e=_.diffWords(this.props.before,this.props.after),n=Y(e),r=O(this.props.before),f=O(this.props.after),a=ee(r,f),s=c.map(n,o=>{const i={};return i.before=c(o).map(function(l,u){return d.createElement("span",{key:u,className:j(l,"not-present","removed dark")},l.value)}),i.after=c(o).map(function(l,u){return d.createElement("span",{key:u,className:j(l,"added dark","not-present")},l.value)}),i}),p=D({"diff-row":!0,collapsed:this.state.collapsed});return d.createElement("div",null,d.createElement("div",{className:"diff-header"},this.props.title),d.createElement("div",{className:"diff-header"},this.props.title),d.createElement("div",{className:"diff-body ui-helper-clearfix"},c.map([b,q],(o,i)=>d.createElement("div",{className:"diff-row "+o,key:i},!this.state.collapsed&&c.map(s,(l,u)=>{const h=l[o].length>1,v=D({"diff-line":!0,added:o===q&&h,removed:o===b&&h});return d.createElement("div",{className:v,key:u},l[o])}),!this.state.collapsed&&d.createElement(F,{images:a[o]})))),c.map([b,q],(o,i)=>d.createElement("div",{className:p+" "+o,key:i,onClick:this.handleExpand},this.state.collapsed&&d.createElement("span",null,d.createElement("span",{className:"expand-button"}," ","[ show unmodified ]"," ")))))}};N.propTypes={after:C.string,before:C.string,title:C.string.isRequired},N.defaultProps={after:"",before:""};let T=N;T.__docgenInfo={description:"",methods:[{name:"handleExpand",docblock:null,modifiers:[],params:[],returns:null}],displayName:"TextDiff",props:{after:{defaultValue:{value:'""',computed:!1},description:"",type:{name:"string"},required:!1},before:{defaultValue:{value:'""',computed:!1},description:"",type:{name:"string"},required:!1},title:{description:"",type:{name:"string"},required:!0}}};export{T};
