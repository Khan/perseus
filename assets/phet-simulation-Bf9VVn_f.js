var P=Object.defineProperty;var E=(n,r,e)=>r in n?P(n,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[r]=e;var c=(n,r,e)=>(E(n,typeof r!="symbol"?r+"":r,e),e);import{j as p}from"./jsx-runtime-BT65X5dW.js";import{r as t}from"./index-C6mWTJJr.js";import{n as w}from"./no-important-DlFk8a1I.js";import{I,x as _}from"./index-CfqIx-dS.js";import{B as j}from"./index-CYrfVekP.js";import{V as l}from"./index-CskvhqFA.js";import{P as B}from"./index-CIHqsnLr.js";import{L as W}from"./index-BRgWRRgj.js";import{a as d,s as i,f as U}from"./index-C9RM_t1w.js";import{b as D}from"./index-CbNKSLRm.js";import{a as z}from"./i18n-context-3AkWzTTj.js";import{g as F}from"./dependencies-BsVPGK1s.js";import{l as N}from"./constants-BIpV3g0K.js";const O=(n,r="")=>({type:n,isSupported:!1,message:r}),A=""+new URL("info-C9QkPWf7.svg",import.meta.url).href,T=""+new URL("smiley-DF1jp_kf.svg",import.meta.url).href,J=""+new URL("warning-By3DoRa6.svg",import.meta.url).href,q=""+new URL("warning-circle-6sErWO7z.svg",import.meta.url).href,V=n=>{switch(n){case"success":return{color:d.status.success.foreground,icon:T,role:"status"};case"warning":return{color:d.status.warning.foreground,icon:J,role:"alert",ariaLive:"polite"};case"critical":return{color:d.status.critical.foreground,icon:q,role:"alert"};default:return{color:d.status.notice.foreground,icon:A,role:"status"}}},K=n=>{const{actions:r,"aria-label":e,dismissAriaLabel:s="Dismiss banner.",onDismiss:m,kind:u="info",layout:g,text:h,testId:y,icon:b}=n,x=()=>r==null?void 0:r.filter(Boolean).map((o,R)=>{if(o.type==="custom")return t.createElement(l,{style:a.action,key:`custom-action-${R}`},o.node);const C=o.onClick;if(o.type==="link"){var v;return t.createElement(l,{style:a.action,key:o.title},t.createElement(W,{href:o.href,onClick:C,"aria-label":(v=o.ariaLabel)!=null?v:o.title,style:a.link},o.title))}else{var L;return t.createElement(l,{style:a.action,key:o.title},t.createElement(j,{kind:"tertiary",size:"small","aria-label":(L=o.ariaLabel)!=null?L:o.title,onClick:C},o.title))}}),f=V(u);return t.createElement(l,{style:[a.containerOuter,g==="floating"&&a.floatingBorder,{borderInlineStartColor:f.color}],role:f.role,"aria-label":e,"aria-live":f.ariaLive,testId:y},t.createElement(l,{style:[a.backgroundColor,{backgroundColor:f.color}]}),t.createElement(l,{style:a.containerInner},t.createElement(B,{icon:b||f.icon,size:"medium",style:a.icon,"aria-label":u,testId:"banner-kind-icon",role:"img"}),t.createElement(l,{style:a.labelAndButtonsContainer},t.createElement(l,{style:a.labelContainer},t.createElement(D,null,h)),r&&t.createElement(l,{style:a.actionsContainer},x())),m?t.createElement(l,{style:a.dismissContainer},t.createElement(I,{icon:_,kind:"tertiary",onClick:m,style:a.dismiss,"aria-label":s})):null))},a=w.StyleSheet.create({backgroundColor:{position:"absolute",top:0,bottom:0,left:0,right:0,opacity:.08},containerOuter:{borderInlineStartWidth:i.xxSmall_6,width:"100%",backgroundColor:d.surface.primary},containerInner:{flexDirection:"row",padding:i.xSmall_8},icon:{marginTop:i.xSmall_8,marginBottom:i.xSmall_8,marginInlineStart:i.xxxxSmall_2,marginInlineEnd:i.xSmall_8,alignSelf:"flex-start",color:d.icon.primary},labelAndButtonsContainer:{flex:1,flexDirection:"row",alignItems:"center",alignContent:"center",flexWrap:"wrap",justifyContent:"space-between"},labelContainer:{flexShrink:1,margin:i.xSmall_8,textAlign:"start",overflowWrap:"break-word"},actionsContainer:{flexDirection:"row",justifyContent:"flex-start",marginTop:i.xSmall_8,marginBottom:i.xSmall_8,height:18,alignItems:"center"},action:{marginLeft:i.xSmall_8,marginRight:i.xSmall_8,justifyContent:"center"},link:{fontSize:U.size.small},dismiss:{flexShrink:1},dismissContainer:{height:40,width:40,justifyContent:"center",alignItems:"center",marginLeft:i.xSmall_8,marginRight:i.xSmall_8},floatingBorder:{borderRadius:4,overflow:"hidden"}}),M=""+new URL("corners-out-Blw9vUtj.svg",import.meta.url).href,$=()=>O("phet-simulation");class k extends t.Component{constructor(e){super(e);c(this,"iframeRef",t.createRef());c(this,"locale");c(this,"isWidget",!0);c(this,"state",{url:null,banner:null});c(this,"getPhetCompatibleLocale",e=>{switch(e){case"pt-pt":return"pt";case"zh-hans":return"zh_CN";case"zh-hant":return"zh_TW";case"fa-af":return"fa_DA";default:return e}});c(this,"displayLoadFailure",()=>{this.setState({url:null,banner:{message:this.context.strings.simulationLoadFail,kind:"critical"}})});this.locale=this.getPhetCompatibleLocale(F().kaLocale)}async componentDidMount(){await this.updateSimState(this.props.url)}async componentDidUpdate(e){e.url!==this.props.url&&await this.updateSimState(this.props.url)}getPromptJSON(){return $()}async updateSimState(e){const s=Q(e,this.locale);if(s===null){this.displayLoadFailure();return}if(!(await fetch(s)).ok){this.displayLoadFailure();return}const u=await this.showLocaleWarning(s);this.setState({url:s,banner:u?{message:this.context.strings.simulationLocaleWarning,kind:"warning"}:null})}async showLocaleWarning(e){if(!e)return!1;const m=/https:\/\/phet\.colorado\.edu\/sims\/html\/([a-zA-Z0-9-]+)\/.*/g.exec(e.toString());if(m===null)return!1;const u=m[1],g=await fetch(`https://phet.colorado.edu/sims/html/${u}/latest/string-map.json`);if(!g.ok)return!1;let h;try{h=await g.json()}catch{return!1}const y=Object.keys(h),b=this.locale.split("_")[0];for(const x of y)if(b===x.split("_")[0])return!1;return!0}render(){var s;return p.jsxs(l,{style:S.widgetContainer,children:[this.state.banner!==null&&p.jsx(l,{style:{marginBottom:N},children:p.jsx(K,{layout:"floating",kind:this.state.banner.kind,text:this.state.banner.message})}),p.jsx(l,{style:S.iframeContainer,children:p.jsx("iframe",{ref:this.iframeRef,title:this.props.description,sandbox:"allow-same-origin allow-scripts",className:w.css(S.iframeResponsive),src:(s=this.state.url)==null?void 0:s.toString(),allow:"fullscreen"})}),this.state.url!==null&&p.jsx(I,{icon:M,onClick:()=>{var m;(m=this.iframeRef.current)==null||m.requestFullscreen()},kind:"secondary","aria-label":"Fullscreen",style:{marginTop:5,marginBottom:5,alignSelf:"flex-end"}})]})}}c(k,"contextType",z);const Q=(n,r)=>{if(!URL.canParse(n))return null;const e=new URL(n);return e.origin!=="https://phet.colorado.edu"?null:(e.searchParams.set("locale",r),e)},S=w.StyleSheet.create({widgetContainer:{borderRadius:6,borderWidth:1,borderColor:"#CCC",padding:i.medium_16,paddingBottom:0},iframeContainer:{position:"relative",overflow:"hidden",width:"100%",paddingTop:"56.25%"},iframeResponsive:{borderWidth:0,position:"absolute",top:0,left:0,bottom:0,right:0,width:"100%",height:"100%"}}),me={name:"phet-simulation",displayName:"PhET Simulation",widget:k,isLintable:!0};k.__docgenInfo={description:"",methods:[{name:"getPhetCompatibleLocale",docblock:null,modifiers:[],params:[{name:"kaLocale",optional:!1,type:null}],returns:null},{name:"getPromptJSON",docblock:null,modifiers:[],params:[],returns:{type:{name:"signature",type:"object",raw:`{
    type: UnsupportedWidget;
    message?: string;
    isSupported: boolean;
}`,signature:{properties:[{key:"type",value:{name:"union",raw:`| "cs-program"
| "iframe"
| "interaction"
| "interactive-graph-unsupported"
| "measurer"
| "phet-simulation"
| "plotter"
| "python-program"
| "video"`,elements:[{name:"literal",value:'"cs-program"'},{name:"literal",value:'"iframe"'},{name:"literal",value:'"interaction"'},{name:"literal",value:'"interactive-graph-unsupported"'},{name:"literal",value:'"measurer"'},{name:"literal",value:'"phet-simulation"'},{name:"literal",value:'"plotter"'},{name:"literal",value:'"python-program"'},{name:"literal",value:'"video"'}],required:!0}},{key:"message",value:{name:"string",required:!1}},{key:"isSupported",value:{name:"boolean",required:!0}}]}}}},{name:"displayLoadFailure",docblock:null,modifiers:[],params:[],returns:null},{name:"updateSimState",docblock:null,modifiers:["async"],params:[{name:"urlString",optional:!1,type:{name:"string"}}],returns:null},{name:"showLocaleWarning",docblock:null,modifiers:["async"],params:[{name:"url",optional:!1,type:{name:"URL",alias:"URL"}}],returns:{type:{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>"}}}],displayName:"PhetSimulation"};export{K as B,k as P,me as a,O as g,Q as m};
