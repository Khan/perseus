import{j as r,a as l}from"./jsx-runtime-BGVbfQ2Z.js";import{p as D}from"./compare-VLxlEkSV.js";import{_ as d}from"./index-default-4_ZsnO94.js";import{P as F,E as N}from"./article-renderer-anqXYUuk.js";import"./util-WvQWLN3r.js";import{l as f,c as w}from"./unit-uxf7imOh.js";import{g as C}from"./dependencies-fnqF3NiV.js";import"./perseus-api-BF68z3pH.js";import"./multi-renderer-RJ1Gy1Qp.js";import"./hints-renderer-gKOQJsVP.js";import"./renderer-0WTyF9ZX.js";import"./base-radio-ZMSPcM4W.js";import{c as k}from"./components-04bRc_gR.js";import"./jquery-5v7aFUvu.js";import"./i18n-context-9-s9cJ--.js";import{f as E}from"./index-J2t_5nK1.js";import{r as y}from"./index-qhcEwEpg.js";import{c as S}from"./prop-check-box-yQKE-Nit.js";import{P as _}from"./index-tvtfaFq4.js";import{R as I}from"./index-E09jvG0x.js";const a=_,A=S({propTypes:{className:a.string,components:a.arrayOf(a.node).isRequired,onReorder:a.func.isRequired,style:a.any,verify:a.func},getDefaultProps:function(){return{verify:()=>!0}},getInitialState:function(){return{dragging:null,components:this.props.components}},componentDidMount:function(){this._setDragEvents()},UNSAFE_componentWillReceiveProps:function(n){this.setState({components:n.components})},componentDidUpdate:function(){this._setDragEvents()},onDragStart:function(n){this.setState({dragging:n})},onDrop:function(){this.setState({dragging:null}),this.props.onReorder(this.state.components)},onDragEnter:function(n){if(this.state.dragging===n)return;const e=this.state.components.slice(),s=e.splice(this.state.dragging,1);e.splice(n,0,s[0]);const t=this.props.verify(e);return t&&this.setState({dragging:n,components:e}),t},_listenEvent:function(n){n.dataTransfer.setData("hackhackhack","because browsers!")},_cancelEvent:function(n){n.preventDefault()},_setDragEvents:function(){this._dragItems=this._dragItems||[];const n=I.findDOMNode(this).querySelectorAll("[draggable=true]"),e=[],s=[];for(let t=0;t<this._dragItems.length;t++){const i=this._dragItems[t];n.indexOf(i)<0&&e.push(i)}for(let t=0;t<n.length;t++){const i=n[t];this._dragItems.indexOf(i)<0&&s.push(i)}for(let t=0;t<s.length;t++){const i=s[t];i.addEventListener("dragstart",this._listenEvent),i.addEventListener("drop",this._cancelEvent)}for(let t=0;t<e.length;t++){const i=e[t];i.removeEventListener("dragstart",this._listenEvent),i.removeEventListener("drop",this._cancelEvent)}},render:function(){const n=this.state.components.map((e,s)=>r(q,{index:s,component:e,area:this,draggable:e.props.draggable,dragging:s===this.state.dragging},e.key));return r("ol",{className:this.props.className,style:this.props.style,children:n})}}),q=S({propTypes:{area:a.shape({onDragEnter:a.func.isRequired,onDragStart:a.func.isRequired,onDrop:a.func.isRequired}),component:a.node.isRequired,dragging:a.bool.isRequired,draggable:a.bool.isRequired,index:a.number.isRequired},handleDragStart:function(n){n.nativeEvent.dataTransfer.effectAllowed="move",this.props.area.onDragStart(this.props.index)},handleDrop:function(){this.props.area.onDrop(this.props.index)},handleDragEnter:function(n){const e=this.props.area.onDragEnter(this.props.index);n.nativeEvent.dataTransfer.effectAllowed=e?"move":"none"},handleDragOver:function(n){n.preventDefault()},render:function(){let n="sortable-disabled";return this.props.dragging?n="sortable-dragging":this.props.draggable&&(n="sortable-enabled"),r("li",{draggable:this.props.draggable,className:n,onDragStart:this.handleDragStart,onDrop:this.handleDrop,onDragEnter:this.handleDragEnter,onDragOver:this.handleDragOver,children:this.props.component})}}),{InfoTip:c,PropCheckBox:b}=k,v=["basic","trig","prealgebra","logarithms","basic relations","advanced relations"],x=({key:n})=>Number.parseInt(n??""),R=n=>{const e=[];n.forEach(s=>{e[x(s)]=!0});for(let s=0;s<e.length;s++)if(!e[s])return s;return e.length},u=class u extends y.Component{constructor(){super(...arguments),this.serialize=()=>{const e=["value","form","simplify","considered","key"],s=["answerForms","buttonSets","functions","times"],t=this.props.answerForms.map(i=>d(i).pick(e));return f(this.props).set(["answerForms"],t).mod([],i=>d(i).pick(s)).freeze()},this.getSaveWarnings=()=>{const e=[];return this.props.answerForms.length===0?e.push("No answers specified"):(this.props.answerForms.some(t=>t.considered==="correct")||e.push("No correct answer specified"),d(this.props.answerForms).each((t,i)=>{if(this.props.value==="")e.push(`Answer ${i+1} is empty`);else{const o=D(t.value,{functions:this.props.functions});o.parsed?t.simplify&&!o.expr.isSimplified()&&e.push(`${t.value} isn't simplified, but is required" +
                            " to be`):e.push(`Couldn't parse ${t.value}`)}})),e},this._newEmptyAnswerForm=()=>({considered:"correct",form:!1,key:R(this.props.answerForms),simplify:!1,value:""}),this.newAnswer=()=>{const e=this.props.answerForms.slice();e.push(this._newEmptyAnswerForm()),this.change({answerForms:e})},this.handleRemoveForm=e=>{const s=this.props.answerForms.slice();s.splice(e,1),this.change({answerForms:s})},this.updateForm=(e,s)=>{const t=f(this.props.answerForms).merge([e],s).freeze();this.change({answerForms:t})},this.handleReorder=e=>{const s=e.map(t=>{const i=d(t.props).pick("considered","form","simplify","value");return i.key=t.key,i});this.change({answerForms:s})},this.handleButtonSet=e=>{const t=v.filter(i=>this.props.buttonSets.includes(i)!==(i===e));this.props.onChange({buttonSets:t})},this.handleToggleDiv=()=>{let e,s;this.props.buttonSets.includes("basic+div")?(e="basic",s="basic+div"):(e="basic+div",s="basic");const t=this.props.buttonSets.filter(i=>i!==s).concat(e);this.change("buttonSets",t)},this.handleTexInsert=e=>{this.refs.expression.insert(e)},this.handleFunctions=e=>{const s={};s.functions=e.target.value.split(/[ ,]+/).filter(E),this.props.onChange(s)}}change(...e){return w.apply(this,e)}render(){const e=this.props.answerForms.map(o=>{const p=x(o),m={times:this.props.times,functions:this.props.functions,buttonSets:this.props.buttonSets,buttonsVisible:"focused",form:o.form,simplify:o.simplify,value:o.value,onChange:g=>this.updateForm(p,g),trackInteraction:()=>{},widgetId:this.props.widgetId+"-"+o.key};return f(o).merge([],{key:p,draggable:!0,onChange:g=>this.updateForm(Number.parseInt(o.key??""),g),onDelete:()=>this.handleRemoveForm(p),expressionProps:m}).freeze()}).map(o=>r(P,{...o},o.key)),s=r(A,{components:e,onReorder:this.handleReorder,className:"answer-options-list"}),t=v.map(o=>{const p=o==="basic",m=this.props.buttonSets.includes(o)||p;return l("label",{className:"button-set-label",children:[r("input",{type:"checkbox",checked:m,disabled:p,onChange:()=>this.handleButtonSet(o)}),o]},o)}),{TeX:i}=C();return t.unshift(l("label",{className:"button-set-label",children:[r("input",{type:"checkbox",onChange:this.handleToggleDiv}),l("span",{className:"show-div-button",children:["show ",r(i,{children:"\\div"})," button"]})]},"show-div")),l("div",{className:"perseus-widget-expression-editor",children:[r("h3",{className:"expression-editor-h3",children:"Global Options"}),l("div",{children:[r(b,{times:this.props.times,onChange:this.props.onChange,labelAlignment:"right",label:`Use Ã— for rendering multiplication instead of a
                        center dot.`}),r(c,{children:r("p",{children:"For pre-algebra problems this option displays multiplication as \\times instead of \\cdot in both the rendered output and the acceptable formats examples."})})]}),l("div",{children:[l("label",{children:["Function variables: ",r("input",{type:"text",defaultValue:this.props.functions.join(" "),onChange:this.handleFunctions})]}),r(c,{children:r("p",{children:'Single-letter variables listed here will be interpreted as functions. This let us know that f(x) means "f of x" and not "f times x".'})})]}),l("div",{children:[r("div",{children:"Button sets:"}),t]}),r("h3",{className:"expression-editor-h3",children:"Answers"}),r("p",{style:{margin:"4px 0"},children:"student responses area matched against these from top to bottom"}),s,r("div",{children:r("button",{className:"simple-button orange",style:{fontSize:13},onClick:this.newAnswer,type:"button",children:"Add new answer"})})]})}};u.widgetName="expression",u.defaultProps={answerForms:[],times:!1,buttonSets:["basic"],functions:["f","g","h"]};let h=u;const T=function(n,e){let s=n.indexOf(e);return s=(s+1)%n.length,n[s]};class P extends y.Component{constructor(){super(...arguments),this.state={deleteFocused:!1},this.handleDeleteBlur=()=>{this.setState({deleteFocused:!1})},this.change=(...e)=>w.apply(this,e),this.handleImSure=()=>{this.props.onDelete()},this.handleDelete=()=>{this.setState({deleteFocused:!0})},this.toggleConsidered=()=>{const e=T(F,this.props.considered);this.change({considered:e})}}render(){let e=null;return this.state.deleteFocused?e=r("button",{type:"button",className:"simple-button orange",onClick:this.handleImSure,onBlur:this.handleDeleteBlur,children:"I'm sure!"}):e=r("button",{type:"button",className:"simple-button orange",onClick:this.handleDelete,children:"Delete"}),l("div",{className:"expression-answer-option",children:[r("div",{className:"answer-handle"}),l("div",{className:"answer-body",children:[l("div",{className:"answer-considered",children:[r("div",{onClick:this.toggleConsidered,className:"answer-status "+this.props.considered,children:this.props.considered}),r("div",{className:"answer-expression",children:r(N,{...this.props.expressionProps})})]}),l("div",{className:"answer-option",children:[r(b,{form:this.props.form,onChange:this.props.onChange,labelAlignment:"right",label:"Answer expression must have the same form."}),r(c,{children:r("p",{children:"The student's answer must be in the same form. Commutativity and excess negative signs are ignored."})})]}),l("div",{className:"answer-option",children:[r(b,{simplify:this.props.simplify,onChange:this.props.onChange,labelAlignment:"right",label:`Answer expression must be fully expanded and
                            simplified.`}),r(c,{children:r("p",{children:`The student's answer must be fully expanded and simplified. Answering this equation (x^2+2x+1) with this factored equation (x+1)^2 will render this response "Your answer is not fully expanded and simplified."`})})]}),r("div",{className:"remove-container",children:e})]})]})}}try{h.displayName="ExpressionEditor",h.__docgenInfo={description:"",displayName:"ExpressionEditor",props:{widgetId:{defaultValue:null,description:"",name:"widgetId",required:!1,type:{name:"any"}},value:{defaultValue:null,description:"",name:"value",required:!1,type:{name:"string"}},answerForms:{defaultValue:{value:"[]"},description:"",name:"answerForms",required:!1,type:{name:"readonly PerseusExpressionAnswerForm[]"}},buttonSets:{defaultValue:{value:'["basic"]'},description:"",name:"buttonSets",required:!1,type:{name:"LegacyButtonSets"}},functions:{defaultValue:{value:'["f", "g", "h"]'},description:"",name:"functions",required:!1,type:{name:"readonly string[]"}},times:{defaultValue:{value:"false"},description:"",name:"times",required:!1,type:{name:"boolean"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(values: { [key: string]: any; }, callback?: (() => unknown) | null | undefined, silent?: boolean | undefined) => unknown"}}}}}catch{}export{h as E};
