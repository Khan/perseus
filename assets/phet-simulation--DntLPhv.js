import{j as c}from"./jsx-runtime-63Ea5SlK.js";import{r}from"./index-6oxdNXpR.js";import{n as w}from"./no-important-xCWWYXQR.js";import{I as L,x as E}from"./index-ZdJtI3z8.js";import{B as P}from"./index-_CVl-B2F.js";import{V as o}from"./index-_3CKOwHy.js";import{P as _}from"./index-7Z-R4z4z.js";import{L as j}from"./index-Xg8lxIoz.js";import{s as a,a as u,f as B}from"./index-QHkT31Yt.js";import{b as U}from"./index-4dAUYsag.js";import{P as W}from"./i18n-context-dE2bX2K_.js";import{g as D}from"./dependencies-CP7Uh8Kq.js";import{s as z}from"./constants-NhstHO4m.js";const F=(l,e="")=>({type:l,isSupported:!1,message:e}),N=""+new URL("info-vUJD1n-8.svg",import.meta.url).href,O=""+new URL("smiley-xdY6f5H9.svg",import.meta.url).href,A=""+new URL("warning-ctw6EWuu.svg",import.meta.url).href,T=""+new URL("warning-circle-OrBK1ju8.svg",import.meta.url).href,J=l=>{switch(l){case"success":return{color:u.status.success.foreground,icon:O,role:"status"};case"warning":return{color:u.status.warning.foreground,icon:A,role:"alert",ariaLive:"polite"};case"critical":return{color:u.status.critical.foreground,icon:T,role:"alert"};default:return{color:u.status.notice.foreground,icon:N,role:"status"}}},q=l=>{const{actions:e,"aria-label":t,dismissAriaLabel:s="Dismiss banner.",onDismiss:m,kind:p="info",layout:f,text:g,testId:y,icon:b}=l,I=()=>e==null?void 0:e.filter(Boolean).map((i,R)=>{if(i.type==="custom")return r.createElement(o,{style:n.action,key:`custom-action-${R}`},i.node);const k=i.onClick;if(i.type==="link"){var C;return r.createElement(o,{style:n.action,key:i.title},r.createElement(j,{kind:"primary",href:i.href,onClick:k,"aria-label":(C=i.ariaLabel)!=null?C:i.title,style:n.link},i.title))}else{var v;return r.createElement(o,{style:n.action,key:i.title},r.createElement(P,{kind:"tertiary",size:"small","aria-label":(v=i.ariaLabel)!=null?v:i.title,onClick:k},i.title))}}),d=J(p);return r.createElement(o,{style:[n.containerOuter,f==="floating"&&n.floatingBorder,{borderInlineStartColor:d.color}],role:d.role,"aria-label":t,"aria-live":d.ariaLive,testId:y},r.createElement(o,{style:[n.backgroundColor,{backgroundColor:d.color}]}),r.createElement(o,{style:n.containerInner},r.createElement(_,{icon:b||d.icon,size:"medium",style:n.icon,"aria-label":p,testId:"banner-kind-icon",role:"img"}),r.createElement(o,{style:n.labelAndButtonsContainer},r.createElement(o,{style:n.labelContainer},r.createElement(U,null,g)),e&&r.createElement(o,{style:n.actionsContainer},I())),m?r.createElement(o,{style:n.dismissContainer},r.createElement(L,{icon:E,kind:"tertiary",onClick:m,style:n.dismiss,"aria-label":s})):null))},n=w.StyleSheet.create({backgroundColor:{position:"absolute",top:0,bottom:0,left:0,right:0,opacity:.08},containerOuter:{borderInlineStartWidth:a.xxSmall_6,width:"100%",backgroundColor:u.surface.primary},containerInner:{flexDirection:"row",padding:a.xSmall_8},icon:{marginTop:a.xSmall_8,marginBottom:a.xSmall_8,marginInlineStart:a.xxxxSmall_2,marginInlineEnd:a.xSmall_8,alignSelf:"flex-start",color:u.icon.primary},labelAndButtonsContainer:{flex:1,flexDirection:"row",alignItems:"center",alignContent:"center",flexWrap:"wrap",justifyContent:"space-between"},labelContainer:{flexShrink:1,margin:a.xSmall_8,textAlign:"start",overflowWrap:"break-word"},actionsContainer:{flexDirection:"row",justifyContent:"flex-start",marginTop:a.xSmall_8,marginBottom:a.xSmall_8,height:18,alignItems:"center"},action:{marginLeft:a.xSmall_8,marginRight:a.xSmall_8,justifyContent:"center"},link:{fontSize:B.size.small},dismiss:{flexShrink:1},dismissContainer:{height:40,width:40,justifyContent:"center",alignItems:"center",marginLeft:a.xSmall_8,marginRight:a.xSmall_8},floatingBorder:{borderRadius:4,overflow:"hidden"}}),K=""+new URL("corners-out-ZcPb1LY6.svg",import.meta.url).href,V=()=>F("phet-simulation"),S=class S extends r.Component{constructor(e){super(e),this.iframeRef=r.createRef(),this.isWidget=!0,this.state={url:null,banner:null},this.getPhetCompatibleLocale=t=>{switch(t){case"pt-pt":return"pt";case"zh-hans":return"zh_CN";case"zh-hant":return"zh_TW";case"fa-af":return"fa_DA";default:return t}},this.displayLoadFailure=()=>{this.setState({url:null,banner:{message:this.context.strings.simulationLoadFail,kind:"critical"}})},this.locale=this.getPhetCompatibleLocale(D().kaLocale)}async componentDidMount(){await this.updateSimState(this.props.url)}async componentDidUpdate(e){e.url!==this.props.url&&await this.updateSimState(this.props.url)}getPromptJSON(){return V()}async updateSimState(e){const t=M(e,this.locale);if(t===null){this.displayLoadFailure();return}if(!(await fetch(t)).ok){this.displayLoadFailure();return}const m=await this.showLocaleWarning(t);this.setState({url:t,banner:m?{message:this.context.strings.simulationLocaleWarning,kind:"warning"}:null})}async showLocaleWarning(e){if(!e)return!1;const s=/https:\/\/phet\.colorado\.edu\/sims\/html\/([a-zA-Z0-9-]+)\/.*/g.exec(e.toString());if(s===null)return!1;const m=s[1],p=await fetch(`https://phet.colorado.edu/sims/html/${m}/latest/string-map.json`);if(!p.ok)return!1;let f;try{f=await p.json()}catch{return!1}const g=Object.keys(f),y=this.locale.split("_")[0];for(const b of g)if(y===b.split("_")[0])return!1;return!0}render(){var t;return c.jsxs(o,{style:x.widgetContainer,children:[this.state.banner!==null&&c.jsx(o,{style:{marginBottom:z},children:c.jsx(q,{layout:"floating",kind:this.state.banner.kind,text:this.state.banner.message})}),c.jsx(o,{style:x.iframeContainer,children:c.jsx("iframe",{ref:this.iframeRef,title:this.props.description,sandbox:"allow-same-origin allow-scripts",className:w.css(x.iframeResponsive),src:(t=this.state.url)==null?void 0:t.toString(),allow:"fullscreen"})}),this.state.url!==null&&c.jsx(L,{icon:K,onClick:()=>{var s;(s=this.iframeRef.current)==null||s.requestFullscreen()},kind:"secondary","aria-label":"Fullscreen",style:{marginTop:5,marginBottom:5,alignSelf:"flex-end"}})]})}};S.contextType=W;let h=S;const M=(l,e)=>{if(!URL.canParse(l))return null;const t=new URL(l);return t.origin!=="https://phet.colorado.edu"?null:(t.searchParams.set("locale",e),t)},x=w.StyleSheet.create({widgetContainer:{borderRadius:6,borderWidth:1,borderColor:"#CCC",padding:a.medium_16,paddingBottom:0},iframeContainer:{position:"relative",overflow:"hidden",width:"100%",paddingTop:"56.25%"},iframeResponsive:{borderWidth:0,position:"absolute",top:0,left:0,bottom:0,right:0,width:"100%",height:"100%"}}),oe={name:"phet-simulation",displayName:"PhET Simulation",widget:h,isLintable:!0};h.__docgenInfo={description:"",methods:[{name:"getPhetCompatibleLocale",docblock:null,modifiers:[],params:[{name:"kaLocale",optional:!1,type:null}],returns:null},{name:"getPromptJSON",docblock:null,modifiers:[],params:[],returns:{type:{name:"signature",type:"object",raw:`{
    type: UnsupportedWidget;
    message?: string;
    isSupported: boolean;
}`,signature:{properties:[{key:"type",value:{name:"union",raw:`| "cs-program"
| "iframe"
| "interaction"
| "interactive-graph-unsupported"
| "measurer"
| "phet-simulation"
| "plotter"
| "python-program"
| "video"`,elements:[{name:"literal",value:'"cs-program"'},{name:"literal",value:'"iframe"'},{name:"literal",value:'"interaction"'},{name:"literal",value:'"interactive-graph-unsupported"'},{name:"literal",value:'"measurer"'},{name:"literal",value:'"phet-simulation"'},{name:"literal",value:'"plotter"'},{name:"literal",value:'"python-program"'},{name:"literal",value:'"video"'}],required:!0}},{key:"message",value:{name:"string",required:!1}},{key:"isSupported",value:{name:"boolean",required:!0}}]}}}},{name:"displayLoadFailure",docblock:null,modifiers:[],params:[],returns:null},{name:"updateSimState",docblock:null,modifiers:["async"],params:[{name:"urlString",optional:!1,type:{name:"string"}}],returns:null},{name:"showLocaleWarning",docblock:null,modifiers:["async"],params:[{name:"url",optional:!1,type:{name:"URL",alias:"URL"}}],returns:{type:{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>"}}}],displayName:"PhetSimulation"};export{q as B,h as P,oe as a,F as g,M as m};
