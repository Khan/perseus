var J=Object.defineProperty;var K=(e,t,s)=>t in e?J(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var j=(e,t,s)=>(K(e,typeof t!="symbol"?t+"":t,s),s);import{j as c}from"./jsx-runtime-BT65X5dW.js";import"./all-widgets-CcvBUZyq.js";import"./index-CW2s7ekB.js";import"./answer-choices-o7nWuEK5.js";import"./index-CFvGmn7i.js";import{r as M}from"./index-C6mWTJJr.js";import"./index-B1Gws05u.js";import"./i18n-context-3AkWzTTj.js";import"./perseus-api-Ty_QvlNi.js";import"./renderer-MnwUqKiq.js";import{c as b}from"./index-D7h-teXI.js";import"./jquery-CkHB0_Mt.js";import{_ as d}from"./underscore-U-AHniOr.js";import"./dependencies-BsVPGK1s.js";import"./util-CqRduJsD.js";import"./zoomable-tex-Dy-nElJT.js";import"./svg-image-Cfg9MzBk.js";import"./core-widget-registry-BDqK5cn0.js";import"./no-important-DlFk8a1I.js";import"./number-input-CoXYXYV4.js";import"./simple-keypad-input-ajnHB_Fe.js";import"./text-input-sx8AZWeZ.js";import"./phet-simulation-DSu5lgF2.js";import"./sortable-BYWQvUMB.js";import"./fixed-to-responsive-CTsII9Xx.js";import"./math-input-Bp0dA6SW.js";import"./video-transcript-link-BsyCgIOs.js";import"./item-version-D4DfJQO4.js";import"./article-renderer-D2RcX4oT.js";import"./server-item-renderer-BU1lu1GY.js";import"./hints-renderer-B4RsSymp.js";import"./base-radio-Bf-PIA4H.js";import{c as Q}from"./components-RRYcreih.js";import"./index-Dd-cahjY.js";import{P as E}from"./index-CrGd2QqM.js";function F(e){return{newPos:e.newPos,components:e.components.slice(0)}}function O(e){for(var t=[],s=0;s<e.length;s++)e[s]&&t.push(e[s]);return t}function Y(e){var t=e;return t=t.replace(/&/g,"&amp;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=t.replace(/"/g,"&quot;"),t}var w=function(e){this.ignoreWhitespace=e};w.prototype={diff:function(e,t){if(t===e)return[{value:t}];if(!t)return[{value:e,removed:!0}];if(!e)return[{value:t,added:!0}];t=this.tokenize(t),e=this.tokenize(e);var s=t.length,r=e.length,f=s+r,i=[{newPos:-1,components:[]}],n=this.extractCommon(i[0],t,e,0);if(i[0].newPos+1>=s&&n+1>=r)return i[0].components;for(var u=1;u<=f;u++)for(var p=-1*u;p<=u;p+=2){var o,l=i[p-1],a=i[p+1];n=(a?a.newPos:0)-p,l&&(i[p-1]=void 0);var m=l&&l.newPos+1<s,v=a&&0<=n&&n<r;if(!m&&!v){i[p]=void 0;continue}!m||v&&l.newPos<a.newPos?(o=F(a),this.pushComponent(o.components,e[n],void 0,!0)):(o=F(l),o.newPos++,this.pushComponent(o.components,t[o.newPos],!0,void 0));var n=this.extractCommon(o,t,e,p);if(o.newPos+1>=s&&n+1>=r)return o.components;i[p]=o}},pushComponent:function(e,t,s,r){var f=e[e.length-1];f&&f.added===s&&f.removed===r?e[e.length-1]={value:this.join(f.value,t),added:s,removed:r}:e.push({value:t,added:s,removed:r})},extractCommon:function(e,t,s,r){for(var f=t.length,i=s.length,n=e.newPos,u=n-r;n+1<f&&u+1<i&&this.equals(t[n+1],s[u+1]);)n++,u++,this.pushComponent(e.components,t[n],void 0,void 0);return e.newPos=n,u},equals:function(e,t){var s=/\S/;return this.ignoreWhitespace&&!s.test(e)&&!s.test(t)?!0:e===t},join:function(e,t){return e+t},tokenize:function(e){return e}};var Z=new w,_=new w(!0),G=new w;_.tokenize=G.tokenize=function(e){return O(e.split(/(\s+|\b)/))};var U=new w(!0);U.tokenize=function(e){return O(e.split(/([{}:;,]|\s+)/))};var q=new w;q.tokenize=function(e){for(var t=[],s=e.split(/^/m),r=0;r<s.length;r++){var f=s[r],i=s[r-1];f==`
`&&i&&i[i.length-1]==="\r"?t[t.length-1]+=`
`:f&&t.push(f)}return t};const V={Diff:w,diffChars:function(e,t){return Z.diff(e,t)},diffWords:function(e,t){return _.diff(e,t)},diffWordsWithSpace:function(e,t){return G.diff(e,t)},diffLines:function(e,t){return q.diff(e,t)},diffCss:function(e,t){return U.diff(e,t)},createPatch:function(e,t,s,r,f){var i=[];i.push("Index: "+e),i.push("==================================================================="),i.push("--- "+e+(typeof r>"u"?"":"	"+r)),i.push("+++ "+e+(typeof f>"u"?"":"	"+f));var n=q.diff(t,s);n[n.length-1].value||n.pop(),n.push({value:"",lines:[]});function u(C){return C.map(function(N){return" "+N})}function p(C,N,D){var I=n[n.length-2],$=N===n.length-2,B=N===n.length-3&&(D.added!==I.added||D.removed!==I.removed);!/\n$/.test(D.value)&&($||B)&&C.push("\\ No newline at end of file")}for(var o=0,l=0,a=[],m=1,v=1,g=0;g<n.length;g++){var x=n[g],h=x.lines||x.value.replace(/\n$/,"").split(`
`);if(x.lines=h,x.added||x.removed){if(!o){var T=n[g-1];o=m,l=v,T&&(a=u(T.lines.slice(-4)),o-=a.length,l-=a.length)}a.push.apply(a,h.map(function(C){return(x.added?"+":"-")+C})),p(a,g,x),x.added?v+=h.length:m+=h.length}else{if(o)if(h.length<=8&&g<n.length-2)a.push.apply(a,u(h));else{var L=Math.min(h.length,4);i.push("@@ -"+o+","+(m-o+L)+" +"+l+","+(v-l+L)+" @@"),i.push.apply(i,a),i.push.apply(i,u(h.slice(0,L))),h.length<=4&&p(i,g,x),o=0,l=0,a=[]}m+=h.length,v+=h.length}}return i.join(`
`)+`
`},applyPatch:function(e,t){for(var s=t.split(`
`),r=[],f=!1,i=!1,n=s[0][0]==="I"?4:0;n<s.length;n++)if(s[n][0]==="@"){var u=s[n].split(/@@ -(\d+),(\d+) \+(\d+),(\d+) @@/);r.unshift({start:u[3],oldlength:u[2],oldlines:[],newlength:u[4],newlines:[]})}else s[n][0]==="+"?r[0].newlines.push(s[n].substr(1)):s[n][0]==="-"?r[0].oldlines.push(s[n].substr(1)):s[n][0]===" "?(r[0].newlines.push(s[n].substr(1)),r[0].oldlines.push(s[n].substr(1))):s[n][0]==="\\"&&(s[n-1][0]==="+"?f=!0:s[n-1][0]==="-"&&(i=!0));for(var p=e.split(`
`),n=r.length-1;n>=0;n--){for(var o=r[n],l=0;l<o.oldlength;l++)if(p[o.start-1+l]!==o.oldlines[l])return!1;Array.prototype.splice.apply(p,[o.start-1,+o.oldlength].concat(o.newlines))}if(f)for(;!p[p.length-1];)p.pop();else i&&p.push("");return p.join(`
`)},convertChangesToXML:function(e){for(var t=[],s=0;s<e.length;s++){var r=e[s];r.added?t.push("<ins>"):r.removed&&t.push("<del>"),t.push(Y(r.value)),r.added?t.push("</ins>"):r.removed&&t.push("</del>")}return t.join("")},convertChangesToDMP:function(e){for(var t=[],s,r=0;r<e.length;r++)s=e[r],t.push([s.added?1:s.removed?-1:0,s.value]);return t}},H=function(e){const t=[];let s=[];return d.each(e,r=>{const f=r.value.split(`
`);d.each(f,(i,n)=>{n>0&&(t.push(s),s=[]);const p=d.extend({},r,{value:i});s.push(p)})}),s.length&&t.push(s),t},P=function(e){return e.added?"added":e.removed?"removed":"unchanged"},S=e=>d.map(e.value,t=>({value:t,status:P(e)})),ee=function(e,t){return d.flatten(d.map(e,t),!0)},y=new V.Diff;y.tokenize=e=>d.map(e,t=>[t]);y.join=(e,t)=>e.concat(t);y.equals=d.isEqual;const te=e=>ee(e,S),se=function(e,t){const s=y.diff(e,t),r=te(s);return{before:d.filter(r,f=>f.status!=="added"),after:d.filter(r,f=>f.status!=="removed")}},{SvgImage:ne}=Q,k="before",W="after",re=/http.*?\.png|web\+graphie[^)]*/g,z=function(e){return e.match(re)||[]},A=function(e,t,s){return e.added?t:e.removed?s:""};class X extends M.Component{render(){return c.jsx("div",{children:d.map(this.props.images,(t,s)=>{const r=b({image:!0,"image-unchanged":t.status==="unchanged","image-added":t.status==="added","image-removed":t.status==="removed"});return c.jsx("div",{children:c.jsx("div",{className:r,children:c.jsx(ne,{src:t.value,title:t.value})})},s)})})}}j(X,"propTypes",{images:E.arrayOf(E.shape({})).isRequired});class R extends M.Component{constructor(){super(...arguments);j(this,"state",{collapsed:this.props.before===this.props.after});j(this,"handleExpand",()=>{this.setState({collapsed:!1})})}UNSAFE_componentWillReceiveProps(s){this.setState({collapsed:s.before===s.after})}render(){const s=V.diffWords(this.props.before,this.props.after),r=H(s),f=z(this.props.before),i=z(this.props.after),n=se(f,i),u=d.map(r,o=>{const l={};return l.before=d(o).map(function(a,m){return c.jsx("span",{className:A(a,"not-present","removed dark"),children:a.value},m)}),l.after=d(o).map(function(a,m){return c.jsx("span",{className:A(a,"added dark","not-present"),children:a.value},m)}),l}),p=b({"diff-row":!0,collapsed:this.state.collapsed});return c.jsxs("div",{children:[c.jsx("div",{className:"diff-header",children:this.props.title}),c.jsx("div",{className:"diff-header",children:this.props.title}),c.jsx("div",{className:"diff-body ui-helper-clearfix",children:d.map([k,W],(o,l)=>c.jsxs("div",{className:"diff-row "+o,children:[!this.state.collapsed&&d.map(u,(a,m)=>{const v=a[o].length>1,g=b({"diff-line":!0,added:o===W&&v,removed:o===k&&v});return c.jsx("div",{className:g,children:a[o]},m)}),!this.state.collapsed&&c.jsx(X,{images:n[o]})]},l))}),d.map([k,W],(o,l)=>c.jsx("div",{className:p+" "+o,onClick:this.handleExpand,children:this.state.collapsed&&c.jsx("span",{children:c.jsxs("span",{className:"expand-button",children:[" ","[ show unmodified ]"," "]})})},l))]})}}j(R,"propTypes",{after:E.string,before:E.string,title:E.string.isRequired}),j(R,"defaultProps",{after:"",before:""});R.__docgenInfo={description:"",methods:[{name:"handleExpand",docblock:null,modifiers:[],params:[],returns:null}],displayName:"TextDiff",props:{after:{defaultValue:{value:'""',computed:!1},description:"",type:{name:"string"},required:!1},before:{defaultValue:{value:'""',computed:!1},description:"",type:{name:"string"},required:!1},title:{description:"",type:{name:"string"},required:!0}}};export{R as T};
