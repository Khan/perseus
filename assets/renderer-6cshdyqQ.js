import{j as p,a as fe}from"./jsx-runtime-BGVbfQ2Z.js";import{a as me}from"./version-akiLXZts.js";import{P as F}from"./index-tvtfaFq4.js";import{e as ut}from"./index-J2t_5nK1.js";import{c as xe}from"./index-awCzqCwC.js";import{$ as dt}from"./jquery-5v7aFUvu.js";import{r as L}from"./index-qhcEwEpg.js";import{R as Ee}from"./index-E09jvG0x.js";import{_ as c,d as ht}from"./index-default-4_ZsnO94.js";import{c as be}from"./asset-context-pmjKTqqL.js";import{S as pt,o as gt}from"./svg-image-6q36axAB.js";import{T as Fe}from"./tex-SwZEYYPF.js";import{Z as ft}from"./zoomable-QW77xrsT.js";import{Z as mt}from"./zoomable-tex-LJgLrbXQ.js";import{g as X,D as yt}from"./dependencies-fnqF3NiV.js";import{L as j,E as C,P as B}from"./perseus-error-OpXxk17X.js";import{A as vt,C as ke}from"./perseus-api-Ly41NhN4.js";import{L as wt}from"./lint-4QkP-VXi.js";import{U as se}from"./util-WvQWLN3r.js";import{f as bt,t as kt,u as _t,z as It}from"./constants-I_nlPaPx.js";const St="@khanacademy/perseus-error",xt="__lib_version__";me(St,xt);const Z=Object.freeze({Unknown:"Unknown",Internal:"Internal",InvalidInput:"InvalidInput",NotAllowed:"NotAllowed",TransientService:"TransientService",Service:"Service"});class Q extends Error{constructor(t,e,r){super(t),this.kind=e,this.metadata=r==null?void 0:r.metadata}}class V{static parse(t){return new ye(t).parse()}match(t){throw new Q("Selector subclasses must implement match()",Z.NotAllowed)}toString(){return"Unknown selector class"}}class ye{constructor(t){t=t.trim().replace(/\s+/g," "),this.tokens=t.match(ye.TOKENS)||[],this.tokenIndex=0}nextToken(){return this.tokens[this.tokenIndex]||""}consume(){this.tokenIndex++}isIdentifier(){const t=this.tokens[this.tokenIndex][0];return t>="a"&&t<="z"||t>="A"&&t<="Z"}skipSpace(){for(;this.nextToken()===" ";)this.consume()}parse(){const t=this.parseTreeSelector();let e=this.nextToken();if(!e)return t;const r=[t];for(;e;){if(e===",")this.consume();else throw new _e("Expected comma");r.push(this.parseTreeSelector()),e=this.nextToken()}return new Et(r)}parseTreeSelector(){this.skipSpace();let t=this.parseNodeSelector();for(;;){const e=this.nextToken();if(!e||e===",")break;if(e===" ")this.consume(),t=new Tt(t,this.parseNodeSelector());else if(e===">")this.consume(),t=new Pt(t,this.parseNodeSelector());else if(e==="+")this.consume(),t=new At(t,this.parseNodeSelector());else if(e==="~")this.consume(),t=new Ct(t,this.parseNodeSelector());else throw new _e("Unexpected token: "+e)}return t}parseNodeSelector(){this.skipSpace();const t=this.nextToken();if(t==="*")return this.consume(),new Rt;if(this.isIdentifier())return this.consume(),new Nt(t);throw new _e("Expected node type")}}ye.TOKENS=/([a-zA-Z][\w-]*)|(\d+)|[^\s]|(\s(?=[a-zA-Z\*]))/g;class _e extends Error{constructor(t){super(t)}}class Et extends V{constructor(t){super(),this.selectors=t}match(t){for(let e=0;e<this.selectors.length;e++){const i=this.selectors[e].match(t);if(i)return i}return null}toString(){let t="";for(let e=0;e<this.selectors.length;e++)t+=e>0?", ":"",t+=this.selectors[e].toString();return t}}class Rt extends V{match(t){return[t.currentNode()]}toString(){return"*"}}class Nt extends V{constructor(t){super(),this.type=t}match(t){const e=t.currentNode();return e.type===this.type?[e]:null}toString(){return this.type}}class ve extends V{constructor(t,e){super(),this.left=t,this.right=e}}class Tt extends ve{constructor(t,e){super(t,e)}match(t){const e=this.right.match(t);if(e)for(t=t.clone();t.hasParent();){t.goToParent();const r=this.left.match(t);if(r)return r.concat(e)}return null}toString(){return this.left.toString()+" "+this.right.toString()}}class Pt extends ve{constructor(t,e){super(t,e)}match(t){const e=this.right.match(t);if(e&&t.hasParent()){t=t.clone(),t.goToParent();const r=this.left.match(t);if(r)return r.concat(e)}return null}toString(){return this.left.toString()+" > "+this.right.toString()}}class At extends ve{constructor(t,e){super(t,e)}match(t){const e=this.right.match(t);if(e&&t.hasPreviousSibling()){t=t.clone(),t.goToPreviousSibling();const r=this.left.match(t);if(r)return r.concat(e)}return null}toString(){return this.left.toString()+" + "+this.right.toString()}}class Ct extends ve{constructor(t,e){super(t,e)}match(t){const e=this.right.match(t);if(e)for(t=t.clone();t.hasPreviousSibling();){t.goToPreviousSibling();const r=this.left.match(t);if(r)return r.concat(e)}return null}toString(){return this.left.toString()+" ~ "+this.right.toString()}}const O=class O{constructor(t,e,r,i,s,a){if(!r&&!i)throw new Q("Lint rules must have a selector or pattern",Z.InvalidInput,{metadata:{name:t}});this.name=t||"unnamed rule",this.severity=e||O.Severity.BULK_WARNING,this.selector=r||O.DEFAULT_SELECTOR,this.pattern=i||null,typeof s=="function"?(this.lint=s,this.message=null):(this.lint=(...o)=>this._defaultLintFunction(...o),this.message=s),this.applies=a||function(){return!0}}static makeRule(t){return new O(t.name,t.severity,t.selector?V.parse(t.selector):null,O.makePattern(t.pattern),t.lint||t.message,t.applies)}check(t,e,r,i){const s=this.selector.match(e);if(!s)return null;let a;if(this.pattern?a=r.match(this.pattern):a=O.FakePatternMatch(r,r,0),!a)return null;try{const o=this.lint(e,r,s,a,i);return o?typeof o=="string"?{rule:this.name,severity:this.severity,message:o,start:0,end:r.length}:{rule:this.name,severity:this.severity,message:o.message,start:o.start,end:o.end}:null}catch(o){return{rule:"lint-rule-failure",message:`Exception in rule ${this.name}: ${o.message}
Stack trace:
${o.stack}`,start:0,end:r.length}}}_defaultLintFunction(t,e,r,i,s){return{message:this.message||"",start:i.index,end:i.index+i[0].length}}static makePattern(t){if(!t)return null;if(t instanceof RegExp)return t;if(t[0]==="/"){const e=t.lastIndexOf("/"),r=t.substring(1,e),i=t.substring(e+1);return new RegExp(r,i)}return new RegExp(t)}static FakePatternMatch(t,e,r){const i=[e];return i.index=r,i.input=t,i}};O.Severity={ERROR:1,WARNING:2,GUIDELINE:3,BULK_WARNING:4};let d=O;d.DEFAULT_SELECTOR=V.parse("text");const Lt=/\/\/([^\/]+)/;function Wt(n){if(!n)return"";const t=n.match(Lt);return t?t[1]:""}const Ot=d.makeRule({name:"absolute-url",severity:d.Severity.GUIDELINE,selector:"link, image",lint:function(n,t,e,r){const i=e[0].target,s=Wt(i);if(s==="khanacademy.org"||s.endsWith(".khanacademy.org"))return`Don't use absolute URLs:
When linking to KA content or images, omit the
https://www.khanacademy.org URL prefix.
Use a relative URL beginning with / instead.`}}),Mt=d.makeRule({name:"blockquoted-math",severity:d.Severity.WARNING,selector:"blockQuote math, blockQuote blockMath",message:`Blockquoted math:
math should not be indented.`}),Ft=d.makeRule({name:"blockquoted-widget",severity:d.Severity.WARNING,selector:"blockQuote widget",message:`Blockquoted widget:
widgets should not be indented.`}),Dt=d.makeRule({name:"double-spacing-after-terminal",severity:d.Severity.BULK_WARNING,selector:"paragraph",pattern:/[.!\?] {2}/i,message:`Use a single space after a sentence-ending period, or
any other kind of terminal punctuation.`}),Ut=d.makeRule({name:"extra-content-spacing",selector:"paragraph",pattern:/\s+$/,applies:function(n){return n.contentType==="article"},message:"No extra whitespace at the end of content blocks."}),zt=d.makeRule({name:"heading-level-1",severity:d.Severity.WARNING,selector:"heading",lint:function(n,t,e,r){if(e[0].level===1)return`Don't use level-1 headings:
Begin headings with two or more # characters.`}}),qt=d.makeRule({name:"heading-level-skip",severity:d.Severity.WARNING,selector:"heading ~ heading",lint:function(n,t,e,r){const i=e[1],s=e[0];if(i.level>s.level+1)return`Skipped heading level:
this heading is level ${i.level} but
the previous heading was level ${s.level}`}}),$t=d.makeRule({name:"heading-sentence-case",severity:d.Severity.GUIDELINE,selector:"heading",pattern:/^\W*[a-z]/,message:`First letter is lowercase:
the first letter of a heading should be capitalized.`}),jt={and:!0,nor:!0,but:!0,the:!0,for:!0};function Bt(n){const t=n[0];return t===t.toUpperCase()}const Vt=d.makeRule({name:"heading-title-case",severity:d.Severity.GUIDELINE,selector:"heading",pattern:/[^\s:]\s+[A-Z]+[a-z]/,locale:"en",lint:function(n,t,e,r){let s=t.trim().split(/\s+/);if(s.shift(),s=s.filter(a=>a.length>2&&!jt.hasOwnProperty(a)),s.length>=3&&s.every(a=>Bt(a)))return`Title-case heading:
This heading appears to be in title-case, but should be sentence-case.
Only capitalize the first letter and proper nouns.`}}),Gt=d.makeRule({name:"image-alt-text",severity:d.Severity.WARNING,selector:"image",lint:function(n,t,e,r){const i=e[0];if(!i.alt||!i.alt.trim())return`Images should have alt text:
for accessibility, all images should have alt text.
Specify alt text inside square brackets after the !.`;if(i.alt.length<8)return`Images should have alt text:
for accessibility, all images should have descriptive alt text.
This image's alt text is only ${i.alt.length} characters long.`}}),Ht=d.makeRule({name:"image-in-table",severity:d.Severity.BULK_WARNING,selector:"table image",message:`Image in table:
do not put images inside of tables.`}),Kt=d.makeRule({name:"image-spaces-around-urls",severity:d.Severity.ERROR,selector:"image",lint:function(n,t,e,r,i){const a=e[0].target;if(i&&i.content){const o=i.content.indexOf(a);if(o===-1)return;if(i.content[o-1]!=="("||i.content[o+a.length]!==")")return`Whitespace before or after image url:
For images, don't include any space or newlines after '(' or before ')'.
Whitespace in image URLs causes translation difficulties.`}}}),Jt=d.makeRule({name:"image-widget",severity:d.Severity.WARNING,selector:"widget",lint:function(n,t,e,r,i){if(n.currentNode().widgetType!=="image")return;const s=i&&i.widgets&&i.widgets[n.currentNode().id];if(!s)return;const a=s.options.alt;if(!a)return`Images should have alt text:
for accessibility, all images should have a text description.
Add a description in the "Alt Text" box of the image widget.`;if(a.trim().length<8)return`Images should have alt text:
for accessibility, all images should have descriptive alt text.
This image's alt text is only ${a.trim().length} characters long.`;if(s.options.caption&&s.options.caption.match(/[^\\]\$/))return`No math in image captions:
Don't include math expressions in image captions.`}}),Xt=d.makeRule({name:"link-click-here",severity:d.Severity.WARNING,selector:"link",pattern:/click here/i,message:`Inappropriate link text:
Do not use the words "click here" in links.`}),Zt=d.makeRule({name:"long-paragraph",severity:d.Severity.GUIDELINE,selector:"paragraph",pattern:/^.{501,}/,lint:function(n,t,e,r){return`Paragraph too long:
This paragraph is ${t.length} characters long.
Shorten it to 500 characters or fewer.`}}),Qt=d.makeRule({name:"math-adjacent",severity:d.Severity.WARNING,selector:"blockMath+blockMath",message:`Adjacent math blocks:
combine the blocks between \\begin{align} and \\end{align}`}),Yt=d.makeRule({name:"math-align-extra-break",severity:d.Severity.WARNING,selector:"blockMath",pattern:/(\\{2,})\s*\\end{align}/,message:`Extra space at end of block:
Don't end an align block with backslashes`}),en=d.makeRule({name:"math-align-linebreaks",severity:d.Severity.WARNING,selector:"blockMath",pattern:/\\begin{align}[\s\S]*\\\\[\s\S]+\\end{align}/,lint:function(n,t,e,r){let i=r[0];for(;i.length;){const s=i.indexOf("\\\\");if(s===-1)return null;i=i.substring(s+2);const a=i.match(/^\s*\\\\\s*(?!\\\\)/);if(!a)return"Use four backslashes between lines of an align block";i=i.substring(a[0].length)}}}),tn=d.makeRule({name:"math-empty",severity:d.Severity.WARNING,selector:"math, blockMath",pattern:/^$/,message:"Empty math: don't use $$ in your markdown."}),nn=d.makeRule({name:"math-font-size",severity:d.Severity.GUIDELINE,selector:"math, blockMath",pattern:/\\(tiny|Tiny|small|large|Large|LARGE|huge|Huge|scriptsize|normalsize)\s*{/,message:`Math font size:
Don't change the default font size with \\Large{} or similar commands`}),rn=d.makeRule({name:"math-frac",severity:d.Severity.GUIDELINE,selector:"math, blockMath",pattern:/\\frac[ {]/,message:"Use \\dfrac instead of \\frac in your math expressions."}),sn=d.makeRule({name:"math-nested",severity:d.Severity.ERROR,selector:"math, blockMath",pattern:/\\text{[^$}]*\$[^$}]*\$[^}]*}/,message:`Nested math:
Don't nest math expressions inside \\text{} blocks`}),an=d.makeRule({name:"math-starts-with-space",severity:d.Severity.GUIDELINE,selector:"math, blockMath",pattern:/^\s*(~|\\qquad|\\quad|\\,|\\;|\\:|\\ |\\!|\\enspace|\\phantom)/,message:`Math starts with space:
math should not be indented. Do not begin math expressions with
LaTeX space commands like ~, \\;, \\quad, or \\phantom`}),on=d.makeRule({name:"math-text-empty",severity:d.Severity.WARNING,selector:"math, blockMath",pattern:/\\text{\s*}/,message:"Empty \\text{} block in math expression"}),ln=d.makeRule({name:"math-without-dollars",severity:d.Severity.GUIDELINE,pattern:/\\\w+{[^}]*}|{|}/,message:`This looks like LaTeX:
did you mean to put it inside dollar signs?`}),cn=d.makeRule({name:"nested-lists",severity:d.Severity.WARNING,selector:"list list",message:`Nested lists:
nested lists are hard to read on mobile devices;
do not use additional indentation.`}),un=d.makeRule({name:"profanity",pattern:/\b(shit|piss|fuck|cunt|cocksucker|motherfucker|tits)\b/i,message:"Avoid profanity"}),dn=d.makeRule({name:"table-missing-cells",severity:d.Severity.WARNING,selector:"table",lint:function(n,t,e,r){const i=e[0],s=i.header.length,a=i.cells.map(o=>o.length);for(let o=0;o<a.length;o++)if(a[o]!==s)return`Table rows don't match header:
The table header has ${s} cells, but
Row ${o+1} has ${a[o]} cells.`}}),hn=d.makeRule({name:"unbalanced-code-delimiters",severity:d.Severity.ERROR,pattern:/[`~]+/,message:`Unbalanced code delimiters:
code blocks should begin and end with the same type and number of delimiters`}),pn=d.makeRule({name:"unescaped-dollar",severity:d.Severity.ERROR,selector:"unescapedDollar",message:`Unescaped dollar sign:
Dollar signs must appear in pairs or be escaped as \\$`}),gn=d.makeRule({name:"widget-in-table",severity:d.Severity.BULK_WARNING,selector:"table widget",message:`Widget in table:
do not put widgets inside of tables.`}),fn=[Ot,Mt,Ft,Dt,Ut,zt,qt,$t,Vt,Gt,Ht,Xt,Zt,Qt,Yt,en,tn,nn,rn,sn,an,on,cn,dn,pn,gn,un,ln,hn,Kt,Jt];class q{constructor(t){this.root=t}static isNode(t){return t&&typeof t=="object"&&typeof t.type=="string"}static isTextNode(t){return q.isNode(t)&&t.type==="text"&&typeof t.content=="string"}traverse(t){this._traverse(this.root,new Ce(this.root),t)}_traverse(t,e,r){let i="";if(q.isNode(t)){const s=t;e._containers.push(s),e._ancestors.push(s),typeof s.content=="string"&&(i=s.content),Object.keys(s).forEach(o=>{if(o==="type")return;const l=s[o];l&&typeof l=="object"&&(e._indexes.push(o),i+=this._traverse(l,e,r),e._indexes.pop())}),e._currentNode=e._ancestors.pop(),e._containers.pop(),r(s,e,i)}else if(Array.isArray(t)){const s=t;e._containers.push(s);let a=0;for(;a<s.length;)e._indexes.push(a),i+=this._traverse(s[a],e,r),a=e._indexes.pop()+1;e._containers.pop()}return i}}class Ce{constructor(t){this.root=t,this._currentNode=null,this._containers=new Y,this._indexes=new Y,this._ancestors=new Y}currentNode(){return this._currentNode||this.root}parent(){return this._ancestors.top()}ancestors(){return this._ancestors.values()}nextSibling(){const t=this._containers.top();if(!t||!Array.isArray(t))return null;const e=this._indexes.top();return t.length>e+1?t[e+1]:null}previousSibling(){const t=this._containers.top();if(!t||!Array.isArray(t))return null;const e=this._indexes.top();return e>0?t[e-1]:null}removeNextSibling(){const t=this._containers.top();if(t&&Array.isArray(t)){const e=this._indexes.top();if(t.length>e+1)return t.splice(e+1,1)[0]}return null}replace(...t){const e=this._containers.top();if(!e)throw new Q("Can't replace the root of the tree",Z.Internal);if(Array.isArray(e)){const r=this._indexes.top();e.splice(r,1,...t),this._indexes.pop(),this._indexes.push(r+t.length-1)}else{const r=this._indexes.top();t.length===0?delete e[r]:t.length===1?e[r]=t[0]:e[r]=t}}hasPreviousSibling(){return Array.isArray(this._containers.top())&&this._indexes.top()>0}goToPreviousSibling(){if(!this.hasPreviousSibling())throw new Q("goToPreviousSibling(): node has no previous sibling",Z.Internal);this._currentNode=this.previousSibling();const t=this._indexes.pop();this._indexes.push(t-1)}hasParent(){return this._ancestors.size()!==0}goToParent(){if(!this.hasParent())throw new Q("goToParent(): node has no ancestor",Z.NotAllowed);for(this._currentNode=this._ancestors.pop();this._containers.size()&&this._containers.top()[this._indexes.top()]!==this._currentNode;)this._containers.pop(),this._indexes.pop()}clone(){const t=new Ce(this.root);return t._currentNode=this._currentNode,t._containers=this._containers.clone(),t._indexes=this._indexes.clone(),t._ancestors=this._ancestors.clone(),t}equals(t){return this.root===t.root&&this._currentNode===t._currentNode&&this._containers.equals(t._containers)&&this._indexes.equals(t._indexes)&&this._ancestors.equals(t._ancestors)}}class Y{constructor(t){this.stack=t?t.slice(0):[]}push(t){this.stack.push(t)}pop(){return this.stack.pop()}top(){return this.stack[this.stack.length-1]}values(){return this.stack.slice(0)}size(){return this.stack.length}toString(){return this.stack.toString()}clone(){return new Y(this.stack)}equals(t){if(!t||!t.stack||t.stack.length!==this.stack.length)return!1;for(let e=0;e<this.stack.length;e++)if(this.stack[e]!==t.stack[e])return!1;return!0}}const mn="@khanacademy/perseus-linter",yn="__lib_version__";me(mn,yn);const Zr=F.shape({contentType:F.string,highlightLint:F.bool,paths:F.arrayOf(F.string),stack:F.arrayOf(F.string)}),Xe={contentType:"",highlightLint:!1,paths:[],stack:[]},vn=fn.filter(n=>n.severity<d.Severity.BULK_WARNING);function wn(n,t,e,r=vn){const i=[],s=new q(n);s.traverse((l,u,h)=>{if(q.isTextNode(l)){let g=u.nextSibling();for(;q.isTextNode(g);)l.content+=g.content,u.removeNextSibling(),g=u.nextSibling()}});let a=[],o=!1;return s.traverse((l,u,h)=>{const g=[],w=r.filter(f=>f.applies(t)),k=[...t.stack];k.push(l.type);const S={...t,stack:k.join(".")};if(w.forEach(f=>{const v=f.check(l,u,h,S);v&&((v.start||v.end)&&(v.target=h.substring(v.start,v.end)),i.push(v),e&&g.push(v))}),!!e&&(l.type==="table"?(a.length&&g.push(...a),o=!1,a=[]):o||(o=u.ancestors().some(f=>f.type==="table")),o&&g.length&&a.push(...g),g.length))if(g.sort((f,v)=>f.severity-v.severity),l.type!=="text"||g.length>1)u.replace({type:"lint",content:l,message:g.map(f=>f.message).join(`

`),ruleName:g[0].rule,blockHighlight:S.blockHighlight,insideTable:o,severity:g[0].severity});else{const f=l.content,v=g[0],x=v.start||0,N=v.end||f.length,M=f.substring(0,x),E=f.substring(x,N),re=f.substring(N),ie=[];M&&ie.push({type:"text",content:M}),ie.push({type:"lint",content:{type:"text",content:E},message:v.message,ruleName:v.rule,insideTable:o,severity:v.severity}),re&&ie.push({type:"text",content:re}),u.replace(...ie)}}),i}function bn(n,t){const e=n.stack||[];return{...n,stack:e.concat(t)}}const kn={activeDefinitionId:null,setActiveDefinitionId:()=>{}},Ze=L.createContext(kn);class de extends L.Component{constructor(){super(...arguments),this.state={activeDefinitionId:null},this.setActiveDefinitionId=t=>{this.setState(e=>({activeDefinitionId:t}))}}render(){const{children:t}=this.props,{activeDefinitionId:e}=this.state,{setActiveDefinitionId:r}=this;return p(Ze.Provider,{value:{activeDefinitionId:e,setActiveDefinitionId:r},children:t})}}const De=Ze.Consumer;try{de.displayName="DefinitionProvider",de.__docgenInfo={description:"",displayName:"DefinitionProvider",props:{}}}catch{}try{De.displayName="DefinitionConsumer",De.__docgenInfo={description:"",displayName:"DefinitionConsumer",props:{}}}catch{}class A extends L.Component{constructor(t){super(t),this.state={error:""}}componentDidCatch(t,e){var r,i;this.setState({error:t.toString()}),(i=(r=this.props).onError)==null||i.call(r,t,e),j.error("Unhandled Perseus error: "+t.message,C.Internal,{cause:t,loggedMetadata:{componentStack:e&&"componentStack"in e?e.componentStack:"componentStack not provided",...this.props.metadata}})}render(){return this.state.error?fe("svg",{height:"16",width:"16",viewBox:"0 0 16 16",role:"img",children:[p("title",{children:"Rendering Error!"}),p("path",{d:"m8 16c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm0-3c0.55 0 1-0.45 1-1s-0.45-1-1-1-1 0.45-1 1 0.45 1 1 1zm0-9c-0.55 0-1 0.45-1 1v4c0 0.55.45 1 1 1s1-0.45 1-1v-4c0-0.55-0.45-1-1-1z",fill:"#d92916",fillRule:"evenodd"})]}):this.props.children}}try{A.displayName="ErrorBoundary",A.__docgenInfo={description:"",displayName:"ErrorBoundary",props:{metadata:{defaultValue:null,description:"",name:"metadata",required:!1,type:{name:"Record<string, string>"}},onError:{defaultValue:null,description:"",name:"onError",required:!1,type:{name:"((error: Error, info: any) => void)"}}}}}catch{}function _n(){}class In{constructor(t,e,r,i){this._track=s=>{this._tracked&&!this.setting||(this._tracked=!0,this.trackApi({type:this.widgetType,id:this.widgetID,...s}))},t?(this._tracked=!1,this.trackApi=t,this.widgetType=e,this.widgetID=r,this.setting=i,this.track=this._track):this.track=_n}}const Sn="@khanacademy/simple-markdown",xn="__lib_version__";me(Sn,xn);var En=/\r\n?/g,Rn=/\t/g,Nn=/\f/g,Qe=function(n){return n.replace(En,`
`).replace(Nn,"").replace(Rn,"    ")},Ye=function(n,t){var e=n||{};if(t!=null)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},et=function(n,t){var e=Object.keys(n).filter(function(a){var o=n[a];if(o==null||o.match==null)return!1;var l=o.order;return(typeof l!="number"||!isFinite(l))&&typeof console<"u"&&console.warn("simple-markdown: Invalid order for rule `"+a+"`: "+String(l)),!0});e.sort(function(a,o){var l=n[a],u=n[o],h=l.order,g=u.order;if(h!==g)return h-g;var w=l.quality?0:1,k=u.quality?0:1;return w!==k?w-k:a<o?-1:a>o?1:0});var r,i=function(a,o){var l=[];for(o=o||r,r=o;a;){var u=null,h=null,g=null,w=NaN,k=0,S=e[0],f=n[S];do{var v=f.order,x=o.prevCapture==null?"":o.prevCapture[0],N=f.match(a,o,x);if(N){var M=f.quality?f.quality(N,o,x):0;M<=w||(u=S,h=f,g=N,w=M)}k++,S=e[k],f=n[S]}while(f&&(!g||f.order===v&&f.quality));if(h==null||g==null)throw new Error("Could not find a matching rule for the below content. The rule with highest `order` should always match content provided to it. Check the definition of `match` for '"+e[e.length-1]+`'. It seems to not match the following source:
`+a);if(g.index)throw new Error("`match` must return a capture starting at index 0 (the current parse index). Did you forget a ^ at the start of the RegExp?");var E=h.parse(g,i,o);if(Array.isArray(E))Array.prototype.push.apply(l,E);else{if(E==null||typeof E!="object")throw new Error(`parse() function returned invalid parse result: '${E}'`);E.type==null&&(E.type=u),l.push(E)}o.prevCapture=g,a=a.substring(o.prevCapture[0].length)}return l},s=function(a,o){return r=Ye(o,t),!r.inline&&!r.disableAutoBlockNewlines&&(a=a+`

`),r.prevCapture=null,i(Qe(a),r)};return s},R=function(n){var t=function(e,r,i){return r.inline?n.exec(e):null};return t.regex=n,t},P=function(n){var t=function(e,r){return r.inline?null:n.exec(e)};return t.regex=n,t},Re=function(n){var t=function(e,r){return n.exec(e)};return t.regex=n,t},Tn=typeof Symbol=="function"&&Symbol.for&&Symbol.for("react.element")||60103,b=function(n,t,e){var r={$$typeof:Tn,type:n,key:t??void 0,ref:null,props:e,_owner:null};return r},_=function(n,t,e,r){e=e||{},r=typeof r<"u"?r:!0;var i="";for(var s in e){var a=e[s];Object.prototype.hasOwnProperty.call(e,s)&&a&&(i+=" "+$(s)+'="'+$(a)+'"')}var o="<"+n+i+">";return r?o+t+"</"+n+">":o},Ue={},J=function(n){if(n==null)return null;try{var t=new URL(n,"https://localhost").protocol;if(t.indexOf("javascript:")===0||t.indexOf("vbscript:")===0||t.indexOf("data:")===0)return null}catch{return null}return n},Pn=/[<>&"']/g,An={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#x27;","/":"&#x2F;","`":"&#96;"},$=function(n){return String(n).replace(Pn,function(t){return An[t]})},Cn=/\\([^0-9A-Za-z\s])/g,Ne=function(n){return n.replace(Cn,"$1")},he=function(n,t,e){var r=e.inline||!1;e.inline=!0;var i=n(t,e);return e.inline=r,i},Ln=function(n,t,e){var r=e.inline||!1;e.inline=!1;var i=n(t+`

`,e);return e.inline=r,i},ae=function(n,t,e){return{content:he(t,n[1],e)}},Ie=function(){return{}},pe="(?:[*+-]|\\d+\\.)",tt="( *)("+pe+") +",ze=new RegExp("^"+tt),Wn=new RegExp(tt+"[^\\n]*(?:\\n(?!\\1"+pe+` )[^\\n]*)*(
|$)`,"gm"),nt=/\n{2,}$/,On=/^ (?= *`)|(` *) $/g,Mn=nt,qe=/ *\n+$/,Fn=new RegExp("^( *)("+pe+`) [\\s\\S]+?(?:
{2,}(?! )(?!\\1`+pe+` )\\n*|\\s*
*$)`),Dn=/(?:^|\n)( *)$/,oe=function(){var n=/^ *\| *| *\| *$/g,t=/ *$/,e=/^ *-+: *$/,r=/^ *:-+: *$/,i=/^ *:-+ *$/,s=function(h){return e.test(h)?"right":r.test(h)?"center":i.test(h)?"left":null},a=function(h,g,w,k){k&&(h=h.replace(n,""));var S=h.trim().split("|");return S.map(s)},o=function(h,g,w,k){var S=w.inTable;w.inTable=!0;var f=g(h.trim(),w);w.inTable=S;var v=[[]];return f.forEach(function(x,N){x.type==="tableSeparator"?(!k||N!==0&&N!==f.length-1)&&v.push([]):(x.type==="text"&&(f[N+1]==null||f[N+1].type==="tableSeparator")&&(x.content=x.content.replace(t,"")),v[v.length-1].push(x))}),v},l=function(h,g,w,k){var S=h.trim().split(`
`);return S.map(function(f){return o(f,g,w,k)})},u=function(h){return function(g,w,k){k.inline=!0;var S=o(g[1],w,k,h),f=a(g[2],w,k,h),v=l(g[3],w,k,h);return k.inline=!1,{type:"table",header:S,align:f,cells:v}}};return{parseTable:u(!0),parseNpTable:u(!1),TABLE_REGEX:/^ *(\|.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/,NPTABLE_REGEX:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/}}(),le="(?:\\[[^\\]]*\\]|[^\\[\\]]|\\](?=[^\\[]*\\]))*",$e=`\\s*<?((?:\\([^)]*\\)|[^\\s\\\\]|\\\\.)*?)>?(?:\\s+['"]([\\s\\S]*?)['"])?\\s*`,Un=/mailto:/i,je=function(n,t,e){var r=(n[2]||n[1]).replace(/\s+/g," ").toLowerCase();if(t._defs&&t._defs[r]){var i=t._defs[r];e.target=i.target,e.title=i.title}return t._refs=t._refs||{},t._refs[r]=t._refs[r]||[],t._refs[r].push(e),e},y=0,ne={Array:{react:function(n,t,e){for(var r=e.key,i=[],s=0,a=0;s<n.length;s++,a++){e.key=""+s;var o=n[s];if(o.type==="text")for(o={type:"text",content:o.content};s+1<n.length&&n[s+1].type==="text";s++)o.content+=n[s+1].content;i.push(t(o,e))}return e.key=r,i},html:function(n,t,e){for(var r="",i=0,s=0;i<n.length;i++){var a=n[i];if(a.type==="text")for(a={type:"text",content:a.content};i+1<n.length&&n[i+1].type==="text";i++)a.content+=n[i+1].content;r+=t(a,e)}return r}},heading:{order:y++,match:P(/^ *(#{1,6})([^\n]+?)#* *(?:\n *)+\n/),parse:function(n,t,e){return{level:n[1].length,content:he(t,n[2].trim(),e)}},react:function(n,t,e){return b("h"+n.level,e.key,{children:t(n.content,e)})},html:function(n,t,e){return _("h"+n.level,t(n.content,e))}},nptable:{order:y++,match:P(oe.NPTABLE_REGEX),parse:oe.parseNpTable,react:null,html:null},lheading:{order:y++,match:P(/^([^\n]+)\n *(=|-){3,} *(?:\n *)+\n/),parse:function(n,t,e){return{type:"heading",level:n[2]==="="?1:2,content:he(t,n[1],e)}},react:null,html:null},hr:{order:y++,match:P(/^( *[-*_]){3,} *(?:\n *)+\n/),parse:Ie,react:function(n,t,e){return b("hr",e.key,Ue)},html:function(n,t,e){return"<hr>"}},codeBlock:{order:y++,match:P(/^(?:    [^\n]+\n*)+(?:\n *)+\n/),parse:function(n,t,e){var r=n[0].replace(/^    /gm,"").replace(/\n+$/,"");return{lang:void 0,content:r}},react:function(n,t,e){var r=n.lang?"markdown-code-"+n.lang:void 0;return b("pre",e.key,{children:b("code",null,{className:r,children:n.content})})},html:function(n,t,e){var r=n.lang?"markdown-code-"+n.lang:void 0,i=_("code",$(n.content),{class:r});return _("pre",i)}},fence:{order:y++,match:P(/^ *(`{3,}|~{3,}) *(?:(\S+) *)?\n([\s\S]+?)\n?\1 *(?:\n *)+\n/),parse:function(n,t,e){return{type:"codeBlock",lang:n[2]||void 0,content:n[3]}},react:null,html:null},blockQuote:{order:y++,match:P(/^( *>[^\n]+(\n[^\n]+)*\n*)+\n{2,}/),parse:function(n,t,e){var r=n[0].replace(/^ *> ?/gm,"");return{content:t(r,e)}},react:function(n,t,e){return b("blockquote",e.key,{children:t(n.content,e)})},html:function(n,t,e){return _("blockquote",t(n.content,e))}},list:{order:y++,match:function(n,t){var e=t.prevCapture==null?"":t.prevCapture[0],r=Dn.exec(e),i=t._list||!t.inline;return r&&i?(n=r[1]+n,Fn.exec(n)):null},parse:function(n,t,e){var r=n[2],i=r.length>1,s=i?+r:void 0,a=n[0].replace(Mn,`
`).match(Wn),o=!1,l=a.map(function(u,h){var g=ze.exec(u),w=g?g[0].length:0,k=new RegExp("^ {1,"+w+"}","gm"),S=u.replace(k,"").replace(ze,""),f=h===a.length-1,v=S.indexOf(`

`)!==-1,x=v||f&&o;o=x;var N=e.inline,M=e._list;e._list=!0;var E;x?(e.inline=!1,E=S.replace(qe,`

`)):(e.inline=!0,E=S.replace(qe,""));var re=t(E,e);return e.inline=N,e._list=M,re});return{ordered:i,start:s,items:l}},react:function(n,t,e){var r=n.ordered?"ol":"ul";return b(r,e.key,{start:n.start,children:n.items.map(function(i,s){return b("li",""+s,{children:t(i,e)})})})},html:function(n,t,e){var r=n.items.map(function(a){return _("li",t(a,e))}).join(""),i=n.ordered?"ol":"ul",s={start:n.start};return _(i,r,s)}},def:{order:y++,match:P(/^ *\[([^\]]+)\]: *<?([^\s>]*)>?(?: +["(]([^\n]+)[")])? *\n(?: *\n)*/),parse:function(n,t,e){var r=n[1].replace(/\s+/g," ").toLowerCase(),i=n[2],s=n[3];return e._refs&&e._refs[r]&&e._refs[r].forEach(function(a){a.target=i,a.title=s}),e._defs=e._defs||{},e._defs[r]={target:i,title:s},{def:r,target:i,title:s}},react:function(){return null},html:function(){return""}},table:{order:y++,match:P(oe.TABLE_REGEX),parse:oe.parseTable,react:function(n,t,e){var r=function(a){return n.align[a]==null?{}:{textAlign:n.align[a]}},i=n.header.map(function(a,o){return b("th",""+o,{style:r(o),scope:"col",children:t(a,e)})}),s=n.cells.map(function(a,o){return b("tr",""+o,{children:a.map(function(l,u){return b("td",""+u,{style:r(u),children:t(l,e)})})})});return b("table",e.key,{children:[b("thead","thead",{children:b("tr",null,{children:i})}),b("tbody","tbody",{children:s})]})},html:function(n,t,e){var r=function(l){return n.align[l]==null?"":"text-align:"+n.align[l]+";"},i=n.header.map(function(l,u){return _("th",t(l,e),{style:r(u),scope:"col"})}).join(""),s=n.cells.map(function(l){var u=l.map(function(h,g){return _("td",t(h,e),{style:r(g)})}).join("");return _("tr",u)}).join(""),a=_("thead",_("tr",i)),o=_("tbody",s);return _("table",a+o)}},newline:{order:y++,match:P(/^(?:\n *)*\n/),parse:Ie,react:function(n,t,e){return`
`},html:function(n,t,e){return`
`}},paragraph:{order:y++,match:P(/^((?:[^\n]|\n(?! *\n))+)(?:\n *)+\n/),parse:ae,react:function(n,t,e){return b("div",e.key,{className:"paragraph",children:t(n.content,e)})},html:function(n,t,e){var r={class:"paragraph"};return _("div",t(n.content,e),r)}},escape:{order:y++,match:R(/^\\([^0-9A-Za-z\s])/),parse:function(n,t,e){return{type:"text",content:n[1]}},react:null,html:null},tableSeparator:{order:y++,match:function(n,t){return t.inTable?/^ *\| */.exec(n):null},parse:function(){return{type:"tableSeparator"}},react:function(){return" | "},html:function(){return" &vert; "}},autolink:{order:y++,match:R(/^<([^: >]+:\/[^ >]+)>/),parse:function(n,t,e){return{type:"link",content:[{type:"text",content:n[1]}],target:n[1]}},react:null,html:null},mailto:{order:y++,match:R(/^<([^ >]+@[^ >]+)>/),parse:function(n,t,e){var r=n[1],i=n[1];return Un.test(i)||(i="mailto:"+i),{type:"link",content:[{type:"text",content:r}],target:i}},react:null,html:null},url:{order:y++,match:R(/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/),parse:function(n,t,e){return{type:"link",content:[{type:"text",content:n[1]}],target:n[1],title:void 0}},react:null,html:null},link:{order:y++,match:R(new RegExp("^\\[("+le+")\\]\\("+$e+"\\)")),parse:function(n,t,e){var r={content:t(n[1],e),target:Ne(n[2]),title:n[3]};return r},react:function(n,t,e){return b("a",e.key,{href:J(n.target),title:n.title,children:t(n.content,e)})},html:function(n,t,e){var r={href:J(n.target),title:n.title};return _("a",t(n.content,e),r)}},image:{order:y++,match:R(new RegExp("^!\\[("+le+")\\]\\("+$e+"\\)")),parse:function(n,t,e){var r={alt:n[1],target:Ne(n[2]),title:n[3]};return r},react:function(n,t,e){return b("img",e.key,{src:J(n.target),alt:n.alt,title:n.title})},html:function(n,t,e){var r={src:J(n.target),alt:n.alt,title:n.title};return _("img","",r,!1)}},reflink:{order:y++,match:R(new RegExp("^\\[("+le+")\\]\\s*\\[([^\\]]*)\\]")),parse:function(n,t,e){return je(n,e,{type:"link",content:t(n[1],e)})},react:null,html:null},refimage:{order:y++,match:R(new RegExp("^!\\[("+le+")\\]\\s*\\[([^\\]]*)\\]")),parse:function(n,t,e){return je(n,e,{type:"image",alt:n[1]})},react:null,html:null},em:{order:y,match:R(new RegExp("^\\b_((?:__|\\\\[\\s\\S]|[^\\\\_])+?)_\\b|^\\*(?=\\S)((?:\\*\\*|\\\\[\\s\\S]|\\s+(?:\\\\[\\s\\S]|[^\\s\\*\\\\]|\\*\\*)|[^\\s\\*\\\\])+?)\\*(?!\\*)")),quality:function(n){return n[0].length+.2},parse:function(n,t,e){return{content:t(n[2]||n[1],e)}},react:function(n,t,e){return b("em",e.key,{children:t(n.content,e)})},html:function(n,t,e){return _("em",t(n.content,e))}},strong:{order:y,match:R(/^\*\*((?:\\[\s\S]|[^\\])+?)\*\*(?!\*)/),quality:function(n){return n[0].length+.1},parse:ae,react:function(n,t,e){return b("strong",e.key,{children:t(n.content,e)})},html:function(n,t,e){return _("strong",t(n.content,e))}},u:{order:y++,match:R(/^__((?:\\[\s\S]|[^\\])+?)__(?!_)/),quality:function(n){return n[0].length},parse:ae,react:function(n,t,e){return b("u",e.key,{children:t(n.content,e)})},html:function(n,t,e){return _("u",t(n.content,e))}},del:{order:y++,match:R(/^~~(?=\S)((?:\\[\s\S]|~(?!~)|[^\s~\\]|\s(?!~~))+?)~~/),parse:ae,react:function(n,t,e){return b("del",e.key,{children:t(n.content,e)})},html:function(n,t,e){return _("del",t(n.content,e))}},inlineCode:{order:y++,match:R(/^(`+)([\s\S]*?[^`])\1(?!`)/),parse:function(n,t,e){return{content:n[2].replace(On,"$1")}},react:function(n,t,e){return b("code",e.key,{children:n.content})},html:function(n,t,e){return _("code",$(n.content))}},br:{order:y++,match:Re(/^ {2,}\n/),parse:Ie,react:function(n,t,e){return b("br",e.key,Ue)},html:function(n,t,e){return"<br>"}},text:{order:y++,match:Re(/^[\s\S]+?(?=[^0-9A-Za-z\s\u00c0-\uffff]|\n\n| {2,}\n|\w+:\S|$)/),parse:function(n,t,e){return{content:n[0]}},react:function(n,t,e){return n.content},html:function(n,t,e){return $(n.content)}}},zn=function(n,t){!t&&typeof console<"u"&&console.warn("simple-markdown ruleOutput should take 'react' or 'html' as the second argument.");var e=function(r,i,s){return n[r.type][t](r,i,s)};return e},qn=function(n){var t=function(e,r){if(r=r||{},Array.isArray(e)){for(var i=r.key,s=[],a=null,o=0;o<e.length;o++){r.key=""+o;var l=t(e[o],r);typeof l=="string"&&typeof a=="string"?(a=a+l,s[s.length-1]=a):(s.push(l),a=l)}return r.key=i,s}else return n(e,t,r)};return t},$n=function(n){var t=function(e,r){return r=r||{},Array.isArray(e)?e.map(function(i){return t(i,r)}).join(""):n(e,t,r)};return t},Le=function(n,t,e={}){if(!t)throw new Error("simple-markdown: outputFor: `property` must be defined. if you just upgraded, you probably need to replace `outputFor` with `reactFor`");var r,i=n.Array||ne.Array,s=i[t];if(!s)throw new Error("simple-markdown: outputFor: to join nodes of type `"+t+"` you must provide an `Array:` joiner rule with that type, Please see the docs for details on specifying an Array rule.");var a=s,o=function(u,h){return h=h||r,r=h,Array.isArray(u)?a(u,o,h):n[u.type][t](u,o,h)},l=function(u,h){return r=Ye(h,e),o(u,r)};return l},we=et(ne),We=function(n,t){return t=t||{},t.inline=!1,we(n,t)},jn=function(n,t){return t=t||{},t.inline=!0,we(n,t)},Be=function(n,t){var e=nt.test(n);return t=t||{},t.inline=!e,we(n,t)},Te=Le(ne,"react"),rt=Le(ne,"html"),it=function(n,t){return Te(We(n,t),t)},Bn=function(n,t){return rt(We(n,t),t)},Vn=function(n){var t={};for(var e in n)e!=="source"&&Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e]);return t.children=it(n.source),b("div",null,t)},m={defaultRules:ne,parserFor:et,outputFor:Le,inlineRegex:R,blockRegex:P,anyScopeRegex:Re,parseInline:he,parseBlock:Ln,markdownToReact:it,markdownToHtml:Bn,ReactMarkdown:Vn,defaultBlockParse:We,defaultInlineParse:jn,defaultImplicitParse:Be,defaultReactOutput:Te,defaultHtmlOutput:rt,preprocess:Qe,sanitizeText:$,sanitizeUrl:J,unescapeUrl:Ne,htmlTag:_,reactElement:b,defaultRawParse:we,ruleOutput:zn,reactFor:qn,htmlFor:$n,defaultParse:function(...n){return typeof console<"u"&&console.warn("defaultParse is deprecated, please use `defaultImplicitParse`"),Be.apply(null,n)},defaultOutput:function(...n){return typeof console<"u"&&console.warn("defaultOutput is deprecated, please use `defaultReactOutput`"),Te.apply(null,n)}};const Gn={fence:{match:m.defaultRules.fence.match,order:1,parse:(n,t,e)=>({type:"codeBlock",lang:n[2]||void 0,content:n[3]})},paragraph:{match:m.defaultRules.paragraph.match,order:2,parse:(n,t,e)=>({content:n[1]})}},Hn=m.parserFor(Gn),Kn=n=>{const t=n.replace(/^\n\s*\n/,"")+`

`;return Hn(t,{inline:!1}).map(e=>e.content)},Jn=n=>n.join(`

`),Ve={parseToArray:Kn,joinFromArray:Jn},Xn="@khanacademy/pure-markdown",Zn="__lib_version__";me(Xn,Zn);const Qn=/^\[\[\u2603 (([a-z-]+) ([0-9]+))\]\]/,st=(n,t,e)=>{const r=n.length;let i=0;if(e){if(t.inline)return null;for(;i<r&&n[i]===" ";)i++}if(!(i<r&&n[i]==="$"))return null;i++;const s=i;let a=0;for(;i<r;){const o=n[i];if(o==="\\")i++;else if(a<=0&&o==="$"){let l=i+1;if(e){const u=/^(?: *\n){2,}/.exec(n.slice(l));l=u?l+u[0].length:null}return l?[n.substring(0,l),n.substring(s,i)]:null}else if(o==="{")a++;else if(o==="}")a--;else if(o===`
`&&n[i-1]===`
`)return null;i++}return null},Yn=(n,t)=>st(n,t,!1),er=(n,t)=>st(n,t,!0),tr=new RegExp("^\\|\\| +(.*) +\\|\\| *\\n("+m.defaultRules.nptable.match.regex.source.substring(1)+")"),nr=m.blockRegex(/^(crwdns.*)\n\s*\n/),T={...m.defaultRules,columns:{order:-2,match:m.blockRegex(/^([\s\S]*\n\n)={5,}\n\n([\s\S]*)/),parse:(n,t,e)=>({col1:t(n[1],e),col2:t(n[2],e)})},crowdinId:{order:-1,match:(n,t,e)=>t.isJipt?nr(n,t,e):null,parse:(n,t,e)=>({id:n[1]})},titledTable:{order:m.defaultRules.nptable.order-.5,match:m.blockRegex(tr),parse:(n,t,e)=>{const r=m.parseInline(t,n[1],e),i=n.slice(2),s=m.defaultRules.nptable.parse(i,t,e);return{title:r,table:s}}},widget:{order:m.defaultRules.link.order-.75,match:m.inlineRegex(Qn),parse:(n,t,e)=>({id:n[1],widgetType:n[2]})},blockMath:{order:m.defaultRules.codeBlock.order+.5,match:er,parse:(n,t,e)=>({content:n[1]})},math:{order:m.defaultRules.link.order-.25,match:Yn,parse:(n,t,e)=>({content:n[1]})},unescapedDollar:{order:m.defaultRules.link.order-.24,match:m.inlineRegex(/^(?!\\)\$/),parse:(n,t,e)=>({})},fence:{...m.defaultRules.fence,parse:(n,t,e)=>{const r=m.defaultRules.fence.parse(n,t,e);return r.lang==="alt"?{type:"codeBlock",lang:"alt",content:t(r.content+`

`,e)}:r}},blockQuote:{...m.defaultRules.blockQuote,match:m.blockRegex(/^ *>[^\n]+(\n( *>)?[^\n]+)*\n{2,}/)},lint:{order:1e3,match:n=>null,parse:(n,t,e)=>({})}};m.parserFor(T);const ee={...T,columns:{...T.columns,react:(n,t,e)=>fe("div",{className:"perseus-two-columns",children:[p("div",{className:"perseus-column",children:p("div",{className:"perseus-column-content",children:t(n.col1,e)})}),p("div",{className:"perseus-column",children:p("div",{className:"perseus-column-content",children:t(n.col2,e)})})]},e.key)},crowdinId:{...T.crowdinId,react:(n,t,e)=>n.id},table:{...T.table,react:function(n,t,e){const r=m.defaultRules.table.react(n,t,e);return e.isMobile?L.cloneElement(r,{tabIndex:0}):r}},titledTable:{...T.titledTable,react:(n,t,e)=>{var i;let r;if(!n.table)r="//invalid table//";else if(n.table.type==="lint")((i=n.table.content)==null?void 0:i.type)==="table"?r=ee.lint.react({...n.table,content:{...n,table:n.table.content}},t,{...e,unwrapTitledTableContents:!0}):r=ee.lint.react(n.table,t,e);else{const s=m.defaultRules.table.react(n.table,t,e),a=p("caption",{className:"perseus-table-title",children:t(n.title,e)},"caption");r=L.cloneElement(s,null,[a,...s.props.children])}return e.unwrapTitledTableContents?r:p("div",{className:"perseus-titled-table",children:r},e.key)}},widget:{...T.widget,react:(n,t,e)=>p("em",{children:`[Widget: ${n.id}]`},e.key)},blockMath:{...T.blockMath,react:(n,t,e)=>{const{TeX:r}=X();return p(r,{children:n.content},e.key)}},math:{...T.math,react:(n,t,e)=>{const{TeX:r}=X();return p(r,{children:n.content},e.key)}},unescapedDollar:{...T.unescapedDollar,react:(n,t,e)=>"$"},link:{...T.link,react:function(n,t,e){const r=m.defaultRules.link.react(n,t,e),i=r.props.href;let s=null;(i?i.match(/https?:\/\/[^\/]*khanacademy.org|^\//):!1)||(s="noopener noreferrer");const o={...r.props,target:"_blank",href:i,rel:s};return e.baseElements&&e.baseElements.Link?e.baseElements.Link(o):L.cloneElement(r,o)}},codeBlock:{...T.codeBlock,react:(n,t,e)=>n.lang==="alt"?p("div",{className:"perseus-markdown-alt perseus-sr-only",children:t(n.content,e)},e.key):m.defaultRules.codeBlock.react(n,t,e)},lint:{...T.lint,react:(n,t,e)=>p(wt,{message:n.message,ruleName:n.ruleName,inline:rr(n.content),blockHighlight:n.blockHighlight,insideTable:n.insideTable,severity:n.severity,children:t(n.content,e)})}};function rr(n){return!!(n&&n.type&&ir.hasOwnProperty(n.type))}const ir={text:!0,math:!0,unescapedDollar:!0,link:!0,img:!0,strong:!0,u:!0,em:!0,del:!0,code:!0},at=m.parserFor(ee),ot=(n,t)=>{const e=n+`

`;return at(e,{...t,inline:!1})},sr=(n,t)=>at(n,{...t,inline:!0}),W=(n,t)=>{c.isArray(n)?c.each(n,e=>W(e,t)):c.isObject(n)&&(t(n),n.type==="table"?(W(n.header,t),W(n.cells,t)):n.type==="list"?W(n.items,t):n.type==="titledTable"?W(n.table,t):n.type==="columns"?(W(n.col1,t),W(n.col2,t)):c.isArray(n.content)&&W(n.content,t))},Pe=n=>{if(c.isArray(n))return c.flatten(c.map(n,Pe));if(n.content&&c.isString(n.content))return n.type.toLowerCase().indexOf("code")!==-1?["",n.content,""]:[n.content.replace(/\s+/g," ")];const t=c.chain(n).values().flatten().filter(r=>r!=null&&c.has(r,"type")).value();if(!t.length)return[];const e=Pe(t);if(n.type==="paragraph"&&e.length){e[0]=e[0].replace(/^\s+/,"");const r=e.length-1;e[r]=e[r].replace(/\s+$/,"")}return e},ar=n=>{const t=ot(n);return Pe(t).join("").length},z={characterCount:ar,traverseContent:W,parse:ot,parseInline:sr,reactFor:m.reactFor,ruleOutput:m.ruleOutput(ee,"react"),basicOutput:m.reactFor(m.ruleOutput(ee,"react")),sanitizeUrl:m.sanitizeUrl};class Ae extends L.Component{render(){const t=this.props.className?"paragraph "+this.props.className:"paragraph";return p("div",{className:this.props.inline?this.props.className??void 0:t,"data-perseus-component-index":this.props.translationIndex,"data-perseus-paragraph-index":this.props.paragraphIndex,children:this.props.children})}}try{Ae.displayName="QuestionParagraph",Ae.__docgenInfo={description:"",displayName:"QuestionParagraph",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string | null"}},translationIndex:{defaultValue:null,description:"",name:"translationIndex",required:!0,type:{name:"number"}},paragraphIndex:{defaultValue:null,description:"",name:"paragraphIndex",required:!1,type:{name:"number"}},inline:{defaultValue:null,description:"",name:"inline",required:!1,type:{name:"boolean"}}}}}catch{}const or=1e3;class lr{constructor(){this.previousContent=null,this.runLinter=ht((t,e)=>{if(!(typeof KA>"u")&&t!==this.previousContent){if(this.previousContent=t,t===""){e([]);return}fetch("/api/internal/translations/lint_poentry?preview=1&lang=en",{headers:{"Content-Type":"application/json"},body:JSON.stringify({msgid:t,msgstr:t,format:"perseus_text",filename:""}),method:"POST"}).then(r=>r.status>=400?{status:"error",message:"Could not run i18n linter."}:r.json(),r=>({status:"error",message:"Could not run i18n linter."})).then(r=>{r.status==="error"?e(["Some part of this text makes it untranslatable. The specific message from the i18n linter was: "+r.message.replace(/\n/g," ")]):e([])})}},or)}applyLintErrors(t,e){if(e.length){const r=e.join(`

`);t.unshift({content:{type:"text",content:""},insideTable:!1,message:r,ruleName:"legacy-error",severity:d.Severity.ERROR,type:"lint"})}}}const cr=n=>n.replace(/\{align[*]?\}/g,"{aligned}").replace(/[\u00a0]/g," "),{interactiveSizes:ce}=bt,ur=kt,dr=_t,D={SMALL:"small",MEDIUM:"medium",LARGE:"large",XLARGE:"xlarge"},lt=n=>n?n<=ur?D.SMALL:n<=dr?D.MEDIUM:D.LARGE:D.MEDIUM,hr=n=>n===D.SMALL?[ce.defaultBoxSizeSmall,ce.defaultBoxSizeSmall]:[ce.defaultBoxSize,ce.defaultBoxSize],Qr=Object.freeze(Object.defineProperty({__proto__:null,containerSizeClass:D,getClassFromWidth:lt,getInteractiveBoxFromSizeClass:hr},Symbol.toStringTag,{value:"Module"})),Ge="block",pr=["default"],gr=!1,fr="",mr=!1,I={},U={},ct=(n,t)=>{I[n]=t},Yr=n=>{n.forEach(t=>{ct(t.name,t)}),Ir()},G=(n,t)=>{const e=I[t];if(!e){const r=`Failed to replace ${n} with ${t}`;throw new B(r,C.Internal)}ct(n,e)},ei=()=>{G("transformer","deprecated-standin"),G("lights-puzzle","deprecated-standin"),G("reaction-diagram","deprecated-standin"),G("sequence","deprecated-standin"),G("simulator","deprecated-standin")},ti=n=>{n.forEach(t=>{if(!t.widgetName)throw new B(`Editor ${t.displayName} doesn't have a widgetName property`,C.Internal);U[t.widgetName]=t})},H=(n,t)=>{const e=U[t];if(!e&&j){const r=`Failed to replace editor ${n} with ${t}`;j.error(r,C.Internal);return}U[n]=e},ni=()=>{H("transformer","deprecated-standin"),H("lights-puzzle","deprecated-standin"),H("reaction-diagram","deprecated-standin"),H("sequence","deprecated-standin"),H("simulator","deprecated-standin")},yr=n=>{var t,e,r;return c.has(I,n)?(t=I[n])!=null&&t.getWidget?(r=(e=I[n]).getWidget)==null?void 0:r.call(e):I[n].widget:null},ri=n=>c.has(U,n)?U[n]:null,vr=n=>{if(I[n])return I[n].version||{major:0,minor:0}},ii=()=>{const n={};return c.each(c.keys(I),function(t){n[t]=vr(t)}),n},si=()=>c.pick(I,c.reject(c.keys(I),function(n){return I[n].hidden})),ai=()=>c.keys(I),wr=n=>{const t=n.type;if(!c.isString(t))throw new B("widget type must be a string, but was: "+t,C.Internal);const e=I[t];if(e==null)return n;const r=n.version||{major:0,minor:0},i=e.version||{major:0,minor:0};if(r.major>i.major||r.major===i.major&&r.minor>i.minor)return n;let s=c.clone(n.options)||{};const a=e.propUpgrades||{};if(c.keys(s).length!==0)for(let h=r.major+1;h<=i.major;h++)a[String(h)]?s=a[String(h)](s):j.error("No upgrade found for widget. Cannot render.",C.Internal,{loggedMetadata:{type:t,fromMajorVersion:h-1,toMajorVersion:h}});s={...t in U?U[t].defaultProps:{},...s};let l=n.alignment;(l==null||l==="default")&&(l=kr(t)[0]);let u=n.static;return u==null&&(u=gr),c.extend({},n,{version:i,graded:n.graded!=null?n.graded:!0,alignment:l,static:u,options:s})},br=(n,t,e)=>{const r=n.type,i=I[r];if(i==null)return n;let s;return n.static?s=Sr(r)||c.identity:s=i.transform||c.identity,s(n.options,t,e)},kr=n=>{const t=I[n];return t&&t.supportedAlignments||pr},_r=n=>{const t=I[n];let e;return t?(t.getDefaultAlignment?e=t.getDefaultAlignment():e=t.defaultAlignment,e||Ge):Ge},He=["block","inline-block","inline","float-left","float-right","full-width"],Ir=()=>{c.each(I,function(n){if(n.defaultAlignment&&!c.contains(He,n.defaultAlignment))throw new B("Widget '"+n.displayName+"' has an invalid defaultAlignment value: "+n.defaultAlignment,C.InvalidInput);if(n.supportedAlignments){const t=c.difference(n.supportedAlignments,He);if(t.length)throw new B("Widget '"+n.displayName+"' has an invalid value for supportedAlignments: "+t.join(" "),C.InvalidInput)}})},oi=n=>{const t=I[n];return t&&t.staticTransform!=null},Sr=n=>{const t=I[n];return t&&t.staticTransform},xr=n=>{const t=I[n];return t&&t.tracking||fr},Er=n=>{const t=I[n];return t&&t.isLintable||mr},Oe=class Oe extends L.Component{constructor(){super(...arguments),this.widgetRef=L.createRef(),this.state={sizeClass:D.MEDIUM,widgetProps:this.props.initialProps},this.getWidget=()=>this.widgetRef.current,this.replaceWidgetProps=t=>{this.setState({widgetProps:t})}}componentDidMount(){if(this.state.widgetProps.apiOptions.isMobile){const t=Ee.findDOMNode(this).offsetWidth;this.setState({sizeClass:lt(t)})}}render(){let t=xe({"perseus-widget-container":!0,"widget-highlight":this.props.shouldHighlight,"widget-nohighlight":!this.props.shouldHighlight,"perseus-widget__definition":this.props.type==="definition"});const e=this.props.type,r=yr(e);if(r==null)return console.warn(`Widget type '${e}' not found!`),p("div",{className:t});let i=this.state.widgetProps.alignment;i==="default"&&(i=_r(e)),t+=" widget-"+i;const s=this.state.widgetProps.apiOptions,a=this.state.widgetProps.static||s.readOnly,o={position:"relative",overflow:"visible"},l={width:"100%",height:"100%",position:"absolute",top:0,left:0,zIndex:It},u=Er(e)?this.props.linterContext:{...this.props.linterContext,highlightLint:!1};return p("div",{className:t,style:a?o:{},children:p(yt.Consumer,{children:({analytics:h})=>fe(A,{metadata:{widget_type:e,widget_id:this.props.id},onError:()=>{h.onAnalyticsEvent({type:"perseus:widget-rendering-error",payload:{widgetType:e,widgetId:this.props.id}})},children:[p(r,{...this.state.widgetProps,linterContext:u,containerSizeClass:this.state.sizeClass,ref:this.widgetRef}),a&&p("div",{style:l})]})})})}UNSAFE_componentWillReceiveProps(t){if(this.props.type!==t.type)throw new Error("WidgetContainer can't change widget type; set a different key instead to recreate the container.")}shouldComponentUpdate(t,e){return this.props.shouldHighlight!==t.shouldHighlight||this.props.type!==t.type||this.state.widgetProps!==e.widgetProps||this.state.sizeClass!==e.sizeClass}};Oe.defaultProps={linterContext:Xe};let te=Oe;try{te.displayName="WidgetContainer",te.__docgenInfo={description:"",displayName:"WidgetContainer",props:{shouldHighlight:{defaultValue:null,description:"",name:"shouldHighlight",required:!0,type:{name:"boolean"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},initialProps:{defaultValue:null,description:"",name:"initialProps",required:!0,type:{name:"any"}},linterContext:{defaultValue:{value:`{
    contentType: "",
    highlightLint: false,
    paths: [] as ReadonlyArray<any>,
    stack: [] as ReadonlyArray<any>,
}`},description:"",name:"linterContext",required:!1,type:{name:"LinterContextProps"}}}}}catch{}const{mapObject:Se,mapObjectFromArray:Rr}=gt,Nr=/\S/,Tr=/(web\+graphie|https):\/\/[^\s]*/,K=()=>{},Ke=["content","problemNum","widgets"],ue=n=>"container:"+n,Pr=function(n,t){return n===null||t===null?n===t:c.every(n,(e,r)=>{if(t!=null)return c.isEqual(e,t[r])})},Me=class Me extends L.Component{constructor(t){super(t),this._widgetContainers=new Map,this.getApiOptions=()=>({...vt.defaults,...this.props.apiOptions}),this._getInitialWidgetState=e=>{const r=this._getAllWidgetsInfo(e);return{widgetInfo:r,widgetProps:this._getAllWidgetsStartProps(r,e)}},this._getAllWidgetsInfo=e=>Se(e.widgets,(r,i)=>{if(!r.type||!r.alignment){const s={};r.type||(s.type=i.split(" ")[0]),r.alignment||(s.alignment="default"),r=c.extend({},r,s)}return wr(r)}),this._getAllWidgetsStartProps=(e,r)=>{var l;const{apiOptions:i,problemNum:s}=r,a={},{strings:o}=this.props;return ut(e).forEach(([u,h])=>{a[u]=br(h,o,s)}),(l=i==null?void 0:i.onWidgetStartProps)==null||l.call(i,a),a},this._getDefaultWidgetInfo=e=>{const r=se.rTypeFromWidgetId.exec(e);return r==null?{}:{type:r[1],graded:!0,options:{}}},this._getWidgetInfo=e=>this.state.widgetInfo[e]||this._getDefaultWidgetInfo(e),this.renderWidget=(e,r,i)=>{const s=this.state.widgetInfo[r];if(s&&s.alignment==="full-width"&&(i.foundFullWidth=!0),s){const a=s&&s.type||e,o=c.contains(this.props.highlightedWidgets,r);return p(te,{id:r,ref:l=>{const u=ue(r);l!=null?this._widgetContainers.set(u,l):this._widgetContainers.delete(u)},type:a,initialProps:this.getWidgetProps(r),shouldHighlight:o,linterContext:bn(this.props.linterContext,"widget")},ue(r))}return null},this.getWidgetProps=e=>{const r=this.getApiOptions(),i=this.state.widgetProps[e]||{},s=this.state.widgetInfo[e],a=this.props.reviewMode&&s?s.options:null;this._interactionTrackers||(this._interactionTrackers={});let o=this._interactionTrackers[e];return o||(o=this._interactionTrackers[e]=new In(r.trackInteraction,s&&s.type,e,xr(s&&s.type))),{...i,widgetId:e,alignment:s&&s.alignment,static:s&&s.static&&!this.props.problemNum,problemNum:this.props.problemNum,apiOptions:this.getApiOptions(),keypadElement:this.props.keypadElement,questionCompleted:this.props.questionCompleted,showSolutions:this.props.showSolutions,onFocus:c.partial(this._onWidgetFocus,e),onBlur:c.partial(this._onWidgetBlur,e),findWidgets:this.findWidgets,reviewModeRubric:a,onChange:(l,u,h=!1)=>{this._setWidgetProps(e,l,u,h)},trackInteraction:o.track,isLastUsedWidget:e===this.state.lastUsedWidgetId}},this.getSerializedState=e=>Se(e||this.state.widgetProps,(r,i)=>{const s=this.getWidgetInstance(i);return s&&s.getSerializedState?s.getSerializedState():r}),this.restoreSerializedState=(e,r)=>{const i=c.keys(e),s=c.keys(this.state.widgetProps);if(i.length!==s.length||c.intersection(i,s).length!==i.length){j.error("Refusing to restore bad serialized state:",C.Internal,{loggedMetadata:{serializedState:JSON.stringify(e),currentProps:JSON.stringify(this.state.widgetProps)}});return}let a=1;const o=()=>{--a,r&&a===0&&r()};this.setState({widgetProps:Se(e,(l,u)=>{const h=this.getWidgetInstance(u);if(h&&h.restoreSerializedState){++a;const g=h.restoreSerializedState(l,o);return c.extend({},this.state.widgetProps[u],g)}return l})},()=>{setTimeout(o,0)})},this.showRationalesForCurrentlySelectedChoices=()=>{Object.keys(this.props.widgets).forEach(e=>{const r=this.getWidgetInstance(e);r&&r.showRationalesForCurrentlySelectedChoices&&r.showRationalesForCurrentlySelectedChoices(this._getWidgetInfo(e).options)})},this.deselectIncorrectSelectedChoices=()=>{Object.keys(this.props.widgets).forEach(e=>{const r=this.getWidgetInstance(e);r&&r.deselectIncorrectSelectedChoices&&r.deselectIncorrectSelectedChoices()})},this.findInternalWidgets=e=>{let r;if(typeof e=="string")if(e.indexOf(" ")!==-1){const s=e;r=(a,o,l)=>a===s}else{const s=e;r=(a,o,l)=>o.type===s}else r=e;return this.widgetIds.filter(s=>{const a=this._getWidgetInfo(s),o=this.getWidgetInstance(s);return r(s,a,o)}).map(this.getWidgetInstance)},this.findWidgets=e=>[...this.findInternalWidgets(e),...this.props.findExternalWidgets(e)],this.getWidgetInstance=e=>{const r=this._widgetContainers.get(ue(e));return r?r.getWidget():null},this._onWidgetFocus=(e,r=[])=>{if(!c.isArray(r))throw new B("widget props.onFocus focusPath must be an Array, but was"+JSON.stringify(r),C.Internal);this._setCurrentFocus([e].concat(r))},this._onWidgetBlur=(e,r)=>{const i=this._currentFocus,s=[e].concat(r);c.isEqual(s,i)&&c.defer(()=>{c.isEqual(this._currentFocus,i)&&this._setCurrentFocus(null)})},this.getContent=(e,r)=>r.jiptContent||e.content,this.shouldRenderJiptPlaceholder=(e,r)=>X().JIPT.useJIPT&&r.jiptContent==null&&e.content.indexOf("crwdns")!==-1,this.replaceJiptContent=(e,r)=>{if(r==null)this.setState({jiptContent:e});else{/^\s*(`{3,}|~{3,})\s*(\S+)?\s*\n([\s\S]+?)\s*\1\s*$/.test(e)||(/\S\n\s*\n\S/.test(e)?e="$\\large{\\red{\\text{Please translate each paragraph to a single paragraph.}}}$":/^\s*$/.test(e)&&(e="$\\large{\\red{\\text{Translated paragraph is currently empty}}}$"));const s=this.getContent(this.props,this.state),a=Ve.parseToArray(s);a[r]=e,this.setState({jiptContent:Ve.joinFromArray(a)})}},this.outputMarkdown=(e,r)=>{if(c.isArray(e)){const a=r.key,o=[];let l=!1;for(let u=0;u<e.length;u++){r.key=u,r.paragraphIndex=u;const h=this.outputMarkdown(e[u],r),g=typeof h=="string";typeof h=="string"&&l?o[o.length-1]+=h:o.push(h),l=g}return r.key=a,o}this._foundTextNodes=!1,r.foundFullWidth=!1;const i=this.outputNested(e,r);let s;return this.translationIndex!=null?s=null:s=xe({"perseus-paragraph-centered":!this._foundTextNodes,"perseus-paragraph-full-width":r.foundFullWidth&&e.content.length===1}),p(Ae,{className:s,translationIndex:this.translationIndex,paragraphIndex:r.paragraphIndex,inline:this.props.inline,children:p(A,{children:i})},r.key)},this.outputNested=(e,r)=>{if(c.isArray(e)){const i=r.key,s=[];let a=!1;for(let o=0;o<e.length;o++){r.key=o;const l=this.outputNested(e[o],r),u=typeof l=="string";typeof l=="string"&&a?s[s.length-1]+=l:s.push(l),a=u}return r.key=i,s}return this.outputNode(e,this.outputNested,r)},this.outputNode=(e,r,i)=>{const s=this.getApiOptions(),a=s.imagePlaceholder;if(e.type==="widget"){const o=s.widgetPlaceholder;return o||(this._foundTextNodes=!0,c.contains(this.widgetIds,e.id)?p("span",{className:"renderer-widget-error",children:["Widget [[","☃"," ",e.id,"]] already exists."].join("")},i.key):(this.widgetIds.push(e.id),this.renderWidget(e.widgetType,e.id,i)))}if(e.type==="blockMath"){const o=cr(e.content),l={overflowX:"auto",overflowY:"hidden",paddingTop:10,paddingBottom:10,marginTop:-10,marginBottom:-10};if(s.isMobile){const h={marginLeft:-16,marginRight:-16},g={paddingLeft:16,paddingRight:16},w={...l,...Je.mobileZoomableParentFix};return p("div",{className:"perseus-block-math",style:h,children:p(A,{children:p("div",{className:"perseus-block-math-inner",style:{...w,...g},children:p(mt,{children:o})})})},i.key)}return p("div",{className:"perseus-block-math",children:p(A,{children:p("div",{className:"perseus-block-math-inner",style:l,children:p(be.Consumer,{children:({setAssetStatus:u})=>p(Fe,{setAssetStatus:u,children:o})})})})},i.key)}if(e.type==="math"){const o=e.content.replace(/\{align[*]?\}/g,"{aligned}");return p("span",{style:{whiteSpace:"nowrap"},children:fe(A,{children:[p("span",{}),p(be.Consumer,{children:({setAssetStatus:l})=>p(Fe,{onRender:this.props.onRender,setAssetStatus:l,children:o})}),p("span",{})]})},i.key)}if(e.type==="image"){if(a)return a;const o=c.has(this.props.images,e.target)?this.props.images[e.target]:null,l=!i.inTable;return p(A,{children:p(be.Consumer,{children:({setAssetStatus:u})=>p(pt,{setAssetStatus:u,src:z.sanitizeUrl(e.target),alt:e.alt,title:e.title,responsive:l,onUpdate:this.props.onRender,zoomToFullSizeOnMobile:s.isMobile&&s.isArticle,...o})})},i.key)}if(e.type==="columns")return this._isTwoColumn=!0,p(A,{children:z.ruleOutput(e,r,i)},i.key);if(e.type==="text")return Nr.test(e.content)&&(this._foundTextNodes=!0),a&&Tr.test(e.content)?a:e.content;if(e.type==="table"||e.type==="titledTable"){const o=z.ruleOutput(e,r,{...i,isMobile:s.isMobile,inTable:!0});if(!s.isMobile)return o;const l=16,u={marginLeft:-l,marginRight:-l},g={...{paddingLeft:0,paddingRight:0},...Je.mobileZoomableParentFix},w=p("div",{style:{...g,overflowX:"auto"},children:p(A,{children:p(ft,{animateHeight:!0,children:o})})});return p("div",{style:u,children:w})}return p(A,{children:z.ruleOutput(e,r,i)},i.key)},this.handleRender=e=>{const r=this.props.onRender,i=e.onRender;if(r!==K||i!==K){const s=dt(Ee.findDOMNode(this)).find("img");i!==K&&s.off("load",i),r!==K&&s.on("load",r)}r()},this._setCurrentFocus=e=>{const r=this.getApiOptions();if(!Pr(e,this._currentFocus)){const i=this._currentFocus;i&&this.blurPath(i),this._currentFocus=e,r.onFocusChange(this._currentFocus,i)}},this.focus=()=>{let e,r;for(let i=0;i<this.widgetIds.length;i++){const s=this.widgetIds[i],a=this.getWidgetInstance(s),o=a&&a.focus&&a.focus();if(o){e=s,r=o;break}}if(e){let i;return typeof r=="object"?(i=[e].concat(r.path||[]),j.error("Renderer received a focus result of type 'object' instead of the expected type 'boolean'",C.Internal,{loggedMetadata:{focusResult:JSON.stringify(r),currentProps:JSON.stringify(this.state.widgetProps)}})):i=[e],this._setCurrentFocus(i),!0}},this.getDOMNodeForPath=e=>{const r=c.first(e),i=c.rest(e),s=this.getWidgetInstance(r),a=s&&s.getDOMNodeForPath;if(a)return a(i);if(i.length===0)return Ee.findDOMNode(s)},this.getGrammarTypeForPath=e=>{const r=c.first(e),i=c.rest(e),s=this.getWidgetInstance(r);if(s&&s.getGrammarTypeForPath)return s.getGrammarTypeForPath(i)},this.getInputPaths=()=>{const e=[];return c.each(this.widgetIds,r=>{const i=this.getWidgetInstance(r);if(i&&i.getInputPaths){const s=i.getInputPaths();c.each(s,a=>{const o=[r].concat(a);e.push(o)})}}),e},this.focusPath=e=>{if(c.isEqual(this._currentFocus,e))return;this._currentFocus&&this.blurPath(this._currentFocus);const r=c.first(e),i=c.rest(e),s=this.getWidgetInstance(r);s&&s.focusInputPath&&s.focusInputPath(i)},this.blurPath=e=>{if(!c.isEqual(this._currentFocus,e))return;const r=c.first(e),i=c.rest(e);if(this.getWidgetInstance(r)){const a=this.getWidgetInstance(r);a&&a.blurInputPath&&a.blurInputPath(i)}},this.blur=()=>{this._currentFocus&&this.blurPath(this._currentFocus)},this.serialize=()=>{const e={};return c.each(this.state.widgetInfo,function(r,i){const a=this.getWidgetInstance(i).serialize();c.isEmpty(a)||(e[i]=a)},this),e},this.emptyWidgets=()=>c.filter(this.widgetIds,e=>{const r=this._getWidgetInfo(e);if(r.static)return!1;const i=this.getWidgetInstance(e);if(i&&i.simpleValidate){const s=i.simpleValidate(r.options,null);return se.scoreIsEmpty(s)}}),this._setWidgetProps=(e,r,i,s)=>{this.setState(a=>{const o={...a.widgetProps,[e]:{...a.widgetProps[e],...r}},l=s?a.lastUsedWidgetId:e;return s||this.props.onSerializedStateUpdated(this.getSerializedState(o)),{lastUsedWidgetId:l,widgetProps:o}},()=>{setTimeout(()=>{const a=i&&i();s||this.props.onInteractWithWidget(e),a!==!1&&this._setCurrentFocus([e])},0)})},this.setInputValue=(e,r,i)=>{var l;const s=c.first(e),a=c.rest(e),o=this.getWidgetInstance(s);(l=o==null?void 0:o.setInputValue)==null||l.call(o,a,r,i)},this.getUserInput=()=>this.widgetIds.map(e=>{const r=this.getWidgetInstance(e);if(r&&r.getUserInput)return r.getUserInput()}),this.getWidgetIds=()=>this.widgetIds,this.getUserInputForWidgets=()=>Rr(this.widgetIds,e=>{const r=this.getWidgetInstance(e);if(r&&r.getUserInput)return r.getUserInput()}),this.scoreWidgets=()=>{const e=this.state.widgetInfo,r=this.getApiOptions().onInputError,i=c.filter(this.widgetIds,a=>{const o=e[a],l=(o==null?void 0:o.graded)==null||o.graded,u=!!(o!=null&&o.static);return l&&!u}),s={};return c.each(i,a=>{const o=e[a],l=this.getWidgetInstance(a);l&&l.simpleValidate&&(s[a]=l.simpleValidate({...o==null?void 0:o.options,scoring:!0},r))}),s},this.score=()=>c.reduce(this.scoreWidgets(),se.combineScores,se.noScore),this.guessAndScore=()=>{const e=this.getUserInput(),r=this.score();return[e,r]},this.examples=()=>{const e=this.widgetIds,r=c.compact(c.map(e,s=>{const a=this.getWidgetInstance(s);return a!=null&&a.examples?a.examples():null}));return!r.length||!c.all(r,function(s){return c.isEqual(r[0],s)})?null:r[0]},this.handletranslationLintErrors=e=>{this._isMounted&&this.setState({translationLintErrors:e})},this._translationLinter=new lr,this.state={jiptContent:null,translationLintErrors:[],lastUsedWidgetId:null,...this._getInitialWidgetState(t)}}componentDidMount(){this._isMounted=!0,this.handleRender({}),this._currentFocus=null,this.props.serializedState&&this.restoreSerializedState(this.props.serializedState),this.props.linterContext.highlightLint&&this._translationLinter.runLinter(this.props.content,this.handletranslationLintErrors)}UNSAFE_componentWillReceiveProps(t){c.isEqual(c.pick(this.props,Ke),c.pick(t,Ke))||this.setState(this._getInitialWidgetState(t))}shouldComponentUpdate(t,e){if(this.props.alwaysUpdate)return!0;const r=!c.isEqual(this.state,e);return!c.isEqual(this.props,t)||r}UNSAFE_componentWillUpdate(t,e){const r=this.shouldRenderJiptPlaceholder(this.props,this.state),i=this.shouldRenderJiptPlaceholder(t,e),s=this.getContent(this.props,this.state),a=this.getContent(t,e),o=this.props.highlightedWidgets,l=t.highlightedWidgets;this.reuseMarkdown=!r&&!i&&s===a&&c.isEqual(this.state.translationLintErrors,e.translationLintErrors)&&(!this.props.linterContext.highlightLint||c.isEqual(this.props.widgets,t.widgets))&&this.props.linterContext.highlightLint===t.linterContext.highlightLint&&o===l}componentDidUpdate(t,e){this.handleRender(t),c.each(this.widgetIds,r=>{const i=this._widgetContainers.get(ue(r));i&&i.replaceWidgetProps(this.getWidgetProps(r))}),this.props.serializedState&&!c.isEqual(this.props.serializedState,this.getSerializedState())&&this.restoreSerializedState(this.props.serializedState),this.props.linterContext.highlightLint&&this._translationLinter.runLinter(this.props.content,this.handletranslationLintErrors)}componentWillUnmount(){this.widgetIds=[],this.translationIndex!=null&&X().rendererTranslationComponents.removeComponentAtIndex(this.translationIndex),this._isMounted=!1}render(){const t=this.getApiOptions();if(this.reuseMarkdown)return this.lastRenderedMarkdown;const e=this.getContent(this.props,this.state);if(this.widgetIds=[],this.shouldRenderJiptPlaceholder(this.props,this.state)&&(this.translationIndex||(this.translationIndex=X().rendererTranslationComponents.addComponent(this)),!t.isArticle))return p(de,{children:p("div",{"data-perseus-component-index":this.translationIndex,children:e})});this._isTwoColumn=!1;const r=this.props.inline?z.parseInline(e,{isJipt:this.translationIndex!=null}):z.parse(e,{isJipt:this.translationIndex!=null});if(this.props.linterContext.highlightLint){const a={content:this.props.content,widgets:this.props.widgets,...this.props.linterContext};wn(r,a,!0),this._translationLinter.applyLintErrors(r,[...this.state.translationLintErrors,...this.props.legacyPerseusLint||[]])}const i=this.outputMarkdown(r,{baseElements:t.baseElements}),s=xe({[ke.RENDERER]:!0,[ke.RESPONSIVE_RENDERER]:!0,[ke.TWO_COLUMN_RENDERER]:this._isTwoColumn});return this.lastRenderedMarkdown=p(de,{children:p("div",{className:s,children:i})}),this.lastRenderedMarkdown}};Me.defaultProps={content:"",widgets:{},images:{},highlightedWidgets:[],questionCompleted:!1,showSolutions:"none",onRender:K,onInteractWithWidget:function(){},findExternalWidgets:()=>[],alwaysUpdate:!1,reviewMode:!1,serializedState:null,onSerializedStateUpdated:()=>{},linterContext:Xe};let ge=Me;const Je={mobileZoomableParentFix:{transform:"translate3d(0,0,0)"}};try{ge.displayName="Renderer",ge.__docgenInfo={description:"",displayName:"Renderer",props:{analytics:{defaultValue:null,description:"",name:"analytics",required:!1,type:{name:"{ onAnalyticsEvent: AnalyticsEventHandlerFn; }"}},apiOptions:{defaultValue:null,description:"",name:"apiOptions",required:!1,type:{name:"Readonly<{ isArticle?: boolean; onInputError?: ((widgetId: any, value: string, message?: string | null) => unknown) | undefined; onFocusChange?: ((newFocusPath: FocusPath, oldFocusPath: FocusPath, keypadHeight?: number | undefined, focusedElement?: HTMLElement | undefined) => unknown) | undef..."}},alwaysUpdate:{defaultValue:{value:"false"},description:"",name:"alwaysUpdate",required:!1,type:{name:"boolean"}},findExternalWidgets:{defaultValue:{value:"() => []"},description:"",name:"findExternalWidgets",required:!1,type:{name:"any"}},highlightedWidgets:{defaultValue:{value:"[]"},description:"",name:"highlightedWidgets",required:!1,type:{name:"readonly any[]"}},images:{defaultValue:{value:"{}"},description:"",name:"images",required:!1,type:{name:"{ [key: string]: PerseusImageDetail; }"}},keypadElement:{defaultValue:null,description:"",name:"keypadElement",required:!1,type:{name:"any"}},onInteractWithWidget:{defaultValue:{value:"function () {}"},description:"",name:"onInteractWithWidget",required:!1,type:{name:"(id: string) => void"}},onRender:{defaultValue:{value:"() => {}"},description:"",name:"onRender",required:!1,type:{name:"(node?: any) => void"}},problemNum:{defaultValue:null,description:"",name:"problemNum",required:!1,type:{name:"number"}},questionCompleted:{defaultValue:{value:"false"},description:"",name:"questionCompleted",required:!1,type:{name:"boolean"}},reviewMode:{defaultValue:{value:"false"},description:"",name:"reviewMode",required:!1,type:{name:"boolean | null"}},showSolutions:{defaultValue:{value:"none"},description:'If set to "all", all rationales or solutions will be shown. If set to\n"selected", soltions will only be shown for selected choices. If set to\n"none", solutions will not be shown-- equivalent to `undefined`.',name:"showSolutions",required:!1,type:{name:"enum",value:[{value:'"all"'},{value:'"selected"'},{value:'"none"'}]}},content:{defaultValue:{value:""},description:"",name:"content",required:!1,type:{name:"string"}},serializedState:{defaultValue:{value:"null"},description:"",name:"serializedState",required:!1,type:{name:"any"}},onSerializedStateUpdated:{defaultValue:{value:"() => {}"},description:`Callback which is called when serialized state changes with the new
serialized state.`,name:"onSerializedStateUpdated",required:!1,type:{name:"(serializedState: { [key: string]: any; }) => unknown"}},linterContext:{defaultValue:{value:"PerseusLinter.linterContextDefault"},description:`If linterContext.highlightLint is true, then content will be passed to
the linter and any warnings will be highlighted in the rendered output.`,name:"linterContext",required:!1,type:{name:"LinterContextProps"}},legacyPerseusLint:{defaultValue:null,description:"",name:"legacyPerseusLint",required:!1,type:{name:"readonly string[]"}},widgets:{defaultValue:{value:"{}"},description:"",name:"widgets",required:!1,type:{name:"PerseusWidgetsMap"}},inline:{defaultValue:null,description:"Skip adding paragraph class",name:"inline",required:!1,type:{name:"boolean"}},strings:{defaultValue:null,description:"",name:"strings",required:!0,type:{name:"PerseusStrings"}}}}}catch{}export{De as D,Ve as J,z as P,ge as R,Qr as S,ei as a,ri as b,si as c,ai as d,_r as e,vr as f,kr as g,cr as h,ii as i,ti as j,ni as k,Xe as l,hr as m,Zr as n,m as o,bn as p,Yr as r,oi as s,wr as u};
