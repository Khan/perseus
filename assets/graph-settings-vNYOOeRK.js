import{j as a}from"./jsx-runtime-63Ea5SlK.js";import{U as u,K as S}from"./util-lM0i5-yG.js";import{_ as n}from"./index-default-4_ZsnO94.js";import"./core-widget-registry-AphjUPV9.js";import{c as k}from"./article-renderer-TzvQpiVw.js";import"./phet-simulation-t69N-Bc7.js";import{g as y}from"./dependencies-CP7Uh8Kq.js";import"./perseus-api-DO0X8arb.js";import"./server-item-renderer-lTBc1xft.js";import"./hints-renderer-IW_JBjXT.js";import"./renderer-Abm1y3vX.js";import"./base-radio-ADeFMeSX.js";import{c as T}from"./components-qKE69rRA.js";import{j as v}from"./constants-qvNmarDy.js";import"./i18n-context-GVCAGr7t.js";import"./svg-image-7bBodxv8.js";import"./jquery-5v7aFUvu.js";import"./index-smZ6iCr_.js";import{C as m}from"./index-DQJhbslN.js";import{r as j}from"./index-6oxdNXpR.js";import{F as w}from"./index-9gkyvru-.js";const{ButtonGroup:R,InfoTip:N,RangeInput:c}=T,G={url:null,width:0,height:0};function C(b,e){return Math.floor((b[1]-b[0])/e)}const g=class g extends j.Component{constructor(e){super(e),this._isMounted=!1,this.state=this.getInitialState(),this.change=this.change.bind(this),this.changeBackgroundUrl=this.changeBackgroundUrl.bind(this),this.changeGraph=this.changeGraph.bind(this),this.changeGridStep=this.changeGridStep.bind(this),this.changeLabel=this.changeLabel.bind(this),this.changeRange=this.changeRange.bind(this),this.changeRulerLabel=this.changeRulerLabel.bind(this),this.changeRulerTicks=this.changeRulerTicks.bind(this),this.changeSnapStep=this.changeSnapStep.bind(this),this.changeStep=this.changeStep.bind(this)}getInitialState(){return this.stateFromProps(this.props)}componentDidMount(){this._isMounted=!0,this.changeGraph=n.debounce(this.changeGraph,300)}UNSAFE_componentWillReceiveProps(e){(!n.isEqual(this.props.labels,e.labels)||!n.isEqual(this.props.gridStep,e.gridStep)||!n.isEqual(this.props.snapStep,e.snapStep)||!n.isEqual(this.props.step,e.step)||!n.isEqual(this.props.range,e.range)||!n.isEqual(this.props.backgroundImage,e.backgroundImage))&&this.setState(this.stateFromProps(e))}componentWillUnmount(){this._isMounted=!1}stateFromProps(e){return{labelsTextbox:e.labels,gridStepTextbox:e.gridStep,snapStepTextbox:e.snapStep,stepTextbox:e.step,rangeTextbox:e.range,backgroundImage:n.clone(e.backgroundImage)}}change(...e){return k.apply(this,e)}changeRulerLabel(e){this.change({rulerLabel:e.target.value})}changeRulerTicks(e){this.change({rulerTicks:+e.target.value})}changeBackgroundUrl(e){if(e.type==="keypress"&&e.key!=="Enter")return;const s=(i,r,o)=>{const l=n.clone(this.props.backgroundImage);l.url=i,l.width=r,l.height=o,this.setState({backgroundImage:l},this.changeGraph)},t=w.findDOMNode(this.refs["bg-url"]).value;t?u.getImageSize(t,(i,r)=>{this._isMounted&&s(t,i,r)}):s(null,0,0)}renderLabelChoices(e){return n.map(e,function([s,t]){return a.jsx("option",{value:t,children:s},t)})}validRange(e){return n.every(e,function(t){return n.isFinite(t)})?e[0]>=e[1]?"Range must have a higher number on the right":!0:"Range must be a valid number"}validateStepValue(e){const{step:s,range:t,name:i,minTicks:r,maxTicks:o}=e;if(!n.isFinite(s))return i+" must be a valid number";const l=C(t,s);return l<r?i+" is too large, there must be at least "+r+" ticks.":l>o?i+" is too small, there can be at most "+o+" ticks.":!0}validSnapStep(e,s){return this.validateStepValue({step:e,range:s,name:"Snap step",minTicks:5,maxTicks:60})}validGridStep(e,s){return this.validateStepValue({step:e,range:s,name:"Grid step",minTicks:3,maxTicks:60})}validStep(e,s){return this.validateStepValue({step:e,range:s,name:"Step",minTicks:3,maxTicks:20})}validBackgroundImageSize(e){return e.url?e.width<=450&&e.height<=450?!0:"Image must be smaller than 450px x 450px.":!0}validateGraphSettings(e,s,t,i,r){const o=this;let l;if(!n.every(e,function(p){return l=o.validRange(p),l===!0})||!n.every(s,function(p,d){return l=o.validStep(p,e[d]),l===!0})||!n.every(t,function(p,d){return l=o.validGridStep(p,e[d]),l===!0})||!n.every(i,function(p,d){return l=o.validSnapStep(p,e[d]),l===!0}))return l;const f=this.validBackgroundImageSize(r);return f!==!0?(l=f,l):!0}changeLabel(e,s){const t=s.target.value,i=this.state.labelsTextbox.slice();i[e]=t,this.setState({labelsTextbox:i},this.changeGraph)}changeRange(e,s){const t=this.state.rangeTextbox.slice();t[e]=s;const i=this.state.stepTextbox.slice(),r=this.state.gridStepTextbox.slice(),o=this.state.snapStepTextbox.slice(),l=u.scaleFromExtent(t[e],this.props.box[e]);this.validRange(t[e])===!0&&(i[e]=u.tickStepFromExtent(t[e],this.props.box[e]),r[e]=u.gridStepFromTickStep(i[e],l),o[e]=r[e]/2),this.setState({stepTextbox:i,gridStepTextbox:r,snapStepTextbox:o,rangeTextbox:t},this.changeGraph)}changeStep(e){this.setState({stepTextbox:e},this.changeGraph)}changeSnapStep(e){this.setState({snapStepTextbox:e},this.changeGraph)}changeGridStep(e){this.setState({gridStepTextbox:e,snapStepTextbox:n.map(e,function(s){return s/2})},this.changeGraph)}changeGraph(){const e=this.state.labelsTextbox,s=n.map(this.state.rangeTextbox,function(x){return n.map(x,Number)}),t=n.map(this.state.stepTextbox,Number),i=this.state.gridStepTextbox,r=this.state.snapStepTextbox,o=this.state.backgroundImage,l=this.validateGraphSettings(s,t,i,r,o);l===!0?this.change({valid:!0,labels:e,range:s,step:t,gridStep:i,snapStep:r,backgroundImage:o}):this.change({valid:l})}render(){const e=[S.roundTo(2,u.scaleFromExtent(this.props.range[0],this.props.box[0])),S.roundTo(2,u.scaleFromExtent(this.props.range[1],this.props.box[1]))],{TeX:s}=y();return a.jsxs("div",{children:[n.contains(this.props.editableSettings,"canvas")&&a.jsxs("div",{className:"graph-settings",children:[a.jsxs("div",{className:"perseus-widget-row",children:[a.jsx("label",{htmlFor:"canvas-size",children:"Canvas size (x,y pixels)"}),a.jsx(c,{id:"canvas-size",value:this.props.box,onChange:t=>{this.change({box:t})}})]}),a.jsxs("div",{className:"perseus-widget-row",children:["Scale (px per div):"," ",a.jsx(s,{children:"("+e[0]+", "+e[1]+")"})]})]}),n.contains(this.props.editableSettings,"graph")&&a.jsxs("div",{className:"graph-settings",children:[a.jsxs("div",{className:"perseus-widget-row",children:[a.jsxs("div",{className:"perseus-widget-left-col",children:[a.jsx("label",{htmlFor:"labels-x",children:"x Label"}),a.jsx("input",{id:"labels-x",type:"text",className:"graph-settings-axis-label",ref:"labels-0",onChange:t=>this.changeLabel(0,t),value:this.state.labelsTextbox[0]||""})]}),a.jsxs("div",{className:"perseus-widget-right-col",children:[a.jsx("label",{htmlFor:"labels-y",children:"y Label"}),a.jsx("input",{id:"labels-y",type:"text",className:"graph-settings-axis-label",ref:"labels-1",onChange:t=>this.changeLabel(1,t),value:this.state.labelsTextbox[1]||""})]})]}),a.jsxs("div",{className:"perseus-widget-row",children:[a.jsxs("div",{className:"perseus-widget-left-col",children:[a.jsx("label",{htmlFor:"range-x",children:"x Range"}),a.jsx(c,{id:"range-x",value:this.state.rangeTextbox[0],onChange:t=>this.changeRange(0,t)})]}),a.jsxs("div",{className:"perseus-widget-right-col",children:[a.jsx("label",{htmlFor:"range-y",children:"y Range"}),a.jsx(c,{id:"range-y",value:this.state.rangeTextbox[1],onChange:t=>this.changeRange(1,t)})]})]}),a.jsxs("div",{className:"perseus-widget-row",children:[a.jsxs("div",{className:"perseus-widget-left-col",children:[a.jsx("label",{htmlFor:"tick-step",children:"Tick Step"}),a.jsx(c,{id:"tick-step",value:this.state.stepTextbox,onChange:this.changeStep})]}),a.jsxs("div",{className:"perseus-widget-right-col",children:[a.jsx("label",{htmlFor:"grid-step",children:"Grid Step"}),a.jsx(c,{id:"grid-step",value:this.state.gridStepTextbox,onChange:this.changeGridStep})]})]}),n.contains(this.props.editableSettings,"snap")&&a.jsx("div",{className:"perseus-widget-row",children:a.jsxs("div",{className:"perseus-widget-left-col",children:[a.jsx("label",{htmlFor:"snap-step",children:"Snap Step"}),a.jsx(c,{id:"snap-step",value:this.state.snapStepTextbox,onChange:this.changeSnapStep})]})}),a.jsxs("div",{className:"perseus-widget-row",children:[a.jsx("label",{children:"Markings: "}),a.jsx(R,{value:this.props.markings,allowEmpty:!1,buttons:[{value:"graph",content:"Graph"},{value:"grid",content:"Grid"},{value:"none",content:"None"}],onChange:this.change("markings")})]}),a.jsx("div",{className:"perseus-widget-left-col",children:a.jsx(m,{label:"Show tooltips",checked:this.props.showTooltips,onChange:t=>{this.change({showTooltips:t})}})})]}),n.contains(this.props.editableSettings,"image")&&a.jsxs("div",{className:"image-settings",children:[a.jsx("div",{children:"Background image:"}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"bg-url",children:"Url:"}),a.jsx("input",{id:"bg-url",type:"text",className:"graph-settings-background-url",ref:"bg-url",value:this.state.backgroundImage.url||"",onChange:t=>{const i=n.clone(this.props.backgroundImage);i.url=t.target.value,this.setState({backgroundImage:i})},onKeyPress:this.changeBackgroundUrl,onBlur:this.changeBackgroundUrl}),a.jsx(N,{children:a.jsx("p",{children:'Create an image in graphie, or use the "Add image" function to create a background.'})})]})]}),n.contains(this.props.editableSettings,"measure")&&a.jsxs("div",{className:"misc-settings",children:[a.jsxs("div",{className:"perseus-widget-row",children:[a.jsx("div",{className:"perseus-widget-left-col",children:a.jsx(m,{label:"Show ruler",checked:this.props.showRuler,onChange:t=>{this.change({showRuler:t})}})}),a.jsx("div",{className:"perseus-widget-right-col",children:a.jsx(m,{label:"Show protractor",checked:this.props.showProtractor,onChange:t=>{this.change({showProtractor:t})}})})]}),this.props.showRuler&&a.jsxs("div",{children:[a.jsx("div",{children:a.jsxs("label",{children:[" ","Ruler label:"," ",a.jsxs("select",{onChange:this.changeRulerLabel,value:this.props.rulerLabel,children:[a.jsx("option",{value:"",children:"None"}),a.jsx("optgroup",{label:"Metric",children:this.renderLabelChoices([["milimeters","mm"],["centimeters","cm"],["meters","m"],["kilometers","km"]])}),a.jsx("optgroup",{label:"Imperial",children:this.renderLabelChoices([["inches","in"],["feet","ft"],["yards","yd"],["miles","mi"]])})]})]})}),a.jsx("div",{children:a.jsxs("label",{children:[" ","Ruler ticks:"," ",a.jsx("select",{onChange:this.changeRulerTicks,value:this.props.rulerTicks,children:n.map([1,2,4,8,10,16],function(t){return a.jsx("option",{value:t,children:t},t)})})]})})]})]})]})}};g.defaultProps={editableSettings:["graph","snap","image","measure"],box:[v.defaultBoxSizeSmall,v.defaultBoxSizeSmall],labels:["x","y"],range:[[-10,10],[-10,10]],step:[1,1],gridStep:[1,1],snapStep:[1,1],valid:!0,backgroundImage:G,markings:"graph",rulerLabel:"",rulerTicks:10,showProtractor:!1,showRuler:!1,showTooltips:!1};let h=g;const ee=h;h.__docgenInfo={description:"",methods:[{name:"stateFromProps",docblock:null,modifiers:[],params:[{name:"props",optional:!1,type:null}],returns:null},{name:"change",docblock:null,modifiers:[],params:[{name:"...args",optional:!1,type:null}],returns:null},{name:"changeRulerLabel",docblock:null,modifiers:[],params:[{name:"e",optional:!1,type:null}],returns:null},{name:"changeRulerTicks",docblock:null,modifiers:[],params:[{name:"e",optional:!1,type:null}],returns:null},{name:"changeBackgroundUrl",docblock:null,modifiers:[],params:[{name:"e",optional:!1,type:null}],returns:null},{name:"renderLabelChoices",docblock:null,modifiers:[],params:[{name:"choices",optional:!1,type:null}],returns:null},{name:"validRange",docblock:null,modifiers:[],params:[{name:"range",optional:!1,type:null}],returns:null},{name:"validateStepValue",docblock:null,modifiers:[],params:[{name:"settings",optional:!1,type:null}],returns:null},{name:"validSnapStep",docblock:null,modifiers:[],params:[{name:"step",optional:!1,type:null},{name:"range",optional:!1,type:null}],returns:null},{name:"validGridStep",docblock:null,modifiers:[],params:[{name:"step",optional:!1,type:null},{name:"range",optional:!1,type:null}],returns:null},{name:"validStep",docblock:null,modifiers:[],params:[{name:"step",optional:!1,type:null},{name:"range",optional:!1,type:null}],returns:null},{name:"validBackgroundImageSize",docblock:null,modifiers:[],params:[{name:"image",optional:!1,type:null}],returns:null},{name:"validateGraphSettings",docblock:null,modifiers:[],params:[{name:"range",optional:!1,type:null},{name:"step",optional:!1,type:null},{name:"gridStep",optional:!1,type:null},{name:"snapStep",optional:!1,type:null},{name:"image",optional:!1,type:null}],returns:null},{name:"changeLabel",docblock:null,modifiers:[],params:[{name:"i",optional:!1,type:null},{name:"e",optional:!1,type:null}],returns:null},{name:"changeRange",docblock:null,modifiers:[],params:[{name:"i",optional:!1,type:null},{name:"values",optional:!1,type:null}],returns:null},{name:"changeStep",docblock:null,modifiers:[],params:[{name:"step",optional:!1,type:null}],returns:null},{name:"changeSnapStep",docblock:null,modifiers:[],params:[{name:"snapStep",optional:!1,type:null}],returns:null},{name:"changeGridStep",docblock:null,modifiers:[],params:[{name:"gridStep",optional:!1,type:null}],returns:null},{name:"changeGraph",docblock:null,modifiers:[],params:[],returns:null}],props:{editableSettings:{required:!1,tsType:{name:"ReadonlyArray",elements:[{name:"union",raw:'"canvas" | "graph" | "snap" | "image" | "measure"',elements:[{name:"literal",value:'"canvas"'},{name:"literal",value:'"graph"'},{name:"literal",value:'"snap"'},{name:"literal",value:'"image"'},{name:"literal",value:'"measure"'}]}],raw:`ReadonlyArray<
    "canvas" | "graph" | "snap" | "image" | "measure"
>`},description:"",defaultValue:{value:'["graph", "snap", "image", "measure"]',computed:!1}},box:{required:!1,tsType:{name:"unknown"},description:"",defaultValue:{value:`[
    interactiveSizes.defaultBoxSizeSmall,
    interactiveSizes.defaultBoxSizeSmall,
]`,computed:!1}},labels:{required:!1,tsType:{name:"unknown"},description:"",defaultValue:{value:'["x", "y"]',computed:!1}},range:{required:!1,tsType:{name:"tuple",raw:"[Coord, Coord]",elements:[{name:"tuple",raw:"[x: number, y: number]",elements:[{name:"unknown"},{name:"unknown"}]},{name:"tuple",raw:"[x: number, y: number]",elements:[{name:"unknown"},{name:"unknown"}]}]},description:"",defaultValue:{value:`[
    [-10, 10],
    [-10, 10],
]`,computed:!1}},step:{required:!1,tsType:{name:"tuple",raw:"[number, number]",elements:[{name:"number"},{name:"number"}]},description:"",defaultValue:{value:"[1, 1]",computed:!1}},gridStep:{required:!1,tsType:{name:"tuple",raw:"[number, number]",elements:[{name:"number"},{name:"number"}]},description:"",defaultValue:{value:"[1, 1]",computed:!1}},snapStep:{required:!1,tsType:{name:"tuple",raw:"[number, number]",elements:[{name:"number"},{name:"number"}]},description:"",defaultValue:{value:"[1, 1]",computed:!1}},valid:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},backgroundImage:{required:!1,tsType:{name:"any"},description:"",defaultValue:{value:`{
    url: null,
    width: 0,
    height: 0,
}`,computed:!1}},markings:{required:!1,tsType:{name:"union",raw:'"axes" | "graph" | "grid" | "none"',elements:[{name:"literal",value:'"axes"'},{name:"literal",value:'"graph"'},{name:"literal",value:'"grid"'},{name:"literal",value:'"none"'}]},description:"",defaultValue:{value:'"graph"',computed:!1}},showProtractor:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},showRuler:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},showTooltips:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},rulerLabel:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'""',computed:!1}},rulerTicks:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"10",computed:!1}}}};export{ee as G};
