import{U as p,K as v}from"./util-pBxNglIl.js";import{_ as l}from"./underscore-885MUNGo.js";import"./random-util-wZstT-Qs.js";import{c as k}from"./all-widgets-Y4SYDpG-.js";import"./phet-simulation-FTLyxKwk.js";import{g as E}from"./dependencies-CP7Uh8Kq.js";import"./perseus-api-Y55S7ZPk.js";import"./server-item-renderer-A_MnaDQM.js";import"./article-renderer-pyQ_HofA.js";import"./hints-renderer-5aG6E1Uq.js";import"./renderer-ZibUmNWI.js";import"./base-radio-UE6giogv.js";import{c as y}from"./components-K5MWvf6b.js";import{j as x}from"./constants-vGHYchdS.js";import"./i18n-context-g2lQsEMW.js";import"./svg-image-Prev2-2p.js";import"./jquery-5v7aFUvu.js";import"./index-smZ6iCr_.js";import{C as h}from"./index-Mag-4PMw.js";import{r as t}from"./index-6oxdNXpR.js";import{F as T}from"./index-9gkyvru-.js";const{ButtonGroup:w,InfoTip:R,RangeInput:c}=y,N={url:null,width:0,height:0};function G(b,e){return Math.floor((b[1]-b[0])/e)}const g=class g extends t.Component{constructor(e){super(e),this._isMounted=!1,this.state=this.getInitialState(),this.change=this.change.bind(this),this.changeBackgroundUrl=this.changeBackgroundUrl.bind(this),this.changeGraph=this.changeGraph.bind(this),this.changeGridStep=this.changeGridStep.bind(this),this.changeLabel=this.changeLabel.bind(this),this.changeRange=this.changeRange.bind(this),this.changeRulerLabel=this.changeRulerLabel.bind(this),this.changeRulerTicks=this.changeRulerTicks.bind(this),this.changeSnapStep=this.changeSnapStep.bind(this),this.changeStep=this.changeStep.bind(this)}getInitialState(){return this.stateFromProps(this.props)}componentDidMount(){this._isMounted=!0,this.changeGraph=l.debounce(this.changeGraph,300)}UNSAFE_componentWillReceiveProps(e){(!l.isEqual(this.props.labels,e.labels)||!l.isEqual(this.props.gridStep,e.gridStep)||!l.isEqual(this.props.snapStep,e.snapStep)||!l.isEqual(this.props.step,e.step)||!l.isEqual(this.props.range,e.range)||!l.isEqual(this.props.backgroundImage,e.backgroundImage))&&this.setState(this.stateFromProps(e))}componentWillUnmount(){this._isMounted=!1}stateFromProps(e){return{labelsTextbox:e.labels,gridStepTextbox:e.gridStep,snapStepTextbox:e.snapStep,stepTextbox:e.step,rangeTextbox:e.range,backgroundImage:l.clone(e.backgroundImage)}}change(...e){return k.apply(this,e)}changeRulerLabel(e){this.change({rulerLabel:e.target.value})}changeRulerTicks(e){this.change({rulerTicks:+e.target.value})}changeBackgroundUrl(e){if(e.type==="keypress"&&e.key!=="Enter")return;const n=(r,i,o)=>{const s=l.clone(this.props.backgroundImage);s.url=r,s.width=i,s.height=o,this.setState({backgroundImage:s},this.changeGraph)},a=T.findDOMNode(this.refs["bg-url"]).value;a?p.getImageSize(a,(r,i)=>{this._isMounted&&n(a,r,i)}):n(null,0,0)}renderLabelChoices(e){return l.map(e,function([n,a]){return t.createElement("option",{key:a,value:a},n)})}validRange(e){return l.every(e,function(a){return l.isFinite(a)})?e[0]>=e[1]?"Range must have a higher number on the right":!0:"Range must be a valid number"}validateStepValue(e){const{step:n,range:a,name:r,minTicks:i,maxTicks:o}=e;if(!l.isFinite(n))return r+" must be a valid number";const s=G(a,n);return s<i?r+" is too large, there must be at least "+i+" ticks.":s>o?r+" is too small, there can be at most "+o+" ticks.":!0}validSnapStep(e,n){return this.validateStepValue({step:e,range:n,name:"Snap step",minTicks:5,maxTicks:60})}validGridStep(e,n){return this.validateStepValue({step:e,range:n,name:"Grid step",minTicks:3,maxTicks:60})}validStep(e,n){return this.validateStepValue({step:e,range:n,name:"Step",minTicks:3,maxTicks:20})}validBackgroundImageSize(e){return e.url?e.width<=450&&e.height<=450?!0:"Image must be smaller than 450px x 450px.":!0}validateGraphSettings(e,n,a,r,i){const o=this;let s;if(!l.every(e,function(u){return s=o.validRange(u),s===!0})||!l.every(n,function(u,m){return s=o.validStep(u,e[m]),s===!0})||!l.every(a,function(u,m){return s=o.validGridStep(u,e[m]),s===!0})||!l.every(r,function(u,m){return s=o.validSnapStep(u,e[m]),s===!0}))return s;const S=this.validBackgroundImageSize(i);return S!==!0?(s=S,s):!0}changeLabel(e,n){const a=n.target.value,r=this.state.labelsTextbox.slice();r[e]=a,this.setState({labelsTextbox:r},this.changeGraph)}changeRange(e,n){const a=this.state.rangeTextbox.slice();a[e]=n;const r=this.state.stepTextbox.slice(),i=this.state.gridStepTextbox.slice(),o=this.state.snapStepTextbox.slice(),s=p.scaleFromExtent(a[e],this.props.box[e]);this.validRange(a[e])===!0&&(r[e]=p.tickStepFromExtent(a[e],this.props.box[e]),i[e]=p.gridStepFromTickStep(r[e],s),o[e]=i[e]/2),this.setState({stepTextbox:r,gridStepTextbox:i,snapStepTextbox:o,rangeTextbox:a},this.changeGraph)}changeStep(e){this.setState({stepTextbox:e},this.changeGraph)}changeSnapStep(e){this.setState({snapStepTextbox:e},this.changeGraph)}changeGridStep(e){this.setState({gridStepTextbox:e,snapStepTextbox:l.map(e,function(n){return n/2})},this.changeGraph)}changeGraph(){const e=this.state.labelsTextbox,n=l.map(this.state.rangeTextbox,function(f){return l.map(f,Number)}),a=l.map(this.state.stepTextbox,Number),r=this.state.gridStepTextbox,i=this.state.snapStepTextbox,o=this.state.backgroundImage,s=this.validateGraphSettings(n,a,r,i,o);s===!0?this.change({valid:!0,labels:e,range:n,step:a,gridStep:r,snapStep:i,backgroundImage:o}):this.change({valid:s})}render(){const e=[v.roundTo(2,p.scaleFromExtent(this.props.range[0],this.props.box[0])),v.roundTo(2,p.scaleFromExtent(this.props.range[1],this.props.box[1]))],{TeX:n}=E();return t.createElement("div",null,l.contains(this.props.editableSettings,"canvas")&&t.createElement("div",{className:"graph-settings"},t.createElement("div",{className:"perseus-widget-row"},t.createElement("label",{htmlFor:"canvas-size"},"Canvas size (x,y pixels)"),t.createElement(c,{id:"canvas-size",value:this.props.box,onChange:a=>{this.change({box:a})}})),t.createElement("div",{className:"perseus-widget-row"},"Scale (px per div):"," ",t.createElement(n,null,"("+e[0]+", "+e[1]+")"))),l.contains(this.props.editableSettings,"graph")&&t.createElement("div",{className:"graph-settings"},t.createElement("div",{className:"perseus-widget-row"},t.createElement("div",{className:"perseus-widget-left-col"},t.createElement("label",{htmlFor:"labels-x"},"x Label"),t.createElement("input",{id:"labels-x",type:"text",className:"graph-settings-axis-label",ref:"labels-0",onChange:a=>this.changeLabel(0,a),value:this.state.labelsTextbox[0]||""})),t.createElement("div",{className:"perseus-widget-right-col"},t.createElement("label",{htmlFor:"labels-y"},"y Label"),t.createElement("input",{id:"labels-y",type:"text",className:"graph-settings-axis-label",ref:"labels-1",onChange:a=>this.changeLabel(1,a),value:this.state.labelsTextbox[1]||""}))),t.createElement("div",{className:"perseus-widget-row"},t.createElement("div",{className:"perseus-widget-left-col"},t.createElement("label",{htmlFor:"range-x"},"x Range"),t.createElement(c,{id:"range-x",value:this.state.rangeTextbox[0],onChange:a=>this.changeRange(0,a)})),t.createElement("div",{className:"perseus-widget-right-col"},t.createElement("label",{htmlFor:"range-y"},"y Range"),t.createElement(c,{id:"range-y",value:this.state.rangeTextbox[1],onChange:a=>this.changeRange(1,a)}))),t.createElement("div",{className:"perseus-widget-row"},t.createElement("div",{className:"perseus-widget-left-col"},t.createElement("label",{htmlFor:"tick-step"},"Tick Step"),t.createElement(c,{id:"tick-step",value:this.state.stepTextbox,onChange:this.changeStep})),t.createElement("div",{className:"perseus-widget-right-col"},t.createElement("label",{htmlFor:"grid-step"},"Grid Step"),t.createElement(c,{id:"grid-step",value:this.state.gridStepTextbox,onChange:this.changeGridStep}))),l.contains(this.props.editableSettings,"snap")&&t.createElement("div",{className:"perseus-widget-row"},t.createElement("div",{className:"perseus-widget-left-col"},t.createElement("label",{htmlFor:"snap-step"},"Snap Step"),t.createElement(c,{id:"snap-step",value:this.state.snapStepTextbox,onChange:this.changeSnapStep}))),t.createElement("div",{className:"perseus-widget-row"},t.createElement("label",null,"Markings: "),t.createElement(w,{value:this.props.markings,allowEmpty:!1,buttons:[{value:"graph",content:"Graph"},{value:"grid",content:"Grid"},{value:"none",content:"None"}],onChange:this.change("markings")})),t.createElement("div",{className:"perseus-widget-left-col"},t.createElement(h,{label:"Show tooltips",checked:this.props.showTooltips,onChange:a=>{this.change({showTooltips:a})}}))),l.contains(this.props.editableSettings,"image")&&t.createElement("div",{className:"image-settings"},t.createElement("div",null,"Background image:"),t.createElement("div",null,t.createElement("label",{htmlFor:"bg-url"},"Url:"),t.createElement("input",{id:"bg-url",type:"text",className:"graph-settings-background-url",ref:"bg-url",value:this.state.backgroundImage.url||"",onChange:a=>{const r=l.clone(this.props.backgroundImage);r.url=a.target.value,this.setState({backgroundImage:r})},onKeyPress:this.changeBackgroundUrl,onBlur:this.changeBackgroundUrl}),t.createElement(R,null,t.createElement("p",null,'Create an image in graphie, or use the "Add image" function to create a background.')))),l.contains(this.props.editableSettings,"measure")&&t.createElement("div",{className:"misc-settings"},t.createElement("div",{className:"perseus-widget-row"},t.createElement("div",{className:"perseus-widget-left-col"},t.createElement(h,{label:"Show ruler",checked:this.props.showRuler,onChange:a=>{this.change({showRuler:a})}})),t.createElement("div",{className:"perseus-widget-right-col"},t.createElement(h,{label:"Show protractor",checked:this.props.showProtractor,onChange:a=>{this.change({showProtractor:a})}}))),this.props.showRuler&&t.createElement("div",null,t.createElement("div",null,t.createElement("label",null," ","Ruler label:"," ",t.createElement("select",{onChange:this.changeRulerLabel,value:this.props.rulerLabel},t.createElement("option",{value:""},"None"),t.createElement("optgroup",{label:"Metric"},this.renderLabelChoices([["milimeters","mm"],["centimeters","cm"],["meters","m"],["kilometers","km"]])),t.createElement("optgroup",{label:"Imperial"},this.renderLabelChoices([["inches","in"],["feet","ft"],["yards","yd"],["miles","mi"]]))))),t.createElement("div",null,t.createElement("label",null," ","Ruler ticks:"," ",t.createElement("select",{onChange:this.changeRulerTicks,value:this.props.rulerTicks},l.map([1,2,4,8,10,16],function(a){return t.createElement("option",{key:a,value:a},a)})))))))}};g.defaultProps={editableSettings:["graph","snap","image","measure"],box:[x.defaultBoxSizeSmall,x.defaultBoxSizeSmall],labels:["x","y"],range:[[-10,10],[-10,10]],step:[1,1],gridStep:[1,1],snapStep:[1,1],valid:!0,backgroundImage:N,markings:"graph",rulerLabel:"",rulerTicks:10,showProtractor:!1,showRuler:!1,showTooltips:!1};let d=g;const Z=d;d.__docgenInfo={description:"",methods:[{name:"stateFromProps",docblock:null,modifiers:[],params:[{name:"props",optional:!1,type:null}],returns:null},{name:"change",docblock:null,modifiers:[],params:[{name:"...args",optional:!1,type:null}],returns:null},{name:"changeRulerLabel",docblock:null,modifiers:[],params:[{name:"e",optional:!1,type:null}],returns:null},{name:"changeRulerTicks",docblock:null,modifiers:[],params:[{name:"e",optional:!1,type:null}],returns:null},{name:"changeBackgroundUrl",docblock:null,modifiers:[],params:[{name:"e",optional:!1,type:null}],returns:null},{name:"renderLabelChoices",docblock:null,modifiers:[],params:[{name:"choices",optional:!1,type:null}],returns:null},{name:"validRange",docblock:null,modifiers:[],params:[{name:"range",optional:!1,type:null}],returns:null},{name:"validateStepValue",docblock:null,modifiers:[],params:[{name:"settings",optional:!1,type:null}],returns:null},{name:"validSnapStep",docblock:null,modifiers:[],params:[{name:"step",optional:!1,type:null},{name:"range",optional:!1,type:null}],returns:null},{name:"validGridStep",docblock:null,modifiers:[],params:[{name:"step",optional:!1,type:null},{name:"range",optional:!1,type:null}],returns:null},{name:"validStep",docblock:null,modifiers:[],params:[{name:"step",optional:!1,type:null},{name:"range",optional:!1,type:null}],returns:null},{name:"validBackgroundImageSize",docblock:null,modifiers:[],params:[{name:"image",optional:!1,type:null}],returns:null},{name:"validateGraphSettings",docblock:null,modifiers:[],params:[{name:"range",optional:!1,type:null},{name:"step",optional:!1,type:null},{name:"gridStep",optional:!1,type:null},{name:"snapStep",optional:!1,type:null},{name:"image",optional:!1,type:null}],returns:null},{name:"changeLabel",docblock:null,modifiers:[],params:[{name:"i",optional:!1,type:null},{name:"e",optional:!1,type:null}],returns:null},{name:"changeRange",docblock:null,modifiers:[],params:[{name:"i",optional:!1,type:null},{name:"values",optional:!1,type:null}],returns:null},{name:"changeStep",docblock:null,modifiers:[],params:[{name:"step",optional:!1,type:null}],returns:null},{name:"changeSnapStep",docblock:null,modifiers:[],params:[{name:"snapStep",optional:!1,type:null}],returns:null},{name:"changeGridStep",docblock:null,modifiers:[],params:[{name:"gridStep",optional:!1,type:null}],returns:null},{name:"changeGraph",docblock:null,modifiers:[],params:[],returns:null}],props:{editableSettings:{required:!1,tsType:{name:"ReadonlyArray",elements:[{name:"union",raw:'"canvas" | "graph" | "snap" | "image" | "measure"',elements:[{name:"literal",value:'"canvas"'},{name:"literal",value:'"graph"'},{name:"literal",value:'"snap"'},{name:"literal",value:'"image"'},{name:"literal",value:'"measure"'}]}],raw:`ReadonlyArray<
    "canvas" | "graph" | "snap" | "image" | "measure"
>`},description:"",defaultValue:{value:'["graph", "snap", "image", "measure"]',computed:!1}},box:{required:!1,tsType:{name:"unknown"},description:"",defaultValue:{value:`[
    interactiveSizes.defaultBoxSizeSmall,
    interactiveSizes.defaultBoxSizeSmall,
]`,computed:!1}},labels:{required:!1,tsType:{name:"unknown"},description:"",defaultValue:{value:'["x", "y"]',computed:!1}},range:{required:!1,tsType:{name:"tuple",raw:"[Coord, Coord]",elements:[{name:"tuple",raw:"[x: number, y: number]",elements:[{name:"unknown"},{name:"unknown"}]},{name:"tuple",raw:"[x: number, y: number]",elements:[{name:"unknown"},{name:"unknown"}]}]},description:"",defaultValue:{value:`[
    [-10, 10],
    [-10, 10],
]`,computed:!1}},step:{required:!1,tsType:{name:"tuple",raw:"[number, number]",elements:[{name:"number"},{name:"number"}]},description:"",defaultValue:{value:"[1, 1]",computed:!1}},gridStep:{required:!1,tsType:{name:"tuple",raw:"[number, number]",elements:[{name:"number"},{name:"number"}]},description:"",defaultValue:{value:"[1, 1]",computed:!1}},snapStep:{required:!1,tsType:{name:"tuple",raw:"[number, number]",elements:[{name:"number"},{name:"number"}]},description:"",defaultValue:{value:"[1, 1]",computed:!1}},valid:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},backgroundImage:{required:!1,tsType:{name:"any"},description:"",defaultValue:{value:`{
    url: null,
    width: 0,
    height: 0,
}`,computed:!1}},markings:{required:!1,tsType:{name:"union",raw:'"axes" | "graph" | "grid" | "none"',elements:[{name:"literal",value:'"axes"'},{name:"literal",value:'"graph"'},{name:"literal",value:'"grid"'},{name:"literal",value:'"none"'}]},description:"",defaultValue:{value:'"graph"',computed:!1}},showProtractor:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},showRuler:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},showTooltips:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},rulerLabel:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'""',computed:!1}},rulerTicks:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"10",computed:!1}}}};export{Z as G};
