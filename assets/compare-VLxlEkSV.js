import{a as Fe}from"./version-akiLXZts.js";import{_ as r}from"./index-default-4_ZsnO94.js";const Ce="@khanacademy/kas",Le="__lib_version__";Fe(Ce,Le);var ze=function(){var e=function(_,c,o,h){for(o=o||{},h=_.length;h--;o[_[h]]=c);return o},t=[1,11],n=[1,9],i=[8,17],s=[6,11],u=[6,11,13,17],f={trace:function(){},yy:{},symbols_:{error:2,unitvalue:3,magnitude:4,unit:5,EOF:6,float:7,POW:8,int:9,multatoms:10,DIV:11,expatom:12,MUL:13,atom:14,"^":15,nat:16,ATOM:17,FLOAT:18,NAT:19,NEG:20,$accept:0,$end:1},terminals_:{2:"error",6:"EOF",8:"POW",11:"DIV",13:"MUL",15:"^",17:"ATOM",18:"FLOAT",19:"NAT",20:"NEG"},productions_:[0,[3,3],[3,2],[4,3],[4,1],[5,3],[5,1],[10,3],[10,2],[10,1],[12,3],[12,1],[14,1],[7,1],[7,1],[16,1],[9,2],[9,1]],performAction:function(c,o,h,a,x,d,N){var E=d.length-1;switch(x){case 1:return{type:"unitMagnitude",magnitude:d[E-2],unit:d[E-1]};case 2:return{type:"unitStandalone",unit:d[E-1]};case 3:this.$=d[E-2]+"e"+d[E];break;case 4:case 13:case 14:case 15:case 17:this.$=d[E];break;case 5:this.$={num:d[E-2],denom:d[E]};break;case 6:this.$={num:d[E],denom:null};break;case 7:this.$=[d[E-2]].concat(d[E]);break;case 8:this.$=[d[E-1]].concat(d[E]);break;case 9:this.$=[d[E]];break;case 10:this.$={name:d[E-2],pow:d[E]};break;case 11:this.$={name:d[E],pow:1};break;case 12:this.$=c;break;case 16:this.$="-"+d[E];break}},table:[{3:1,4:2,5:3,7:4,10:5,12:8,14:10,16:7,17:t,18:[1,6],19:n},{1:[3]},{5:12,10:5,12:8,14:10,17:t},{6:[1,13]},{8:[1,14],17:[2,4]},{6:[2,6],11:[1,15]},e(i,[2,13]),e(i,[2,14]),e(s,[2,9],{12:8,14:10,10:17,13:[1,16],17:t}),e([6,8,11,13,17],[2,15]),e(u,[2,11],{15:[1,18]}),e([6,11,13,15,17],[2,12]),{6:[1,19]},{1:[2,2]},{9:20,19:[1,22],20:[1,21]},{10:23,12:8,14:10,17:t},{10:24,12:8,14:10,17:t},e(s,[2,8]),{16:25,19:n},{1:[2,1]},{17:[2,3]},{19:[1,26]},{17:[2,17]},{6:[2,5]},e(s,[2,7]),e(u,[2,10]),{17:[2,16]}],defaultActions:{13:[2,2],19:[2,1],20:[2,3],22:[2,17],23:[2,5],26:[2,16]},parseError:function(c,o){if(o.recoverable)this.trace(c);else throw new Error(c)},parse:function(c){var o=this,h=[0],a=[null],x=[],d=this.table,N="",E=0,H=0,B=2,oe=1,pe=x.slice.call(arguments,1),R=Object.create(this.lexer),L={yy:{}};for(var X in this.yy)Object.prototype.hasOwnProperty.call(this.yy,X)&&(L.yy[X]=this.yy[X]);R.setInput(c,L.yy),L.yy.lexer=R,L.yy.parser=this,typeof R.yylloc>"u"&&(R.yylloc={});var G=R.yylloc;x.push(G);var ve=R.options&&R.options.ranges;typeof L.yy.parseError=="function"?this.parseError=L.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;function xe(){var $;return $=R.lex()||oe,typeof $!="number"&&($=o.symbols_[$]||$),$}for(var U,Z,w,A,m={},I,P,S,ne;;){if(Z=h[h.length-1],this.defaultActions[Z]?w=this.defaultActions[Z]:((U===null||typeof U>"u")&&(U=xe()),w=d[Z]&&d[Z][U]),typeof w>"u"||!w.length||!w[0]){var D="";ne=[];for(I in d[Z])this.terminals_[I]&&I>B&&ne.push("'"+this.terminals_[I]+"'");R.showPosition?D="Parse error on line "+(E+1)+`:
`+R.showPosition()+`
Expecting `+ne.join(", ")+", got '"+(this.terminals_[U]||U)+"'":D="Parse error on line "+(E+1)+": Unexpected "+(U==oe?"end of input":"'"+(this.terminals_[U]||U)+"'"),this.parseError(D,{text:R.match,token:this.terminals_[U]||U,line:R.yylineno,loc:G,expected:ne})}if(w[0]instanceof Array&&w.length>1)throw new Error("Parse Error: multiple actions possible at state: "+Z+", token: "+U);switch(w[0]){case 1:h.push(U),a.push(R.yytext),x.push(R.yylloc),h.push(w[1]),U=null,H=R.yyleng,N=R.yytext,E=R.yylineno,G=R.yylloc;break;case 2:if(P=this.productions_[w[1]][1],m.$=a[a.length-P],m._$={first_line:x[x.length-(P||1)].first_line,last_line:x[x.length-1].last_line,first_column:x[x.length-(P||1)].first_column,last_column:x[x.length-1].last_column},ve&&(m._$.range=[x[x.length-(P||1)].range[0],x[x.length-1].range[1]]),A=this.performAction.apply(m,[N,H,E,L.yy,w[1],a,x].concat(pe)),typeof A<"u")return A;P&&(h=h.slice(0,-1*P*2),a=a.slice(0,-1*P),x=x.slice(0,-1*P)),h.push(this.productions_[w[1]][0]),a.push(m.$),x.push(m._$),S=d[h[h.length-2]][h[h.length-1]],h.push(S);break;case 3:return!0}}return!0}},y=function(){var _={EOF:1,parseError:function(o,h){if(this.yy.parser)this.yy.parser.parseError(o,h);else throw new Error(o)},setInput:function(c,o){return this.yy=o||this.yy||{},this._input=c,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var c=this._input[0];this.yytext+=c,this.yyleng++,this.offset++,this.match+=c,this.matched+=c;var o=c.match(/(?:\r\n?|\n).*/g);return o?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),c},unput:function(c){var o=c.length,h=c.split(/(?:\r\n?|\n)/g);this._input=c+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-o),this.offset-=o;var a=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),h.length-1&&(this.yylineno-=h.length-1);var x=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:h?(h.length===a.length?this.yylloc.first_column:0)+a[a.length-h.length].length-h[0].length:this.yylloc.first_column-o},this.options.ranges&&(this.yylloc.range=[x[0],x[0]+this.yyleng-o]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+`. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
`+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(c){this.unput(this.match.slice(c))},pastInput:function(){var c=this.matched.substr(0,this.matched.length-this.match.length);return(c.length>20?"...":"")+c.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var c=this.match;return c.length<20&&(c+=this._input.substr(0,20-c.length)),(c.substr(0,20)+(c.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var c=this.pastInput(),o=new Array(c.length+1).join("-");return c+this.upcomingInput()+`
`+o+"^"},test_match:function(c,o){var h,a,x;if(this.options.backtrack_lexer&&(x={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(x.yylloc.range=this.yylloc.range.slice(0))),a=c[0].match(/(?:\r\n?|\n).*/g),a&&(this.yylineno+=a.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:a?a[a.length-1].length-a[a.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+c[0].length},this.yytext+=c[0],this.match+=c[0],this.matches=c,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(c[0].length),this.matched+=c[0],h=this.performAction.call(this,this.yy,this,o,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),h)return h;if(this._backtrack){for(var d in x)this[d]=x[d];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var c,o,h,a;this._more||(this.yytext="",this.match="");for(var x=this._currentRules(),d=0;d<x.length;d++)if(h=this._input.match(this.rules[x[d]]),h&&(!o||h[0].length>o[0].length)){if(o=h,a=d,this.options.backtrack_lexer){if(c=this.test_match(h,x[d]),c!==!1)return c;if(this._backtrack){o=!1;continue}else return!1}else if(!this.options.flex)break}return o?(c=this.test_match(o,x[a]),c!==!1?c:!1):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var o=this.next();return o||this.lex()},begin:function(o){this.conditionStack.push(o)},popState:function(){var o=this.conditionStack.length-1;return o>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(o){return o=this.conditionStack.length-1-Math.abs(o||0),o>=0?this.conditionStack[o]:"INITIAL"},pushState:function(o){this.begin(o)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(o,h,a,x){switch(a){case 0:return 11;case 1:return"(";case 2:return")";case 3:return 8;case 4:return 15;case 5:return 13;case 6:return 18;case 7:return 19;case 8:return 20;case 9:return 17;case 10:return 17;case 11:return 17;case 12:break;case 13:return 6}},rules:[/^(?:\/)/,/^(?:\()/,/^(?:\))/,/^(?:(\*|x|\u00d7|\u2219|\u22c5|\u00b7)\s*10\s*\^)/,/^(?:\^)/,/^(?:\*)/,/^(?:[0-9]+\.[0-9]+)/,/^(?:[0-9]+)/,/^(?:-)/,/^(?:\u00b0( ?)[cCfF])/,/^(?:fl\.? oz\.?)/,/^(?:[\u00b5]?([A-Za-z-]+|[\u2103\u2109\u212b]))/,/^(?:\s+)/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}};return _}();f.lexer=y;function g(){this.yy={}}return g.prototype=f,f.Parser=g,new g}();const He=ze;var he=function(){var e=function(Z,w,A,m){for(A=A||{},m=Z.length;m--;A[Z[m]]=w);return A},t=[1,7],n=[1,17],i=[1,13],s=[1,14],u=[1,15],f=[1,32],y=[1,22],g=[1,23],_=[1,24],c=[1,25],o=[1,26],h=[1,33],a=[1,27],x=[1,28],d=[1,29],N=[1,30],E=[1,20],H=[1,36],B=[1,37],oe=[5,6,8,10,33,35,41,43,45],pe=[1,39],R=[1,40],L=[5,6,8,10,12,14,16,19,21,22,28,29,30,31,32,33,34,35,37,39,41,42,43,44,45,46],X=[10,16,19,21,22,28,29,30,31,32,34,37,39,42,43,44,46],G=[5,6,8,10,12,14,16,18,19,21,22,28,29,30,31,32,33,34,35,37,39,41,42,43,44,45,46],ve={trace:function(){},yy:{},symbols_:{error:2,equation:3,expression:4,SIGN:5,EOF:6,additive:7,"+":8,multiplicative:9,"-":10,triglog:11,"*":12,negative:13,"/":14,trig:15,TRIG:16,trigfunc:17,"^":18,TRIGINV:19,logbase:20,ln:21,log:22,_:23,subscriptable:24,power:25,primitive:26,variable:27,VAR:28,CONST:29,INT:30,FLOAT:31,"{":32,"}":33,"(":34,")":35,function:36,FUNC:37,invocation:38,sqrt:39,"[":40,"]":41,abs:42,"|":43,"LEFT|":44,"RIGHT|":45,FRAC:46,$accept:0,$end:1},terminals_:{2:"error",5:"SIGN",6:"EOF",8:"+",10:"-",12:"*",14:"/",16:"TRIG",18:"^",19:"TRIGINV",21:"ln",22:"log",23:"_",28:"VAR",29:"CONST",30:"INT",31:"FLOAT",32:"{",33:"}",34:"(",35:")",37:"FUNC",39:"sqrt",40:"[",41:"]",42:"abs",43:"|",44:"LEFT|",45:"RIGHT|",46:"FRAC"},productions_:[0,[3,4],[3,2],[3,1],[4,1],[7,3],[7,3],[7,1],[9,2],[9,3],[9,3],[9,1],[13,2],[13,1],[15,1],[17,1],[17,3],[17,1],[20,1],[20,1],[20,3],[11,2],[11,2],[11,1],[25,3],[25,1],[27,1],[24,3],[24,1],[24,1],[24,1],[24,1],[24,3],[24,3],[36,1],[38,4],[38,4],[38,7],[38,4],[38,3],[38,3],[38,4],[26,1],[26,1],[26,7]],performAction:function(w,A,m,I,P,S,ne){var D=S.length-1;switch(P){case 1:return new I.Eq(S[D-3],S[D-2],S[D-1]);case 2:return S[D-1];case 3:return new I.Add([]);case 4:case 7:case 11:case 13:case 15:case 20:case 23:case 25:case 42:case 43:this.$=S[D];break;case 5:this.$=I.Add.createOrAppend(S[D-2],S[D]);break;case 6:this.$=I.Add.createOrAppend(S[D-2],I.Mul.handleNegative(S[D],"subtract"));break;case 8:this.$=I.Mul.fold(I.Mul.createOrAppend(S[D-1],S[D]));break;case 9:this.$=I.Mul.fold(I.Mul.createOrAppend(S[D-2],S[D]));break;case 10:this.$=I.Mul.fold(I.Mul.handleDivide(S[D-2],S[D]));break;case 12:this.$=I.Mul.handleNegative(S[D]);break;case 14:case 17:this.$=[w];break;case 16:this.$=S[D-2].concat(S[D]);break;case 18:this.$=I.Log.natural();break;case 19:this.$=I.Log.common();break;case 21:this.$=I.Trig.create(S[D-1],S[D]);break;case 22:this.$=I.Log.create(S[D-1],S[D]);break;case 24:this.$=new I.Pow(S[D-2],S[D]);break;case 26:case 34:this.$=w;break;case 27:this.$=new I.Var(S[D-2],S[D]);break;case 28:this.$=new I.Var(S[D]);break;case 29:this.$=new I.Const(w.toLowerCase());break;case 30:this.$=I.Int.create(Number(w));break;case 31:this.$=I.Float.create(Number(w));break;case 32:this.$=S[D-1].completeParse();break;case 33:this.$=S[D-1].completeParse().addHint("parens");break;case 35:case 36:this.$=I.Pow.sqrt(S[D-1]);break;case 37:this.$=new I.Pow.nthroot(S[D-1],S[D-4]);break;case 38:case 39:case 40:this.$=new I.Abs(S[D-1]);break;case 41:this.$=new I.Func(S[D-3],S[D-1]);break;case 44:this.$=I.Mul.handleDivide(S[D-4],S[D-1]);break}},table:[{3:1,4:2,6:[1,3],7:4,9:5,10:t,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:s,22:u,24:18,25:11,26:16,27:21,28:f,29:y,30:g,31:_,32:c,34:o,36:31,37:h,38:19,39:a,42:x,43:d,44:N,46:E},{1:[3]},{5:[1,34],6:[1,35]},{1:[2,3]},e([5,6],[2,4],{8:H,10:B}),e(oe,[2,7],{17:9,20:10,25:11,15:12,26:16,24:18,38:19,27:21,36:31,11:38,12:pe,14:R,16:n,19:i,21:s,22:u,28:f,29:y,30:g,31:_,32:c,34:o,37:h,39:a,42:x,44:N,46:E}),e(L,[2,11]),{10:t,11:8,13:41,15:12,16:n,17:9,19:i,20:10,21:s,22:u,24:18,25:11,26:16,27:21,28:f,29:y,30:g,31:_,32:c,34:o,36:31,37:h,38:19,39:a,42:x,43:d,44:N,46:E},e(L,[2,13]),{10:t,11:8,13:42,15:12,16:n,17:9,19:i,20:10,21:s,22:u,24:18,25:11,26:16,27:21,28:f,29:y,30:g,31:_,32:c,34:o,36:31,37:h,38:19,39:a,42:x,43:d,44:N,46:E},{10:t,11:8,13:43,15:12,16:n,17:9,19:i,20:10,21:s,22:u,24:18,25:11,26:16,27:21,28:f,29:y,30:g,31:_,32:c,34:o,36:31,37:h,38:19,39:a,42:x,43:d,44:N,46:E},e(L,[2,23]),e(X,[2,15],{18:[1,44]}),e(X,[2,17]),e(X,[2,18]),e(X,[2,19],{23:[1,45]}),e(L,[2,25],{18:[1,46]}),e([10,16,18,19,21,22,28,29,30,31,32,34,37,39,42,43,44,46],[2,14]),e(G,[2,42]),e(G,[2,43]),{32:[1,47]},e(G,[2,28],{23:[1,48]}),e(G,[2,29]),e(G,[2,30]),e(G,[2,31]),{7:49,9:5,10:t,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:s,22:u,24:18,25:11,26:16,27:21,28:f,29:y,30:g,31:_,32:c,34:o,36:31,37:h,38:19,39:a,42:x,43:d,44:N,46:E},{7:50,9:5,10:t,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:s,22:u,24:18,25:11,26:16,27:21,28:f,29:y,30:g,31:_,32:c,34:o,36:31,37:h,38:19,39:a,42:x,43:d,44:N,46:E},{32:[1,52],34:[1,51],40:[1,53]},{34:[1,54]},{7:55,9:5,10:t,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:s,22:u,24:18,25:11,26:16,27:21,28:f,29:y,30:g,31:_,32:c,34:o,36:31,37:h,38:19,39:a,42:x,43:d,44:N,46:E},{7:56,9:5,10:t,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:s,22:u,24:18,25:11,26:16,27:21,28:f,29:y,30:g,31:_,32:c,34:o,36:31,37:h,38:19,39:a,42:x,43:d,44:N,46:E},{34:[1,57]},e([5,6,8,10,12,14,16,18,19,21,22,23,28,29,30,31,32,33,34,35,37,39,41,42,43,44,45,46],[2,26]),{34:[2,34]},{4:58,7:4,9:5,10:t,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:s,22:u,24:18,25:11,26:16,27:21,28:f,29:y,30:g,31:_,32:c,34:o,36:31,37:h,38:19,39:a,42:x,43:d,44:N,46:E},{1:[2,2]},{9:59,10:t,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:s,22:u,24:18,25:11,26:16,27:21,28:f,29:y,30:g,31:_,32:c,34:o,36:31,37:h,38:19,39:a,42:x,43:d,44:N,46:E},{9:60,10:t,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:s,22:u,24:18,25:11,26:16,27:21,28:f,29:y,30:g,31:_,32:c,34:o,36:31,37:h,38:19,39:a,42:x,43:d,44:N,46:E},e(L,[2,8]),{10:t,11:8,13:61,15:12,16:n,17:9,19:i,20:10,21:s,22:u,24:18,25:11,26:16,27:21,28:f,29:y,30:g,31:_,32:c,34:o,36:31,37:h,38:19,39:a,42:x,43:d,44:N,46:E},{10:t,11:8,13:62,15:12,16:n,17:9,19:i,20:10,21:s,22:u,24:18,25:11,26:16,27:21,28:f,29:y,30:g,31:_,32:c,34:o,36:31,37:h,38:19,39:a,42:x,43:d,44:N,46:E},e(L,[2,12]),e(L,[2,21]),e(L,[2,22]),{10:t,11:8,13:63,15:12,16:n,17:9,19:i,20:10,21:s,22:u,24:18,25:11,26:16,27:21,28:f,29:y,30:g,31:_,32:c,34:o,36:31,37:h,38:19,39:a,42:x,43:d,44:N,46:E},{24:64,27:21,28:f,29:y,30:g,31:_,32:c,34:o},{10:t,11:8,13:65,15:12,16:n,17:9,19:i,20:10,21:s,22:u,24:18,25:11,26:16,27:21,28:f,29:y,30:g,31:_,32:c,34:o,36:31,37:h,38:19,39:a,42:x,43:d,44:N,46:E},{7:66,9:5,10:t,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:s,22:u,24:18,25:11,26:16,27:21,28:f,29:y,30:g,31:_,32:c,34:o,36:31,37:h,38:19,39:a,42:x,43:d,44:N,46:E},{24:67,27:21,28:f,29:y,30:g,31:_,32:c,34:o},{8:H,10:B,33:[1,68]},{8:H,10:B,35:[1,69]},{7:70,9:5,10:t,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:s,22:u,24:18,25:11,26:16,27:21,28:f,29:y,30:g,31:_,32:c,34:o,36:31,37:h,38:19,39:a,42:x,43:d,44:N,46:E},{7:71,9:5,10:t,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:s,22:u,24:18,25:11,26:16,27:21,28:f,29:y,30:g,31:_,32:c,34:o,36:31,37:h,38:19,39:a,42:x,43:d,44:N,46:E},{7:72,9:5,10:t,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:s,22:u,24:18,25:11,26:16,27:21,28:f,29:y,30:g,31:_,32:c,34:o,36:31,37:h,38:19,39:a,42:x,43:d,44:N,46:E},{7:73,9:5,10:t,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:s,22:u,24:18,25:11,26:16,27:21,28:f,29:y,30:g,31:_,32:c,34:o,36:31,37:h,38:19,39:a,42:x,43:d,44:N,46:E},{8:H,10:B,43:[1,74]},{8:H,10:B,45:[1,75]},{7:76,9:5,10:t,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:s,22:u,24:18,25:11,26:16,27:21,28:f,29:y,30:g,31:_,32:c,34:o,36:31,37:h,38:19,39:a,42:x,43:d,44:N,46:E},{6:[1,77]},e(oe,[2,5],{17:9,20:10,25:11,15:12,26:16,24:18,38:19,27:21,36:31,11:38,12:pe,14:R,16:n,19:i,21:s,22:u,28:f,29:y,30:g,31:_,32:c,34:o,37:h,39:a,42:x,44:N,46:E}),e(oe,[2,6],{17:9,20:10,25:11,15:12,26:16,24:18,38:19,27:21,36:31,11:38,12:pe,14:R,16:n,19:i,21:s,22:u,28:f,29:y,30:g,31:_,32:c,34:o,37:h,39:a,42:x,44:N,46:E}),e(L,[2,9]),e(L,[2,10]),e(X,[2,16]),e(X,[2,20]),e(L,[2,24]),{8:H,10:B,33:[1,78]},e(G,[2,27]),e(G,[2,32]),e(G,[2,33]),{8:H,10:B,35:[1,79]},{8:H,10:B,33:[1,80]},{8:H,10:B,41:[1,81]},{8:H,10:B,35:[1,82]},e(G,[2,39]),e(G,[2,40]),{8:H,10:B,35:[1,83]},{1:[2,1]},{32:[1,84]},e(G,[2,35]),e(G,[2,36]),{32:[1,85]},e(G,[2,38]),e(G,[2,41]),{7:86,9:5,10:t,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:s,22:u,24:18,25:11,26:16,27:21,28:f,29:y,30:g,31:_,32:c,34:o,36:31,37:h,38:19,39:a,42:x,43:d,44:N,46:E},{7:87,9:5,10:t,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:s,22:u,24:18,25:11,26:16,27:21,28:f,29:y,30:g,31:_,32:c,34:o,36:31,37:h,38:19,39:a,42:x,43:d,44:N,46:E},{8:H,10:B,33:[1,88]},{8:H,10:B,33:[1,89]},e(G,[2,44]),e(G,[2,37])],defaultActions:{3:[2,3],33:[2,34],35:[2,2],77:[2,1]},parseError:function(w,A){if(A.recoverable)this.trace(w);else throw new Error(w)},parse:function(w){var A=this,m=[0],I=[null],P=[],S=this.table,ne="",D=0,$=0,qe=2,Ie=1,Ve=P.slice.call(arguments,1),j=Object.create(this.lexer),se={yy:{}};for(var we in this.yy)Object.prototype.hasOwnProperty.call(this.yy,we)&&(se.yy[we]=this.yy[we]);j.setInput(w,se.yy),se.yy.lexer=j,se.yy.parser=this,typeof j.yylloc>"u"&&(j.yylloc={});var be=j.yylloc;P.push(be);var Re=j.options&&j.options.ranges;typeof se.yy.parseError=="function"?this.parseError=se.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;function Ge(){var ue;return ue=j.lex()||Ie,typeof ue!="number"&&(ue=A.symbols_[ue]||ue),ue}for(var J,ae,K,ke,ce={},ge,ee,Ee,me;;){if(ae=m[m.length-1],this.defaultActions[ae]?K=this.defaultActions[ae]:((J===null||typeof J>"u")&&(J=Ge()),K=S[ae]&&S[ae][J]),typeof K>"u"||!K.length||!K[0]){var _e="";me=[];for(ge in S[ae])this.terminals_[ge]&&ge>qe&&me.push("'"+this.terminals_[ge]+"'");j.showPosition?_e="Parse error on line "+(D+1)+`:
`+j.showPosition()+`
Expecting `+me.join(", ")+", got '"+(this.terminals_[J]||J)+"'":_e="Parse error on line "+(D+1)+": Unexpected "+(J==Ie?"end of input":"'"+(this.terminals_[J]||J)+"'"),this.parseError(_e,{text:j.match,token:this.terminals_[J]||J,line:j.yylineno,loc:be,expected:me})}if(K[0]instanceof Array&&K.length>1)throw new Error("Parse Error: multiple actions possible at state: "+ae+", token: "+J);switch(K[0]){case 1:m.push(J),I.push(j.yytext),P.push(j.yylloc),m.push(K[1]),J=null,$=j.yyleng,ne=j.yytext,D=j.yylineno,be=j.yylloc;break;case 2:if(ee=this.productions_[K[1]][1],ce.$=I[I.length-ee],ce._$={first_line:P[P.length-(ee||1)].first_line,last_line:P[P.length-1].last_line,first_column:P[P.length-(ee||1)].first_column,last_column:P[P.length-1].last_column},Re&&(ce._$.range=[P[P.length-(ee||1)].range[0],P[P.length-1].range[1]]),ke=this.performAction.apply(ce,[ne,$,D,se.yy,K[1],I,P].concat(Ve)),typeof ke<"u")return ke;ee&&(m=m.slice(0,-1*ee*2),I=I.slice(0,-1*ee),P=P.slice(0,-1*ee)),m.push(this.productions_[K[1]][0]),I.push(ce.$),P.push(ce._$),Ee=S[m[m.length-2]][m[m.length-1]],m.push(Ee);break;case 3:return!0}}return!0}},xe=function(){var Z={EOF:1,parseError:function(A,m){if(this.yy.parser)this.yy.parser.parseError(A,m);else throw new Error(A)},setInput:function(w,A){return this.yy=A||this.yy||{},this._input=w,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var w=this._input[0];this.yytext+=w,this.yyleng++,this.offset++,this.match+=w,this.matched+=w;var A=w.match(/(?:\r\n?|\n).*/g);return A?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),w},unput:function(w){var A=w.length,m=w.split(/(?:\r\n?|\n)/g);this._input=w+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-A),this.offset-=A;var I=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),m.length-1&&(this.yylineno-=m.length-1);var P=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:m?(m.length===I.length?this.yylloc.first_column:0)+I[I.length-m.length].length-m[0].length:this.yylloc.first_column-A},this.options.ranges&&(this.yylloc.range=[P[0],P[0]+this.yyleng-A]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+`. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
`+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(w){this.unput(this.match.slice(w))},pastInput:function(){var w=this.matched.substr(0,this.matched.length-this.match.length);return(w.length>20?"...":"")+w.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var w=this.match;return w.length<20&&(w+=this._input.substr(0,20-w.length)),(w.substr(0,20)+(w.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var w=this.pastInput(),A=new Array(w.length+1).join("-");return w+this.upcomingInput()+`
`+A+"^"},test_match:function(w,A){var m,I,P;if(this.options.backtrack_lexer&&(P={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(P.yylloc.range=this.yylloc.range.slice(0))),I=w[0].match(/(?:\r\n?|\n).*/g),I&&(this.yylineno+=I.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:I?I[I.length-1].length-I[I.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+w[0].length},this.yytext+=w[0],this.match+=w[0],this.matches=w,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(w[0].length),this.matched+=w[0],m=this.performAction.call(this,this.yy,this,A,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),m)return m;if(this._backtrack){for(var S in P)this[S]=P[S];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var w,A,m,I;this._more||(this.yytext="",this.match="");for(var P=this._currentRules(),S=0;S<P.length;S++)if(m=this._input.match(this.rules[P[S]]),m&&(!A||m[0].length>A[0].length)){if(A=m,I=S,this.options.backtrack_lexer){if(w=this.test_match(m,P[S]),w!==!1)return w;if(this._backtrack){A=!1;continue}else return!1}else if(!this.options.flex)break}return A?(w=this.test_match(A,P[I]),w!==!1?w:!1):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var A=this.next();return A||this.lex()},begin:function(A){this.conditionStack.push(A)},popState:function(){var A=this.conditionStack.length-1;return A>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(A){return A=this.conditionStack.length-1-Math.abs(A||0),A>=0?this.conditionStack[A]:"INITIAL"},pushState:function(A){this.begin(A)},stateStackSize:function(){return this.conditionStack.length},options:{flex:!0},performAction:function(A,m,I,P){switch(I){case 0:break;case 1:break;case 2:break;case 3:return"INT";case 4:return"FLOAT";case 5:return"^";case 6:return"*";case 7:return"*";case 8:return"*";case 9:return"*";case 10:return"/";case 11:return"/";case 12:return"-";case 13:return"-";case 14:return"+";case 15:return"^";case 16:return"(";case 17:return")";case 18:return"(";case 19:return")";case 20:return"[";case 21:return"]";case 22:return"{";case 23:return"}";case 24:return"{";case 25:return"}";case 26:return"_";case 27:return"|";case 28:return"LEFT|";case 29:return"RIGHT|";case 30:return"!";case 31:return"SIGN";case 32:return m.yytext="<=","SIGN";case 33:return m.yytext=">=","SIGN";case 34:return m.yytext="<=","SIGN";case 35:return m.yytext=">=","SIGN";case 36:return m.yytext="<>","SIGN";case 37:return m.yytext="<>","SIGN";case 38:return m.yytext="<>","SIGN";case 39:return m.yytext="<>","SIGN";case 40:return m.yytext="<=","SIGN";case 41:return m.yytext=">=","SIGN";case 42:return"FRAC";case 43:return"FRAC";case 44:return"sqrt";case 45:return"abs";case 46:return"ln";case 47:return"log";case 48:return"TRIG";case 49:return"TRIG";case 50:return"TRIG";case 51:return"TRIG";case 52:return m.yytext="sin","TRIG";case 53:return m.yytext="cos","TRIG";case 54:return m.yytext="tan","TRIG";case 55:return m.yytext="csc","TRIG";case 56:return m.yytext="sec","TRIG";case 57:return m.yytext="cot","TRIG";case 58:return m.yytext="arcsin","TRIG";case 59:return m.yytext="arccos","TRIG";case 60:return m.yytext="arctan","TRIG";case 61:return m.yytext="arccsc","TRIG";case 62:return m.yytext="arcsec","TRIG";case 63:return m.yytext="arccot","TRIG";case 64:return"TRIGINV";case 65:return"TRIGINV";case 66:return m.yytext="sinh","TRIG";case 67:return m.yytext="cosh","TRIG";case 68:return m.yytext="tanh","TRIG";case 69:return m.yytext="csch","TRIG";case 70:return m.yytext="sech","TRIG";case 71:return m.yytext="tanh","TRIG";case 72:return"CONST";case 73:return m.yytext="pi","CONST";case 74:return m.yytext="pi","CONST";case 75:return"VAR";case 76:return m.yytext="theta","VAR";case 77:return m.yytext="theta","VAR";case 78:return"VAR";case 79:return m.yytext="phi","VAR";case 80:return m.yytext="phi","VAR";case 81:return A.symbolLexer(m.yytext);case 82:return"EOF";case 83:return"INVALID";case 84:console.log(m.yytext);break}},rules:[/^(?:\s+)/,/^(?:\\space)/,/^(?:\\ )/,/^(?:[0-9]+\.?)/,/^(?:([0-9]+)?\.[0-9]+)/,/^(?:\*\*)/,/^(?:\*)/,/^(?:\\cdot|·)/,/^(?:\\times|×)/,/^(?:\\ast)/,/^(?:\/)/,/^(?:\\div|÷)/,/^(?:-)/,/^(?:−)/,/^(?:\+)/,/^(?:\^)/,/^(?:\()/,/^(?:\))/,/^(?:\\left\()/,/^(?:\\right\))/,/^(?:\[)/,/^(?:\])/,/^(?:\{)/,/^(?:\})/,/^(?:\\left\{)/,/^(?:\\right\})/,/^(?:_)/,/^(?:\|)/,/^(?:\\left\|)/,/^(?:\\right\|)/,/^(?:\!)/,/^(?:<=|>=|<>|<|>|=)/,/^(?:\\le)/,/^(?:\\ge)/,/^(?:\\leq)/,/^(?:\\geq)/,/^(?:=\/=)/,/^(?:\\ne)/,/^(?:\\neq)/,/^(?:≠)/,/^(?:≤)/,/^(?:≥)/,/^(?:\\frac)/,/^(?:\\dfrac)/,/^(?:sqrt|\\sqrt)/,/^(?:abs|\\abs)/,/^(?:ln|\\ln)/,/^(?:log|\\log)/,/^(?:sin|cos|tan)/,/^(?:csc|sec|cot)/,/^(?:sinh|cosh|tanh)/,/^(?:csch|sech|coth)/,/^(?:\\sin)/,/^(?:\\cos)/,/^(?:\\tan)/,/^(?:\\csc)/,/^(?:\\sec)/,/^(?:\\cot)/,/^(?:\\arcsin)/,/^(?:\\arccos)/,/^(?:\\arctan)/,/^(?:\\arccsc)/,/^(?:\\arcsec)/,/^(?:\\arccot)/,/^(?:arcsin|arccos|arctan)/,/^(?:arccsc|arcsec|arccot)/,/^(?:\\sinh)/,/^(?:\\cosh)/,/^(?:\\tanh)/,/^(?:\\csch)/,/^(?:\\sech)/,/^(?:\\coth)/,/^(?:pi)/,/^(?:π)/,/^(?:\\pi)/,/^(?:theta)/,/^(?:θ)/,/^(?:\\theta)/,/^(?:phi)/,/^(?:φ)/,/^(?:\\phi)/,/^(?:[a-zA-Z])/,/^(?:$)/,/^(?:.)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84],inclusive:!0}}};return Z}();ve.lexer=xe;function U(){this.yy={}}return U.prototype=ve,ve.Parser=U,new U}(),Y=function(){throw new Error("Abstract method - must override for expr: "+this.print())},Se=function(e){throw new Error(e)},Ne=function(e){return e!==e},Ue=function(e,t){var n=t-e;return Math.random()*n+e},Ae=12,De=9;function Q(){}r.extend(Q.prototype,{func:Y,args:Y,construct:function(e){var t=new this.func;return this.func.apply(t,e),t},recurse:function(e){var t=Array.prototype.slice.call(arguments,1),n=r.map(this.args(),function(i){return r.isString(i)?i:i[e].apply(i,t)});return this.construct(n)},eval:Y,codegen:Y,compile:function(){var e=this.codegen();try{return new Function("vars","return "+e+";")}catch{throw new Error("Function did not compile: "+e)}},print:Y,tex:Y,asTex:function(e){e=e||{},r.defaults(e,{display:!0,dynamic:!0,times:!1});var t=this.tex();return e.display&&(t="\\displaystyle "+t),e.dynamic&&(t=t.replace(/\(/g,"\\left("),t=t.replace(/\)/g,"\\right)")),e.times&&(t=t.replace(/\\cdot/g,"\\times")),t},name:function(){return this.func.name?this.func.name:this.func.toString().match(/^function\s*([^\s(]+)/)[1]},repr:function(){return this.name()+"("+r.map(this.args(),function(e){return r.isString(e)?e:e.repr()}).join(",")+")"},strip:function(){return this.recurse("strip")},normalize:function(){return this.recurse("normalize")},expand:function(){return this.recurse("expand")},factor:function(e){return this.recurse("factor",e)},collect:function(e){return this.recurse("collect",e)},equals:function(e){return this.normalize().print()===e.normalize().print()},simplify:function(e){e=r.extend({once:!1},e);var t=this.factor(e),n=t.collect(e);t.equals(n)&&(n=this.collect(e));var i=n.expand(e),s=i.collect(e);i.equals(s)&&(s=n.collect(e));var u=s;return e.once||this.equals(u)?u:u.simplify(e)},isSimplified:function(){return this.equals(this.simplify())},exprArgs:function(){return r.filter(this.args(),function(e){return e instanceof Q})},getVars:function(e){return r.uniq(r.flatten(r.invoke(this.exprArgs(),"getVars",e))).sort()},getConsts:function(){return r.uniq(r.flatten(r.invoke(this.exprArgs(),"getConsts"))).sort()},getUnits:function(){return r.flatten(r.invoke(this.exprArgs(),"getUnits"))},is:function(e){return this instanceof e},has:function(e){return this instanceof e?!0:r.any(this.exprArgs(),function(t){return t.has(e)})},raiseToThe:function(e){return new M(this,e)},isSubtract:function(){return!1},isDivide:function(){return!1},isRoot:function(){return!1},needsExplicitMul:function(){return this.args()[0].needsExplicitMul()},sameVars:function(e){var t=this.getVars(),n=e.getVars(),i=function(y,g){return!r.difference(y,g).length},s=function(y){return r.uniq(r.invoke(y,"toLowerCase")).sort()},u=i(t,n),f=i(s(t),s(n));return{equal:u,equalIgnoringCase:f}},compare:function(e){if(e instanceof re)return!1;var t=r.union(this.getVars(!0),e.getVars(!0)),n=function(d,N){return Math.abs(d)<1||Math.abs(N)<1?Math.abs(d-N):Math.abs(1-d/N)},i=function(d,N){var E=n(d,N);return d===N||Ne(d)&&Ne(N)||E<Math.pow(10,-De)};if(!t.length&&!this.has(C)&&!e.has(C))return i(this.eval(),e.eval());var s=this.collect(),u=e.collect(),f=this.getUnits(),y=e.getUnits();if(!r.isEqual(f,y))return!1;for(var g=0;g<Ae;g++){var _={},c=Math.pow(10,1+Math.floor(3*g/Ae)),o=g%2===0;r.each(t,function(d){_[d]=o?Ue(-c,c):r.random(-c,c)});var h;if(s.has(te)||u.has(te)||s.has(C)||u.has(C)){var a=s.partialEval(_),x=u.partialEval(_);h=a.simplify().equals(x.simplify())}else{var a=s.eval(_),x=u.eval(_);h=i(a,x)}if(!h)return!1}return!0},partialEval:function(e){return this instanceof C?this:this.has(te)?this instanceof te?new te(this.symbol,this.arg.partialEval(e)):this.recurse("partialEval",e):new F(this.eval(e).toFixed(De)).collect()},sameForm:function(e){return this.strip().equals(e.strip())},findGCD:function(e){return this.equals(e)?e:l.One},getDenominator:function(){return l.One},asMul:function(){return new p(l.One,this)},isPositive:Y,isNegative:function(){return!1},asPositiveFactor:function(){return this.isPositive()?this:l.One},addHint:function(e){if(!e)return this;var t=this.construct(this.args());return t.hints=r.clone(this.hints),t.hints[e]=!0,t},hints:{parens:!1},asExpr:function(){return this},completeParse:function(){return this.recurse("completeParse")},abs:Y,negate:function(){return new p(l.Neg,this)}});function fe(){}fe.prototype=new Q;r.extend(fe.prototype,{args:function(){return this.terms},normalize:function(){var e=r.sortBy(r.invoke(this.terms,"normalize"),function(t){return t.print()});return new this.func(e)},expand:function(){return this.recurse("expand").flatten()},partition:function(){var e=r.groupBy(this.terms,function(i){return i instanceof l}),t=e[!0]||[],n=e[!1]||[];return[new this.func(t),new this.func(n)]},flatten:function(){var e=this,t=r.reject(this.terms,function(f){return f.equals(e.identity)});if(t.length===0)return e.identity;if(t.length===1)return t[0];var n=r.groupBy(t,function(f){return f instanceof e.func}),i=n[!0]||[],s=n[!1]||[],u=s.concat(r.flatten(r.pluck(i,"terms"),!0));return new e.func(u)},identity:void 0,reduce:Y,isPositive:function(){var e=r.invoke(this.terms,"collect");return r.all(r.invoke(e,"isPositive"))},replace:function(e,t){var n;e instanceof Q?n=r.indexOf(this.terms,e):n=e;var i=[];r.isArray(t)?i=t:t&&(i=[t]);var s=this.terms.slice(0,n).concat(i).concat(this.terms.slice(n+1));return new this.func(s)},remove:function(e){return this.replace(e)},getDenominator:function(){return new p(r.invoke(this.terms,"getDenominator")).flatten()}});function V(){arguments.length===1?this.terms=arguments[0]:this.terms=r.toArray(arguments)}V.prototype=new fe;r.extend(V.prototype,{func:V,eval:function(e,t){return r.reduce(this.terms,function(n,i){return n+i.eval(e,t)},0)},codegen:function(){return r.map(this.terms,function(e){return"("+e.codegen()+")"}).join(" + ")||"0"},print:function(){return r.invoke(this.terms,"print").join("+")},tex:function(){var e="";return r.each(this.terms,function(t){!e||t.isSubtract()?e+=t.tex():e+="+"+t.tex()}),e},collect:function(e){var t=r.invoke(this.terms,"collect",e),n=[];r.each(t,function(u){if(u instanceof p){var f=u.partition();n.push([f[1].flatten(),f[0].reduce(e)])}else u instanceof l?n.push([l.One,u]):n.push([u,l.One])});var i=r.groupBy(n,function(u){return u[0].normalize().print()}),s=r.compact(r.map(i,function(u){var f=u[0][0],y=new V(r.zip.apply(r,u)[1]),g=y.reduce(e);return new p(g,f).collect(e)}));return new V(s).flatten()},factor:function(e){e=r.extend({keepNegative:!1},e);var t=r.invoke(this.terms,"collect"),n;t[0]instanceof p?n=t[0].terms:n=[t[0]],r.each(r.rest(this.terms),function(s){n=r.map(n,function(u){return s.findGCD(u)})}),!e.keepNegative&&this.isNegative()&&n.push(l.Neg),n=new p(n).flatten().collect();var i=r.map(t,function(s){return p.handleDivide(s,n).simplify()});return i=new V(i).flatten(),p.createOrAppend(n,i).flatten()},reduce:function(e){return r.reduce(this.terms,function(t,n){return t.add(n,e)},this.identity)},needsExplicitMul:function(){return!1},isNegative:function(){var e=r.invoke(this.terms,"collect");return r.all(r.invoke(e,"isNegative"))},negate:function(){return new V(r.invoke(this.terms,"negate"))}});function p(){arguments.length===1?this.terms=arguments[0]:this.terms=r.toArray(arguments)}p.prototype=new fe;r.extend(p.prototype,{func:p,eval:function(e,t){return r.reduce(this.terms,function(n,i){return n*i.eval(e,t)},1)},codegen:function(){return r.map(this.terms,function(e){return"("+e.codegen()+")"}).join(" * ")||"0"},print:function(){return r.map(this.terms,function(e){return e instanceof V?"("+e.print()+")":e.print()}).join("*")},getUnits:function(){var e=r(this.terms).chain().map(function(t){return t.getUnits()}).flatten().value();return e.sort((t,n)=>t.unit.localeCompare(n.unit)),e},tex:function(){for(var e=" \\cdot ",t=r.groupBy(this.terms,function(a){return a.isDivide()?"inverse":a instanceof l?"number":"other"}),n=t.inverse||[],i=t.number||[],s=t.other||[],u="",f,y=0;y<i.length;y++){var g=i[y]instanceof T&&!(i[y]instanceof k);if(g&&s.length>0&&n.length>0){var _=i.slice();_.splice(y,1);var c=_.concat(n).concat(s);return i[y].tex()+new p(c).tex()}}if(i=r.compact(r.map(i,function(a){var x=a instanceof T&&!(a instanceof k),d=!a.hints.fraction||n.length>0;if(x&&d){n.push(new M(new k(a.d),l.Div));var N=new k(a.n);return N.hints=a.hints,r.any(a.hints)?N:null}else return a})),i.length===0&&s.length===1)f=s[0].tex();else{var o="";r.each(i,function(a){a.hints.subtract&&a.hints.entered?(u+="-",o+=(o?e:"")+a.abs().tex()):a instanceof k&&a.n===-1&&(a.hints.negate||a.hints.subtract)?u+="-":o+=(o?e:"")+a.tex()}),r.each(s,function(a){a.needsExplicitMul()?o+=(o?e:"")+a.tex():a instanceof V?o+="("+a.tex()+")":o+=a.tex()}),f=o||"1"}if(n.length){var h=new p(r.invoke(n,"asDivide")).flatten().tex();return u+"\\frac{"+f+"}{"+h+"}"}else return u+f},strip:function(){var e=r.map(this.terms,function(t){return t instanceof l?t.abs():t.strip()});return new p(e).flatten()},expand:function(){var e=function(d){return d instanceof V},t=function(d){return d instanceof M&&d.exp.isNegative()},n=function(d){return t(d)&&e(d.base)},i=this.recurse("expand").flatten(),s=r.any(i.terms,e),u=r.any(i.terms,n);if(!(s||u))return i;var f=r.groupBy(i.terms,t),y=f[!1]||[],g=f[!0]||[];if(s){var _=r.groupBy(y,e),c=_[!0]||[],o=_[!1]||[],h=r.reduce(c,function(d,N){return r.reduce(d,function(E,H){return E.concat(r.map(N.terms,function(B){return H.concat(B)}))},[])},[[]]),a=r.map(h,function(d){return new p(o.concat(d)).flatten()});y=[new V(a)]}if(u){var x=new p(r.invoke(g,"getDenominator")).flatten();g=[new M(x.expand(),l.Div)]}return new p(y.concat(g)).flatten()},factor:function(e){var t=this.recurse("factor",e).flatten();if(!(t instanceof p))return t;var n=r.groupBy(t.terms,function(s){return s instanceof T}),i=r.reduce(n[!0],function(s,u){return{n:s.n*u.n,d:s.d*u.d}},{n:1,d:1});return i.d===1?i=new k(i.n):i=new T(i.n,i.d),new p((n[!1]||[]).concat(i)).flatten()},collect:function(e){var t=this.recurse("collect",e).partition(),n=t[0].reduce(e);if(n.eval()===0)return l.Zero;var i=t[1].flatten();if(!(i instanceof p))return new p(n,i).flatten();i=i.terms;var f=[];r.each(i,function(a){a instanceof M?f.push([a.base,a.exp]):f.push([a,l.One])});var s=r.groupBy(f,function(a){return a[0].normalize().print()}),u=r.compact(r.map(s,function(a){var x=a[0][0],d=new V(r.zip.apply(r,a)[1]),N=d.collect(e);return N instanceof l&&N.eval()===0?null:[x,N]})),f=r.groupBy(u,function(a){return a[0]instanceof O&&a[0].isBasic()?"trig":a[0]instanceof z?"log":"expr"}),y=f.trig||[],g=f.log||[],_=f.expr||[];if(y.length>1){var c=r.groupBy(y,function(a){return a[0].arg.normalize().print()});y=[],r.each(c,function(a){var x=a[0][0].arg,d={sin:l.Zero,cos:l.Zero};r.each(a,function(N){d[N[0].type]=N[1]}),p.handleNegative(d.sin).collect(e).equals(d.cos)&&(d.cos.isNegative()?d={tan:d.sin}:d={cot:d.cos}),r.each(d,function(N,E){y.push([new O(E,x),N])})})}if(g.length>1){var o=r.groupBy(g,function(a){return a[0].base.normalize().print()});g=[],r.each(o,function(a){a.length===2&&p.handleNegative(a[0][1]).collect(e).equals(a[1][1])?a[0][1].isNegative()?g.push([new z(a[0][0].power,a[1][0].power),a[1][1]]):g.push([new z(a[1][0].power,a[0][0].power),a[0][1]]):g=g.concat(a)})}f=y.concat(g).concat(_);var h=r.map(f,function(a){return new M(a[0],a[1]).collect(e)});return new p([n].concat(h)).flatten()},isSubtract:function(){return r.any(this.terms,function(e){return e instanceof l&&e.hints.subtract})},factorIn:function(e){var t=this.partition(),n=t[0].terms,i=n.length&&r.all(n,function(u){return u.n>0});if(i){var s=n[0].negate();return s.hints=n[0].hints,this.replace(n[0],s.addHint(e))}else return new p([l.negativeOne(e)].concat(this.terms))},factorOut:function(){var e=!1,t=r.compact(r.map(this.terms,function(n,i,s){return!e&&n instanceof l&&n.hints.divide?(e=!0,n.n!==-1?n.negate():null):n}));return t.length===1?t[0]:new p(t)},reduce:function(e){return r.reduce(this.terms,function(t,n){return t.mul(n,e)},this.identity)},findGCD:function(e){return new p(r.invoke(this.terms,"findGCD",e)).flatten()},asMul:function(){return this},asPositiveFactor:function(){if(this.isPositive())return this;var e=r.invoke(this.collect().terms,"asPositiveFactor");return new p(e).flatten()},isNegative:function(){return r.any(r.invoke(this.collect().terms,"isNegative"))},fold:function(){return p.fold(this)},negate:function(){var e=function(n){return n instanceof l};if(r.any(this.terms,e)){var t=r.find(this.terms,e);return this.replace(t,t.negate())}else return new p([l.Neg].concat(this.terms))}});r.each([V,p],function(e){r.extend(e,{createOrAppend:function(t,n){return t instanceof e?new e(t.terms.concat(n)):new e(t,n)}})});r.extend(p,{handleNegative:function(e,t){if(e instanceof l&&e.n>0){var n=e.negate();return n.hints=e.hints,n.addHint(t)}else return e instanceof p?e.factorIn(t):new p(l.negativeOne(t),e)},handleDivide:function(e,t){if(t instanceof p){var n=p.handleDivide(e,t.terms[0]),i=new p(r.rest(t.terms)).flatten();return p.handleDivide(n,i)}var s=function(o){return o instanceof k},u=function(o){return o instanceof T};if(s(t)&&e instanceof p&&r.any(e.terms,s)){var f=e.terms.slice().reverse(),y=r.find(f,u);if(!s(y))return new p(e.terms.concat([new T(1,t.n).addHint("fraction")]));var g=new T(y.n,t.n);return g.hints=y.hints,y===f[0]&&(g=g.addHint("fraction")),y.n<0&&t.n<0?(g.d=-g.d,e.replace(y,[l.Neg,g])):e.replace(y,g)}var _=function(o,h){if(h instanceof k){if(o instanceof k)return o.n<0&&h.n<0?[l.Neg,new T(o.n,-h.n).addHint("fraction")]:[new T(o.n,h.n).addHint("fraction")];var a=new T(1,h.eval());return h.eval()<0?[o,a.addHint("negate")]:[o,a]}else{var x;if(h instanceof O&&h.exp){var d=h.exp;h.exp=void 0,h=new M(h,d)}return h instanceof M?x=new M(h.base,p.handleNegative(h.exp,"divide")):x=new M(h,l.Div),o instanceof k&&o.n===1?[x]:[o,x]}};if(e instanceof p){var c=_(r.last(e.terms),t);return new p(r.initial(e.terms).concat(c))}else{var c=_(e,t);return new p(c).flatten()}},fold:function(e){if(e instanceof p){var t=r.find(r.initial(e.terms),function(h){return(h instanceof O||h instanceof z)&&h.hints.open}),n=r.indexOf(e.terms,t);if(t){var i=r.last(e.terms);if(t.hints.parens||i.hints.parens||i.has(O)||i.has(z))t.hints.open=!1;else{var s;return t instanceof O?s=O.create([t.type,t.exp],p.createOrAppend(t.arg,i).fold()):s=z.create(t.base,p.createOrAppend(t.power,i).fold()),n===0?s:new p(e.terms.slice(0,n).concat(s)).fold()}}var u=e.partition(),f=u[0].terms,y=function(h){return h.n>0},g=function(h){return h.n===-1&&h.hints.negate},_=function(h){return y(h)||g(h)};if(f.length>1&&r.some(f,g)&&r.some(f,y)&&r.every(f,_)){var c=r.indexOf(e.terms,r.find(e.terms,g)),o=r.indexOf(e.terms,r.find(e.terms,y));if(c<o)return e.replace(o,e.terms[o].negate()).remove(c)}}return e}});function M(e,t){this.base=e,this.exp=t}M.prototype=new Q;r.extend(M.prototype,{func:M,args:function(){return[this.base,this.exp]},eval:function(e,t){var n=this.base.eval(e,t),i=this.exp.eval(e,t);if(n<0){var s=this.exp.simplify();if(s instanceof F){var u=s.n,f=(u-u.toFixed()).toString().length-2,y=Math.pow(10,f),g=new T(u*y,y);s=g.simplify()}if(s instanceof T){var _=Math.abs(s.d)%2===1;if(_){var c=Math.abs(s.n)%2===1,o=c?-1:1;return o*Math.pow(-1*n,i)}}}return Math.pow(n,i)},getUnits:function(){return this.base.getUnits().map((function(e){return{unit:e.unit,pow:e.pow*this.exp.n}}).bind(this))},codegen:function(){return"Math.pow("+this.base.codegen()+", "+this.exp.codegen()+")"},print:function(){var e=this.base.print();return(this.base instanceof fe||this.base instanceof M)&&(e="("+e+")"),e+"^("+this.exp.print()+")"},tex:function(){if(this.isDivide())return"\\frac{1}{"+this.asDivide().tex()+"}";if(this.isRoot())return this.exp.n!==1&&Se("Node marked with hint 'root' does not have exponent of form 1/x."),this.exp.d===2?"\\sqrt{"+this.base.tex()+"}":"\\sqrt["+this.exp.d+"]{"+this.base.tex()+"}";if(this.base instanceof O&&!this.base.isInverse()&&this.exp instanceof l&&this.exp.isSimple()&&this.exp.eval()>=0){var e=this.base.tex({split:!0});return e[0]+"^{"+this.exp.tex()+"}"+e[1]}else{var t=this.base.tex();return this.base instanceof fe||this.base instanceof M||this.base instanceof l&&!this.base.isSimple()?t="("+t+")":(this.base instanceof O||this.base instanceof z)&&(t="["+t+"]"),t+"^{"+this.exp.tex()+"}"}},needsExplicitMul:function(){return this.isRoot()?!1:this.base.needsExplicitMul()},expand:function(){var e=this.recurse("expand");if(e.base instanceof p){var t=r.map(e.base.terms,function(_){return new M(_,e.exp)});return new p(t).expand()}else if(e.base instanceof V&&e.exp instanceof k&&e.exp.abs().eval()>1){for(var n=e.exp.eval()>0,i=e.exp.abs().eval(),s=function(_){return n?_:new M(_,l.Div)},u={1:e.base},f=2;f<=i;f*=2){var g=new p(u[f/2],u[f/2]);u[f]=g.expand().collect()}if(r.has(u,i))return s(u[i]);var y=r.map(i.toString(2).split(""),function(_,c,o){return Number(_)*Math.pow(2,o.length-c-1)});y=r.without(y,0);var g=new p(r.pick(u,y)).expand().collect();return s(g)}else if(e.exp instanceof V){var t=r.map(e.exp.terms,function(c){return new M(e.base,c).expand()});return new p(t).expand()}else return e},factor:function(){var e=this.recurse("factor");if(e.base instanceof p){var t=r.map(e.base.terms,function(n){return n instanceof k&&e.exp.equals(l.Div)?new T(1,n.n):new M(n,e.exp)});return new p(t)}else return e},collect:function(e){if(this.base instanceof M){var t=this.base.base,n=p.createOrAppend(this.base.exp,this.exp);return new M(t,n).collect(e)}var i=this.recurse("collect",e),s=function(c){return c instanceof z&&c.base.equals(i.base)};if(i.exp instanceof l&&i.exp.eval()===0)return l.One;if(i.exp instanceof l&&i.exp.eval()===1)return i.base;if(s(i.exp))return i.exp.power;if(i.exp instanceof p&&r.any(i.exp.terms,s)){var u=r.find(i.exp.terms,s),t=u.power,n=i.exp.remove(u).flatten();return new M(t,n).collect(e)}else if(i.base instanceof l&&i.exp instanceof l){if(e&&e.preciseFloats){var n=i.exp.asRational(),f=i.base.getDecimalPlaces(),y=new M(i.base,new T(1,n.d)),g=y.collect().getDecimalPlaces();if(g>f){var _=new M(i.base,new k(n.n)).collect();return new M(_,new T(1,n.d))}}return i.base.raiseToThe(i.exp,e)}else return i},isDivide:function(){var e=function(t){return t instanceof l&&t.hints.divide};return e(this.exp)||this.exp instanceof p&&r.any(this.exp.terms,e)},asDivide:function(){if(this.exp instanceof l){if(this.exp.eval()===-1)return this.base;var e=this.exp.negate();return e.hints=r.clone(this.exp.hints),e.hints.divide=!1,new M(this.base,e)}else{if(this.exp instanceof p)return new M(this.base,this.exp.factorOut());Se("called asDivide() on an Expr that wasn't a Num or Mul")}},isRoot:function(){return this.exp instanceof T&&this.exp.hints.root},isSquaredTrig:function(){return this.base instanceof O&&!this.base.isInverse()&&this.exp instanceof l&&this.exp.eval()===2},getDenominator:function(){if(this.exp instanceof l&&this.exp.eval()===-1)return p.createOrAppend(this.base,this.base.getDenominator()).flatten();if(this.exp.isNegative()){var e=new M(this.base,p.handleNegative(this.exp).collect());return p.createOrAppend(e,e.collect().getDenominator()).flatten()}else return this.base instanceof l?new M(this.base.getDenominator(),this.exp).collect():l.One},findGCD:function(e){var t,n;if(e instanceof M?(t=e.base,n=e.exp):(t=e,n=l.One),this.base.equals(t)){if(this.exp.equals(n))return this;if(this.exp instanceof l&&n instanceof l)return new M(this.base,l.min(this.exp,n)).collect();if(this.exp instanceof l||n instanceof l)return l.One;var i=this.exp.asMul().partition(),s=n.asMul().partition();if(i[1].equals(s[1])){var u=l.min(i[0].reduce(),s[0].reduce()),f=new p(u,i[1].flatten()).flatten();return new M(t,f).collect()}}return l.One},isPositive:function(){if(this.base.isPositive())return!0;var e=this.exp.simplify();return e instanceof k&&e.eval()%2===0},asPositiveFactor:function(){if(this.isPositive())return this;var e=this.exp.simplify();if(e instanceof k){var t=e.eval();if(t>2)return new M(this.base,new k(t-1));if(t<-2)return new M(this.base,new k(t+1))}return l.One}});r.extend(M,{sqrt:function(e){return new M(e,l.Sqrt)},nthroot:function(e,t){var n=p.fold(p.handleDivide(new k(1),t));return new M(e,n.addHint("root"))}});function z(e,t){this.base=e,this.power=t}z.prototype=new Q;r.extend(z.prototype,{func:z,args:function(){return[this.base,this.power]},eval:function(e,t){return Math.log(this.power.eval(e,t))/Math.log(this.base.eval(e,t))},codegen:function(){return"(Math.log("+this.power.codegen()+") / Math.log("+this.base.codegen()+"))"},print:function(){var e="("+this.power.print()+")";return this.isNatural()?"ln"+e:"log_("+this.base.print()+") "+e},tex:function(){var e="("+this.power.tex()+")";return this.isNatural()?"\\ln"+e:"\\log_{"+this.base.tex()+"}"+e},collect:function(e){var t=this.recurse("collect",e);return t.power instanceof l&&t.power.eval()===1?l.Zero:t.base.equals(t.power)?l.One:t.power instanceof M&&t.power.base.equals(t.base)?t.power.exp:t},expand:function(){var e=this.recurse("expand");if(e.power instanceof p){var t=r.map(e.power.terms,function(n){return new z(e.base,n).expand()});return new V(t)}else return e.power instanceof M?new p(e.power.exp,new z(e.base,e.power.base).expand()).flatten():e.isNatural()?e:p.handleDivide(new z(W.e,e.power),new z(W.e,e.base))},hints:r.extend(z.prototype.hints,{open:!1}),isPositive:function(){var e=this.collect();return e.base instanceof l&&e.power instanceof l?this.eval()>0:!1},needsExplicitMul:function(){return!1},isNatural:function(){return this.base.equals(W.e)}});r.extend(z,{natural:function(){return W.e},common:function(){return l.Ten},create:function(e,t){var n=new z(e,t);return t.hints.parens||(n=n.addHint("open")),n}});function O(e,t){this.type=e,this.arg=t}O.prototype=new Q;r.extend(O.prototype,{func:O,args:function(){return[this.type,this.arg]},functions:{sin:{eval:Math.sin,codegen:"Math.sin((",tex:"\\sin",expand:function(){return this}},cos:{eval:Math.cos,codegen:"Math.cos((",tex:"\\cos",expand:function(){return this}},tan:{eval:Math.tan,codegen:"Math.tan((",tex:"\\tan",expand:function(){return p.handleDivide(O.sin(this.arg),O.cos(this.arg))}},csc:{eval:function(e){return 1/Math.sin(e)},codegen:"(1/Math.sin(",tex:"\\csc",expand:function(){return p.handleDivide(l.One,O.sin(this.arg))}},sec:{eval:function(e){return 1/Math.cos(e)},codegen:"(1/Math.cos(",tex:"\\sec",expand:function(){return p.handleDivide(l.One,O.cos(this.arg))}},cot:{eval:function(e){return 1/Math.tan(e)},codegen:"(1/Math.tan(",tex:"\\cot",expand:function(){return p.handleDivide(O.cos(this.arg),O.sin(this.arg))}},arcsin:{eval:Math.asin,codegen:"Math.asin((",tex:"\\arcsin"},arccos:{eval:Math.acos,codegen:"Math.acos((",tex:"\\arccos"},arctan:{eval:Math.atan,codegen:"Math.atan((",tex:"\\arctan"},arccsc:{eval:function(e){return Math.asin(1/e)},codegen:"Math.asin(1/(",tex:"\\operatorname{arccsc}"},arcsec:{eval:function(e){return Math.acos(1/e)},codegen:"Math.acos(1/(",tex:"\\operatorname{arcsec}"},arccot:{eval:function(e){return Math.atan(1/e)},codegen:"Math.atan(1/(",tex:"\\operatorname{arccot}"},sinh:{eval:function(e){return(Math.exp(e)-Math.exp(-e))/2},codegen:function(e){return"((Math.exp("+e+") - Math.exp(-("+e+"))) / 2)"},tex:"\\sinh",expand:function(){return this}},cosh:{eval:function(e){return(Math.exp(e)+Math.exp(-e))/2},codegen:function(e){return"((Math.exp("+e+") + Math.exp(-("+e+"))) / 2)"},tex:"\\cosh",expand:function(){return this}},tanh:{eval:function(e){return(Math.exp(e)-Math.exp(-e))/(Math.exp(e)+Math.exp(-e))},codegen:function(e){return"((Math.exp("+e+") - Math.exp(-("+e+"))) / (Math.exp("+e+") + Math.exp(-("+e+"))))"},tex:"\\tanh",expand:function(){return p.handleDivide(O.sinh(this.arg),O.cosh(this.arg))}},csch:{eval:function(e){return 2/(Math.exp(e)-Math.exp(-e))},codegen:function(e){return"(2 / (Math.exp("+e+") - Math.exp(-("+e+"))))"},tex:"\\csch",expand:function(){return p.handleDivide(l.One,O.sinh(this.arg))}},sech:{eval:function(e){return 2/(Math.exp(e)+Math.exp(-e))},codegen:function(e){return"(2 / (Math.exp("+e+") + Math.exp(-("+e+"))))"},tex:"\\sech",expand:function(){return p.handleDivide(l.One,O.cosh(this.arg))}},coth:{eval:function(e){return(Math.exp(e)+Math.exp(-e))/(Math.exp(e)-Math.exp(-e))},codegen:function(e){return"((Math.exp("+e+") + Math.exp(-("+e+"))) / (Math.exp("+e+") - Math.exp(-("+e+"))))"},tex:"\\coth",expand:function(){return p.handleDivide(O.cosh(this.arg),O.sinh(this.arg))}}},isEven:function(){return r.contains(["cos","sec"],this.type)},isInverse:function(){return this.type.indexOf("arc")===0},isBasic:function(){return r.contains(["sin","cos"],this.type)},eval:function(e,t){var n=this.functions[this.type].eval,i=this.arg.eval(e,t);return n(i)},codegen:function(){var e=this.functions[this.type].codegen;if(typeof e=="function")return e(this.arg.codegen());if(typeof e=="string")return e+this.arg.codegen()+"))";throw new Error("codegen not implemented for "+this.type)},print:function(){return this.type+"("+this.arg.print()+")"},tex:function(e){var t=this.functions[this.type].tex,n="("+this.arg.tex()+")";return e&&e.split?[t,n]:t+n},hints:r.extend(O.prototype.hints,{open:!1}),isPositive:function(){var e=this.collect();return e.arg instanceof l?this.eval()>0:!1},completeParse:function(){if(this.exp){var e=new M(this,this.exp);return this.exp=void 0,e}else return this},needsExplicitMul:function(){return!1},expand:function(){var e=this.recurse("expand");if(e.isInverse())return e;var t=e.functions[e.type].expand;return r.bind(t,e)()},collect:function(e){var t=this.recurse("collect",e);if(!t.isInverse()&&t.arg.isNegative()){var n;return t.arg instanceof l?n=t.arg.abs():n=p.handleDivide(t.arg,l.Neg).collect(e),t.isEven()?new O(t.type,n):new p(l.Neg,new O(t.type,n))}else return t}});r.extend(O,{create:function(e,t){var n=e[0],i=e[1];i&&i.equals(l.Neg)&&(n="arc"+n,i=void 0);var s=new O(n,t);return t.hints.parens||(s=s.addHint("open")),i&&(s.exp=i),s},sin:function(e){return new O("sin",e)},cos:function(e){return new O("cos",e)},sinh:function(e){return new O("sinh",e)},cosh:function(e){return new O("cosh",e)}});function le(e){this.arg=e}le.prototype=new Q;r.extend(le.prototype,{func:le,args:function(){return[this.arg]},eval:function(e,t){return Math.abs(this.arg.eval(e,t))},codegen:function(){return"Math.abs("+this.arg.codegen()+")"},print:function(){return"abs("+this.arg.print()+")"},tex:function(){return"\\left|"+this.arg.tex()+"\\right|"},collect:function(e){var t=this.recurse("collect",e);if(t.arg.isPositive())return t.arg;if(t.arg instanceof l)return t.arg.abs();if(t.arg instanceof p){var n=r.groupBy(t.arg.terms,function(s){return s.isPositive()?"positive":s instanceof l?"number":"other"}),i=n.positive.concat(r.invoke(n.number,"abs"));return n.other.length&&i.push(new le(new p(n.other).flatten())),new p(i).flatten()}else return t},expand:function(){var e=this.recurse("expand");if(e.arg instanceof p){var t=r.map(e.arg.terms,function(n){return new le(n)});return new p(t)}else return e},isPositive:function(){return!0}});function re(e,t,n){this.left=e,this.type=t,this.right=n}re.prototype=new Q;r.extend(re.prototype,{func:re,args:function(){return[this.left,this.type,this.right]},needsExplicitMul:function(){return!1},print:function(){return this.left.print()+this.type+this.right.print()},signs:{"=":" = ","<":" < ",">":" > ","<>":" \\ne ","<=":" \\le ",">=":" \\ge "},tex:function(){return this.left.tex()+this.signs[this.type]+this.right.tex()},normalize:function(){var e=this.recurse("normalize");return r.contains([">",">="],e.type)?new re(e.right,e.type.replace(">","<"),e.left):e},asExpr:function(e){var t=function(y){return y instanceof l&&y.isSimple()&&y.eval()===0},n=[];this.left instanceof V?n=r.clone(this.left.terms):t(this.left)||(n=[this.left]),this.right instanceof V?n=n.concat(this.right.negate().terms):t(this.right)||n.push(this.right.negate());var i=!this.isEquality();n=r.invoke(n,"collect",{preciseFloats:!0});for(var s=0;s<n.length;s++){var u=n[s].getDenominator();i&&!u.isPositive()&&(u=u.asPositiveFactor()),u.equals(l.One)||(n=r.map(n,function(y){return p.createOrAppend(y,u).simplify({once:!0,preciseFloats:!0})}))}var f=new V(n).flatten();return e?f:this.divideThrough(f)},divideThrough:function(e){var t=!this.isEquality(),n=e.simplify({once:!0}),i=n.factor({keepNegative:t});if(!(i instanceof p))return e;var s=i.terms,u=function(a){return a instanceof V},f=function(a){return!!a.getVars().length},y=function(a){return a.equals(l.One)},g=r.groupBy(s,u),_=g[!0]||[],c=g[!1]||[];if(_.length&&this.isEquality())return new p(_).flatten();var o=c;_.length||(o=r.reject(o,f)),t&&(o=r.invoke(o,"asPositiveFactor")),o=r.reject(o,y),o=r.map(o,function(a){return new M(a,l.Div)});var h=new p(s.concat(o)).collect();return h.equals(i)?n:h},isEquality:function(){return r.contains(["=","<>"],this.type)},compare:function(e){if(!(e instanceof re))return!1;var t=this.normalize(),n=e.normalize();if(t.type!==n.type)return!1;var i=t.divideThrough(t.asExpr(!0).collect()),s=n.divideThrough(n.asExpr(!0).collect());return t.isEquality()?i.compare(s)||i.compare(p.handleNegative(s)):i.compare(s)},sameForm:function(e){var t=this.normalize(),n=e.normalize(),i=t.left.sameForm(n.left)&&t.right.sameForm(n.right);return t.isEquality()?i||t.left.sameForm(n.right)&&t.right.sameForm(n.left):i},isSimplified:function(){var e=this.asExpr(!0),t=this.divideThrough(e).simplify();return e.equals(t)&&this.left.isSimplified()&&this.right.isSimplified()}});r.extend(re.prototype,{solveLinearEquationForVariable:function(e){var t=this.asExpr();if(!t.is(V)||t.terms.length!==2)throw new Error("Can only handle linear equations of the form a + bx (= 0)");var n=function(u){return u.has(ye)&&r.contains(u.getVars(),e.symbol)},i,s;return n(t.terms[0])?(i=p.handleNegative(t.terms[1]),s=p.handleDivide(t.terms[0],e)):(i=p.handleNegative(t.terms[0]),s=p.handleDivide(t.terms[1],e)),p.handleDivide(i,s).simplify()}});function ie(){}ie.prototype=new Q;r.extend(ie.prototype,{needsExplicitMul:function(){return!1},findGCD:function(e){return e instanceof ie||e instanceof l?this.equals(e)?this:l.One:e.findGCD(this)}});function te(e,t){this.symbol=e,this.arg=t}te.prototype=new ie;r.extend(te.prototype,{func:te,args:function(){return[this.symbol,this.arg]},print:function(){return this.symbol+"("+this.arg.print()+")"},tex:function(){return this.symbol+"("+this.arg.tex()+")"},eval:function(e,t){var n=this.arg,i=e[this.symbol],s=r.extend(r.clone(e),{x:n.eval(e,t)}),u=Te(i,t);return u.parsed?u.expr.eval(s,t):u},codegen:function(){return'vars["'+this.symbol+'"]('+this.arg.codegen()+")"},getUnits:function(){return this.arg.getUnits()},getVars:function(e){return e?this.arg.getVars():r.union(this.arg.getVars(),[this.symbol]).sort()},getConsts:function(){return this.arg.getConsts()}});function ye(e,t){this.symbol=e,this.subscript=t}ye.prototype=new ie;r.extend(ye.prototype,{func:ye,args:function(){return[this.symbol,this.subscript]},exprArgs:function(){return[]},recurse:function(){return this},print:function(){var e="";return this.subscript&&(e="_("+this.subscript.print()+")"),this.symbol+e},prettyPrint:function(){var e=this.subscript;return e&&(e instanceof l||e instanceof ie)?this.symbol+"_"+e.print():this.print()},tex:function(){var e="";this.subscript&&(e="_{"+this.subscript.tex()+"}");var t=this.symbol.length>1?"\\":"";return t+this.symbol+e},repr:function(){return"Var("+this.print()+")"},eval:function(e,t){return e[this.prettyPrint()]},codegen:function(){return'vars["'+this.prettyPrint()+'"]'},getVars:function(){return[this.prettyPrint()]},isPositive:function(){return!1}});function W(e){this.symbol=e}W.prototype=new ie;r.extend(W.prototype,{func:W,args:function(){return[this.symbol]},recurse:function(){return this},eval:function(e,t){if(this.symbol==="pi")return Math.PI;if(this.symbol==="e")return Math.E},codegen:function(){if(this.symbol==="pi")return"Math.PI";if(this.symbol==="e")return"Math.E"},print:function(){return this.symbol},tex:function(){if(this.symbol==="pi")return"\\pi ";if(this.symbol==="e")return"e"},isPositive:function(){return this.eval()>0},abs:function(){return this.eval()>0?this:p.handleNegative(this)},getConsts:function(){return[this.print()]}});W.e=new W("e");W.pi=new W("pi");function l(){}l.prototype=new Q;r.extend(l.prototype,{repr:function(){return this.print()},strip:function(){return this.abs()},recurse:function(){return this},codegen:function(){return this.print()},add:Y,mul:Y,negate:Y,isSubtract:function(){return this.hints.subtract},abs:Y,needsExplicitMul:function(){return!0},findGCD:Y,isPositive:function(){return this.eval()>0},isNegative:function(){return this.eval()<0},asPositiveFactor:function(){return this.isPositive()?this:this.abs()},hints:r.extend(l.prototype.hints,{negate:!1,subtract:!1,divide:!1,root:!1,fraction:!1,entered:!1}),isSimple:Y,getDecimalPlaces:function(){var e=(""+this.n).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return e?Math.max(0,(e[1]?e[1].length:0)-(e[2]?+e[2]:0)):0},asRational:Y});function T(e,t){var n=e,i=t;i<0&&(n=-n,i=-i),this.n=n,this.d=i}T.prototype=new l;r.extend(T.prototype,{func:T,args:function(){return[this.n,this.d]},eval:function(){return this.n/this.d},print:function(){return this.n.toString()+"/"+this.d.toString()},tex:function(){var e="\\frac{"+Math.abs(this.n).toString()+"}{"+this.d.toString()+"}";return this.n<0?"-"+e:e},add:function(e,t){return e instanceof T?new T(this.n*e.d+this.d*e.n,this.d*e.d).collect():e.add(this,t)},mul:function(e,t){return e instanceof T?new T(this.n*e.n,this.d*e.d).collect():e.mul(this,t)},collect:function(){var e=l.findGCD(this.n,this.d),t=this.n/e,n=this.d/e;return n===1?new k(t):new T(t,n)},negate:function(){return new T(-this.n,this.d)},abs:function(){return new T(Math.abs(this.n),this.d)},findGCD:function(e){if(e instanceof T){var t=l.findGCD(this.n*e.d,e.n*this.d),n=this.d*e.d;return new T(t,n).collect()}else return e instanceof k?new T(l.findGCD(this.n,e.n),this.d):e.findGCD(this)},raiseToThe:function(e){if(e instanceof k){var t=e.eval()>0,n=e.abs().eval(),i=Math.pow(this.n,n),s=Math.pow(this.d,n);return t?new T(i,s).collect():new T(s,i).collect()}else return new F(this.eval()).raiseToThe(e)},getDenominator:function(){return new k(this.d)},isSimple:function(){return!1},asRational:function(){return this}});function k(e){this.n=e}k.prototype=new T(0,1);r.extend(k.prototype,{func:k,args:function(){return[this.n]},print:function(){return this.n.toString()},tex:function(){return this.n.toString()},negate:function(){return new k(-this.n)},abs:function(){return new k(Math.abs(this.n))},isSimple:function(){return!0},findGCD:function(e){return e instanceof k?new k(l.findGCD(this.n,e.n)):e.findGCD(this)}});r.extend(k,{create:function(e){return new k(e).addHint("entered")}});function F(e){this.n=e}F.prototype=new l;r.extend(F.prototype,{func:F,args:function(){return[this.n]},eval:function(){return this.n},print:function(){return this.n.toString()},tex:function(){return this.n.toString()},add:function(e,t){return t&&t.preciseFloats?F.toDecimalPlaces(this.n+e.eval(),Math.max(this.getDecimalPlaces(),e.getDecimalPlaces())):new F(this.n+e.eval()).collect()},mul:function(e,t){return t&&t.preciseFloats?F.toDecimalPlaces(this.n*e.eval(),this.getDecimalPlaces()+e.getDecimalPlaces()):new F(this.n*e.eval()).collect()},collect:function(){return this},negate:function(){return new F(-this.n)},abs:function(){return new F(Math.abs(this.n))},findGCD:function(e){return e instanceof l?new F(l.findGCD(this.eval(),e.eval())).collect():e.findGCD(this)},raiseToThe:function(e,t){return t&&t.preciseFloats&&e instanceof k&&e.n>1?F.toDecimalPlaces(new M(this,e).eval(),this.getDecimalPlaces()*e.n):new F(new M(this,e).eval()).collect()},asRational:function(){var e=this.n.toString().split(".");if(e.length===1)return new T(this.n,1);var t=Number(e.join("")),n=Math.pow(10,e[1].length);return new T(t,n).collect()},getDenominator:function(){return this.asRational().getDenominator()},isSimple:function(){return!0}});r.extend(F,{create:function(e){return new F(e).addHint("entered")},toDecimalPlaces:function(e,t){return new F(+e.toFixed(Math.min(t,20))).collect()}});r.extend(l,{negativeOne:function(e){return e==="subtract"?l.Sub:e==="divide"?l.Div:l.Neg},findGCD:function(e,t){var n;if(e=Math.abs(e),t=Math.abs(t),e!==Math.floor(e)||t!==Math.floor(t))return 1;for(;t;)n=e%t,e=t,t=n;return e},min:function(){return r.min(r.toArray(arguments),function(e){return e.eval()})},max:function(){return r.max(r.toArray(arguments),function(e){return e.eval()})}});l.Neg=new k(-1).addHint("negate");l.Sub=new k(-1).addHint("subtract");l.Div=new k(-1).addHint("divide");l.Sqrt=new T(1,2).addHint("root");l.Zero=new k(0);l.One=new k(1);l.Ten=new k(10);V.prototype.identity=l.Zero;p.prototype.identity=l.One;var je=function(e,t){throw new Error(t.loc.first_column)};he.yy={Add:V,Mul:p,Pow:M,Log:z,Trig:O,Eq:re,Abs:le,Func:te,Const:W,Var:ye,Int:k,Float:F,parseError:je,constants:["e"],symbolLexer:function(e){return r.contains(he.yy.constants,e)?"CONST":r.contains(he.yy.functions,e)?"FUNC":"VAR"}};const Te=function(e,t){try{t&&t.functions?he.yy.functions=r.without(t.functions,"i"):he.yy.functions=[],t&&t.decimal_separator&&(e=e.split(t.decimal_separator).join("."));var n=he.parse(e).completeParse();return{parsed:!0,expr:n}}catch(i){return{parsed:!1,error:i.message}}};function C(e){this.symbol=e}C.prototype=new ie;var Pe=function(e){if(r(Me).has(e)||r(de).has(e))return new C(e);var t=r(r(Oe).keys()).find(function(i){return new RegExp("^"+i).test(e)});if(t){var n=e.replace(new RegExp("^"+t),"");if(r(Me).has(n)||de[n]&&de[n].prefixes===q)return new p(Oe[t],new C(n));throw new Error(n+" does not allow prefixes")}else return new C(e)};const Ye=function(e){try{var t=He.parse(e),n=[];r(t.unit.num).each(function(f){n.push(new M(Pe(f.name),new k(f.pow)))}),r(t.unit.denom).each(function(f){n.push(new M(Pe(f.name),new k(-1*f.pow)))});var i=new p(n).flatten();if(t.type==="unitMagnitude"){var s=[new F(+t.magnitude)].concat(n),u=new p(s);return{parsed:!0,unit:i,expr:u,coefficient:t.magnitude,type:t.type}}else return{parsed:!0,unit:i,type:t.type}}catch(f){return{parsed:!1,error:f.message}}};r.extend(C.prototype,{func:C,args:function(){return[this.symbol]},recurse:function(){return this},eval:function(e,t){return 1},getUnits:function(){return[{unit:this.symbol,pow:1}]},codegen:function(){return"1"},print:function(){return this.symbol},tex:function(){return this.symbol},collect:function(e){if(r(Me).has(this.symbol))return this;if(r(de).has(this.symbol))return de[this.symbol].conversion;throw new Error("could not understand unit: "+this.symbol)}});var Me={m:new C("m"),g:new C("g"),s:new C("s"),A:new C("A"),K:new C("K"),mol:new C("mol"),cd:new C("cd")},Oe={a:new M(new k(10),new k(-18)),f:new M(new k(10),new k(-15)),p:new M(new k(10),new k(-12)),n:new M(new k(10),new k(-9)),u:new M(new k(10),new k(-6)),m:new M(new k(10),new k(-3)),c:new M(new k(10),new k(-2)),d:new M(new k(10),new k(-1)),da:new k(10),h:new M(new k(10),new k(2)),k:new M(new k(10),new k(3)),M:new M(new k(10),new k(6)),G:new M(new k(10),new k(9)),T:new M(new k(10),new k(12)),P:new M(new k(10),new k(15)),E:new M(new k(10),new k(18)),hella:new M(new k(10),new k(27))},q={},b={},v=function(e,t){var n=e.split("|"),i=n[0].trim(),s=n[1].trim(),u=l.One;i!==""&&(u=Te(i).expr);var f=s.split("/"),y=[u];return f[0]&&f[0].split(" ").filter(function(g){return g!==""}).map(function(g){y.push(new C(g))}),f[1]&&f[1].split(" ").filter(function(g){return g!==""}).map(function(g){y.push(new M(new C(g),l.Div))}),{conversion:new p(y),prefixes:t}},de={Da:v("1.6605388628 x 10^-24 | g",q),u:v("| Da",b),meter:v("| m",b),meters:v("| m",b),in:v("254 / 10000 | m",b),ft:v("3048  / 10000 | m",b),yd:v("9144  / 10000 | m",b),mi:v("1609344 / 1000 | m",b),ly:v("9.4607 x 10^15 | m",b),nmi:v("1852 | m",b),Å:v("10^-10 | m",b),pc:v("3.0857 x 10^16 | m",b),min:v("60 | s",b),hr:v("3600 | s",b),sec:v("| s",b),day:v("86400 | s",b),wk:v("604800 | s",b),fortnight:v("14 | day",b),shake:v("10^-8 | s",b),olympiad:v("126200000 | s",b),"°C":v("1 | K",b),"°F":v("5/9 | K",b),"°R":v("5/9 | K",b),e:v("1.6021765314 x 10^-19 | C",b),c:v("299792458 | m / s",b),kn:v("514/1000 | m / s",b),kt:v("| kn",b),knot:v("| kn",b),J:v("| N m",q),BTU:v("1060 | J",b),cal:v("4184 / 1000 | J",q),eV:v("1.602176514 x 10^-19 | J",q),erg:v("10^−7 | J",q),W:v("| J / s",q),"H-e":v("80 | W",b),N:v("1000 | g m / s s",q),lb:v("4448221615 / 1000000000 | N",b),dyn:v("10^-5 | N",b),Pa:v("1 | N / m m m",q),bar:v("10^5 | Pa",q),"㏔":v("1/1000 | bar",b),"㍴":v("| bar",b),atm:v("101325 | Pa",b),Torr:v("1/760 | atm",b),mmHg:v("| Torr",b),ha:v("10^4 | m m",b),b:v("10^−28 | m m",q),barn:v("| b",q),acre:v("4046.87 | m m",b),skilodge:v("10^-31 | m m",b),outhouse:v("10^-34 | m m",b),shed:v("10^-52 | m m",b),L:v("1/1000 | m m m",q),gal:v("3785/1000 | L",q),cup:v("1/16 | gal",b),qt:v("1/4 | gal",b),quart:v("| qt",b),p:v("1/8 | gal",b),pt:v("| p",b),pint:v("| p",b),"fl oz":v("1/8 | cup",b),"fl. oz.":v("1/8 | cup",b),tbsp:v("1/16 | cup",b),tsp:v("1/3 | tbsp",b),rev:v("2 pi | rad",b),deg:v("180 pi | rad",b),"°":v("| deg",b),arcminute:v("1/60 | deg",b),arcsec:v("1/3600 | deg",b),Hu:v("1000 | dB",q),dozen:v("12 |",b),mol:v("6.0221412927 x 10^23 |",q),"%":v("1/100 |",b),percent:v("| %",b),ppm:v("1/1000000 |",b),V:v("1000 | g m m / s s C",q),C:v("| A s",q),ampere:v("| A",b),Ω:v("| V / A",q),ohm:v("| Ω",b),F:v("| C / V",q),H:v("| ohm s",q),T:v("1000 | g / C s",q),Wb:v("1000 | g m m / C s",q),lm:v("pi x 10^4 | cd / m m",b),lx:v("| lm / m m",b),nit:v("| cd / m m",b),sb:v("10^4 | cd / m m",b),stilb:v("1 | sb",b),apostilb:v("1 / pi x 10^(-4) | sb",b),blondel:v("| apostilb",b),asb:v("| apostilb",b),la:v("| lm",b),Lb:v("| lm",b),sk:v("10^-7 | lm",b),skot:v("| sk",b),bril:v("10^-11 | lm",b),Hz:v("| / s",q)};l.Zero;l.One;const Je=function(e,t,n){var i={form:!1,simplify:!1};n!==void 0?n=r.extend(i,n):n=i;var s=e.sameVars(t);if(!s.equal){var u;return s.equalIgnoringCase?u="Check your variables; one or more are using the wrong case (upper or lower).":u="Check your variables; you may have used the wrong letter for one or more of them.",{equal:!1,wrongVariableCase:s.equalIgnoringCase,wrongVariableNames:!s.equalIgnoringCase,message:u}}return e.compare(t)?n.form&&!e.sameForm(t)?{equal:!1,message:"Your answer is not in the correct form."}:n.simplify&&!e.isSimplified()?{equal:!1,message:"Your answer is not fully expanded and simplified."}:{equal:!0,message:null}:{equal:!1,message:null}};export{re as E,p as M,ye as V,Je as c,Te as p,Ye as u};
