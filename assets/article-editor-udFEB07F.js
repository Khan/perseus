import{j as t,a as i}from"./jsx-runtime-FVsy8kgq.js";import"./article-renderer-jbklylbA.js";import{_ as o}from"./jquery-yG1GhClm.js";import{P as p,E as u}from"./util-XR-uqOh-.js";import{B as w}from"./phet-simulation-AAtfWFw-.js";import"./version-akiLXZts.js";import"./dependencies-d8cZibFS.js";import{A as h}from"./perseus-api-Nq3s7IMx.js";import"./perseus-item-SJVPWOrx.js";import"./hints-renderer-ex8ioeAw.js";import"./renderer-A4Q8-2V-.js";import"./base-radio-LJP1VAc6.js";import{c as R}from"./components-QiqQ71b-.js";import{i as _}from"./icon-paths-5JCXzGsq.js";import"./index-k-0mNqHS.js";import"./i18n-context-P5sgPFep.js";import"./svg-image-h96M64n1.js";import"./index-IIMKO4_x.js";import{r as P}from"./index-TT1qJ6UJ.js";import{D as b}from"./device-framer-eGajQcXC.js";import{c as f,a as v,I as C,J as A}from"./register-all-widgets-and-editors-for-testing-B-obf4nx.js";import{S as m}from"./section-control-button-AMyxGSBX.js";import{E as S}from"./editor-FXEchzWL.js";import{i as y,a as j,b as E}from"./icon-paths-EoBkHOLI.js";const{HUD:k,InlineIcon:N}=R,c=class c extends P.Component{constructor(n){super(n),this._handleJsonChange=a=>{this.props.onChange({json:a})},this._handleEditorChange=(a,l)=>{const s=o.clone(this._sections());s[a]=o.extend({},s[a],l),this.setState({json:s}),this.props.onChange({json:s})};const e=n.json instanceof Array?n.json.map(f).reduce((a,l)=>a&&l,!1):f(n.json);let r=n.json;e&&(r=n.json instanceof Array?n.json.map(v):v(n.json)),this.state={highlightLint:!0,json:r,conversionWarningRequired:e}}componentDidMount(){this._updatePreviewFrames()}componentDidUpdate(){this._updatePreviewFrames()}_updatePreviewFrames(){this.props.mode==="preview"?this.refs["frame-all"].sendNewData({type:"article-all",data:this._sections().map((n,e)=>this._apiOptionsForSection(n,e))}):this.props.mode==="edit"&&this._sections().forEach((n,e)=>{this.refs["frame-"+e].sendNewData({type:"article",data:this._apiOptionsForSection(n,e)})})}_apiOptionsForSection(n,e){const r=this.refs[`editor${e}`];return{apiOptions:{...h.defaults,...this.props.apiOptions,showAlignmentOptions:!0,isArticle:!0},json:n,useNewStyles:this.props.useNewStyles,linterContext:{contentType:"article",highlightLint:this.state.highlightLint,paths:this.props.contentPaths},legacyPerseusLint:r?r.getSaveWarnings():[]}}_sections(){return(Array.isArray(this.state.json)?this.state.json:[this.state.json]).filter(e=>e!==null)}_renderEditor(){const{imageUploader:n,sectionImageUploadGenerator:e}=this.props,r={...h.defaults,...this.props.apiOptions,showAlignmentOptions:!0,isArticle:!0},a=this._sections();return i("div",{className:"perseus-editor-table",children:[a.map((l,s)=>[i("div",{className:"perseus-editor-row",children:[i("div",{className:"perseus-editor-left-cell",children:[i("div",{className:"pod-title",children:["Section ",s+1,i("div",{style:{display:"inline-block",float:"right"},children:[e(s),t(m,{icon:y,onClick:()=>{this._handleAddSectionAfter(s)},title:"Add a new section after this one"}),s+1<a.length&&t(m,{icon:j,onClick:()=>{this._handleMoveSectionLater(s)},title:"Move this section down"}),s>0&&t(m,{icon:E,onClick:()=>{this._handleMoveSectionEarlier(s)},title:"Move this section up"}),t(m,{icon:_,onClick:()=>{const g="Are you sure you want to delete section "+(s+1)+"?";confirm(g)&&this._handleRemoveSection(s)},title:"Delete this section"})]})]}),t(S,{...l,apiOptions:r,imageUploader:n,onChange:o.partial(this._handleEditorChange,s),placeholder:"Type your section text here...",ref:"editor"+s})]}),t("div",{className:"editor-preview",children:this._renderIframePreview(s,!0)})]},s)]),this._renderAddSection(),this._renderLinterHUD()]})}_renderAddSection(){return t("div",{className:"perseus-editor-row",children:t("div",{className:"perseus-editor-left-cell",children:i("a",{href:"#",className:"simple-button orange",onClick:()=>{this._handleAddSectionAfter(this._sections().length-1)},children:[t(N,{...y})," Add a section"]})})})}_renderLinterHUD(){return t(k,{message:"Style warnings",enabled:this.state.highlightLint,onClick:()=>{this.setState({highlightLint:!this.state.highlightLint})}})}_renderIframePreview(n,e){const r=this.props.screen==="phone"||this.props.screen==="tablet";return t(b,{deviceType:this.props.screen,nochrome:e,children:t(C,{ref:"frame-"+n,datasetKey:"mobile",datasetValue:r,seamless:e,url:this.props.previewURL},this.props.screen)})}_renderPreviewMode(){return t("div",{className:"standalone-preview",children:this._renderIframePreview("all",!1)})}_handleMoveSectionEarlier(n){if(n===0)return;const e=o.clone(this._sections()),r=e[n];e.splice(n,1),e.splice(n-1,0,r),this.props.onChange({json:e})}_handleMoveSectionLater(n){const e=o.clone(this._sections());if(n+1===e.length)return;const r=e[n];e.splice(n,1),e.splice(n+1,0,r),this.props.onChange({json:e})}_handleAddSectionAfter(n){const e=o.clone(this.serialize()),r=n>=0?{widgets:e[n].widgets}:{};e.splice(n+1,0,r),this.props.onChange({json:e})}_handleRemoveSection(n){const e=o.clone(this._sections());e.splice(n,1),this.props.onChange({json:e})}serialize(){if(this.props.mode==="edit")return this._sections().map((n,e)=>this.refs["editor"+e].serialize());if(this.props.mode==="preview"||this.props.mode==="json")return this.state.json;throw new p("Could not serialize; mode "+this.props.mode+" not found",u.Internal)}getSaveWarnings(){if(this.props.mode!=="edit")throw new p("Can only get save warnings in edit mode.",u.NotAllowed);return this._sections().map((n,e)=>this.refs["editor"+e].getSaveWarnings())}render(){return i("div",{className:"framework-perseus perseus-article-editor",children:[this.state.conversionWarningRequired&&t("div",{style:{marginBottom:10},children:t(w,{text:"Deprecated Input Number Widgets were found, and have been automatically upgraded to Numeric Inputs. Please review the changes before publishing.",kind:"warning",layout:"floating"})}),this.props.mode==="edit"&&this._renderEditor(),this.props.mode==="preview"&&this._renderPreviewMode(),this.props.mode==="json"&&i("div",{className:"json-editor",children:[t("div",{className:"json-editor-warning",children:t("span",{children:"Warning: Editing in this mode can lead to broken articles!"})}),t(A,{multiLine:!0,onChange:this._handleJsonChange,value:this.state.json})]})]})}};c.defaultProps={contentPaths:[],json:[],mode:"edit",screen:"desktop",sectionImageUploadGenerator:()=>t("span",{}),useNewStyles:!1};let d=c;d.__docgenInfo={description:"",methods:[{name:"_updatePreviewFrames",docblock:null,modifiers:[],params:[],returns:null},{name:"_apiOptionsForSection",docblock:null,modifiers:[],params:[{name:"section",optional:!1,type:{name:"PerseusRenderer",alias:"PerseusRenderer"}},{name:"sectionIndex",optional:!1,type:{name:"number"}}],returns:{type:{name:"any"}}},{name:"_sections",docblock:null,modifiers:[],params:[],returns:{type:{name:"Array",elements:[{name:"PerseusRenderer"}],raw:"PerseusRenderer[]"}}},{name:"_renderEditor",docblock:null,modifiers:[],params:[],returns:{type:{name:"ReactReactElement",raw:'React.ReactElement<React.ComponentProps<"div">>',elements:[{name:"ReactComponentProps",raw:'React.ComponentProps<"div">',elements:[{name:"literal",value:'"div"'}]}]}}},{name:"_renderAddSection",docblock:null,modifiers:[],params:[],returns:{type:{name:"ReactReactElement",raw:'React.ReactElement<React.ComponentProps<"div">>',elements:[{name:"ReactComponentProps",raw:'React.ComponentProps<"div">',elements:[{name:"literal",value:'"div"'}]}]}}},{name:"_renderLinterHUD",docblock:null,modifiers:[],params:[],returns:{type:{name:"ReactReactElement",raw:"React.ReactElement<any>",elements:[{name:"any"}]}}},{name:"_renderIframePreview",docblock:null,modifiers:[],params:[{name:"i",optional:!1,type:{name:"union",raw:"number | string",elements:[{name:"number"},{name:"string"}]}},{name:"nochrome",optional:!1,type:{name:"boolean"}}],returns:{type:{name:"ReactReactElement",raw:"React.ReactElement<any>",elements:[{name:"any"}]}}},{name:"_renderPreviewMode",docblock:null,modifiers:[],params:[],returns:{type:{name:"ReactReactElement",raw:'React.ReactElement<React.ComponentProps<"div">>',elements:[{name:"ReactComponentProps",raw:'React.ComponentProps<"div">',elements:[{name:"literal",value:'"div"'}]}]}}},{name:"_handleJsonChange",docblock:null,modifiers:[],params:[{name:"newJson",optional:!1,type:null}],returns:null},{name:"_handleEditorChange",docblock:null,modifiers:[],params:[{name:"i",optional:!1,type:null},{name:"newProps",optional:!1,type:null}],returns:null},{name:"_handleMoveSectionEarlier",docblock:null,modifiers:[],params:[{name:"i",optional:!1,type:{name:"number"}}],returns:null},{name:"_handleMoveSectionLater",docblock:null,modifiers:[],params:[{name:"i",optional:!1,type:{name:"number"}}],returns:null},{name:"_handleAddSectionAfter",docblock:null,modifiers:[],params:[{name:"i",optional:!1,type:{name:"number"}}],returns:null},{name:"_handleRemoveSection",docblock:null,modifiers:[],params:[{name:"i",optional:!1,type:{name:"number"}}],returns:null},{name:"serialize",docblock:null,modifiers:[],params:[],returns:{type:{name:"union",raw:"PerseusRenderer | PerseusRenderer[]",elements:[{name:"PerseusRenderer"},{name:"Array",elements:[{name:"PerseusRenderer"}],raw:"PerseusRenderer[]"}]}}},{name:"getSaveWarnings",docblock:`Returns an array, with one element be section.
Each element is an array of lint warnings present in that section.

This function can currently only be called in edit mode.`,modifiers:[],params:[],returns:{type:{name:"ReadonlyArray",elements:[{name:"PerseusRenderer"}],raw:"ReadonlyArray<PerseusRenderer>"}},description:`Returns an array, with one element be section.
Each element is an array of lint warnings present in that section.

This function can currently only be called in edit mode.`}],displayName:"ArticleEditor",props:{contentPaths:{required:!1,tsType:{name:"ReadonlyArray",elements:[{name:"string"}],raw:"ReadonlyArray<string>"},description:"",defaultValue:{value:"[]",computed:!1}},json:{required:!1,tsType:{name:"union",raw:"PerseusRenderer | PerseusRenderer[]",elements:[{name:"PerseusRenderer"},{name:"Array",elements:[{name:"PerseusRenderer"}],raw:"PerseusRenderer[]"}]},description:"",defaultValue:{value:"[]",computed:!1}},mode:{required:!1,tsType:{name:"union",raw:'"diff" | "edit" | "json" | "preview"',elements:[{name:"literal",value:'"diff"'},{name:"literal",value:'"edit"'},{name:"literal",value:'"json"'},{name:"literal",value:'"preview"'}]},description:"",defaultValue:{value:'"edit"',computed:!1}},screen:{required:!1,tsType:{name:"union",raw:'"phone" | "tablet" | "desktop"',elements:[{name:"literal",value:'"phone"'},{name:"literal",value:'"tablet"'},{name:"literal",value:'"desktop"'}]},description:"",defaultValue:{value:'"desktop"',computed:!1}},sectionImageUploadGenerator:{required:!1,tsType:{name:"signature",type:"function",raw:`(
    i: number,
) => React.ReactElement<React.ComponentProps<"span">>`,signature:{arguments:[{type:{name:"number"},name:"i"}],return:{name:"ReactReactElement",raw:'React.ReactElement<React.ComponentProps<"span">>',elements:[{name:"ReactComponentProps",raw:'React.ComponentProps<"span">',elements:[{name:"literal",value:'"span"'}]}]}}},description:"",defaultValue:{value:"() => <span />",computed:!1}},useNewStyles:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},apiOptions:{required:!1,tsType:{name:"APIOptions"},description:""},imageUploader:{required:!1,tsType:{name:"ImageUploader"},description:""},previewURL:{required:!0,tsType:{name:"string"},description:""}}};export{d as A};
