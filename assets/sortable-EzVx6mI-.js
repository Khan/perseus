import{j as p}from"./jsx-runtime-63Ea5SlK.js";import{l as S,R as T,p as A}from"./renderer-wMIfRMtJ.js";import{C}from"./index-wB6JGB7j.js";import{l as k}from"./index-awljIyHI.js";import{$ as m}from"./jquery-5v7aFUvu.js";import{r as q}from"./index-6oxdNXpR.js";import{F as y}from"./index-9gkyvru-.js";import{_ as i}from"./index-default-4_ZsnO94.js";import{g as I}from"./dependencies-CP7Uh8Kq.js";import{C as U}from"./perseus-api-_PWPZoDE.js";import{U as v}from"./util-FOHsj4WS.js";import{P as D}from"./i18n-context-QDJ9FYgZ.js";const P=(R,e)=>{const t=R.offsetParent();return{top:e.top+t.scrollTop(),left:e.left+t.scrollLeft()}};class j extends q.Component{render(){const{layout:e}=this.props,t=k.css(h.card,h.placeholder,e==="horizontal"&&h.horizontalCard),n={width:this.props.width,height:this.props.height};return this.props.margin!=null&&(n.margin=this.props.margin),p.jsx("li",{className:t,style:n})}}const M=class M extends q.Component{constructor(){super(...arguments),this.animationFrameRequest=null,this.state={startPosition:{left:0,top:0},startMouse:{left:0,top:0},mouse:{left:0,top:0},dragging:!1},this.getCurrentPosition=()=>({left:this.state.startPosition.left+this.state.mouse.left-this.state.startMouse.left,top:this.state.startPosition.top+this.state.mouse.top-this.state.startMouse.top}),this.bindMouseMoveUp=()=>{this.isMouseMoveUpBound=!0,m(document).on("mousemove",this.onMouseMove),m(document).on("mouseup",this.onMouseUp)},this.unbindMouseMoveUp=()=>{this.isMouseMoveUpBound=!1,m(document).off("mousemove",this.onMouseMove),m(document).off("mouseup",this.onMouseUp)},this.onMouseDown=e=>{if(this.props.state!=="static"||!(e.button===0||e.touches!=null&&e.touches.length===1))return;e.preventDefault();const t=v.extractPointerLocation(e);this.animationFrameRequest=requestAnimationFrame(()=>{const n=m(y.findDOMNode(this)),r=n.position(),o=P(n,r);t&&this._mounted&&this.setState({startPosition:o,startMouse:t,mouse:t,dragging:!0},function(){this.bindMouseMoveUp(),this.props.onMouseDown()})})},this.onMouseMove=e=>{if(this.props.state!=="dragging"||!this.state.dragging)return;e.preventDefault();const n=v.extractPointerLocation(e);n&&(this.animationFrameRequest=requestAnimationFrame(()=>{this.setState({mouse:n},this.props.onMouseMove)}))},this.onMouseUp=e=>{if(this.props.state!=="dragging"||!this.state.dragging)return;e.preventDefault(),v.extractPointerLocation(e)&&(this.setState({dragging:!1}),this.unbindMouseMoveUp(),this.props.onMouseUp())}}componentDidMount(){this._mounted=!0,this.isMouseMoveUpBound=!1,document.addEventListener("touchmove",this.onMouseMove,v.supportsPassiveEvents()?{passive:!1}:!1)}componentDidUpdate(e){if(this.props.state!==e.state)if(this.props.state==="animating"&&this.props.endPosition){const t=this.getCurrentPosition(),n=15*Math.sqrt(Math.sqrt(Math.pow(this.props.endPosition.left-t.left,2)+Math.pow(this.props.endPosition.top-t.top,2)));m(y.findDOMNode(this)).animate(this.props.endPosition,{duration:Math.max(n,1),complete:this.props.onAnimationEnd})}else this.props.state==="static"&&m(y.findDOMNode(this)).finish()}componentWillUnmount(){this._mounted=!1,this.isMouseMoveUpBound&&this.unbindMouseMoveUp(),this.animationFrameRequest&&cancelAnimationFrame(this.animationFrameRequest),document.removeEventListener("touchmove",this.onMouseMove)}render(){const{includePadding:e,layout:t,state:n}=this.props;let r=k.css(h.card,h.draggable,t==="horizontal"&&h.horizontalCard,t==="vertical"&&h.verticalCard,n==="dragging"&&h.dragging,n==="disabled"&&h.disabled,!e&&h.unpaddedCard)+" "+U.INTERACTIVE+" perseus-sortable-draggable";e||(r+=" perseus-sortable-draggable-unpadded");const o={position:"static"};return(this.props.state==="dragging"||this.props.state==="animating")&&i.extend(o,{position:"absolute"},this.getCurrentPosition()),this.props.width&&(o.width=this.props.width+1),this.props.height&&(o.height=this.props.height),this.props.margin!=null&&(o.margin=this.props.margin),p.jsx("li",{className:r,style:o,onMouseDown:this.onMouseDown,onTouchStart:this.onMouseDown,onTouchMove:this.onMouseMove,onTouchEnd:this.onMouseUp,onTouchCancel:this.onMouseUp,children:p.jsx(T,{content:this.props.content,linterContext:A(this.props.linterContext,"draggable"),onRender:this.props.onRender,strings:this.context.strings})})}};M.contextType=D,M.defaultProps={includePadding:!0,type:"static",linterContext:S};let w=M;const g=class g extends q.Component{constructor(e){super(e),this.remeasureItems=i.debounce(()=>{this.setState({items:g.clearItemMeasurements(this.state.items)})},20),this.state={items:g.itemsFromProps(this.props),texRendererLoaded:!1}}static itemsFromProps(e){const t=e.disabled?"disabled":"static";return e.options.map((n,r)=>({option:n,key:r,state:t,width:0,height:0}))}static clearItemMeasurements(e){return e.map(t=>({...t,width:0,height:0}))}UNSAFE_componentWillReceiveProps(e){const t=this.props;i.isEqual(e.options,t.options)?(e.layout!==t.layout||e.padding!==t.padding||e.disabled!==t.disabled||!i.isEqual(e.constraints,t.constraints))&&this.setState({items:g.clearItemMeasurements(this.state.items)}):this.setState({items:g.itemsFromProps(e)})}componentDidUpdate(){this.state.items.length&&!this.state.items[0].width&&!this.state.items[0].height&&setTimeout(()=>{this.measureItems()},0)}measureItems(){let e=[...this.state.items];const t=i.map(e,function(a){return m(y.findDOMNode(this.refs[a.key]))},this),n=i.invoke(t,"outerWidth"),r=i.invoke(t,"outerHeight"),{constraints:o,layout:u}=this.props;let l=null;o!=null&&o.width?l=i.max(n.concat(o.width)):u==="vertical"&&(l=i.max(n));let s=null;o!=null&&o.height?s=i.max(r.concat(o.height)):u==="horizontal"&&(s=i.max(r)),e=i.map(e,function(a,d){return a.width=l||n[d],a.height=s||r[d],a}),this.setState({items:e},()=>{var a,d;(d=(a=this.props).onMeasure)==null||d.call(a,{widths:n,heights:r})})}onMouseDown(e){const t=i.map(this.state.items,function(n){return n.key===e&&(n.state="dragging"),n});this.setState({items:t})}moveOptionToIndex(e,t){var l,s;const{items:n}=this.state;if(t<0||t>n.length)throw new Error(`index ${t} out of bounds`);const r=i.clone(n),o=n.filter(a=>a.option===e)[0];if(o==null)throw new Error(`option ${e} not found`);const u=n.findIndex(a=>a.key===o.key);r.splice(u,1),r.splice(t,0,o),this.setState({items:r}),(s=(l=this.props).onChange)==null||s.call(l,{})}onMouseMove(e){const t=m(y.findDOMNode(this.refs[e])),n=m(y.findDOMNode(this)),r=i.clone(this.state.items),o=i.findWhere(this.state.items,{key:e}),u=this.props.margin||0,l=i.indexOf(r,o);let s=0;if(r.splice(l,1),this.props.layout==="horizontal"){const a=t.offset().left-n.offset().left;let d=0,c;i.each(r,function(f){c=f.width,a>d+c/2&&(s+=1),d+=c+u})}else{const a=t.offset().top-n.offset().top;let d=0,c;i.each(r,function(f){c=f.height,a>d+c/2&&(s+=1),d+=c+u})}s!==l&&(r.splice(s,0,o),this.setState({items:r}))}onMouseUp(e){const t=requestAnimationFrame(()=>{var r,o;const n=i.map(this.state.items,function(u){if(u.key===e){u.state="animating";const l=m(y.findDOMNode(this.refs["placeholder_"+e])),s=l.position(),a=P(l,s);u.endPosition=a}return u},this);this.setState({items:n}),(o=(r=this.props).onChange)==null||o.call(r,{})});this.animationFrameRequest=t}onAnimationEnd(e){const t=i.map(this.state.items,function(n){return n.key===e&&(n.state="static"),n});this.setState({items:t})}getOptions(){return i.pluck(this.state.items,"option")}render(){var u,l;if(this.props.waitForTexRendererToLoad&&!this.state.texRendererLoaded){const{TeX:s}=I();return p.jsxs(p.Fragment,{children:[p.jsx(C,{}),p.jsx("div",{style:{display:"none"},children:p.jsx(s,{onRender:()=>this.setState({texRendererLoaded:!0}),children:"1"})})]})}const e=[],{layout:t}=this.props,n=k.css(h.sortable)+" perseus-sortable",r=((u=this.props.constraints)==null?void 0:u.width)||t==="vertical",o=((l=this.props.constraints)==null?void 0:l.height)||t==="horizontal";return i.each(this.state.items,function(s,a,d){const c=a===d.length-1,f=s.state==="static"||s.state==="disabled";let b;this.props.layout==="horizontal"?b="0 "+this.props.margin+"px 0 0":this.props.layout==="vertical"&&(b="0 0 "+this.props.margin+"px 0"),e.push(p.jsx(w,{content:s.option,state:s.state,ref:s.key,width:r?s.width:void 0,height:o?s.height:void 0,layout:t,includePadding:this.props.padding,margin:c&&f?0:b,endPosition:s.endPosition,linterContext:A(this.props.linterContext,"sortable"),onRender:this.remeasureItems,onMouseDown:this.onMouseDown.bind(this,s.key),onMouseMove:this.onMouseMove.bind(this,s.key),onMouseUp:this.onMouseUp.bind(this,s.key),onTouchMove:this.onMouseMove.bind(this,s.key),onTouchEnd:this.onMouseUp.bind(this,s.key),onTouchCancel:this.onMouseUp.bind(this,s.key),onAnimationEnd:this.onAnimationEnd.bind(this,s.key)},s.key)),(s.state==="dragging"||s.state==="animating")&&e.push(p.jsx(j,{ref:"placeholder_"+s.key,width:s.width,height:s.height,layout:t,margin:c?0:b},"placeholder_"+s.key))},this),p.jsx("ul",{className:n,children:e})}};g.defaultProps={layout:"horizontal",padding:!0,disabled:!1,constraints:{},onMeasure:function(){},margin:5,onChange:function(){},linterContext:S,waitForTexRendererToLoad:!0};let x=g;const h=k.StyleSheet.create({sortable:{boxSizing:"border-box",float:"left",padding:0,margin:0},card:{boxSizing:"border-box",background:"#fff",border:"1px solid #ddd",borderRadius:4,cursor:"pointer",minWidth:25,minHeight:44,padding:10,listStyleType:"none",userSelect:"none",touchAction:"none"},placeholder:{background:"#ddd",border:"1px solid #ccc"},draggable:{textAlign:"center"},horizontalCard:{float:"left",cursor:"ew-resize"},verticalCard:{maxWidth:"100%",cursor:"ns-resize"},unpaddedCard:{padding:0},dragging:{background:"#ffedcd",opacity:.8},disabled:{backgroundColor:"inherit",border:"1px solid transparent",cursor:"default"}});x.__docgenInfo={description:"",methods:[{name:"itemsFromProps",docblock:null,modifiers:["static"],params:[{name:"props",optional:!1,type:{name:"signature",type:"object",raw:`{
    disabled: boolean;
    options: ReadonlyArray<SortableOption>;
}`,signature:{properties:[{key:"disabled",value:{name:"boolean",required:!0}},{key:"options",value:{name:"ReadonlyArray",elements:[{name:"string"}],raw:"ReadonlyArray<SortableOption>",required:!0}}]}}}],returns:{type:{name:"ReadonlyArray",elements:[{name:"signature",type:"object",raw:`{
    option: SortableOption;
    key: number;
    state: ItemState;
    endPosition?: Position;
    width: number;
    height: number;
}`,signature:{properties:[{key:"option",value:{name:"string",required:!0}},{key:"key",value:{name:"number",required:!0}},{key:"state",value:{name:"ItemState",required:!0}},{key:"endPosition",value:{name:"signature",type:"object",raw:`{
    top: number;
    left: number;
}`,signature:{properties:[{key:"top",value:{name:"number",required:!0}},{key:"left",value:{name:"number",required:!0}}]},required:!1}},{key:"width",value:{name:"number",required:!0}},{key:"height",value:{name:"number",required:!0}}]}}],raw:"ReadonlyArray<SortableItem>"}}},{name:"clearItemMeasurements",docblock:null,modifiers:["static"],params:[{name:"items",optional:!1,type:{name:"ReadonlyArray",elements:[{name:"signature",type:"object",raw:`{
    option: SortableOption;
    key: number;
    state: ItemState;
    endPosition?: Position;
    width: number;
    height: number;
}`,signature:{properties:[{key:"option",value:{name:"string",required:!0}},{key:"key",value:{name:"number",required:!0}},{key:"state",value:{name:"ItemState",required:!0}},{key:"endPosition",value:{name:"signature",type:"object",raw:`{
    top: number;
    left: number;
}`,signature:{properties:[{key:"top",value:{name:"number",required:!0}},{key:"left",value:{name:"number",required:!0}}]},required:!1}},{key:"width",value:{name:"number",required:!0}},{key:"height",value:{name:"number",required:!0}}]}}],raw:"ReadonlyArray<SortableItem>",alias:"ReadonlyArray"}}],returns:{type:{name:"ReadonlyArray",elements:[{name:"signature",type:"object",raw:`{
    option: SortableOption;
    key: number;
    state: ItemState;
    endPosition?: Position;
    width: number;
    height: number;
}`,signature:{properties:[{key:"option",value:{name:"string",required:!0}},{key:"key",value:{name:"number",required:!0}},{key:"state",value:{name:"ItemState",required:!0}},{key:"endPosition",value:{name:"signature",type:"object",raw:`{
    top: number;
    left: number;
}`,signature:{properties:[{key:"top",value:{name:"number",required:!0}},{key:"left",value:{name:"number",required:!0}}]},required:!1}},{key:"width",value:{name:"number",required:!0}},{key:"height",value:{name:"number",required:!0}}]}}],raw:"ReadonlyArray<SortableItem>"}}},{name:"measureItems",docblock:null,modifiers:[],params:[],returns:null},{name:"onMouseDown",docblock:null,modifiers:[],params:[{name:"key",optional:!1,type:{name:"number",raw:'SortableItem["key"]'}}],returns:null},{name:"moveOptionToIndex",docblock:null,modifiers:[],params:[{name:"option",optional:!1,type:{name:"string",alias:"SortableOption"}},{name:"index",optional:!1,type:{name:"number"}}],returns:null},{name:"onMouseMove",docblock:null,modifiers:[],params:[{name:"key",optional:!1,type:{name:"number",raw:'SortableItem["key"]'}}],returns:null},{name:"onMouseUp",docblock:null,modifiers:[],params:[{name:"key",optional:!1,type:{name:"number",raw:'SortableItem["key"]'}}],returns:null},{name:"onAnimationEnd",docblock:null,modifiers:[],params:[{name:"key",optional:!1,type:{name:"number",raw:'SortableItem["key"]'}}],returns:null},{name:"getOptions",docblock:null,modifiers:[],params:[],returns:{type:{name:"ReadonlyArray",elements:[{name:"string"}],raw:"ReadonlyArray<SortableOption>"}}}],displayName:"Sortable",props:{constraints:{required:!1,tsType:{name:"union",raw:`| {
      width: number;
      height: number;
  }
| Record<any, any>`,elements:[{name:"signature",type:"object",raw:`{
    width: number;
    height: number;
}`,signature:{properties:[{key:"width",value:{name:"number",required:!0}},{key:"height",value:{name:"number",required:!0}}]}},{name:"Record",elements:[{name:"any"},{name:"any"}],raw:"Record<any, any>"}]},description:"",defaultValue:{value:"{}",computed:!1}},disabled:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},layout:{required:!1,tsType:{name:"union",raw:'"horizontal" | "vertical"',elements:[{name:"literal",value:'"horizontal"'},{name:"literal",value:'"vertical"'}]},description:"",defaultValue:{value:'"horizontal"',computed:!1}},margin:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"5",computed:!1}},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(arg1: any) => void",signature:{arguments:[{type:{name:"any"},name:"arg1"}],return:{name:"void"}}},description:"",defaultValue:{value:"function () {}",computed:!1}},onMeasure:{required:!1,tsType:{name:"signature",type:"function",raw:`(arg1: {
    widths: ReadonlyArray<number>;
    heights: ReadonlyArray<number>;
}) => void`,signature:{arguments:[{type:{name:"signature",type:"object",raw:`{
    widths: ReadonlyArray<number>;
    heights: ReadonlyArray<number>;
}`,signature:{properties:[{key:"widths",value:{name:"ReadonlyArray",elements:[{name:"number"}],raw:"ReadonlyArray<number>",required:!0}},{key:"heights",value:{name:"ReadonlyArray",elements:[{name:"number"}],raw:"ReadonlyArray<number>",required:!0}}]}},name:"arg1"}],return:{name:"void"}}},description:"",defaultValue:{value:"function () {}",computed:!1}},padding:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},linterContext:{required:!1,tsType:{name:"signature",type:"object",raw:`{
    contentType: string;
    highlightLint: boolean;
    paths: ReadonlyArray<string>;
    stack: ReadonlyArray<string>;
    // additional properties can be added to the context by widgets
}`,signature:{properties:[{key:"contentType",value:{name:"string",required:!0}},{key:"highlightLint",value:{name:"boolean",required:!0}},{key:"paths",value:{name:"ReadonlyArray",elements:[{name:"string"}],raw:"ReadonlyArray<string>",required:!0}},{key:"stack",value:{name:"ReadonlyArray",elements:[{name:"string"}],raw:"ReadonlyArray<string>",required:!0}}]}},description:"",defaultValue:{value:`{
    contentType: "",
    highlightLint: false,
    paths: [] as ReadonlyArray<any>,
    stack: [] as ReadonlyArray<any>,
}`,computed:!1}},options:{required:!0,tsType:{name:"ReadonlyArray",elements:[{name:"string"}],raw:"ReadonlyArray<SortableOption>"},description:""},waitForTexRendererToLoad:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}}}};export{x as S};
