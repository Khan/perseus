import{a as r,j as n}from"./jsx-runtime-BGVbfQ2Z.js";import"./article-renderer--ZiYYddj.js";import{_ as l}from"./index-default-4_ZsnO94.js";import{U as c}from"./util-WvQWLN3r.js";import{c as f}from"./unit-uxf7imOh.js";import"./dependencies-fnqF3NiV.js";import"./perseus-api-BF68z3pH.js";import"./multi-renderer-RSzPxGU4.js";import"./hints-renderer-RuVSOigB.js";import"./renderer-RSPacoFg.js";import"./base-radio-8XhgSIuH.js";import{c as b}from"./components-1njTRPO8.js";import{c as v}from"./icon-paths-AuJwhOz7.js";import"./jquery-5v7aFUvu.js";import"./i18n-context-9-s9cJ--.js";import{E as y}from"./editor-jsonify-q8hSKygW.js";import{r as w}from"./index-qhcEwEpg.js";import{B as C}from"./blur-input-0MWX_AIX.js";import{E as h}from"./editor-C9--z03F.js";const{InfoTip:u,InlineIcon:k,RangeInput:I}=b,p=400,g=[0,10],x={url:null,width:0,height:0},E="(ka-.*.s3.amazonaws.com|(fastly|cdn).kastatic.org|khanacademy.org|kasandbox.org)",N=new RegExp("^(https?|web\\+graphie)://[^/]*"+E),_=["center","above","above right","right","below right","below","below left","left","above left"],s=class s extends w.Component{constructor(){super(...arguments),this._isMounted=!1,this.state={backgroundImageError:""}}componentDidMount(){this._isMounted=!0}componentWillUnmount(){this._isMounted=!1}render(){const e=this.props.backgroundImage,a=r("div",{className:"image-settings",children:[!c.isLabeledSVG(e.url)&&n("div",{children:r("label",{children:[n("div",{children:"Preview:"}),n("img",{alt:"Editor preview of image",src:e.url,style:{width:"100%"}})]})}),n("div",{children:r("label",{children:[n("div",{children:"Dimensions:"}),r("p",{children:[e.width,"x",e.height]})]})}),n("div",{children:r("label",{children:[r("div",{children:["Alt text:",n(u,{children:"This is important for screenreaders. The content of this alt text will be formatted as markdown (tables, emphasis, etc. are supported)."})]}),n(h,{apiOptions:this.props.apiOptions,content:this.props.alt,onChange:i=>{i.content!=null&&this.change("alt",i.content)},widgetEnabled:!1})]})}),n("div",{children:r("label",{children:[n("div",{children:"Caption:"}),n(h,{apiOptions:this.props.apiOptions,content:this.props.caption,onChange:i=>{i.content!=null&&this.change("caption",i.content)},widgetEnabled:!1})]})})]}),t=n("div",{className:"renderer-widget-error",children:this.state.backgroundImageError});return r("div",{className:"perseus-image-editor",children:[r("label",{children:["Image url:",n(u,{children:"Paste an image or graphie image URL."}),this.state.backgroundImageError&&t,n(C,{value:e.url||"",style:{width:332},onChange:i=>this.onUrlChange(i,!1)})]}),e.url&&a]})}_renderRowForLabel(e,a){return r("tr",{children:[n("td",{children:n(I,{value:e.coordinates,onChange:this.onCoordinateChange.bind(this,a)})}),n("td",{style:{verticalAlign:"bottom",width:"5px"},children:n("input",{type:"text",className:"graph-settings-axis-label",value:e.content,onChange:this.onContentChange.bind(this,a)})}),n("td",{children:n("select",{className:"perseus-widget-dropdown",value:e.alignment,onChange:this.onAlignmentChange.bind(this,a),children:_.map(function(t,i){return n("option",{value:t,children:t},""+i)},this)})}),n("td",{children:n("a",{href:"#",className:"simple-button orange delete-label",title:"Remove this label",onClick:this.removeLabel.bind(this,a),children:n(k,{...v})})})]},a)}change(...e){return f.apply(this,e)}removeLabel(e,a){a.preventDefault();const t=[...this.props.labels];t.splice(e,1),this.props.onChange({labels:t})}onCoordinateChange(e,a){const t=this.props.labels.slice();t[e]=l.extend({},t[e],{coordinates:a}),this.props.onChange({labels:t})}onContentChange(e,a){const t=a.target.value,i=this.props.labels.slice();i[e]=l.extend({},i[e],{content:t}),this.props.onChange({labels:i})}onAlignmentChange(e,a){const t=a.target.value,i=this.props.labels.slice();i[e]=l.extend({},i[e],{alignment:t}),this.props.onChange({labels:i})}setUrl(e,a,t,i){if(!this._isMounted)return;const o=l.clone(this.props.backgroundImage);o.url=e,o.width=a,o.height=t;const m=[o.width,o.height];this.props.onChange({backgroundImage:o,box:m},null,i)}async onUrlChange(e,a){if(!e){this.setUrl(e,0,0,a);return}if(!N.test(e)){this.setState({backgroundImageError:"Images must be from sites hosted by Khan Academy. Please input a Khan Academy-owned address, or use the Add Image tool to rehost an existing image"});return}this.setState({backgroundImageError:""});try{const t=await c.getImageSizeModern(e);this.setUrl(e,t[0],t[1],!0)}catch(t){this.setState({backgroundImageError:`There was an error loading the image URL: ${JSON.stringify(t,null,2)}`})}}onRangeChange(e,a){const t=this.props.range.slice();t[e]=a,this.props.onChange({range:t})}serialize(){return y.serialize.call(this)}};s.displayName="ImageEditor",s.widgetName="image",s.defaultProps={title:"",range:[g,g],box:[p,p],backgroundImage:x,labels:[],alt:"",caption:""};let d=s;try{d.displayName="ImageEditor",d.__docgenInfo={description:"",displayName:"ImageEditor",props:{onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(values: { [key: string]: any; }, callback?: (() => unknown) | null | undefined, silent?: boolean | undefined) => unknown"}},apiOptions:{defaultValue:null,description:"",name:"apiOptions",required:!0,type:{name:"Readonly<{ isArticle?: boolean | undefined; onInputError?: ((widgetId: any, value: string, message?: string | null | undefined) => unknown) | undefined; onFocusChange?: ((newFocusPath: FocusPath, oldFocusPath: FocusPath, keypadHeight?: number | undefined, focusedElement?: HTMLElement | undefined) => unknown) | undef..."}},title:{defaultValue:{value:""},description:"",name:"title",required:!1,type:{name:"string"}},range:{defaultValue:{value:"[defaultRange, defaultRange]"},description:"",name:"range",required:!1,type:{name:"[readonly [min: number, max: number], readonly [min: number, max: number]]"}},box:{defaultValue:{value:"[defaultBoxSize, defaultBoxSize]"},description:"",name:"box",required:!1,type:{name:"Size"}},backgroundImage:{defaultValue:{value:`{
    url: null,
    width: 0,
    height: 0,
} as const`},description:"",name:"backgroundImage",required:!1,type:{name:"any"}},labels:{defaultValue:{value:"[]"},description:"",name:"labels",required:!1,type:{name:"readonly string[]"}},alt:{defaultValue:{value:""},description:"",name:"alt",required:!1,type:{name:"string"}},caption:{defaultValue:{value:""},description:"",name:"caption",required:!1,type:{name:"string"}}}}}catch{}export{d as I};
