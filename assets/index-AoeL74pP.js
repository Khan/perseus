import{a as ee}from"./version-akiLXZts.js";import{j as t,a as d}from"./jsx-runtime-5BUNAZ9W.js";import"./article-renderer-engpwc6z.js";import{_ as u}from"./index-default-4_ZsnO94.js";import"./util-Kf-UsGkl.js";import{l as y}from"./unit-ti2HXQ4p.js";import{P as U,E as V}from"./perseus-error-l3K_anoI.js";import"./dependencies-9B_Bv_mA.js";import{A as x}from"./perseus-api-cFDIds9P.js";import{e as ne,d as te}from"./multi-renderer-9KqIYZwh.js";import"./hints-renderer-5MYO6gBp.js";import{b as re,r as ae,a as se,c as oe}from"./renderer-jXtsf37s.js";import"./base-radio-y4Xo7lPV.js";import{c as B}from"./components-MWI_x7cO.js";import{I as J}from"./icon-paths-AuJwhOz7.js";import"./jquery-5v7aFUvu.js";import"./i18n-context-3gTlIcWM.js";import{r as g}from"./index-4g5l5LRQ.js";import{D as ie}from"./device-framer-yWj_KsNt.js";import{I as le,J as $,H as ce,E as de,A as pe,a as me}from"./editor-page-ifQaUNNz.js";import{S as P}from"./section-control-button-q0ZJuTo6.js";import{E as G}from"./editor-TVM8XXYq.js";import"./viewport-resizer-dYgVTSY3.js";import{P as p}from"./index-tvtfaFq4.js";import{R as T,W as ue}from"./structured-item-diff-5QOPRxXb.js";import"./button-group-KR3umc1e.js";import"./graph-jmTyxyV8.js";import"./svg-image-D5zktulZ.js";import"./hud-CJYktPgf.js";import"./icon-TA3bBVIW.js";import"./info-tip-7k4XWhfR.js";import"./inline-icon-QIU9thzn.js";import"./math-input-b0AfbzvY.js";import"./multi-button-group-AxfQn4Cq.js";import"./number-input-XS-IwU_4.js";import{c as he}from"./prop-check-box-f7I2HerX.js";import"./range-input-XXGnnDKu.js";import"./text-input-Q1V0RBx1.js";import"./text-list-editor-A-LpoxgU.js";import{M as ye}from"./multi-items-5pqJSPip.js";import{l}from"./index-awljIyHI.js";import{R as fe}from"./index-jmm5gWkb.js";/* empty css                       */const ge="@khanacademy/perseus-editor",ve="__lib_version__";ee(ge,ve);const{HUD:we,InlineIcon:be}=B,{iconCircleArrowDown:Ce,iconCircleArrowUp:ke,iconPlus:z,iconTrash:Re}=J,D=class D extends g.Component{constructor(){super(...arguments),this.state={highlightLint:!0},this._handleJsonChange=e=>{this.props.onChange({json:e})},this._handleEditorChange=(e,n)=>{const r=u.clone(this._sections());r[e]=u.extend({},r[e],n),this.props.onChange({json:r})}}componentDidMount(){this._updatePreviewFrames()}componentDidUpdate(){this._updatePreviewFrames()}_updatePreviewFrames(){this.props.mode==="preview"?this.refs["frame-all"].sendNewData({type:"article-all",data:this._sections().map((e,n)=>this._apiOptionsForSection(e,n))}):this.props.mode==="edit"&&this._sections().forEach((e,n)=>{this.refs["frame-"+n].sendNewData({type:"article",data:this._apiOptionsForSection(e,n)})})}_apiOptionsForSection(e,n){const r=this.refs[`editor${n}`];return{apiOptions:{...x.defaults,...this.props.apiOptions,showAlignmentOptions:!0,isArticle:!0},json:e,useNewStyles:this.props.useNewStyles,linterContext:{contentType:"article",highlightLint:this.state.highlightLint,paths:this.props.contentPaths},legacyPerseusLint:r?r.getSaveWarnings():[]}}_sections(){return Array.isArray(this.props.json)?this.props.json:[this.props.json]}_renderEditor(){const{imageUploader:e,sectionImageUploadGenerator:n}=this.props,r={...x.defaults,...this.props.apiOptions,showAlignmentOptions:!0,isArticle:!0},s=this._sections();return d("div",{className:"perseus-editor-table",children:[s.map((c,o)=>[d("div",{className:"perseus-editor-row",children:[d("div",{className:"perseus-editor-left-cell",children:[d("div",{className:"pod-title",children:["Section ",o+1,d("div",{style:{display:"inline-block",float:"right"},children:[n(o),t(P,{icon:z,onClick:()=>{this._handleAddSectionAfter(o)},title:"Add a new section after this one"}),o+1<s.length&&t(P,{icon:Ce,onClick:()=>{this._handleMoveSectionLater(o)},title:"Move this section down"}),o>0&&t(P,{icon:ke,onClick:()=>{this._handleMoveSectionEarlier(o)},title:"Move this section up"}),t(P,{icon:Re,onClick:()=>{const m="Are you sure you want to delete section "+(o+1)+"?";confirm(m)&&this._handleRemoveSection(o)},title:"Delete this section"})]})]}),t(G,{...c,apiOptions:r,imageUploader:e,onChange:u.partial(this._handleEditorChange,o),placeholder:"Type your section text here...",ref:"editor"+o})]}),t("div",{className:"editor-preview",children:this._renderIframePreview(o,!0)})]},o)]),this._renderAddSection(),this._renderLinterHUD()]})}_renderAddSection(){return t("div",{className:"perseus-editor-row",children:t("div",{className:"perseus-editor-left-cell",children:d("a",{href:"#",className:"simple-button orange",onClick:()=>{this._handleAddSectionAfter(this._sections().length-1)},children:[t(be,{...z})," Add a section"]})})})}_renderLinterHUD(){return t(we,{message:"Style warnings",enabled:this.state.highlightLint,onClick:()=>{this.setState({highlightLint:!this.state.highlightLint})}})}_renderIframePreview(e,n){const r=this.props.screen==="phone"||this.props.screen==="tablet";return t(ie,{deviceType:this.props.screen,nochrome:n,children:t(le,{ref:"frame-"+e,datasetKey:"mobile",datasetValue:r,seamless:n,url:this.props.previewURL},this.props.screen)})}_renderPreviewMode(){return t("div",{className:"standalone-preview",children:this._renderIframePreview("all",!1)})}_handleMoveSectionEarlier(e){if(e===0)return;const n=u.clone(this._sections()),r=n[e];n.splice(e,1),n.splice(e-1,0,r),this.props.onChange({json:n})}_handleMoveSectionLater(e){const n=u.clone(this._sections());if(e+1===n.length)return;const r=n[e];n.splice(e,1),n.splice(e+1,0,r),this.props.onChange({json:n})}_handleAddSectionAfter(e){const n=u.clone(this.serialize()),r=e>=0?{widgets:n[e].widgets}:{};n.splice(e+1,0,r),this.props.onChange({json:n})}_handleRemoveSection(e){const n=u.clone(this._sections());n.splice(e,1),this.props.onChange({json:n})}serialize(){if(this.props.mode==="edit")return this._sections().map((e,n)=>this.refs["editor"+n].serialize());if(this.props.mode==="preview"||this.props.mode==="json")return this.props.json;throw new U("Could not serialize; mode "+this.props.mode+" not found",V.Internal)}getSaveWarnings(){if(this.props.mode!=="edit")throw new U("Can only get save warnings in edit mode.",V.NotAllowed);return this._sections().map((e,n)=>this.refs["editor"+n].getSaveWarnings())}render(){return d("div",{className:"framework-perseus perseus-article-editor",children:[this.props.mode==="edit"&&this._renderEditor(),this.props.mode==="preview"&&this._renderPreviewMode(),this.props.mode==="json"&&d("div",{className:"json-editor",children:[t("div",{className:"json-editor-warning",children:t("span",{children:"Warning: Editing in this mode can lead to broken articles!"})}),t($,{multiLine:!0,onChange:this._handleJsonChange,value:this.props.json})]})]})}};D.defaultProps={contentPaths:[],json:[{}],mode:"edit",screen:"desktop",sectionImageUploadGenerator:()=>t("span",{}),useNewStyles:!1};let M=D;M.__docgenInfo={description:"",methods:[{name:"_updatePreviewFrames",docblock:null,modifiers:[],params:[],returns:null},{name:"_apiOptionsForSection",docblock:null,modifiers:[],params:[{name:"section",optional:!1,type:{name:"signature",type:"object",raw:`{
    content?: string;
    widgets?: any;
    images?: any;
}`,signature:{properties:[{key:"content",value:{name:"string",required:!1}},{key:"widgets",value:{name:"any",required:!1}},{key:"images",value:{name:"any",required:!1}}]},alias:"RendererProps"}},{name:"sectionIndex",optional:!1,type:{name:"number"}}],returns:{type:{name:"any"}}},{name:"_sections",docblock:null,modifiers:[],params:[],returns:{type:{name:"ReadonlyArray",elements:[{name:"signature",type:"object",raw:`{
    content?: string;
    widgets?: any;
    images?: any;
}`,signature:{properties:[{key:"content",value:{name:"string",required:!1}},{key:"widgets",value:{name:"any",required:!1}},{key:"images",value:{name:"any",required:!1}}]}}],raw:"ReadonlyArray<RendererProps>"}}},{name:"_renderEditor",docblock:null,modifiers:[],params:[],returns:{type:{name:"ReactReactElement",raw:'React.ReactElement<React.ComponentProps<"div">>',elements:[{name:"ReactComponentProps",raw:'React.ComponentProps<"div">',elements:[{name:"literal",value:'"div"'}]}]}}},{name:"_renderAddSection",docblock:null,modifiers:[],params:[],returns:{type:{name:"ReactReactElement",raw:'React.ReactElement<React.ComponentProps<"div">>',elements:[{name:"ReactComponentProps",raw:'React.ComponentProps<"div">',elements:[{name:"literal",value:'"div"'}]}]}}},{name:"_renderLinterHUD",docblock:null,modifiers:[],params:[],returns:{type:{name:"ReactReactElement",raw:"React.ReactElement<any>",elements:[{name:"any"}]}}},{name:"_renderIframePreview",docblock:null,modifiers:[],params:[{name:"i",optional:!1,type:{name:"union",raw:"number | string",elements:[{name:"number"},{name:"string"}]}},{name:"nochrome",optional:!1,type:{name:"boolean"}}],returns:{type:{name:"ReactReactElement",raw:"React.ReactElement<any>",elements:[{name:"any"}]}}},{name:"_renderPreviewMode",docblock:null,modifiers:[],params:[],returns:{type:{name:"ReactReactElement",raw:'React.ReactElement<React.ComponentProps<"div">>',elements:[{name:"ReactComponentProps",raw:'React.ComponentProps<"div">',elements:[{name:"literal",value:'"div"'}]}]}}},{name:"_handleJsonChange",docblock:null,modifiers:[],params:[{name:"newJson",optional:!1,type:null}],returns:null},{name:"_handleEditorChange",docblock:null,modifiers:[],params:[{name:"i",optional:!1,type:null},{name:"newProps",optional:!1,type:null}],returns:null},{name:"_handleMoveSectionEarlier",docblock:null,modifiers:[],params:[{name:"i",optional:!1,type:{name:"number"}}],returns:null},{name:"_handleMoveSectionLater",docblock:null,modifiers:[],params:[{name:"i",optional:!1,type:{name:"number"}}],returns:null},{name:"_handleAddSectionAfter",docblock:null,modifiers:[],params:[{name:"i",optional:!1,type:{name:"number"}}],returns:null},{name:"_handleRemoveSection",docblock:null,modifiers:[],params:[{name:"i",optional:!1,type:{name:"number"}}],returns:null},{name:"serialize",docblock:null,modifiers:[],params:[],returns:{type:{name:"union",raw:"RendererProps | ReadonlyArray<RendererProps>",elements:[{name:"signature",type:"object",raw:`{
    content?: string;
    widgets?: any;
    images?: any;
}`,signature:{properties:[{key:"content",value:{name:"string",required:!1}},{key:"widgets",value:{name:"any",required:!1}},{key:"images",value:{name:"any",required:!1}}]}},{name:"ReadonlyArray",elements:[{name:"signature",type:"object",raw:`{
    content?: string;
    widgets?: any;
    images?: any;
}`,signature:{properties:[{key:"content",value:{name:"string",required:!1}},{key:"widgets",value:{name:"any",required:!1}},{key:"images",value:{name:"any",required:!1}}]}}],raw:"ReadonlyArray<RendererProps>"}]}}},{name:"getSaveWarnings",docblock:`Returns an array, with one element be section.
Each element is an array of lint warnings present in that section.

This function can currently only be called in edit mode.`,modifiers:[],params:[],returns:{type:{name:"ReadonlyArray",elements:[{name:"signature",type:"object",raw:`{
    content?: string;
    widgets?: any;
    images?: any;
}`,signature:{properties:[{key:"content",value:{name:"string",required:!1}},{key:"widgets",value:{name:"any",required:!1}},{key:"images",value:{name:"any",required:!1}}]}}],raw:"ReadonlyArray<RendererProps>"}},description:`Returns an array, with one element be section.
Each element is an array of lint warnings present in that section.

This function can currently only be called in edit mode.`}],displayName:"ArticleEditor",props:{contentPaths:{required:!1,tsType:{name:"ReadonlyArray",elements:[{name:"string"}],raw:"ReadonlyArray<string>"},description:"",defaultValue:{value:"[]",computed:!1}},json:{required:!1,tsType:{name:"union",raw:"RendererProps | ReadonlyArray<RendererProps>",elements:[{name:"signature",type:"object",raw:`{
    content?: string;
    widgets?: any;
    images?: any;
}`,signature:{properties:[{key:"content",value:{name:"string",required:!1}},{key:"widgets",value:{name:"any",required:!1}},{key:"images",value:{name:"any",required:!1}}]}},{name:"ReadonlyArray",elements:[{name:"signature",type:"object",raw:`{
    content?: string;
    widgets?: any;
    images?: any;
}`,signature:{properties:[{key:"content",value:{name:"string",required:!1}},{key:"widgets",value:{name:"any",required:!1}},{key:"images",value:{name:"any",required:!1}}]}}],raw:"ReadonlyArray<RendererProps>"}]},description:"",defaultValue:{value:"[{}]",computed:!1}},mode:{required:!1,tsType:{name:"union",raw:'"diff" | "edit" | "json" | "preview"',elements:[{name:"literal",value:'"diff"'},{name:"literal",value:'"edit"'},{name:"literal",value:'"json"'},{name:"literal",value:'"preview"'}]},description:"",defaultValue:{value:'"edit"',computed:!1}},screen:{required:!1,tsType:{name:"union",raw:'"phone" | "tablet" | "desktop"',elements:[{name:"literal",value:'"phone"'},{name:"literal",value:'"tablet"'},{name:"literal",value:'"desktop"'}]},description:"",defaultValue:{value:'"desktop"',computed:!1}},sectionImageUploadGenerator:{required:!1,tsType:{name:"signature",type:"function",raw:`(
    i: number,
) => React.ReactElement<React.ComponentProps<"span">>`,signature:{arguments:[{type:{name:"number"},name:"i"}],return:{name:"ReactReactElement",raw:'React.ReactElement<React.ComponentProps<"span">>',elements:[{name:"ReactComponentProps",raw:'React.ComponentProps<"span">',elements:[{name:"literal",value:'"span"'}]}]}}},description:"",defaultValue:{value:"() => <span />",computed:!1}},useNewStyles:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},apiOptions:{required:!1,tsType:{name:"APIOptions"},description:""},imageUploader:{required:!1,tsType:{name:"signature",type:"function",raw:"(arg1: string, arg2: (arg1: string) => unknown) => unknown",signature:{arguments:[{type:{name:"string"},name:"arg1"},{type:{name:"signature",type:"function",raw:"(arg1: string) => unknown",signature:{arguments:[{type:{name:"string"},name:"arg1"}],return:{name:"unknown"}}},name:"arg2"}],return:{name:"unknown"}}},description:""},previewURL:{required:!0,tsType:{name:"string"},description:""}}};const A=p.shape({content:p.string,images:p.objectOf(p.any),widgets:p.objectOf(p.any)}),w=class w extends g.Component{constructor(){super(...arguments),this.state=w._stateFromProps(this.props)}UNSAFE_componentWillReceiveProps(e){this.setState(w._stateFromProps(e))}render(){const{before:e,after:n}=this.state,r=Math.max(e.length,n.length),s=u.times(r,c=>t(T,{before:c<e.length?e[c]:void 0,after:c<n.length?n[c]:void 0,title:`Section ${c+1}`,showAlignmentOptions:!0,showSeparator:c<r-1},c));return t("div",{className:"framework-perseus",children:s})}};w.propTypes={after:p.oneOfType([A,p.arrayOf(A)]).isRequired,before:p.oneOfType([A,p.arrayOf(A)]).isRequired},w._stateFromProps=e=>{const{before:n,after:r}=e;return{before:Array.isArray(n)?n:[n],after:Array.isArray(r)?r:[r]}};let L=w;L.__docgenInfo={description:"",methods:[{name:"_stateFromProps",docblock:null,modifiers:["static"],params:[{name:"props",optional:!1,type:null}],returns:null}],displayName:"ArticleDiff",props:{after:{description:"",type:{name:"union",value:[{name:"custom",raw:"rendererProps"},{name:"arrayOf",value:{name:"custom",raw:"rendererProps"}}]},required:!0},before:{description:"",type:{name:"union",value:[{name:"custom",raw:"rendererProps"},{name:"arrayOf",value:{name:"custom",raw:"rendererProps"}}]},required:!0}}};const F=p.shape({question:p.shape({}).isRequired,answerArea:p.shape({}).isRequired,hints:p.arrayOf(p.any).isRequired}),H=class H extends g.Component{render(){const{before:e,after:n}=this.props,r=Math.max(e.hints.length,n.hints.length),s=t(T,{before:e.question,after:n.question,title:"Question",showAlignmentOptions:!1,showSeparator:!0}),c=t(ue,{before:e.answerArea,after:n.answerArea,title:"Question extras"}),o=u.times(r,function(m){return t(T,{before:m<e.hints.length?e.hints[m]:void 0,after:m<n.hints.length?n.hints[m]:void 0,title:`Hint ${m+1}`,showAlignmentOptions:!1,showSeparator:m<r-1},m)});return d("div",{className:"framework-perseus",children:[s,c,o&&t("div",{className:"diff-separator"}),o]})}};H.propTypes={after:F.isRequired,before:F.isRequired};let j=H;j.__docgenInfo={description:"",methods:[],displayName:"ItemDiff",props:{after:{description:"",type:{name:"custom",raw:"itemProps.isRequired"},required:!1},before:{description:"",type:{name:"custom",raw:"itemProps.isRequired"},required:!1}}};const E=class E extends g.Component{render(){const{children:e,color:n,onClick:r,...s}=this.props;return t("div",{className:l.css(S.baseButton,n==="green"&&S.green,n==="orange"&&S.orange),onClick:r,...s,children:e})}};E.propTypes={children:p.node,color:p.oneOf(["orange","green"]),onClick:p.func},E.defaultProps={children:null,color:"green",onClick:()=>{}};let b=E;const S=l.StyleSheet.create({baseButton:{top:"0",fontSize:"11px",padding:"3px 10px",backgroundRepeat:"repeat-x",borderColor:`
             rgba(0, 0, 0, 0.1)
             rgba(0, 0, 0, 0.1)
             rgba(0, 0, 0, 0.25)
         `,color:"#ffffff",borderRadius:"3px",lineHeight:"15px",cursor:"pointer",transition:"box-shadow ease-in-out 0.15s",appearance:"none",textDecoration:"none",textAlign:"center",":hover":{boxShadow:`0 1px 1px rgba(0, 0, 0, 0.35),
                 inset 0 0 50px 5px rgba(255, 255, 255, 0.2)`}},green:{border:"1px solid #7fab07",backgroundColor:"#80ac07",backgroundImage:"linear-gradient(to bottom, #8aba08, #719807)",":hover":{borderBottomColor:"#547105",backgroundColor:"#719807"}},orange:{border:"1px solid #d45704",backgroundColor:"#d55704",backgroundImage:"linear-gradient(to bottom, #e35d04, #c04f03)",":hover":{borderBottomColor:"#983e03",backgroundColor:"#c04f03"}}});b.__docgenInfo={description:"",methods:[],displayName:"SimpleButton",props:{children:{defaultValue:{value:"null",computed:!1},description:"",type:{name:"node"},required:!1},color:{defaultValue:{value:'"green"',computed:!1},description:"",type:{name:"enum",value:[{value:'"orange"',computed:!1},{value:'"green"',computed:!1}]},required:!1},onClick:{defaultValue:{value:"() => {}",computed:!1},description:"",type:{name:"func"},required:!1}}};const{InlineIcon:q}=B,{iconChevronDown:W,iconTrash:Pe}=J,{MultiRenderer:Ae}=ye;class _ extends g.Component{constructor(){super(...arguments),this._handleSelectMode=e=>{if(this.props.onChange){const n=e.target.value;this.props.onChange(n)}}}render(){return d("label",{children:["Mode:"," ",d("select",{value:this.props.currentMode,onChange:this._handleSelectMode,children:[t("option",{value:"edit",children:"Edit"}),t("option",{value:"preview",children:"Preview"}),t("option",{value:"json",children:"Dev-only JSON"})]})]})}}function Q(a){return a.replace(/[A-Z]/g,e=>" "+e.toLowerCase())}function N(a){return a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()}function K(a){return a.charAt(a.length-1)==="s"?a.slice(0,-1):a}function f(a){return["_multi",...a]}const O=({depth:a,...e})=>{const r=`h${Math.min(a,5)+1}`;return t(r,{...e})},I=a=>{const{shape:e,data:n,path:r,actions:s,name:c,controls:o,...m}=a,h=c||Q(r[r.length-1]||""),C=t(Se,{...m,shape:e,data:n,path:r,actions:s}),k=r.join(".");return e.type==="array"?t(Ne,{name:h,controls:o,path:r,shape:e,actions:s,children:C},k):e.type==="object"?t(Ee,{name:h,controls:o,path:r,children:C},k):t(_e,{name:h,controls:o,path:r,shape:e,children:C},k)},_e=({name:a,controls:e,children:n,path:r,shape:s})=>{const o=(s.type==="content"||s.type==="hint")&&t("div",{className:l.css(i.containerHeader),children:t(O,{depth:r.length,className:l.css(i.containerTitle),children:N(a)})});return d("div",{className:l.css(i.container),children:[d("span",{className:l.css(i.row,i.rowHeading),children:[t("div",{className:l.css(i.columnLeft),children:d("div",{className:"pod-title "+l.css(i.containerHeader),children:[t("div",{className:l.css(i.containerTitle),children:N(a)}),e]})}),t("div",{className:l.css(i.columnRight),children:o})]}),n]})},Ne=a=>{const{name:e,controls:n,children:r,path:s,shape:c,actions:o}=a;return d("div",{className:l.css(i.container),children:[n&&t("div",{className:l.css(i.columnLeft,i.containerHeader),children:n}),t("div",{children:r}),t("div",{className:l.css(i.columnLeft),children:d("a",{href:"javascript:void 0",onClick:()=>o.addArrayElement(s,c.elementShape),children:["Add a ",K(e)]})})]})},Ee=({name:a,controls:e,children:n,path:r})=>{const s=d("div",{className:l.css(i.containerHeader),children:[t(O,{depth:r.length,className:l.css(i.containerTitle),children:N(a)}),e]}),c=(a||e)&&t("div",{className:l.css(i.containerHeader,i.previewCollectionHeader),children:t(O,{depth:r.length,className:l.css(i.containerTitle),children:N(a)})}),o=s&&c;return d("div",{className:l.css(i.container),children:[o&&d("span",{className:l.css(i.row),children:[t("div",{className:l.css(i.columnLeft),children:s}),t("div",{className:l.css(i.columnRight),children:c})]}),t("div",{className:l.css(r.length>0&&i.contentIndent),children:n})]})},Se=a=>{const{shape:e,data:n,...r}=a;return e.type==="content"?t(qe,{shape:e,data:n,...r}):e.type==="hint"?t(xe,{shape:e,data:n,...r}):e.type==="tags"?t(Te,{shape:e,data:n,...r}):e.type==="array"?t(Me,{shape:e,data:n,...r}):e.type==="object"?t(Le,{shape:e,data:n,...r}):null},Y=a=>class extends g.Component{constructor(){super(...arguments),this.state={sticky:!1},this.updateStickiness=()=>{const r=fe.findDOMNode(this).offsetHeight,s=window.innerHeight,c=r>s;c!==this.state.sticky&&this.setState({sticky:c})}}componentDidMount(){this.stickynessTimer=setInterval(this.updateStickiness,1e3),this.updateStickiness()}componentWillUnmount(){clearInterval(this.stickynessTimer)}render(){return t(a,{...this.props,sticky:this.state.sticky})}},qe=Y(a=>{const{data:e,path:n,actions:r,apiOptions:s,renderers:c,sticky:o}=a,m=t("div",{className:"framework-perseus",children:y(c).get(n)});return t("span",{children:d("div",{className:l.css(i.row),children:[t("div",{className:l.css(i.columnLeft),children:t("div",{className:l.css(o&&i.sticky),children:t(G,{...e,onChange:h=>r.mergeValueAtPath(n,h),apiOptions:s})})}),t("div",{className:l.css(i.columnRight),children:t("div",{className:l.css(o&&i.sticky),children:m})})]})})}),xe=Y(a=>{const{data:e,path:n,actions:r,apiOptions:s,renderers:c,sticky:o}=a,m=t("div",{className:"framework-perseus",children:y(c).get(n)});return d("div",{className:l.css(i.row),children:[t("div",{className:l.css(i.columnLeft),children:t("div",{className:l.css(o&&i.sticky),children:t(ce,{...e,className:l.css(i.hintEditor),onChange:h=>r.mergeValueAtPath(n,h),apiOptions:s,showTitle:!1,showRemoveButton:!1,showMoveButtons:!1,onRemove:()=>{},onMove:h=>{},isFirst:!0,isLast:!0})})}),t("div",{className:l.css(i.columnRight),children:t("div",{className:l.css(o&&i.sticky),children:m})})]})}),Te=a=>{const{data:e,path:n,actions:r,apiOptions:s}=a,{GroupMetadataEditor:c}=s;return c==null?null:t("div",{className:l.css(i.columnLeft),children:t("div",{className:l.css(i.tagsEditor),children:t(c,{value:e,onChange:o=>r.setValueAtPath(n,o),showTitle:!1})})})},Me=a=>{const{shape:e,data:n,path:r,actions:s,...c}=a,o=Q(r[r.length-1]),m=K(o),h=e.elementShape.type,C=h==="content"||h==="hint",k=n.map((Z,v)=>{const R=r.concat(v),X=[v>0&&t("div",{className:l.css(i.control),children:t(b,{color:"orange",title:"Move up",onClick:()=>s.moveArrayElementUp(R),children:t("div",{className:l.css(i.verticalFlip),children:t(q,{...W})})})},"moveArrayElementUp"),v<n.length-1&&t("div",{className:l.css(i.control),children:t(b,{color:"orange",title:"Move down",onClick:()=>s.moveArrayElementDown(R),children:t(q,{...W})})},"moveArrayElementDown"),t("div",{className:l.css(i.control),children:t(b,{color:"orange",title:"Delete",onClick:()=>s.removeArrayElement(R),children:t(q,{...Pe})})},"removeArrayElement")];return t("div",{className:l.css(i.arrayElement,!C&&i.arrayElementAndNotLeaf),children:g.createElement(I,{...c,key:v,shape:e.elementShape,data:Z,path:R,actions:s,name:`${m} ${v+1}`,controls:X})},v)});return t("div",{children:k})},Le=a=>{const{shape:e,data:n,path:r,...s}=a,c=Object.keys(e.shape).map(o=>t("div",{className:l.css(i.objectElement),children:t(I,{...s,shape:e.shape[o],data:n[o],path:r.concat(o)})},o));return t("div",{children:c})};class je extends g.Component{constructor(){super(...arguments),this._renderLayout=()=>{const{Layout:e,apiOptions:n,item:r}=this.props;return t(e,{ref:s=>this.layout=s,item:r,apiOptions:n})},this._renderJson=()=>d("div",{children:[t(_,{currentMode:this.props.editorMode,onChange:e=>this.props.onChange({editorMode:e})}),t($,{multiLine:!0,value:this.props.item,onChange:e=>this.props.onChange({item:e})})]}),this._renderPreview=()=>d("div",{children:[t(_,{currentMode:this.props.editorMode,onChange:e=>this.props.onChange({editorMode:e})}),this._renderLayout()]}),this.mergeValueAtPath=(e,n)=>{this.props.onChange({item:y(this.props.item).merge(f(e),n).freeze()})},this.setValueAtPath=(e,n)=>{this.props.onChange({item:y(this.props.item).set(f(e),n).freeze()})},this.addArrayElement=(e,n)=>{const r=y(this.props.item).get(f(e)).length,s=e.concat(r),c=ne(n);this.props.onChange({item:y(this.props.item).set(f(s),c).freeze()})},this.removeArrayElement=e=>{this.props.onChange({item:y(this.props.item).del(f(e)).freeze()})},this.moveArrayElementDown=e=>{const r=e[e.length-1]+1,s=e.slice(0,-1).concat(r),c=y(this.props.item).get(f(e)),o=y(this.props.item).get(f(s));this.props.onChange({item:y(this.props.item).set(f(e),o).set(f(s),c).freeze()})},this.moveArrayElementUp=e=>{const n=e[e.length-1],r=e.slice(0,-1).concat(n-1);this.moveArrayElementDown(r)},this._renderEdit=()=>{const e={...x.defaults,...this.props.apiOptions},{item:n}=this.props,r=this.props.Layout.shape;return d("div",{className:"perseus-multirenderer-editor",children:[t(_,{currentMode:this.props.editorMode,onChange:s=>this.props.onChange({editorMode:s})}),t(Ae,{item:n,shape:r,apiOptions:e,dependencies:{analytics:{onAnalyticsEvent:async()=>{}}},children:({renderers:s})=>t(I,{shape:r,data:te(n),path:[],actions:this,apiOptions:e,renderers:s})})]})},this.score=()=>{if(this.layout)return this.layout.score()},this.getSerializedState=()=>{if(this.layout)return this.layout.getSerializedState()},this.restoreSerializedState=e=>{this.layout&&this.layout.restoreSerializedState(e)},this._renderContent=()=>{switch(this.props.editorMode){case"json":return this._renderJson();case"preview":return this._renderPreview();case"edit":return this._renderEdit();default:return t(_,{currentMode:this.props.editorMode,onChange:e=>this.props.onChange({editorMode:e})})}}}render(){return t("div",{id:"perseus",children:this._renderContent()})}}const i=l.StyleSheet.create({container:{},editor:{width:"100%"},treePreview:{position:"relative"},verticalFlip:{transform:"scaleY(-1)"},control:{marginLeft:12},containerHeader:{alignItems:"flex-end",display:"flex",flexDirection:"row"},previewCollectionHeader:{marginBottom:16},containerTitle:{flexGrow:1,margin:0},contentIndent:{marginLeft:8},hintEditor:{paddingBottom:0},arrayElement:{marginBottom:16},arrayElementAndNotLeaf:{borderBottom:"1px solid #ccc",":first-child":{borderTop:"1px solid #ccc",paddingTop:16}},objectElement:{marginBottom:16},tagsEditor:{border:"1px solid #ddd",padding:"5px 10px"},row:{display:"flex",position:"relative"},columnLeft:{width:360,marginRight:30,position:"relative"},columnRight:{flex:1,marginLeft:30,position:"relative"},sticky:{position:"sticky",top:33},rowHeading:{position:"sticky",backgroundColor:"white",width:"100%",zIndex:101,top:-1}});je.__docgenInfo={description:"",methods:[{name:"_renderLayout",docblock:null,modifiers:[],params:[],returns:null},{name:"_renderJson",docblock:null,modifiers:[],params:[],returns:null},{name:"_renderPreview",docblock:null,modifiers:[],params:[],returns:null},{name:"mergeValueAtPath",docblock:null,modifiers:[],params:[{name:"path",optional:!1,type:{name:"ReadonlyArray",elements:[{name:"any"}],raw:"ReadonlyArray<any>",alias:"Path"}},{name:"newValue",optional:!1,type:{name:"unknown"}}],returns:null},{name:"setValueAtPath",docblock:null,modifiers:[],params:[{name:"path",optional:!1,type:{name:"ReadonlyArray",elements:[{name:"any"}],raw:"ReadonlyArray<any>",alias:"Path"}},{name:"newValue",optional:!1,type:{name:"unknown"}}],returns:null},{name:"addArrayElement",docblock:null,modifiers:[],params:[{name:"path",optional:!1,type:{name:"ReadonlyArray",elements:[{name:"any"}],raw:"ReadonlyArray<any>",alias:"Path"}},{name:"shape",optional:!1,type:{name:"Shape",alias:"Shape"}}],returns:null},{name:"removeArrayElement",docblock:null,modifiers:[],params:[{name:"path",optional:!1,type:{name:"ReadonlyArray",elements:[{name:"any"}],raw:"ReadonlyArray<any>",alias:"Path"}}],returns:null},{name:"moveArrayElementDown",docblock:null,modifiers:[],params:[{name:"path",optional:!1,type:{name:"ReadonlyArray",elements:[{name:"any"}],raw:"ReadonlyArray<any>",alias:"Path"}}],returns:null},{name:"moveArrayElementUp",docblock:null,modifiers:[],params:[{name:"path",optional:!1,type:{name:"ReadonlyArray",elements:[{name:"any"}],raw:"ReadonlyArray<any>",alias:"Path"}}],returns:null},{name:"_renderEdit",docblock:null,modifiers:[],params:[],returns:null},{name:"score",docblock:null,modifiers:[],params:[],returns:null},{name:"getSerializedState",docblock:null,modifiers:[],params:[],returns:null},{name:"restoreSerializedState",docblock:null,modifiers:[],params:[{name:"state",optional:!1,type:{name:"any"}}],returns:null},{name:"_renderContent",docblock:null,modifiers:[],params:[],returns:null}],displayName:"MultiRendererEditor",props:{Layout:{required:!0,tsType:{name:"intersection",raw:"React.ComponentType<any> & LayoutStatics",elements:[{name:"ReactComponentType",raw:"React.ComponentType<any>",elements:[{name:"any"}]},{name:"LayoutStatics"}]},description:""},apiOptions:{required:!0,tsType:{name:"APIOptions"},description:""},item:{required:!0,tsType:{name:"Item"},description:""},editorMode:{required:!0,tsType:{name:"EditorMode"},description:""},onChange:{required:!0,tsType:{name:"ChangeHandler"},description:""}}};he({displayName:"StatefulEditorPage",propTypes:{componentClass:p.func},getDefaultProps:function(){return{componentClass:de}},render:function(){const a=this.props.componentClass;return t(a,{...this.state})},getInitialState:function(){return u({}).extend(u.omit(this.props,"componentClass"),{onChange:this.handleChange,ref:"editor"})},componentDidMount:function(){this._isMounted=!0},componentWillUnmount:function(){this._isMounted=!1},UNSAFE_componentWillReceiveProps:function(a){this.setState(u(a).pick("apiOptions","imageUploader","developerMode","problemNum","previewDevice","frameSource"))},getSaveWarnings:function(){return this.refs.editor.getSaveWarnings()},serialize:function(){return this.refs.editor.serialize()},handleChange:function(a,e){this._isMounted&&this.setState(a,e)},scorePreview:function(){return this.refs.editor.scorePreview()}});re(me);ae(pe);se();oe();
