import{j as r,a as p,F as I}from"./jsx-runtime-FVsy8kgq.js";import{p as N}from"./util-XR-uqOh-.js";import{c as k,P as R,E as _}from"./article-renderer-QPGTB0Q1.js";import{_ as f}from"./jquery-yG1GhClm.js";import"./phet-simulation-QObOE2Mw.js";import"./version-akiLXZts.js";import"./dependencies-d8cZibFS.js";import"./perseus-api-Nq3s7IMx.js";import{l as x}from"./perseus-item-rw9Gxpue.js";import"./hints-renderer-hVjwEMMU.js";import"./renderer-Rz8FxZAD.js";import"./base-radio-nPRq466h.js";import{c as T}from"./components-8e2wXp0G.js";import"./index-k-0mNqHS.js";import"./i18n-context-xqHghGAX.js";import"./svg-image-h96M64n1.js";import{f as L}from"./index-J2t_5nK1.js";import"./index-xs9l8-Af.js";import{B as b}from"./choice-XJA1Q6b6.js";import{C as g,l as v}from"./index-QCAhLhLD.js";import{S as q}from"./index-qUyqkRvh.js";import{s as m,c as y}from"./index-deFLJwr4.js";import{H as F,d as O}from"./index-h_CiYGGb.js";import{l}from"./index-awljIyHI.js";import{r as C}from"./index-TT1qJ6UJ.js";import{c as D}from"./index-fuycm_QE.js";import{P as B}from"./index-0C4KXdeC.js";import{R as P}from"./index-7vsPyIck.js";const d=B,Y=D({propTypes:{className:d.string,components:d.arrayOf(d.node).isRequired,onReorder:d.func.isRequired,style:d.any,verify:d.func},getDefaultProps:function(){return{verify:()=>!0}},getInitialState:function(){return{dragging:null,components:this.props.components}},componentDidMount:function(){this._setDragEvents()},UNSAFE_componentWillReceiveProps:function(a){this.setState({components:a.components})},componentDidUpdate:function(){this._setDragEvents()},onDragStart:function(a){this.setState({dragging:a})},onDrop:function(){this.setState({dragging:null}),this.props.onReorder(this.state.components)},onDragEnter:function(a){if(this.state.dragging===a)return;const s=this.state.components.slice(),e=s.splice(this.state.dragging,1);s.splice(a,0,e[0]);const t=this.props.verify(s);return t&&this.setState({dragging:a,components:s}),t},_listenEvent:function(a){a.dataTransfer.setData("hackhackhack","because browsers!")},_cancelEvent:function(a){a.preventDefault()},_setDragEvents:function(){this._dragItems=this._dragItems||[];const a=P.findDOMNode(this).querySelectorAll("[draggable=true]"),s=[],e=[];for(let t=0;t<this._dragItems.length;t++){const n=this._dragItems[t];a.indexOf(n)<0&&s.push(n)}for(let t=0;t<a.length;t++){const n=a[t];this._dragItems.indexOf(n)<0&&e.push(n)}for(let t=0;t<e.length;t++){const n=e[t];n.addEventListener("dragstart",this._listenEvent),n.addEventListener("drop",this._cancelEvent)}for(let t=0;t<s.length;t++){const n=s[t];n.removeEventListener("dragstart",this._listenEvent),n.removeEventListener("drop",this._cancelEvent)}},render:function(){const a=this.state.components.map((s,e)=>r(W,{index:e,component:s,area:this,draggable:s.props.draggable,dragging:e===this.state.dragging},s.key));return r("ol",{className:this.props.className,style:this.props.style,children:a})}}),W=D({propTypes:{area:d.shape({onDragEnter:d.func.isRequired,onDragStart:d.func.isRequired,onDrop:d.func.isRequired}),component:d.node.isRequired,dragging:d.bool.isRequired,draggable:d.bool.isRequired,index:d.number.isRequired},handleDragStart:function(a){a.nativeEvent.dataTransfer.effectAllowed="move",this.props.area.onDragStart(this.props.index)},handleDrop:function(){this.props.area.onDrop(this.props.index)},handleDragEnter:function(a){const s=this.props.area.onDragEnter(this.props.index);a.nativeEvent.dataTransfer.effectAllowed=s?"move":"none"},handleDragOver:function(a){a.preventDefault()},render:function(){let a="sortable-disabled";return this.props.dragging?a="sortable-dragging":this.props.draggable&&(a="sortable-enabled"),r("li",{draggable:this.props.draggable,className:[a,l.css(z.sortableListItem)].join(" "),onDragStart:this.handleDragStart,onDrop:this.handleDrop,onDragEnter:this.handleDragEnter,onDragOver:this.handleDragOver,children:this.props.component})}}),z=l.StyleSheet.create({sortableListItem:{margin:"5px 0"}}),{InfoTip:u}=T,A=["basic","trig","prealgebra","logarithms","basic relations","advanced relations"],E=({key:a})=>Number.parseInt(a??""),U=a=>{const s=[];a.forEach(e=>{s[E(e)]=!0});for(let e=0;e<s.length;e++)if(!s[e])return e;return s.length},w=class w extends C.Component{constructor(s){super(s),this.change=(...e)=>k.apply(this,e),this.serialize=()=>{const e=["value","form","simplify","considered","key"],t=["answerForms","buttonSets","functions","times","visibleLabel","ariaLabel"],n=this.props.answerForms.map(i=>f(i).pick(e));return x(this.props).set(["answerForms"],n).mod([],i=>f(i).pick(t)).freeze()},this.getSaveWarnings=()=>{const e=[];return this.props.answerForms.length===0?e.push("No answers specified"):(this.props.answerForms.some(n=>n.considered==="correct")||e.push("No correct answer specified"),f(this.props.answerForms).each((n,i)=>{if(this.props.value==="")e.push(`Answer ${i+1} is empty`);else{const h=N(n.value,{functions:this.props.functions});h.parsed?n.simplify&&!h.expr.isSimplified()&&e.push(`${n.value} isn't simplified, but is required" +
                            " to be`):e.push(`Couldn't parse ${n.value}`)}})),e},this._newEmptyAnswerForm=()=>({considered:"correct",form:!1,key:U(this.props.answerForms),simplify:!1,value:""}),this.newAnswer=()=>{const e=this.props.answerForms.slice();e.push(this._newEmptyAnswerForm()),this.change({answerForms:e})},this.handleRemoveForm=e=>{const t=this.props.answerForms.slice();t.splice(e,1),this.change({answerForms:t})},this.handleReorder=e=>{const t=e.map(n=>{const i=f(n.props).pick("considered","form","simplify","value");return i.key=n.key,i});this.change({answerForms:t})},this.handleButtonSet=e=>{const n=A.filter(i=>this.props.buttonSets.includes(i)!==(i===e));this.props.onChange({buttonSets:n})},this.handleToggleDiv=()=>{let e,t;this.props.buttonSets.includes("basic+div")?(e="basic",t="basic+div"):(e="basic+div",t="basic");const n=this.props.buttonSets.filter(i=>i!==t).concat(e);this.change("buttonSets",n)},this.handleTexInsert=e=>{this.refs.expression.insert(e)},this.handleFunctions=e=>{this.setState({functionsInternal:e});const t={};t.functions=e.split(/[ ,]+/).filter(L),this.props.onChange(t)},this.changeExpressionWidget=(e,t)=>{const n={...this.props.answerForms[e],key:`${e}`,value:t.value};this.updateAnswerForm(e,n)},this.state={functionsInternal:this.props.functions.join(" ")}}updateAnswerForm(s,e){const t=x(this.props.answerForms).merge([s],e).freeze();this.change({answerForms:t})}changeSimplify(s,e){const t={...this.props.answerForms[s],key:`${s}`,simplify:e};this.updateAnswerForm(s,t)}changeForm(s,e){const t={...this.props.answerForms[s],form:e,key:`${s}`};this.updateAnswerForm(s,t)}changeConsidered(s,e){const t={...this.props.answerForms[s],key:`${s}`,considered:e};this.updateAnswerForm(s,t)}changeTimes(s){this.change({times:s})}render(){const s=this.props.answerForms.map(n=>{const i=E(n),h={times:this.props.times,functions:this.props.functions,buttonSets:this.props.buttonSets,buttonsVisible:"focused",value:n.value,onChange:c=>this.changeExpressionWidget(i,c),trackInteraction:()=>{},widgetId:this.props.widgetId+"-"+n.key,visibleLabel:this.props.visibleLabel,ariaLabel:this.props.ariaLabel};return r($,{draggable:!0,considered:n.considered,expressionProps:h,form:n.form,simplify:n.simplify,onDelete:()=>this.handleRemoveForm(i),onChangeSimplify:c=>this.changeSimplify(i,c),onChangeForm:c=>this.changeForm(i,c),onChangeConsidered:c=>this.changeConsidered(i,c)})}),e=r(Y,{components:s,onReorder:this.handleReorder}),t=A.map(n=>{const i=n==="basic",h=this.props.buttonSets.includes(n)||i;return r(g,{label:n,checked:h,disabled:i,onChange:()=>this.handleButtonSet(n)},n)});return t.unshift(r(g,{label:"show ÷ button",checked:this.props.buttonSets.includes("basic+div"),onChange:this.handleToggleDiv},"show ÷ button")),p("div",{children:[r(F,{children:"Global Options"}),p("div",{className:l.css(o.paddedY),children:[r(v,{label:"Visible label",value:this.props.visibleLabel||"",onChange:this.change("visibleLabel")}),r(u,{children:r("p",{children:"Optional visible text; strongly encouraged to help learners using dictation software, but can be omitted if the surrounding content provides enough context."})})]}),p("div",{className:l.css(o.paddedY),children:[r(v,{label:"Aria label",value:this.props.ariaLabel||"",onChange:this.change("ariaLabel")}),r(u,{children:p("p",{children:["Label text that's read by screen readers. Highly recommend adding a label here to ensure your exercise is accessible. For more information on writting accessible labels, please see"," ",r("a",{href:"https://www.w3.org/WAI/tips/designing/#ensure-that-form-elements-include-clearly-associated-labels",target:"_blank",children:"this article."})]})})]}),p("div",{className:l.css(o.paddedY),children:[r(v,{label:"Function variables",value:this.state.functionsInternal,onChange:this.handleFunctions}),r(u,{children:r("p",{children:'Single-letter variables listed here will be interpreted as functions. This let us know that f(x) means "f of x" and not "f times x".'})})]}),p("div",{className:l.css(o.paddedY),children:[r(g,{label:"Use × instead of ⋅ for multiplication",checked:this.props.times,onChange:n=>{this.changeTimes(n)}}),r(u,{children:r("p",{children:"For pre-algebra problems this option displays multiplication as \\times instead of \\cdot in both the rendered output and the acceptable formats examples."})})]}),p("div",{className:l.css(o.paddedY),children:[r(O,{children:"Button Sets"}),t]}),r(F,{children:"Answers"}),r("p",{style:{margin:"4px 0"},children:"student responses area matched against these from top to bottom"}),e,r("div",{children:r(b,{size:"small",onClick:this.newAnswer,children:"Add new answer"})})]})}};w.widgetName="expression",w.defaultProps={answerForms:[],times:!1,buttonSets:["basic"],functions:["f","g","h"]};let S=w;const V=function(a,s){let e=a.indexOf(s);return e=(e+1)%a.length,a[e]};class $ extends C.Component{constructor(){super(...arguments),this.state={deleteFocused:!1},this.change=(...s)=>k.apply(this,s),this.handleImSure=()=>{this.props.onDelete()},this.handleCancelDelete=()=>{this.setState({deleteFocused:!1})},this.handleDelete=()=>{this.setState({deleteFocused:!0})},this.toggleConsidered=()=>{const s=V(R,this.props.considered);this.props.onChangeConsidered(s)}}render(){const s=this.state.deleteFocused?p(I,{children:[r(b,{size:"small",onClick:this.handleImSure,color:"destructive",children:"I'm sure!"}),r(q,{size:m.small_12}),r(b,{size:"small",onClick:this.handleCancelDelete,light:!0,children:"Cancel"})]}):r(b,{size:"small",onClick:this.handleDelete,color:"destructive",light:!0,children:"Delete"}),e=l.css(o.answerStatus,this.props.considered==="wrong"&&o.answerStatusWrong,this.props.considered==="correct"&&o.answerStatusCorrect,this.props.considered==="ungraded"&&o.answerStatusUngraded);return p("div",{className:l.css(o.answerOption),children:[r("div",{className:l.css(o.answerHandle)}),p("div",{className:l.css(o.answerBody),children:[p("div",{children:[r("button",{onClick:this.toggleConsidered,className:e,children:this.props.considered}),r("div",{children:r(_,{...this.props.expressionProps})})]}),p("div",{className:l.css(o.paddedY,o.paddedX),children:[r(g,{label:"Answer expression must have the same form.",checked:this.props.form,onChange:this.props.onChangeForm}),r(u,{children:r("p",{children:"The student's answer must be in the same form. Commutativity and excess negative signs are ignored."})})]}),p("div",{className:l.css(o.paddedY,o.paddedX),children:[r(g,{label:"Answer expression must be fully expanded and simplified.",checked:this.props.simplify,onChange:this.props.onChangeSimplify}),r(u,{children:r("p",{children:`The student's answer must be fully expanded and simplified. Answering this equation (x^2+2x+1) with this factored equation (x+1)^2 will render this response "Your answer is not fully expanded and simplified."`})})]}),r("div",{className:l.css(o.buttonRow,o.paddedY),children:s})]})]})}}const o=l.StyleSheet.create({paddedX:{paddingLeft:m.xSmall_8,paddingRight:m.xSmall_8},paddedY:{paddingTop:m.xxSmall_6,paddingBottom:m.xxSmall_6},answerOption:{border:"1px solid #ddd",borderRadius:"3px",display:"flex"},answerHandle:{background:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAeCAYAAADkftS9AAAAIklEQVQoU2M4c+bMfxAGAgYYmwGrIIiDjrELjpo5aiZeMwF+yNnOs5KSvgAAAABJRU5ErkJggg==) no-repeat 50% 50%",borderRight:"1px solid #ddd",cursor:"move",width:"20px",minWidth:"20px"},answerStatus:{border:"none",userSelect:"none",width:"100px",paddingTop:m.small_12,paddingBottom:m.small_12},answerStatusWrong:{backgroundColor:y.fadedRed16},answerStatusCorrect:{backgroundColor:y.fadedGreen16},answerStatusUngraded:{backgroundColor:y.fadedBlue16},answerBody:{},buttonRow:{display:"flex"}});S.__docgenInfo={description:"",methods:[{name:"change",docblock:null,modifiers:[],params:[{name:"...args",optional:!1,type:null}],returns:null},{name:"serialize",docblock:null,modifiers:[],params:[],returns:null},{name:"getSaveWarnings",docblock:null,modifiers:[],params:[],returns:null},{name:"_newEmptyAnswerForm",docblock:null,modifiers:[],params:[],returns:null},{name:"newAnswer",docblock:null,modifiers:[],params:[],returns:null},{name:"handleRemoveForm",docblock:null,modifiers:[],params:[{name:"i",optional:!1,type:null}],returns:null},{name:"updateAnswerForm",docblock:null,modifiers:[],params:[{name:"i",optional:!1,type:{name:"number"}},{name:"props",optional:!1,type:{name:'PerseusExpressionWidgetOptions["answerForms"][number]',raw:'PerseusExpressionWidgetOptions["answerForms"][number]',alias:"AnswerForm"}}],returns:null},{name:"handleReorder",docblock:null,modifiers:[],params:[{name:"components",optional:!1,type:null}],returns:null},{name:"handleButtonSet",docblock:null,modifiers:[],params:[{name:"changingName",optional:!1,type:null}],returns:null},{name:"handleToggleDiv",docblock:null,modifiers:[],params:[],returns:null},{name:"handleTexInsert",docblock:null,modifiers:[],params:[{name:"str",optional:!1,type:null}],returns:null},{name:"handleFunctions",docblock:null,modifiers:[],params:[{name:"value",optional:!1,type:null}],returns:null},{name:"changeSimplify",docblock:null,modifiers:[],params:[{name:"key",optional:!1,type:{name:"number"}},{name:"simplify",optional:!1,type:{name:"boolean"}}],returns:null},{name:"changeForm",docblock:null,modifiers:[],params:[{name:"key",optional:!1,type:{name:"number"}},{name:"form",optional:!1,type:{name:"boolean"}}],returns:null},{name:"changeConsidered",docblock:null,modifiers:[],params:[{name:"key",optional:!1,type:{name:"number"}},{name:"considered",optional:!1,type:{name:"unknown[number]",raw:"(typeof PerseusExpressionAnswerFormConsidered)[number]"}}],returns:null},{name:"changeTimes",docblock:null,modifiers:[],params:[{name:"times",optional:!1,type:{name:"boolean"}}],returns:null},{name:"changeExpressionWidget",docblock:null,modifiers:[],params:[{name:"key",optional:!1,type:null},{name:"props",optional:!1,type:null}],returns:null}],displayName:"ExpressionEditor",props:{widgetId:{required:!1,tsType:{name:"any"},description:""},value:{required:!1,tsType:{name:"string"},description:""},answerForms:{defaultValue:{value:"[]",computed:!1},required:!1},times:{defaultValue:{value:"false",computed:!1},required:!1},buttonSets:{defaultValue:{value:'["basic"]',computed:!1},required:!1},functions:{defaultValue:{value:'["f", "g", "h"]',computed:!1},required:!1}}};export{S as E};
