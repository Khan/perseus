import{j as r,a as v}from"./jsx-runtime-BGVbfQ2Z.js";import"./prop-types-3U8aPQU9.js";import{a as y,c as S,g as u,m as T}from"./key-translator-LscBjx_B.js";import{C as _,K as E}from"./index-AMPNwp1g.js";import{M as w,c as V}from"./button-assets-cmoMUwP4.js";import{C as F}from"./index-TeOhC3cV.js";import{V as C}from"./index-oMd7J_hd.js";import{P as B,a as R}from"./index-JYyfyxPN.js";import{c as o,s as b}from"./index-lUErx3pE.js";import{l as K}from"./index-awljIyHI.js";import{c as q}from"./index-dnMhQZ-1.js";import{$ as A}from"./jquery-5v7aFUvu.js";import{r as h}from"./index-qhcEwEpg.js";import{_ as I}from"./index-default-4_ZsnO94.js";import{P as L}from"./i18n-context-9-s9cJ--.js";const N=(n,e)=>{let t=null;return(...s)=>{t&&clearTimeout(t),t=window.setTimeout(()=>{n(...s)},e)}},d=class d extends h.Component{constructor(){super(...arguments),this.__mathFieldWrapperRef=null,this.__mathField=null,this.state={focused:!1,keypadOpen:this.props.buttonsVisible==="always",cursorContext:_.NONE},this.insert=e=>{const t=this.mathField(),{locale:s}=this.context,i={...y(s),FRAC:c=>{const k=c.latex();c.typedText("/"),c.latex()===k&&c.cmd("\\frac")}}[e];if(i){i(t,e),t==null||t.focus();return}I(e).isFunction()?e(t):e[0]==="\\"?t==null||t.cmd(e).focus():t==null||t.write(e).focus(),t==null||t.focus()},this.mathField=()=>{if(!this.__mathField&&this.__mathFieldWrapperRef){const{locale:e}=this.context;this.__mathField=S(this.__mathFieldWrapperRef,e,this.props.mathInputStrings,t=>({...t,handlers:{edit:N(s=>{let a=s.latex();if(a=a.replace(/<>/g,"\\ne"),V(e,this.props.convertDotToTimes)){a=a.replace(/\\cdot/g,"\\times");const i=s.cursor()[T.L];i&&i.ctrlSeq==="\\cdot "&&(s.controller().backspace(),s.cmd("\\times"))}else a=a.replace(/\\times/g,"\\cdot");this.props.value!==a&&this.props.onChange(a),this.setState({cursorContext:u(s)})},100),enter:()=>{this.__mathFieldWrapperRef&&A(this.__mathFieldWrapperRef).submit()},upOutOf:s=>{s.typedText("^")}}}))}return this.__mathField},this.focus=()=>{var e;(e=this.mathField())==null||e.focus(),this.setState({focused:!0})},this.blur=()=>this.setState({focused:!1}),this.handleKeypadPress=(e,t)=>{const{locale:s}=this.context,a=y(s)[e],i=this.mathField();i&&(a&&a(i,e),this.setState({cursorContext:u(i)})),t.type==="click"&&this.focus()}}componentDidMount(){var e;(e=this.mathField())==null||e.latex(this.props.value)}openKeypad(){this.props.buttonsVisible!=="never"&&this.setState({keypadOpen:!0})}closeKeypad(){this.setState({keypadOpen:!1})}render(){let e=q({"perseus-math-input":!0,"mq-editable-field":!0,"mq-math-mode":!0});return this.props.className&&(e=e+" "+this.props.className),r(C,{style:[l.outerWrapper,this.state.focused&&l.wrapperFocused,this.props.hasError&&l.wrapperError],children:v("div",{style:{display:"flex",padding:1},onClick:t=>{t.stopPropagation();const s=this.mathField();s&&this.setState({cursorContext:u(s)})},children:[r("span",{className:e,ref:t=>this.__mathFieldWrapperRef=t,"aria-label":this.props.labelText,onFocus:()=>this.focus(),onBlur:()=>this.blur()}),r(B,{opened:this.state.keypadOpen,onClose:()=>this.closeKeypad(),dismissEnabled:!0,content:()=>{var t;return r(R,{closeButtonVisible:!0,style:l.popoverContent,children:r(E,{onAnalyticsEvent:this.props.analytics.onAnalyticsEvent,extraKeys:this.props.extraKeys,onClickKey:this.handleKeypadPress,cursorContext:this.state.cursorContext,convertDotToTimes:this.props.convertDotToTimes,...this.props.keypadButtonSets??O((t=this.props)==null?void 0:t.buttonSets)})})},children:this.props.buttonsVisible==="never"?r(g,{hovered:!1,focused:!1,active:!1}):r(F,{"aria-label":this.state.keypadOpen?this.context.strings.closeKeypad:this.context.strings.openKeypad,"aria-checked":this.state.keypadOpen,role:"switch",onClick:()=>this.state.keypadOpen?this.closeKeypad():this.openKeypad(),children:t=>r(g,{active:this.state.keypadOpen,...t})})})]})})}};d.contextType=L,d.defaultProps={value:"",convertDotToTimes:!1};let m=d;const f=class f extends h.Component{constructor(){super(...arguments),this.inputRef=h.createRef()}blur(){var e;(e=this.inputRef.current)==null||e.blur()}focus(){var e;(e=this.inputRef.current)==null||e.focus()}insert(e){var t;(t=this.inputRef.current)==null||t.insert(e)}render(){return r(m,{...this.props,ref:this.inputRef,mathInputStrings:this.context.strings})}};f.contextType=w;let p=f;const g=({hovered:n,focused:e,active:t})=>{let s;switch(!0){case(e||t):s=o.white;break;case n:s=o.blue;break;default:s=o.offBlack;break}const a=t||e?l.iconActive:l.iconInactive;return r(C,{style:[l.iconContainer,a],children:r("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:s,viewBox:"0 0 256 256",children:r("path",{d:"M112,72a8,8,0,0,1-8,8H40a8,8,0,0,1,0-16h64A8,8,0,0,1,112,72Zm-8,104H80V152a8,8,0,0,0-16,0v24H40a8,8,0,0,0,0,16H64v24a8,8,0,0,0,16,0V192h24a8,8,0,0,0,0-16Zm48,0h64a8,8,0,0,0,0-16H152a8,8,0,0,0,0,16Zm64,16H152a8,8,0,0,0,0,16h64a8,8,0,0,0,0-16Zm-61.66-90.34a8,8,0,0,0,11.32,0L184,83.31l18.34,18.35a8,8,0,0,0,11.32-11.32L195.31,72l18.35-18.34a8,8,0,0,0-11.32-11.32L184,60.69,165.66,42.34a8,8,0,0,0-11.32,11.32L172.69,72,154.34,90.34A8,8,0,0,0,154.34,101.66Z"})})})},O=n=>{const e={};return n&&n.forEach(t=>{switch(t){case"advanced relations":e.advancedRelations=!0;break;case"basic relations":e.basicRelations=!0;break;case"basic+div":e.divisionKey=!0;break;case"logarithms":e.logarithms=!0;break;case"prealgebra":e.preAlgebra=!0;break;case"trig":e.trigonometry=!0;break}}),e},x={borderWidth:2,borderColor:o.blue,margin:-1},l=K.StyleSheet.create({iconContainer:{display:"flex",justifyContent:"center",height:"100%",padding:b.xxxSmall_4,borderRadius:1},iconInactive:{backgroundColor:o.offBlack8},iconActive:{backgroundColor:o.offBlack64},outerWrapper:{display:"inline-block",borderStyle:"solid",borderWidth:1,borderColor:o.offBlack50,borderRadius:3,background:o.white,":hover":x},wrapperFocused:x,wrapperError:{borderColor:o.red,background:o.fadedRed8,":hover":{borderColor:o.red}},popoverContent:{padding:0,paddingBottom:b.xxSmall_6,maxWidth:"initial"}});try{p.displayName="MathInput",p.__docgenInfo={description:"",displayName:"MathInput",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},value:{defaultValue:null,description:"",name:"value",required:!0,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"any"}},convertDotToTimes:{defaultValue:null,description:"",name:"convertDotToTimes",required:!0,type:{name:"boolean"}},buttonSets:{defaultValue:null,description:"@deprecated Use `keypadButtonSets` instead. Maps to `keypadButtonSets`.\n@see keypadButtonSets",name:"buttonSets",required:!1,type:{name:"LegacyButtonSets"}},keypadButtonSets:{defaultValue:null,description:"Overrides deprecated `buttonSets` prop.",name:"keypadButtonSets",required:!1,type:{name:"KeypadButtonSets"}},labelText:{defaultValue:null,description:"",name:"labelText",required:!1,type:{name:"string"}},onFocus:{defaultValue:null,description:"",name:"onFocus",required:!1,type:{name:"(() => void)"}},onBlur:{defaultValue:null,description:"",name:"onBlur",required:!1,type:{name:"(() => void)"}},hasError:{defaultValue:null,description:"",name:"hasError",required:!1,type:{name:"boolean"}},extraKeys:{defaultValue:null,description:"",name:"extraKeys",required:!1,type:{name:'readonly ("PLUS" | "MINUS" | "NEGATIVE" | "TIMES" | "DIVIDE" | "DECIMAL" | "PERIOD" | "PERCENT" | "CDOT" | "EQUAL" | "NEQ" | "GT" | "LT" | "GEQ" | "LEQ" | "FRAC_INCLUSIVE" | "FRAC_EXCLUSIVE" | ... 96 more ... | "LOG_B")[]'}},buttonsVisible:{defaultValue:null,description:"Whether to show the keypad buttons.\nThe strings now misleading, but we keep them for backwards compatibility.\n- `focused` means that the keypad **appears on toggle, *off* by default**.\n- `always` means that the keypad **appears on toggle, *on* by default.**\n- `never` means that the keypad is **never shown**.",name:"buttonsVisible",required:!1,type:{name:"enum",value:[{value:'"always"'},{value:'"never"'},{value:'"focused"'}]}},analytics:{defaultValue:null,description:"",name:"analytics",required:!0,type:{name:"{ onAnalyticsEvent: AnalyticsEventHandlerFn; }"}}}}}catch{}export{p as M};
