import{r as s}from"./index-qhcEwEpg.js";import{r as T}from"./index-E09jvG0x.js";import{T as k,V as v,U as D}from"./index-4c2J3ov1.js";import{m as I}from"./index-T1CwBClJ.js";import{l as g}from"./index-awljIyHI.js";import{s as h,c}from"./index-25YgVP-A.js";import{S as F}from"./index-BrnICqZg.js";import{H as U,L}from"./index-Fg8WJp4t.js";import{P as M}from"./Popper-2p8US95Y.js";class O{constructor(){this._subscribers=[],this._active=!1}_getIndex(e){return this._subscribers.findIndex(t=>t===e)}steal(e){const t=!!this._active;this._active=!0;for(const n of this._subscribers)n!==e&&n.activeStateStolen();return t}giveup(){this._active=!1}subscribe(e){if(this._getIndex(e)>=0)throw new Error("Already subscribed.");return this._subscribers.push(e),()=>{const n=this._getIndex(e);this._subscribers.splice(n,1)}}}const B=100,H=75,S=new O;class _ extends s.Component{constructor(e){super(e),this._weSetFocusivity=void 0,this._anchorNode=void 0,this._focused=void 0,this._hovered=void 0,this._stolenFromUs=void 0,this._unsubscribeFromTracker=void 0,this._timeoutID=void 0,this.activeStateStolen=()=>{this._stolenFromUs=this.state.active||!!this._timeoutID,this._focused=!1,this._setActiveState(!1,!0)},this._handleFocusIn=()=>{this._updateActiveState(this._hovered,!0)},this._handleFocusOut=()=>{this._updateActiveState(this._hovered,!1)},this._handleMouseEnter=()=>{this._updateActiveState(!0,this._focused)},this._handleMouseLeave=()=>{this._updateActiveState(!1,this._focused)},this._handleKeyUp=t=>{t.key==="Escape"&&this.state.active&&(t.preventDefault(),t.stopPropagation(),this._updateActiveState(!1,!1))},this._focused=!1,this._hovered=!1,this.state={active:!1}}componentDidMount(){const e=T.findDOMNode(this);if(e instanceof Text)throw new Error("TooltipAnchor must be applied to an Element. Text content is not supported.");this._unsubscribeFromTracker=S.subscribe(this),this._anchorNode=e,this._updateFocusivity(),e&&(e.addEventListener("focusin",this._handleFocusIn),e.addEventListener("focusout",this._handleFocusOut),e.addEventListener("mouseenter",this._handleMouseEnter),e.addEventListener("mouseleave",this._handleMouseLeave),this.props.anchorRef(this._anchorNode))}componentDidUpdate(e){(e.forceAnchorFocusivity!==this.props.forceAnchorFocusivity||e.children!==this.props.children)&&this._updateFocusivity()}componentWillUnmount(){this._unsubscribeFromTracker&&this._unsubscribeFromTracker(),this._clearPendingAction();const e=this._anchorNode;e&&(e.removeEventListener("focusin",this._handleFocusIn),e.removeEventListener("focusout",this._handleFocusOut),e.removeEventListener("mouseenter",this._handleMouseEnter),e.removeEventListener("mouseleave",this._handleMouseLeave)),this.state.active&&document.removeEventListener("keyup",this._handleKeyUp)}_updateFocusivity(){const e=this._anchorNode;if(!e)return;const{forceAnchorFocusivity:t}=this.props,n=e.getAttribute("tabindex");t&&!n?(e.setAttribute("tabindex","0"),this._weSetFocusivity=!0):!t&&n&&this._weSetFocusivity&&(e.removeAttribute("tabindex"),this._weSetFocusivity=!1)}_updateActiveState(e,t){this._hovered=e,this._focused=t,this._setActiveState(e||t)}_clearPendingAction(){this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=null)}_setActiveState(e,t){if(this._stolenFromUs||e!==this.state.active||!this.state.active&&this._timeoutID)this._clearPendingAction();else if(e===this.state.active&&!this._timeoutID)return;if(t=t||e&&S.steal(this),t)e?document.addEventListener("keyup",this._handleKeyUp):document.removeEventListener("keyup",this._handleKeyUp),this.setState({active:e}),this.props.onActiveChanged(e),!this._stolenFromUs&&!e&&S.giveup(),this._stolenFromUs=!1;else{const n=e?B:H;this._timeoutID=setTimeout(()=>{this._timeoutID=null,this._setActiveState(e,!0)},n)}}_renderAnchorableChildren(){const{children:e}=this.props;return typeof e=="string"?s.createElement(k,null,e):e}_renderAccessibleChildren(e){const t=this._renderAnchorableChildren();return s.cloneElement(t,{"aria-describedby":e.get(_.ariaContentId)})}render(){return this.props.ids?this._renderAccessibleChildren(this.props.ids):this._renderAnchorableChildren()}}_.defaultProps={forceAnchorFocusivity:!0};_.ariaContentId="aria-content";function A(){return A=Object.assign?Object.assign.bind():function(p){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(p[n]=t[n])}return p},A.apply(this,arguments)}let P=0;class $ extends s.Component{_calculateDimensionsFromPlacement(){const{placement:e}=this.props,t=.5;switch(e){case"top":return{trimlinePoints:[`0,-${t}`,`${r},-${t}`],points:["0,0",`${r/2},${o}`,`${r},0`],height:o,width:r};case"right":return{trimlinePoints:[`${o+t},0`,`${o+t},${r}`],points:[`${o},0`,`0,${r/2}`,`${o},${r}`],width:o,height:r};case"bottom":return{trimlinePoints:[`0, ${o+t}`,`${r},${o+t}`],points:[`0, ${o}`,`${r/2},0`,`${r},${o}`],width:r,height:o};case"left":return{trimlinePoints:[`-${t},0`,`-${t},${r}`],points:["0,0",`${o},${r/2}`,`0,${r}`],width:o,height:r};default:throw new Error(`Unknown placement: ${e}`)}}_getFilterPositioning(){const{placement:e}=this.props;switch(e){case"top":return{y:"-50%",x:"-50%",offsetShadowX:0};case"bottom":return null;case"left":return{y:"-50%",x:"0%",offsetShadowX:1};case"right":return{y:"-50%",x:"-100%",offsetShadowX:-1};default:throw new Error(`Unknown placement: ${e}`)}}_maybeRenderDropshadow(e){const t=this._getFilterPositioning();if(!t)return null;const{placement:n}=this.props,{y:i,x:l,offsetShadowX:a}=t,d=`tooltip-dropshadow-${n}-${P++}`;return[s.createElement("filter",{key:"filter",id:d,width:"200%",height:"200%",x:l,y:i},s.createElement("feGaussianBlur",{in:"SourceAlpha",stdDeviation:h.xxSmall_6/2}),s.createElement("feComponentTransfer",null,s.createElement("feFuncA",{type:"linear",slope:"0.3"}))),s.createElement("g",{key:"dropshadow",transform:`translate(${a},5.5)`},s.createElement("polyline",{fill:c.offBlack16,points:e.join(" "),stroke:c.offBlack32,filter:`url(#${d})`}))]}_getFullTailWidth(){return r+2*u}_getFullTailHeight(){return o+m}_getContainerStyle(){const{placement:e}=this.props,t=this._getFullTailWidth(),n=this._getFullTailHeight();switch(e){case"top":return{top:-1,width:t,height:n};case"right":return{left:1,width:n,height:t};case"bottom":return{top:1,width:t,height:n};case"left":return{left:-1,width:n,height:t};default:throw new Error(`Unknown placement: ${e}`)}}_getArrowStyle(){const{placement:e}=this.props;switch(e){case"top":return{marginLeft:u,marginRight:u,paddingBottom:m};case"right":return{marginTop:u,marginBottom:u,paddingLeft:m};case"bottom":return{marginLeft:u,marginRight:u,paddingTop:m};case"left":return{marginTop:u,marginBottom:u,paddingRight:m};default:throw new Error(`Unknown placement: ${e}`)}}_renderArrow(){const{trimlinePoints:e,points:t,height:n,width:i}=this._calculateDimensionsFromPlacement(),{color:l,show:a}=this.props;return a?s.createElement("svg",{className:g.css(x.arrow),style:this._getArrowStyle(),width:i,height:n,"aria-hidden":!0},this._maybeRenderDropshadow(t),s.createElement("polyline",{fill:c[l],stroke:c[l],points:t.join(" ")}),s.createElement("polyline",{fill:c[l],points:t.join(" "),stroke:c.offBlack16}),s.createElement("polyline",{stroke:c[l],points:e.join(" ")})):s.createElement(F,{size:n})}render(){const{offset:e,placement:t,updateRef:n}=this.props;return s.createElement(v,{style:[x.tailContainer,A({},e),this._getContainerStyle()],"data-placement":t,ref:n},this._renderArrow())}}$.defaultProps={color:"white",show:!0};const m=h.xSmall_8,u=h.xSmall_8,r=h.large_24,o=h.small_12,x=g.StyleSheet.create({tailContainer:{position:"relative",pointerEvents:"none"},arrow:{overflow:"visible"}});class N extends s.Component{constructor(...e){super(...e),this.state={active:!1},this.handleMouseEnter=()=>{this._setActiveState(!0)},this.handleMouseLeave=()=>{this.props.onActiveChanged(!1)}}_setActiveState(e){this.setState({active:e}),this.props.onActiveChanged(e)}render(){const{id:e,children:t,updateBubbleRef:n,placement:i,isReferenceHidden:l,style:a,updateTailRef:d,tailOffset:w,backgroundColor:f}=this.props;return s.createElement(v,{id:e,role:"tooltip","data-placement":i,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,ref:n,style:[l&&b.hide,b.bubble,b[`content-${i}`],a]},s.createElement(v,{style:[b.content,f&&{backgroundColor:c[f]}]},t),s.createElement($,{updateRef:d,placement:i,offset:w,color:f}))}}const b=g.StyleSheet.create({bubble:{position:"absolute"},hide:{pointerEvents:"none",opacity:0,backgroundColor:"transparent",color:"transparent"},"content-top":{flexDirection:"column"},"content-right":{flexDirection:"row-reverse"},"content-bottom":{flexDirection:"column-reverse"},"content-left":{flexDirection:"row"},content:{maxWidth:472,borderRadius:h.xxxSmall_4,border:`solid 1px ${c.offBlack16}`,backgroundColor:c.white,boxShadow:`0 ${h.xSmall_8}px ${h.xSmall_8}px 0 ${c.offBlack8}`,justifyContent:"center"}});class W extends s.Component{_renderTitle(){const{title:e}=this.props;return e?typeof e=="string"?s.createElement(U,null,e):e:null}_renderChildren(){const{children:e}=this.props;return typeof e=="string"?s.createElement(L,null,e):e}render(){const e=this._renderTitle(),t=this._renderChildren(),n=e?C.withTitle:C.withoutTitle;return s.createElement(v,{style:[n,this.props.contentStyle],testId:this.props.testId},e,e&&t&&s.createElement(F,{size:h.xxxSmall_4}),t)}}const C=g.StyleSheet.create({withoutTitle:{padding:`10px ${h.medium_16}px`},withTitle:{padding:h.medium_16}});class R{constructor(){this._lastRef=void 0,this._targetFn=void 0,this.updateRef=e=>{if(e){const n=T.findDOMNode(e);if(n instanceof HTMLElement&&n!==this._lastRef){var t;this._lastRef=n,(t=this._targetFn)==null||t.call(this,n)}}},this.setCallback=e=>{if(this._targetFn!==e){if(e&&typeof e!="function")throw new Error("targetFn must be a function");this._targetFn=e||void 0,this._lastRef&&this._targetFn&&this._targetFn(this._lastRef)}}}}class j extends s.Component{constructor(...e){super(...e),this._bubbleRefTracker=new R,this._tailRefTracker=new R,this._observer=null,this._popperUpdate=null}componentDidMount(){const{anchorElement:e,autoUpdate:t}=this.props;!e||!t||(this._observer=new MutationObserver(()=>{var n;(n=this._popperUpdate)==null||n.call(this)}),this._observer.observe(e,{attributes:!0,childList:!0,subtree:!0}))}componentWillUnmount(){var e;(e=this._observer)==null||e.disconnect()}_renderPositionedContent(e){const{children:t}=this.props,n=e.placement||this.props.placement;this._bubbleRefTracker.setCallback(e.ref),this._tailRefTracker.setCallback(e.arrowProps.ref),this._popperUpdate=e.update;const i={placement:n,style:{top:e.style.top,left:e.style.left,bottom:e.style.bottom,right:e.style.right,position:e.style.position,transform:e.style.transform},updateBubbleRef:this._bubbleRefTracker.updateRef,tailOffset:{bottom:e.arrowProps.style.bottom,right:e.arrowProps.style.right,top:e.arrowProps.style.top,left:e.arrowProps.style.left,transform:e.arrowProps.style.transform},updateTailRef:this._tailRefTracker.updateRef,isReferenceHidden:e.isReferenceHidden};return t(i)}render(){const{anchorElement:e,placement:t}=this.props;return s.createElement(M,{referenceElement:e,strategy:"fixed",placement:t,modifiers:[{name:"preventOverflow",options:{rootBoundary:"viewport"}}]},n=>this._renderPositionedContent(n))}}class y extends s.Component{constructor(...e){super(...e),this.state={active:!1,activeBubble:!1}}static getDerivedStateFromProps(e,t){return{active:typeof e.opened=="boolean"?e.opened:t.active}}_updateAnchorElement(e){e&&e!==this.state.anchorElement&&this.setState({anchorElement:e})}_renderBubbleContent(){const{title:e,content:t,contentStyle:n,testId:i}=this.props;return typeof t=="string"?s.createElement(W,{title:e,contentStyle:n,testId:i?`${i}-content`:void 0},t):e?s.cloneElement(t,{title:e}):t}_renderPopper(e){const{id:t,backgroundColor:n}=this.props,i=e?e.get(y.ariaContentId):t;if(!i)throw new Error("Did not get an identifier factory nor a id prop");const{placement:l}=this.props;return s.createElement(j,{anchorElement:this.state.anchorElement,placement:l,autoUpdate:this.props.autoUpdate},a=>s.createElement(N,{id:i,style:a.style,backgroundColor:n,tailOffset:a.tailOffset,isReferenceHidden:a.isReferenceHidden,placement:a.placement,updateTailRef:a.updateTailRef,updateBubbleRef:a.updateBubbleRef,onActiveChanged:d=>this.setState({activeBubble:d})},this._renderBubbleContent()))}_getHost(){const{anchorElement:e}=this.state;return I(e)||document.body}_renderTooltipAnchor(e){const{autoUpdate:t,children:n,forceAnchorFocusivity:i}=this.props,{active:l,activeBubble:a}=this.state,d=this._getHost(),w=t?this.state.anchorElement:!0,f=d&&(l||a)&&w;return s.createElement(s.Fragment,null,s.createElement(_,{forceAnchorFocusivity:i,anchorRef:E=>this._updateAnchorElement(E),onActiveChanged:E=>this.setState({active:E}),ids:e},n),f&&T.createPortal(this._renderPopper(e),d))}render(){const{id:e}=this.props;return e?this._renderTooltipAnchor():s.createElement(D,{scope:"tooltip",mockOnFirstRender:!0},t=>this._renderTooltipAnchor(t))}}y.defaultProps={forceAnchorFocusivity:!0,placement:"top"};y.ariaContentId="aria-content";export{j as T,$ as a,y as b};
