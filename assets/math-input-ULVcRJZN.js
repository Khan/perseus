import{j as o,a as g}from"./jsx-runtime-BGVbfQ2Z.js";import"./prop-types-fFJpPeTy.js";import{a as h,c as C,g as d,m as x}from"./key-translator-wunrbeOa.js";import{C as _,K as T}from"./index-oh0ULguc.js";import{M as S,c as E}from"./button-assets-j_a3DoNi.js";import{C as w}from"./index-1P5txiDe.js";import{V as k}from"./index-4c2J3ov1.js";import{_ as m}from"./index-uTjn352v.js";import{P as V,a as F}from"./index-cRKslbtI.js";import{c as i,s as f}from"./index-fuyzzUuV.js";import{l as B}from"./index-awljIyHI.js";import{c as K}from"./index-awCzqCwC.js";import{$ as I}from"./jquery-5v7aFUvu.js";import{r as q}from"./index-qhcEwEpg.js";import{_ as R}from"./index-default-4_ZsnO94.js";const A=(n,e)=>{let t=null;return(...a)=>{t&&clearTimeout(t),t=window.setTimeout(()=>{n(...a)},e)}},u=class u extends q.Component{constructor(){super(...arguments),this.__mathFieldWrapperRef=null,this.__mathField=null,this.state={focused:!1,keypadOpen:this.props.buttonsVisible==="always",cursorContext:_.NONE},this.insert=e=>{const t=this.mathField(),{locale:a}=this.context,s={...h(a),FRAC:l=>{const v=l.latex();l.typedText("/"),l.latex()===v&&l.cmd("\\frac")}}[e];if(s){s(t,e),t==null||t.focus();return}R(e).isFunction()?e(t):e[0]==="\\"?t==null||t.cmd(e).focus():t==null||t.write(e).focus(),t==null||t.focus()},this.mathField=()=>{if(!this.__mathField&&this.__mathFieldWrapperRef){const{strings:e,locale:t}=this.context;this.__mathField=C(this.__mathFieldWrapperRef,e,a=>({...a,handlers:{edit:A(r=>{let s=r.latex();if(s=s.replace(/<>/g,"\\ne"),E(t,this.props.convertDotToTimes)){s=s.replace(/\\cdot/g,"\\times");const l=r.cursor()[x.L];l&&l.ctrlSeq==="\\cdot "&&(r.controller().backspace(),r.cmd("\\times"))}else s=s.replace(/\\times/g,"\\cdot");this.props.value!==s&&this.props.onChange(s),this.setState({cursorContext:d(r)})},100),enter:()=>{this.__mathFieldWrapperRef&&I(this.__mathFieldWrapperRef).submit()},upOutOf:r=>{r.typedText("^")}}}))}return this.__mathField},this.focus=()=>{var e;(e=this.mathField())==null||e.focus(),this.setState({focused:!0})},this.blur=()=>this.setState({focused:!1}),this.handleKeypadPress=(e,t)=>{const{strings:a}=this.context,r=h(a)[e],s=this.mathField();s&&(r&&r(s,e),this.setState({cursorContext:d(s)})),t.type==="click"&&this.focus()}}componentDidMount(){var e;(e=this.mathField())==null||e.latex(this.props.value)}openKeypad(){this.props.buttonsVisible!=="never"&&this.setState({keypadOpen:!0})}closeKeypad(){this.setState({keypadOpen:!1})}render(){let e=K({"perseus-math-input":!0,"mq-editable-field":!0,"mq-math-mode":!0});return this.props.className&&(e=e+" "+this.props.className),o(k,{style:[p.outerWrapper,this.state.focused&&p.wrapperFocused,this.props.hasError&&p.wrapperError],children:g("div",{style:{display:"flex",padding:1},onClick:t=>{t.stopPropagation();const a=this.mathField();a&&this.setState({cursorContext:d(a)})},children:[o("span",{className:e,ref:t=>this.__mathFieldWrapperRef=t,"aria-label":this.props.labelText,onFocus:()=>this.focus(),onBlur:()=>this.blur()}),o(V,{opened:this.state.keypadOpen,onClose:()=>this.closeKeypad(),dismissEnabled:!0,content:()=>{var t;return o(F,{closeButtonVisible:!0,style:p.popoverContent,children:o(T,{onAnalyticsEvent:this.props.analytics.onAnalyticsEvent,extraKeys:this.props.extraKeys,onClickKey:this.handleKeypadPress,cursorContext:this.state.cursorContext,convertDotToTimes:this.props.convertDotToTimes,...this.props.keypadButtonSets??L((t=this.props)==null?void 0:t.buttonSets)})})},children:this.props.buttonsVisible==="never"?o(y,{hovered:!1,focused:!1,active:!1}):o(w,{"aria-label":this.state.keypadOpen?m("close math keypad"):m("open math keypad"),"aria-checked":this.state.keypadOpen,role:"switch",onClick:()=>this.state.keypadOpen?this.closeKeypad():this.openKeypad(),children:t=>o(y,{active:this.state.keypadOpen,...t})})})]})})}};u.defaultProps={value:"",convertDotToTimes:!1};let c=u;c.contextType=S;const y=({hovered:n,focused:e,active:t})=>{let a;switch(!0){case(e||t):a=i.white;break;case n:a=i.blue;break;default:a=i.offBlack;break}const r=t||e?p.iconActive:p.iconInactive;return o(k,{style:[p.iconContainer,r],children:o("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:a,viewBox:"0 0 256 256",children:o("path",{d:"M112,72a8,8,0,0,1-8,8H40a8,8,0,0,1,0-16h64A8,8,0,0,1,112,72Zm-8,104H80V152a8,8,0,0,0-16,0v24H40a8,8,0,0,0,0,16H64v24a8,8,0,0,0,16,0V192h24a8,8,0,0,0,0-16Zm48,0h64a8,8,0,0,0,0-16H152a8,8,0,0,0,0,16Zm64,16H152a8,8,0,0,0,0,16h64a8,8,0,0,0,0-16Zm-61.66-90.34a8,8,0,0,0,11.32,0L184,83.31l18.34,18.35a8,8,0,0,0,11.32-11.32L195.31,72l18.35-18.34a8,8,0,0,0-11.32-11.32L184,60.69,165.66,42.34a8,8,0,0,0-11.32,11.32L172.69,72,154.34,90.34A8,8,0,0,0,154.34,101.66Z"})})})},L=n=>{const e={};return n&&n.forEach(t=>{switch(t){case"advanced relations":e.advancedRelations=!0;break;case"basic relations":e.basicRelations=!0;break;case"basic+div":e.divisionKey=!0;break;case"logarithms":e.logarithms=!0;break;case"prealgebra":e.preAlgebra=!0;break;case"trig":e.trigonometry=!0;break}}),e},b={borderWidth:2,borderColor:i.blue,margin:-1},p=B.StyleSheet.create({iconContainer:{display:"flex",justifyContent:"center",height:"100%",padding:f.xxxSmall_4,borderRadius:1},iconInactive:{backgroundColor:i.offBlack8},iconActive:{backgroundColor:i.offBlack64},outerWrapper:{display:"inline-block",borderStyle:"solid",borderWidth:1,borderColor:i.offBlack50,borderRadius:3,background:i.white,":hover":b},wrapperFocused:b,wrapperError:{borderColor:i.red,background:i.fadedRed8,":hover":{borderColor:i.red}},popoverContent:{padding:0,paddingBottom:f.xxSmall_6,maxWidth:"initial"}});try{c.displayName="MathInput",c.__docgenInfo={description:"",displayName:"MathInput",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},value:{defaultValue:{value:""},description:"",name:"value",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"any"}},convertDotToTimes:{defaultValue:{value:"false"},description:"",name:"convertDotToTimes",required:!1,type:{name:"boolean"}},buttonSets:{defaultValue:null,description:"@deprecated Use `keypadButtonSets` instead. Maps to `keypadButtonSets`.\n@see keypadButtonSets",name:"buttonSets",required:!1,type:{name:"LegacyButtonSets"}},keypadButtonSets:{defaultValue:null,description:"Overrides deprecated `buttonSets` prop.",name:"keypadButtonSets",required:!1,type:{name:"KeypadButtonSets"}},labelText:{defaultValue:null,description:"",name:"labelText",required:!1,type:{name:"string"}},onFocus:{defaultValue:null,description:"",name:"onFocus",required:!1,type:{name:"(() => void)"}},onBlur:{defaultValue:null,description:"",name:"onBlur",required:!1,type:{name:"(() => void)"}},hasError:{defaultValue:null,description:"",name:"hasError",required:!1,type:{name:"boolean"}},extraKeys:{defaultValue:null,description:"",name:"extraKeys",required:!1,type:{name:'readonly ("PLUS" | "MINUS" | "NEGATIVE" | "TIMES" | "DIVIDE" | "DECIMAL" | "PERIOD" | "PERCENT" | "CDOT" | "EQUAL" | "NEQ" | "GT" | "LT" | "GEQ" | "LEQ" | "FRAC_INCLUSIVE" | "FRAC_EXCLUSIVE" | ... 96 more ... | "LOG_B")[]'}},buttonsVisible:{defaultValue:null,description:"Whether to show the keypad buttons.\nThe strings now misleading, but we keep them for backwards compatibility.\n- `focused` means that the keypad **appears on toggle, *off* by default**.\n- `always` means that the keypad **appears on toggle, *on* by default.**\n- `never` means that the keypad is **never shown**.",name:"buttonsVisible",required:!1,type:{name:"enum",value:[{value:'"always"'},{value:'"never"'},{value:'"focused"'}]}},analytics:{defaultValue:null,description:"",name:"analytics",required:!0,type:{name:"{ onAnalyticsEvent: AnalyticsEventHandlerFn; }"}}}}}catch{}export{c as M};
