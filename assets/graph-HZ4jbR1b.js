import{j as v,a as _}from"./jsx-runtime-BGVbfQ2Z.js";import{U as k}from"./util-G-g1AweO.js";import{_ as l}from"./index-default-4_ZsnO94.js";import{G as w,m as u,S as x}from"./svg-image-O4Zh6lWM.js";import{$ as d}from"./jquery-5v7aFUvu.js";import{r as q}from"./index-qhcEwEpg.js";import{R as G}from"./index-E09jvG0x.js";import{c as V}from"./asset-context-pmjKTqqL.js";import{i as C}from"./constants-5iWyYZaE.js";const D={url:null},U={fontStyle:"italic",fontWeight:"bold",fontSize:"32px",width:"100%",height:"100%",textAlign:"center",backgroundColor:"white",position:"absolute",zIndex:1,transition:"opacity .25s ease-in-out"},P={position:"relative",top:"25%"};function I(m,s){return Math.floor((m[1]-m[0])/s)}const y=class y extends q.Component{constructor(){super(...arguments),this.reset=()=>{this._setupGraphie(!1)},this.graphie=()=>this._graphie,this.pointsFromNormalized=(s,t)=>{const o=this;return l.map(s,function(i){return l.map(i,function(a,n){const p=o.props.range[n];if(t)return p[0]+(p[1]-p[0])*a;const c=o.props.step[n],r=I(p,c),f=Math.round(a*r);return p[0]+c*f})})},this._setupGraphie=s=>{if(this._hasSetupGraphieThisUpdate)return;const t=G.findDOMNode(this.refs.graphieDiv);d(t).empty();const o=this.props.labels.map(e=>k.unescapeMathMode(e)),i=this.props.range,a=this._graphie=w.createGraphie(t),n=this._getGridConfig();a.snap=this.props.snapStep,this.props.markings==="graph"?(a.graphInit({range:i,scale:u(n,e=>e.scale),axisArrows:"<->",labelFormat:function(e){return"\\small{"+e+"}"},gridStep:this.props.gridStep,tickStep:u(n,e=>e.tickStep),labelStep:1,unityLabels:u(n,e=>e.unityLabel),isMobile:this.props.isMobile}),a.label([0,i[1][1]],o[1],this.props.isMobile?"below right":"above"),a.label([i[0][1],0],o[0],this.props.isMobile?"above left":"right")):this.props.markings==="grid"?a.graphInit({range:i,scale:u(n,e=>e.scale),gridStep:this.props.gridStep,axes:!1,ticks:!1,labels:!1,isMobile:this.props.isMobile}):this.props.markings==="none"&&a.init({range:i,scale:u(n,e=>e.scale),isMobile:this.props.isMobile});const p=.5,c=0;let r;if(this.props.instructions){r=d("<div/>"),l.each(U,function(g,b){r.css(b,g)}),r.css("opacity",p);const e=d("<span/>",{text:this.props.instructions});l.each(P,function(g,b){e.css(b,g)}),r.append(e),d(t).append(r)}else r=void 0;const f=r||this.props.onMouseDown?l.bind(function(e){r&&(r.remove(),r=null),this.props.onMouseDown(e)},this):void 0,M=r?function(){r&&r.css("opacity",c)}:void 0,S=r?function(){r&&r.css("opacity",p)}:void 0;if(a.addMouseLayer({onClick:this.props.onClick,onMouseDown:f,onMouseOver:M,onMouseOut:S,onMouseMove:this.props.onMouseMove,allowScratchpad:!0,setDrawingAreaAvailable:this.props.setDrawingAreaAvailable}),this.props.lockedFigures)for(const e of this.props.lockedFigures)switch(e.type){case"point":a.circle(e.coord,.2,e.style);break;default:throw e.type,new Error(`Unknown locked shape type: ${e.type}`)}this._updateProtractor(),this._updateRuler(),this._hasSetupGraphieThisUpdate=!0,!s&&this.props.onGraphieUpdated&&this.props.onGraphieUpdated(a)},this._getGridConfig=()=>u(this.props.step,(s,t)=>k.gridDimensionConfig(s,this.props.range[t],this.props.box[t],this.props.gridStep[t])),this._updateProtractor=()=>{if(this.protractor&&this.protractor.remove(),this.props.showProtractor){const s=this.pointsFromNormalized([[.5,.05]])[0];this.protractor=this._graphie.protractor(s)}},this._updateRuler=()=>{if(this.ruler&&this.ruler.remove(),this.props.showRuler){const s=this.pointsFromNormalized([[.5,.25]])[0],t=this._graphie.range[0][1]-this._graphie.range[0][0];this.ruler=this._graphie.ruler({center:s,label:this.props.rulerLabel,pixelsPerUnit:this._graphie.scale[0],ticksPerUnit:this.props.rulerTicks,units:Math.round(.8*t)})}},this.toJSON=()=>l.pick(this.props,"range","step","markings","labels","backgroundImage","showProtractor","showRuler","rulerLabel","rulerTicks","gridStep","snapStep")}componentDidMount(){this._setupGraphie(!0)}UNSAFE_componentWillReceiveProps(s){const t=["labels","range","step","markings","showProtractor","showRuler","rulerLabel","rulerTicks","gridStep","snapStep"],o=this;l.each(t,function(i){l.isEqual(o.props[i],s[i])||(o._shouldSetupGraphie=!0)})}componentDidUpdate(){this._hasSetupGraphieThisUpdate=!1,this._shouldSetupGraphie&&(this._setupGraphie(!1),this._shouldSetupGraphie=!1)}render(){let s;const t=this.props.backgroundImage;if(t.url){const o=this.props.box[0]/C.defaultBoxSize;s=v(V.Consumer,{children:({setAssetStatus:i})=>v(x,{src:t.url,width:t.width,height:t.height,scale:o,responsive:!1,setAssetStatus:i})})}else s=null;return _("div",{className:"graphie-container above-scratchpad",style:{width:this.props.box[0],height:this.props.box[1]},onMouseOut:this.onMouseOut,onMouseOver:this.onMouseOver,onClick:this.onClick,children:[s,v("div",{className:"graphie",ref:"graphieDiv"})]})}};y.defaultProps={labels:["x","y"],range:[[-10,10],[-10,10]],step:[1,1],gridStep:[1,1],snapStep:[.5,.5],markings:"graph",backgroundImage:D,showProtractor:!1,showRuler:!1,rulerLabel:"",rulerTicks:10,isMobile:!1};let h=y;try{h.displayName="Graph",h.__docgenInfo={description:"",displayName:"Graph",props:{box:{defaultValue:null,description:"",name:"box",required:!0,type:{name:"[number, number]"}},labels:{defaultValue:{value:'["x", "y"]'},description:"",name:"labels",required:!1,type:{name:"readonly string[]"}},range:{defaultValue:{value:`[
            [-10, 10],
            [-10, 10],
        ]`},description:"",name:"range",required:!1,type:{name:"[Coord, Coord]"}},step:{defaultValue:{value:"[1, 1]"},description:"",name:"step",required:!1,type:{name:"[number, number]"}},gridStep:{defaultValue:{value:"[1, 1]"},description:"",name:"gridStep",required:!1,type:{name:"[number, number]"}},snapStep:{defaultValue:{value:"[0.5, 0.5]"},description:"",name:"snapStep",required:!1,type:{name:"[number, number]"}},markings:{defaultValue:{value:"graph"},description:"",name:"markings",required:!1,type:{name:"string"}},backgroundImage:{defaultValue:{value:`{
    url: null,
}`},description:"",name:"backgroundImage",required:!1,type:{name:"PerseusImageBackground"}},showProtractor:{defaultValue:{value:"false"},description:"",name:"showProtractor",required:!1,type:{name:"boolean"}},showRuler:{defaultValue:{value:"false"},description:"",name:"showRuler",required:!1,type:{name:"boolean"}},rulerLabel:{defaultValue:{value:""},description:"",name:"rulerLabel",required:!1,type:{name:"string"}},rulerTicks:{defaultValue:{value:"10"},description:"",name:"rulerTicks",required:!1,type:{name:"number"}},instructions:{defaultValue:null,description:"",name:"instructions",required:!1,type:{name:"string"}},isMobile:{defaultValue:{value:"false"},description:"",name:"isMobile",required:!1,type:{name:"boolean"}},lockedFigures:{defaultValue:null,description:"",name:"lockedFigures",required:!1,type:{name:"readonly LockedPoint[]"}},onGraphieUpdated:{defaultValue:null,description:"",name:"onGraphieUpdated",required:!1,type:{name:"((graphie: any) => void)"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"((Coord: any) => void)"}},onMouseDown:{defaultValue:null,description:"",name:"onMouseDown",required:!1,type:{name:"((Coord: any) => void)"}},onMouseMove:{defaultValue:null,description:"",name:"onMouseMove",required:!1,type:{name:"((Coord: any) => void)"}},setDrawingAreaAvailable:{defaultValue:null,description:"",name:"setDrawingAreaAvailable",required:!1,type:{name:"((boolean: any) => void)"}}}}}catch{}export{h as G};
