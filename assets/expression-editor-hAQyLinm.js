import{j as n,a as c,F as I}from"./jsx-runtime-FVsy8kgq.js";import{p as N}from"./util-XcxTwqb0.js";import{a as C,c as D,P as R,E as _}from"./article-renderer-8uzAHBVn.js";import{_ as g}from"./jquery-yG1GhClm.js";import"./phet-simulation-sG7qSwcf.js";import"./version-akiLXZts.js";import"./dependencies-8XILypbq.js";import"./perseus-api--FMzJRa0.js";import{l as w}from"./multi-renderer-XUNDymQT.js";import"./hints-renderer-x4hNoxQP.js";import"./renderer-vNHzJQJF.js";import"./base-radio-Cj20Lj-s.js";import{c as T}from"./components-QATbWbgm.js";import"./index-0C4KXdeC.js";import"./i18n-context-W41LcU6B.js";import"./svg-image-Rjw-_QTV.js";import{f as q}from"./index-J2t_5nK1.js";import{B as f}from"./choice-j6w4LtFN.js";import{C as m,l as S}from"./index-QCAhLhLD.js";import{S as O}from"./index-qUyqkRvh.js";import{s as p,c as y}from"./index-deFLJwr4.js";import{H as k,d as L}from"./index-h_CiYGGb.js";import{l}from"./index-awljIyHI.js";import{r as F}from"./index-TT1qJ6UJ.js";import{P as B}from"./index-k-0mNqHS.js";import{R as Y}from"./index-7vsPyIck.js";const d=B,z=C({propTypes:{className:d.string,components:d.arrayOf(d.node).isRequired,onReorder:d.func.isRequired,style:d.any,verify:d.func},getDefaultProps:function(){return{verify:()=>!0}},getInitialState:function(){return{dragging:null,components:this.props.components}},componentDidMount:function(){this._setDragEvents()},UNSAFE_componentWillReceiveProps:function(r){this.setState({components:r.components})},componentDidUpdate:function(){this._setDragEvents()},onDragStart:function(r){this.setState({dragging:r})},onDrop:function(){this.setState({dragging:null}),this.props.onReorder(this.state.components)},onDragEnter:function(r){if(this.state.dragging===r)return;const i=this.state.components.slice(),e=i.splice(this.state.dragging,1);i.splice(r,0,e[0]);const t=this.props.verify(i);return t&&this.setState({dragging:r,components:i}),t},_listenEvent:function(r){r.dataTransfer.setData("hackhackhack","because browsers!")},_cancelEvent:function(r){r.preventDefault()},_setDragEvents:function(){this._dragItems=this._dragItems||[];const r=Y.findDOMNode(this).querySelectorAll("[draggable=true]"),i=[],e=[];for(let t=0;t<this._dragItems.length;t++){const s=this._dragItems[t];r.indexOf(s)<0&&i.push(s)}for(let t=0;t<r.length;t++){const s=r[t];this._dragItems.indexOf(s)<0&&e.push(s)}for(let t=0;t<e.length;t++){const s=e[t];s.addEventListener("dragstart",this._listenEvent),s.addEventListener("drop",this._cancelEvent)}for(let t=0;t<i.length;t++){const s=i[t];s.removeEventListener("dragstart",this._listenEvent),s.removeEventListener("drop",this._cancelEvent)}},render:function(){const r=this.state.components.map((i,e)=>n(P,{index:e,component:i,area:this,draggable:i.props.draggable,dragging:e===this.state.dragging},i.key));return n("ol",{className:this.props.className,style:this.props.style,children:r})}}),P=C({propTypes:{area:d.shape({onDragEnter:d.func.isRequired,onDragStart:d.func.isRequired,onDrop:d.func.isRequired}),component:d.node.isRequired,dragging:d.bool.isRequired,draggable:d.bool.isRequired,index:d.number.isRequired},handleDragStart:function(r){r.nativeEvent.dataTransfer.effectAllowed="move",this.props.area.onDragStart(this.props.index)},handleDrop:function(){this.props.area.onDrop(this.props.index)},handleDragEnter:function(r){const i=this.props.area.onDragEnter(this.props.index);r.nativeEvent.dataTransfer.effectAllowed=i?"move":"none"},handleDragOver:function(r){r.preventDefault()},render:function(){let r="sortable-disabled";return this.props.dragging?r="sortable-dragging":this.props.draggable&&(r="sortable-enabled"),n("li",{draggable:this.props.draggable,className:[r,l.css(U.sortableListItem)].join(" "),onDragStart:this.handleDragStart,onDrop:this.handleDrop,onDragEnter:this.handleDragEnter,onDragOver:this.handleDragOver,children:this.props.component})}}),U=l.StyleSheet.create({sortableListItem:{margin:"5px 0"}}),{InfoTip:u}=T,A=["basic","trig","prealgebra","logarithms","basic relations","advanced relations"],E=({key:r})=>Number.parseInt(r??""),V=r=>{const i=[];r.forEach(e=>{i[E(e)]=!0});for(let e=0;e<i.length;e++)if(!i[e])return e;return i.length},b=class b extends F.Component{constructor(i){super(i),this.serialize=()=>{const e=["value","form","simplify","considered","key"],t=["answerForms","buttonSets","functions","times","visibleLabel","ariaLabel"],s=this.props.answerForms.map(a=>g(a).pick(e));return w(this.props).set(["answerForms"],s).mod([],a=>g(a).pick(t)).freeze()},this.getSaveWarnings=()=>{const e=[];return this.props.answerForms.length===0?e.push("No answers specified"):(this.props.answerForms.some(s=>s.considered==="correct")||e.push("No correct answer specified"),g(this.props.answerForms).each((s,a)=>{if(this.props.value==="")e.push(`Answer ${a+1} is empty`);else{const h=N(s.value,{functions:this.props.functions});h.parsed?s.simplify&&!h.expr.isSimplified()&&e.push(`${s.value} isn't simplified, but is required" +
                            " to be`):e.push(`Couldn't parse ${s.value}`)}})),e},this._newEmptyAnswerForm=()=>({considered:"correct",form:!1,key:V(this.props.answerForms),simplify:!1,value:""}),this.newAnswer=()=>{const e=this.props.answerForms.slice();e.push(this._newEmptyAnswerForm()),this.change({answerForms:e})},this.handleRemoveForm=e=>{const t=this.props.answerForms.slice();t.splice(e,1),this.change({answerForms:t})},this.updateForm=(e,t)=>{const s=w(this.props.answerForms).merge([e],t).freeze();this.change({answerForms:s})},this.handleReorder=e=>{const t=e.map(s=>{const a=g(s.props).pick("considered","form","simplify","value");return a.key=s.key,a});this.change({answerForms:t})},this.handleButtonSet=e=>{const s=A.filter(a=>this.props.buttonSets.includes(a)!==(a===e));this.props.onChange({buttonSets:s})},this.handleToggleDiv=()=>{let e,t;this.props.buttonSets.includes("basic+div")?(e="basic",t="basic+div"):(e="basic+div",t="basic");const s=this.props.buttonSets.filter(a=>a!==t).concat(e);this.change("buttonSets",s)},this.handleTexInsert=e=>{this.refs.expression.insert(e)},this.handleFunctions=e=>{this.setState({functionsInternal:e});const t={};t.functions=e.split(/[ ,]+/).filter(q),this.props.onChange(t)},this.state={functionsInternal:this.props.functions.join(" ")}}change(...i){return D.apply(this,i)}render(){const i=this.props.answerForms.map(s=>{const a=E(s),h={times:this.props.times,functions:this.props.functions,buttonSets:this.props.buttonSets,buttonsVisible:"focused",form:s.form,simplify:s.simplify,value:s.value,onChange:v=>this.updateForm(a,v),trackInteraction:()=>{},widgetId:this.props.widgetId+"-"+s.key};return w(s).merge([],{key:a,draggable:!0,onChange:v=>this.updateForm(Number.parseInt(s.key??""),v),onDelete:()=>this.handleRemoveForm(a),expressionProps:h}).freeze()}).map(s=>n(j,{...s},s.key)),e=n(z,{components:i,onReorder:this.handleReorder}),t=A.map(s=>{const a=s==="basic",h=this.props.buttonSets.includes(s)||a;return n(m,{label:s,checked:h,disabled:a,onChange:()=>this.handleButtonSet(s)},s)});return t.unshift(n(m,{label:"show ÷ button",checked:this.props.buttonSets.includes("basic+div"),onChange:this.handleToggleDiv},"show ÷ button")),c("div",{children:[n(k,{children:"Global Options"}),c("div",{className:l.css(o.paddedY),children:[n(S,{label:"Visible label",value:this.props.visibleLabel||"",onChange:this.change("visibleLabel")}),n(u,{children:n("p",{children:"Optional visible text; strongly encouraged to help learners using dictation software, but can be omitted if the surrounding content provides enough context."})})]}),c("div",{className:l.css(o.paddedY),children:[n(S,{label:"Aria label",value:this.props.ariaLabel||"",onChange:this.change("ariaLabel")}),n(u,{children:c("p",{children:["Label text that's read by screen readers. Highly recommend adding a label here to ensure your exercise is accessible. For more information on writting accessible labels, please see"," ",n("a",{href:"https://www.w3.org/WAI/tips/designing/#ensure-that-form-elements-include-clearly-associated-labels",target:"_blank",children:"this article."})]})})]}),c("div",{className:l.css(o.paddedY),children:[n(S,{label:"Function variables",value:this.state.functionsInternal,onChange:this.handleFunctions}),n(u,{children:n("p",{children:'Single-letter variables listed here will be interpreted as functions. This let us know that f(x) means "f of x" and not "f times x".'})})]}),c("div",{className:l.css(o.paddedY),children:[n(m,{label:"Use × instead of ⋅ for multiplication",checked:this.props.times,onChange:s=>{this.props.onChange({times:s})}}),n(u,{children:n("p",{children:"For pre-algebra problems this option displays multiplication as \\times instead of \\cdot in both the rendered output and the acceptable formats examples."})})]}),c("div",{className:l.css(o.paddedY),children:[n(L,{children:"Button Sets"}),t]}),n(k,{children:"Answers"}),n("p",{style:{margin:"4px 0"},children:"student responses area matched against these from top to bottom"}),e,n("div",{children:n(f,{size:"small",onClick:this.newAnswer,children:"Add new answer"})})]})}};b.widgetName="expression",b.defaultProps={answerForms:[],times:!1,buttonSets:["basic"],functions:["f","g","h"]};let x=b;const W=function(r,i){let e=r.indexOf(i);return e=(e+1)%r.length,r[e]};class j extends F.Component{constructor(){super(...arguments),this.state={deleteFocused:!1},this.change=(...i)=>D.apply(this,i),this.handleImSure=()=>{this.props.onDelete()},this.handleCancelDelete=()=>{this.setState({deleteFocused:!1})},this.handleDelete=()=>{this.setState({deleteFocused:!0})},this.toggleConsidered=()=>{const i=W(R,this.props.considered);this.change({considered:i})}}render(){const i=this.state.deleteFocused?c(I,{children:[n(f,{size:"small",onClick:this.handleImSure,color:"destructive",children:"I'm sure!"}),n(O,{size:p.small_12}),n(f,{size:"small",onClick:this.handleCancelDelete,light:!0,children:"Cancel"})]}):n(f,{size:"small",onClick:this.handleDelete,color:"destructive",light:!0,children:"Delete"}),e=l.css(o.answerStatus,this.props.considered==="wrong"&&o.answerStatusWrong,this.props.considered==="correct"&&o.answerStatusCorrect,this.props.considered==="ungraded"&&o.answerStatusUngraded);return c("div",{className:l.css(o.answerOption),children:[n("div",{className:l.css(o.answerHandle)}),c("div",{className:l.css(o.answerBody),children:[c("div",{children:[n("button",{onClick:this.toggleConsidered,className:e,children:this.props.considered}),n("div",{children:n(_,{...this.props.expressionProps})})]}),c("div",{className:l.css(o.paddedY,o.paddedX),children:[n(m,{label:"Answer expression must have the same form.",checked:this.props.form,onChange:t=>{this.props.onChange({form:t})}}),n(u,{children:n("p",{children:"The student's answer must be in the same form. Commutativity and excess negative signs are ignored."})})]}),c("div",{className:l.css(o.paddedY,o.paddedX),children:[n(m,{label:"Answer expression must be fully expanded and simplified.",checked:this.props.simplify,onChange:t=>{this.props.onChange({simplify:t})}}),n(u,{children:n("p",{children:`The student's answer must be fully expanded and simplified. Answering this equation (x^2+2x+1) with this factored equation (x+1)^2 will render this response "Your answer is not fully expanded and simplified."`})})]}),n("div",{className:l.css(o.buttonRow,o.paddedY),children:i})]})]})}}const o=l.StyleSheet.create({paddedX:{paddingLeft:p.xSmall_8,paddingRight:p.xSmall_8},paddedY:{paddingTop:p.xxSmall_6,paddingBottom:p.xxSmall_6},answerOption:{border:"1px solid #ddd",borderRadius:"3px",display:"flex"},answerHandle:{background:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAeCAYAAADkftS9AAAAIklEQVQoU2M4c+bMfxAGAgYYmwGrIIiDjrELjpo5aiZeMwF+yNnOs5KSvgAAAABJRU5ErkJggg==) no-repeat 50% 50%",borderRight:"1px solid #ddd",cursor:"move",width:"20px",minWidth:"20px"},answerStatus:{border:"none",userSelect:"none",width:"100px",paddingTop:p.small_12,paddingBottom:p.small_12},answerStatusWrong:{backgroundColor:y.fadedRed16},answerStatusCorrect:{backgroundColor:y.fadedGreen16},answerStatusUngraded:{backgroundColor:y.fadedBlue16},answerBody:{},buttonRow:{display:"flex"}});x.__docgenInfo={description:"",methods:[{name:"change",docblock:null,modifiers:[],params:[{name:"...args",optional:!1,type:null}],returns:null},{name:"serialize",docblock:null,modifiers:[],params:[],returns:null},{name:"getSaveWarnings",docblock:null,modifiers:[],params:[],returns:null},{name:"_newEmptyAnswerForm",docblock:null,modifiers:[],params:[],returns:null},{name:"newAnswer",docblock:null,modifiers:[],params:[],returns:null},{name:"handleRemoveForm",docblock:null,modifiers:[],params:[{name:"i",optional:!1,type:null}],returns:null},{name:"updateForm",docblock:null,modifiers:[],params:[{name:"i",optional:!1,type:null},{name:"props",optional:!1,type:null}],returns:null},{name:"handleReorder",docblock:null,modifiers:[],params:[{name:"components",optional:!1,type:null}],returns:null},{name:"handleButtonSet",docblock:null,modifiers:[],params:[{name:"changingName",optional:!1,type:null}],returns:null},{name:"handleToggleDiv",docblock:null,modifiers:[],params:[],returns:null},{name:"handleTexInsert",docblock:null,modifiers:[],params:[{name:"str",optional:!1,type:null}],returns:null},{name:"handleFunctions",docblock:null,modifiers:[],params:[{name:"value",optional:!1,type:null}],returns:null}],displayName:"ExpressionEditor",props:{widgetId:{required:!1,tsType:{name:"any"},description:""},value:{required:!1,tsType:{name:"string"},description:""},answerForms:{defaultValue:{value:"[]",computed:!1},required:!1},times:{defaultValue:{value:"false",computed:!1},required:!1},buttonSets:{defaultValue:{value:'["basic"]',computed:!1},required:!1},functions:{defaultValue:{value:'["f", "g", "h"]',computed:!1},required:!1}}};export{x as E};
