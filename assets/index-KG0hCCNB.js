import{_ as w}from"./extends-DDykod_l.js";import{r as o}from"./index-C6mWTJJr.js";import{r as f}from"./index-B1Gws05u.js";import{I as R,V as m,b as T}from"./index-CW2s7ekB.js";import{b as S,c as N}from"./index-DqS3kFds.js";import{m as A}from"./index-ByoCYR4k.js";import{n as F}from"./no-important-DlFk8a1I.js";import{s as i,c as K,a as P,b as $}from"./index-Ds5N5m2R.js";import{H as M,B as O}from"./index-DfoJsr3g.js";import{a as H,I as U,x as V}from"./index-DAJiRA_A.js";const G={close:void 0,placement:"top"},E=o.createContext(G);E.displayName="PopoverContext";class j extends o.Component{componentDidMount(){const t=f.findDOMNode(this);t&&this.props.anchorRef(t)}render(){const{children:t,id:e,onClick:n,"aria-controls":s,"aria-expanded":a}=this.props,r={id:e,"aria-controls":s,"aria-expanded":a};if(typeof t=="function"){const l=t({open:n});return o.cloneElement(l,r)}else return o.cloneElement(t,w({},t.props,r,{onClick:t.props.onClick?l=>{l.stopPropagation(),t.props.onClick(),n()}:n}))}}class W extends o.Component{componentDidUpdate(t){t.placement!==this.props.placement&&this.props.onUpdate(this.props.placement)}render(){const{placement:t,children:e,id:n,isReferenceHidden:s,updateBubbleRef:a,updateTailRef:r,tailOffset:l,style:b,showTail:u,"aria-describedby":p,"aria-labelledby":h,"aria-label":y}=this.props,g=e.props.color;return o.createElement(o.Fragment,null,o.createElement(m,{"aria-label":y,"aria-describedby":p,"aria-labelledby":h,id:n,role:"dialog",ref:a,"data-placement":t,style:[s&&C.hide,C[`content-${t}`],b]},e,o.createElement(N,{show:u,color:g,updateRef:r,placement:t,offset:l})))}}const C=F.StyleSheet.create({hide:{pointerEvents:"none",opacity:0,backgroundColor:"transparent",color:"transparent"},"content-top":{flexDirection:"column"},"content-right":{flexDirection:"row-reverse"},"content-bottom":{flexDirection:"column-reverse"},"content-left":{flexDirection:"row"}}),L='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';function x(c){return Array.from(c.querySelectorAll(L))}function Y(c){return c.matches(L)}class z extends o.Component{constructor(...t){super(...t),this.state={isFirstClick:!0},this._handleKeyup=e=>{e.key==="Escape"&&(e.preventDefault(),e.stopPropagation(),this.props.onClose(!0))},this._handleClick=e=>{var n;if(this.state.isFirstClick){this.setState({isFirstClick:!1});return}const s=f.findDOMNode((n=this.props.contentRef)==null?void 0:n.current);if(s&&!s.contains(e.target)){e.preventDefault(),e.stopPropagation();const a=!Y(e.target);this.props.onClose(a)}}}componentDidMount(){window.addEventListener("keyup",this._handleKeyup),window.addEventListener("click",this._handleClick)}componentWillUnmount(){window.removeEventListener("keyup",this._handleKeyup),window.removeEventListener("click",this._handleClick)}render(){return null}}class B extends o.Component{constructor(...t){super(...t),this.setInitialFocusableElement=e=>{const n=this.maybeGetInitialFocusElement(e)||this.maybeGetFirstFocusableElement(e)||e;n===e&&(e.tabIndex=-1),setTimeout(()=>{n.focus()},0)}}componentDidMount(){const t=f.findDOMNode(this);t&&this.setInitialFocusableElement(t)}maybeGetInitialFocusElement(t){const{initialFocusId:e}=this.props;return e?t.querySelector(`#${e}`):null}maybeGetFirstFocusableElement(t){const e=x(t);return e.length?e[0]:null}render(){return this.props.children}}class J extends o.Component{constructor(...t){super(...t),this.nextElementAfterPopover=void 0,this.rootNode=void 0,this.elementsThatCanBeFocusableInsidePopover=[],this.firstFocusableElementInPopover=null,this.lastFocusableElementInPopover=null,this.addEventListeners=()=>{const{anchorElement:e}=this.props;e&&e.addEventListener("keydown",this.handleKeydownPreviousFocusableElement),this.rootNode&&(this.elementsThatCanBeFocusableInsidePopover=x(this.rootNode),this.firstFocusableElementInPopover=this.elementsThatCanBeFocusableInsidePopover[0],this.lastFocusableElementInPopover=this.elementsThatCanBeFocusableInsidePopover[this.elementsThatCanBeFocusableInsidePopover.length-1]),this.nextElementAfterPopover=this.getNextFocusableElement(),this.nextElementAfterPopover||window.addEventListener("blur",()=>{this.changeFocusabilityInsidePopover(!0)}),this.firstFocusableElementInPopover&&this.firstFocusableElementInPopover.addEventListener("keydown",this.handleKeydownFirstFocusableElement),this.lastFocusableElementInPopover&&this.lastFocusableElementInPopover.addEventListener("keydown",this.handleKeydownLastFocusableElement),this.nextElementAfterPopover&&this.nextElementAfterPopover.addEventListener("keydown",this.handleKeydownNextFocusableElement)},this.handleKeydownFirstFocusableElement=e=>{if(e.key==="Tab"&&e.shiftKey){var n;e.preventDefault(),(n=this.props.anchorElement)==null||n.focus()}},this.handleKeydownLastFocusableElement=e=>{if(this.nextElementAfterPopover&&e.key==="Tab"&&!e.shiftKey){var n;e.preventDefault(),(n=this.nextElementAfterPopover)==null||n.focus()}},this.getNextFocusableElement=()=>{const{anchorElement:e}=this.props;if(!e)return;const s=x(document).filter(r=>this.elementsThatCanBeFocusableInsidePopover.indexOf(r)<0),a=s.indexOf(e);if(a>=0&&a!==s.length-1){const r=a<s.length-1?a+1:0;return s[r]}},this.getComponentRootNode=e=>{if(!e)return;const n=f.findDOMNode(e);if(!n)throw new Error("Assertion error: root node should exist after mount");this.rootNode=n},this.handleFocusPreviousFocusableElement=()=>{this.props.anchorElement&&this.props.anchorElement.focus()},this.changeFocusabilityInsidePopover=(e=!0)=>{const n=e?"0":"-1";this.elementsThatCanBeFocusableInsidePopover.forEach(s=>{s.setAttribute("tabIndex",n)})},this.handleFocusNextFocusableElement=()=>{this.nextElementAfterPopover&&this.nextElementAfterPopover.focus()},this.handleKeydownPreviousFocusableElement=e=>{if(e.key==="Tab"&&!e.shiftKey){var n;e.preventDefault(),(n=this.firstFocusableElementInPopover)==null||n.focus()}},this.handleKeydownNextFocusableElement=e=>{if(e.key==="Tab"&&e.shiftKey){var n;e.preventDefault(),(n=this.lastFocusableElementInPopover)==null||n.focus()}}}componentDidMount(){this.addEventListeners()}componentDidUpdate(){this.removeEventListeners(),this.addEventListeners()}componentWillUnmount(){this.changeFocusabilityInsidePopover(!0),this.removeEventListeners()}removeEventListeners(){const{anchorElement:t}=this.props;t&&t.removeEventListener("keydown",this.handleKeydownPreviousFocusableElement),this.nextElementAfterPopover||window.removeEventListener("blur",()=>{this.changeFocusabilityInsidePopover(!0)}),this.firstFocusableElementInPopover&&this.firstFocusableElementInPopover.removeEventListener("keydown",this.handleKeydownFirstFocusableElement),this.lastFocusableElementInPopover&&this.lastFocusableElementInPopover.removeEventListener("keydown",this.handleKeydownLastFocusableElement),this.nextElementAfterPopover&&this.nextElementAfterPopover.removeEventListener("keydown",this.handleKeydownNextFocusableElement)}render(){const{children:t}=this.props;return o.createElement("div",{ref:this.getComponentRootNode,onClick:()=>{this.changeFocusabilityInsidePopover(!0)},onFocus:()=>{this.changeFocusabilityInsidePopover(!0)},onBlur:()=>{this.changeFocusabilityInsidePopover(!1)}},o.createElement(B,{initialFocusId:this.props.initialFocusId},t))}}class Q extends o.Component{constructor(...t){super(...t),this.state={opened:!!this.props.opened,placement:this.props.placement},this.contentRef=o.createRef(),this.maybeReturnFocus=()=>{const{anchorElement:e}=this.state,{closedFocusId:n}=this.props;if(n){const s=f.findDOMNode(document.getElementById(n));s==null||s.focus();return}e&&e.focus()},this.handleClose=(e=!0)=>{this.setState({opened:!1},()=>{var n,s;(n=(s=this.props).onClose)==null||n.call(s),e&&this.maybeReturnFocus()})},this.handleOpen=()=>{this.props.dismissEnabled&&this.state.opened?this.handleClose(!0):this.setState({opened:!0})},this.updateRef=e=>{e&&this.state.anchorElement!==e&&this.setState({anchorElement:e})}}static getDerivedStateFromProps(t,e){return{opened:typeof t.opened=="boolean"?t.opened:e.opened}}renderContent(t){const{content:e}=this.props,n=typeof e=="function"?e({close:this.handleClose}):e;return o.cloneElement(n,{ref:this.contentRef,uniqueId:t})}renderPopper(t){const{initialFocusId:e,placement:n,showTail:s,portal:a,"aria-label":r,"aria-describedby":l,rootBoundary:b,viewportPadding:u}=this.props,{anchorElement:p}=this.state,h=l||`${t}-content`,y=r?void 0:`${t}-title`,v=o.createElement(S,{anchorElement:p,placement:n,rootBoundary:b,viewportPadding:u},g=>o.createElement(W,w({},g,{"aria-label":r,"aria-describedby":h,"aria-labelledby":y,id:t,onUpdate:_=>this.setState({placement:_}),showTail:s}),this.renderContent(t)));return a?o.createElement(J,{anchorElement:p,initialFocusId:e},v):o.createElement(B,{initialFocusId:e},v)}getHost(){return A(this.state.anchorElement)||document.body}renderPortal(t,e){if(!e)return null;const{portal:n}=this.props,s=this.getHost();return n&&s?f.createPortal(this.renderPopper(t),s):this.renderPopper(t)}render(){const{children:t,dismissEnabled:e,id:n}=this.props,{opened:s,placement:a}=this.state;return o.createElement(E.Provider,{value:{close:this.handleClose,placement:a}},o.createElement(R,{id:n},r=>o.createElement(o.Fragment,null,o.createElement(j,{anchorRef:this.updateRef,id:`${r}-anchor`,"aria-controls":r,"aria-expanded":s?"true":"false",onClick:this.handleOpen},t),this.renderPortal(r,s))),e&&s&&o.createElement(z,{onClose:this.handleClose,contentRef:this.contentRef}))}}Q.defaultProps={placement:"top",showTail:!0,portal:!0,rootBoundary:"viewport"};class k extends o.Component{render(){const{"aria-label":t,style:e,testId:n}=this.props;return o.createElement(E.Consumer,null,({close:s})=>o.createElement(U,{icon:V,"aria-label":t,onClick:s,kind:"tertiary",actionType:"neutral",style:e,testId:n}))}}k.defaultProps={"aria-label":"Close Popover"};class D extends o.Component{render(){const{"aria-label":t,children:e,closeButtonLight:n,closeButtonLabel:s,closeButtonVisible:a,style:r,testId:l}=this.props;return o.createElement(m,{testId:l,style:[I.content,r],"aria-label":t},a&&o.createElement(k,{"aria-label":s,style:[I.closeButton,n&&H.inverse],testId:`${l||"popover"}-close-btn`}),e)}}D.defaultProps={closeButtonLight:!1,closeButtonVisible:!1};const I=F.StyleSheet.create({content:{borderRadius:$.radius.radius_040,border:`solid 1px ${P.border.primary}`,backgroundColor:P.surface.primary,boxShadow:`0 ${i.xSmall_8}px ${i.xSmall_8}px 0 ${K.offBlack8}`,margin:0,maxWidth:i.medium_16*18,padding:i.large_24,overflow:"hidden",justifyContent:"center"},closeButton:{margin:0,position:"absolute",right:i.xxxSmall_4,top:i.xxxSmall_4,zIndex:1}}),X=T("img");class Z extends o.Component{constructor(...t){super(...t),this.maybeRenderImage=({placement:e})=>{const{image:n}=this.props;return n?o.createElement(m,{style:[d.image,e==="bottom"&&d.imageToBottom]},n):null},this.maybeRenderIcon=()=>{const{icon:e,iconAlt:n}=this.props;return e?o.createElement(m,{style:d.iconContainer},typeof e!="string"?e:o.createElement(X,{src:e,style:d.icon,alt:n||""})):null},this.maybeRenderActions=e=>{const{actions:n}=this.props;return n?o.createElement(m,{style:d.actions},typeof n=="function"?n({close:e}):n):null}}componentDidMount(){const{icon:t,image:e}=this.props;if(e&&t)throw new Error("'image' and 'icon' cannot be used at the same time. You can fix this by either removing 'image' or 'icon' from your instance.")}validateProps({placement:t}){if(this.props.image&&(t==="left"||t==="right"))throw new Error("'image' can only be vertically placed. You can fix this by either changing `placement` to `top` or `bottom` or removing the `image` prop inside `content`.")}render(){const{closeButtonLabel:t,closeButtonVisible:e,content:n,icon:s,image:a,style:r,title:l,testId:b,uniqueId:u}=this.props;return o.createElement(E.Consumer,null,({close:p,placement:h})=>(this.validateProps({close:p,placement:h}),o.createElement(D,{closeButtonLight:a&&h==="top",closeButtonLabel:t,closeButtonVisible:e,style:r,testId:b},o.createElement(m,{style:!!s&&d.withIcon},this.maybeRenderImage({placement:h}),this.maybeRenderIcon(),o.createElement(m,{style:d.text},o.createElement(M,{id:`${u}-title`,style:d.title},l),o.createElement(O,{id:`${u}-content`},n))),this.maybeRenderActions(p))))}}Z.defaultProps={closeButtonVisible:!1};const d=F.StyleSheet.create({actions:{marginTop:i.large_24,flexDirection:"row",alignItems:"center",justifyContent:"flex-end"},text:{justifyContent:"center"},title:{marginBottom:i.xSmall_8},iconContainer:{alignItems:"center",justifyContent:"center",height:i.xxxLarge_64,width:i.xxxLarge_64,minWidth:i.xxxLarge_64,marginRight:i.medium_16,overflow:"hidden"},icon:{width:"100%"},withIcon:{flexDirection:"row"},image:{marginBottom:i.large_24,marginLeft:-i.large_24,marginRight:-i.large_24,marginTop:-i.large_24,width:`calc(100% + ${i.large_24*2}px)`},imageToBottom:{marginBottom:-i.large_24,marginTop:i.large_24,order:1}});export{Q as P,D as a,Z as b};
