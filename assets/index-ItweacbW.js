import{a as F}from"./version-akiLXZts.js";import"./article-editor-udFEB07F.js";import"./device-framer-eGajQcXC.js";import"./viewport-resizer-lVFBL3lJ.js";import{j as t,a as p}from"./jsx-runtime-FVsy8kgq.js";import{P as d}from"./index-0C4KXdeC.js";import{r as y}from"./index-TT1qJ6UJ.js";import{_ as N}from"./jquery-yG1GhClm.js";import{R as M,W as U}from"./structured-item-diff-TNxPFZSJ.js";import{H as W,E as J}from"./editor-page-tkZk5x0l.js";import{E as $}from"./editor-FXEchzWL.js";import{w as G}from"./article-renderer-jbklylbA.js";import"./util-XR-uqOh-.js";import"./phet-simulation-AAtfWFw-.js";import{c as Q,r as Y,a as Z,d as K}from"./renderer-A4Q8-2V-.js";import{A as X}from"./perseus-api-Nq3s7IMx.js";import{l as u,g as ee,e as te}from"./perseus-item-SJVPWOrx.js";import"./hints-renderer-ex8ioeAw.js";import"./base-radio-LJP1VAc6.js";import"./button-group-nsoLlHtM.js";import"./graph-LHyvBqdA.js";import"./svg-image-h96M64n1.js";import"./hud-4BOtaFc1.js";import"./icon-R5gZamfG.js";import"./index-uzeeKkRr.js";import"./inline-icon-NjJlm7d0.js";import"./math-input-w9J4jE0k.js";import"./multi-button-group-atHe8dYZ.js";import"./number-input-csbDd4Oh.js";import"./range-input-VXCy7Y7P.js";import"./text-input-15gEhfDF.js";import"./text-list-editor-Jz35fIN1.js";import"./dependencies-d8cZibFS.js";import"./index-k-0mNqHS.js";import"./i18n-context-P5sgPFep.js";import"./index-IIMKO4_x.js";import{J as re,A as ne}from"./register-all-widgets-and-editors-for-testing-B-obf4nx.js";import{c as oe}from"./components-QiqQ71b-.js";import{c as q,i as se}from"./icon-paths-5JCXzGsq.js";import{M as ae}from"./multi-items-jgmhxaj0.js";import{l as i}from"./index-awljIyHI.js";import{R as ie}from"./index-7vsPyIck.js";import{c as le}from"./index-fuycm_QE.js";/* empty css                       */const ce="@khanacademy/perseus-editor",de="__lib_version__";F(ce,de);const A=d.shape({content:d.string,images:d.objectOf(d.any),widgets:d.objectOf(d.any)}),v=class v extends y.Component{constructor(){super(...arguments),this.state=v._stateFromProps(this.props)}UNSAFE_componentWillReceiveProps(e){this.setState(v._stateFromProps(e))}render(){const{before:e,after:r}=this.state,n=Math.max(e.length,r.length),a=N.times(n,l=>t(M,{before:l<e.length?e[l]:void 0,after:l<r.length?r[l]:void 0,title:`Section ${l+1}`,showAlignmentOptions:!0,showSeparator:l<n-1},l));return t("div",{className:"framework-perseus",children:a})}};v.propTypes={after:d.oneOfType([A,d.arrayOf(A)]).isRequired,before:d.oneOfType([A,d.arrayOf(A)]).isRequired},v._stateFromProps=e=>{const{before:r,after:n}=e;return{before:Array.isArray(r)?r:[r],after:Array.isArray(n)?n:[n]}};let T=v;T.__docgenInfo={description:"",methods:[{name:"_stateFromProps",docblock:null,modifiers:["static"],params:[{name:"props",optional:!1,type:null}],returns:null}],displayName:"ArticleDiff",props:{after:{description:"",type:{name:"union",value:[{name:"custom",raw:"rendererProps"},{name:"arrayOf",value:{name:"custom",raw:"rendererProps"}}]},required:!0},before:{description:"",type:{name:"union",value:[{name:"custom",raw:"rendererProps"},{name:"arrayOf",value:{name:"custom",raw:"rendererProps"}}]},required:!0}}};const I=d.shape({question:d.shape({}).isRequired,answerArea:d.shape({}).isRequired,hints:d.arrayOf(d.any).isRequired}),H=class H extends y.Component{render(){const{before:e,after:r}=this.props,n=Math.max(e.hints.length,r.hints.length),a=t(M,{before:e.question,after:r.question,title:"Question",showAlignmentOptions:!1,showSeparator:!0}),l=t(U,{before:e.answerArea,after:r.answerArea,title:"Question extras"}),c=N.times(n,function(m){return t(M,{before:m<e.hints.length?e.hints[m]:void 0,after:m<r.hints.length?r.hints[m]:void 0,title:`Hint ${m+1}`,showAlignmentOptions:!1,showSeparator:m<n-1},m)});return p("div",{className:"framework-perseus",children:[a,l,c&&t("div",{className:"diff-separator"}),c]})}};H.propTypes={after:I.isRequired,before:I.isRequired};let _=H;_.__docgenInfo={description:"",methods:[],displayName:"ItemDiff",props:{after:{description:"",type:{name:"custom",raw:"itemProps.isRequired"},required:!1},before:{description:"",type:{name:"custom",raw:"itemProps.isRequired"},required:!1}}};const x=class x extends y.Component{render(){const{children:e,color:r,onClick:n,...a}=this.props;return t("div",{className:i.css(S.baseButton,r==="green"&&S.green,r==="orange"&&S.orange),onClick:n,...a,children:e})}};x.propTypes={children:d.node,color:d.oneOf(["orange","green"]),onClick:d.func},x.defaultProps={children:null,color:"green",onClick:()=>{}};let w=x;const S=i.StyleSheet.create({baseButton:{top:"0",fontSize:"11px",padding:"3px 10px",backgroundRepeat:"repeat-x",borderColor:`
             rgba(0, 0, 0, 0.1)
             rgba(0, 0, 0, 0.1)
             rgba(0, 0, 0, 0.25)
         `,color:"#ffffff",borderRadius:"3px",lineHeight:"15px",cursor:"pointer",transition:"box-shadow ease-in-out 0.15s",appearance:"none",textDecoration:"none",textAlign:"center",":hover":{boxShadow:`0 1px 1px rgba(0, 0, 0, 0.35),
                 inset 0 0 50px 5px rgba(255, 255, 255, 0.2)`}},green:{border:"1px solid #7fab07",backgroundColor:"#80ac07",backgroundImage:"linear-gradient(to bottom, #8aba08, #719807)",":hover":{borderBottomColor:"#547105",backgroundColor:"#719807"}},orange:{border:"1px solid #d45704",backgroundColor:"#d55704",backgroundImage:"linear-gradient(to bottom, #e35d04, #c04f03)",":hover":{borderBottomColor:"#983e03",backgroundColor:"#c04f03"}}});w.__docgenInfo={description:"",methods:[],displayName:"SimpleButton",props:{children:{defaultValue:{value:"null",computed:!1},description:"",type:{name:"node"},required:!1},color:{defaultValue:{value:'"green"',computed:!1},description:"",type:{name:"enum",value:[{value:'"orange"',computed:!1},{value:'"green"',computed:!1}]},required:!1},onClick:{defaultValue:{value:"() => {}",computed:!1},description:"",type:{name:"func"},required:!1}}};const{InlineIcon:R}=oe,{MultiRenderer:pe}=ae;class E extends y.Component{constructor(){super(...arguments),this._handleSelectMode=e=>{if(this.props.onChange){const r=e.target.value;this.props.onChange(r)}}}render(){return p("label",{children:["Mode:"," ",p("select",{value:this.props.currentMode,onChange:this._handleSelectMode,children:[t("option",{value:"edit",children:"Edit"}),t("option",{value:"preview",children:"Preview"}),t("option",{value:"json",children:"Dev-only JSON"})]})]})}}function D(o){return o.replace(/[A-Z]/g,e=>" "+e.toLowerCase())}function P(o){return o.charAt(0).toUpperCase()+o.slice(1).toLowerCase()}function j(o){return o.charAt(o.length-1)==="s"?o.slice(0,-1):o}function f(o){return["_multi",...o]}const L=({depth:o,...e})=>{const n=`h${Math.min(o,5)+1}`;return t(n,{...e})},O=o=>{const{shape:e,data:r,path:n,actions:a,name:l,controls:c,...m}=o,h=l||D(n[n.length-1]||""),C=t(fe,{...m,shape:e,data:r,path:n,actions:a}),b=n.join(".");return e.type==="array"?t(he,{name:h,controls:c,path:n,shape:e,actions:a,children:C},b):e.type==="object"?t(ue,{name:h,controls:c,path:n,children:C},b):t(me,{name:h,controls:c,path:n,shape:e,children:C},b)},me=({name:o,controls:e,children:r,path:n,shape:a})=>{const c=(a.type==="content"||a.type==="hint")&&t("div",{className:i.css(s.containerHeader),children:t(L,{depth:n.length,className:i.css(s.containerTitle),children:P(o)})});return p("div",{className:i.css(s.container),children:[p("span",{className:i.css(s.row,s.rowHeading),children:[t("div",{className:i.css(s.columnLeft),children:p("div",{className:"pod-title "+i.css(s.containerHeader),children:[t("div",{className:i.css(s.containerTitle),children:P(o)}),e]})}),t("div",{className:i.css(s.columnRight),children:c})]}),r]})},he=o=>{const{name:e,controls:r,children:n,path:a,shape:l,actions:c}=o;return p("div",{className:i.css(s.container),children:[r&&t("div",{className:i.css(s.columnLeft,s.containerHeader),children:r}),t("div",{children:n}),t("div",{className:i.css(s.columnLeft),children:p("a",{href:"javascript:void 0",onClick:()=>c.addArrayElement(a,l.elementShape),children:["Add a ",j(e)]})})]})},ue=({name:o,controls:e,children:r,path:n})=>{const a=p("div",{className:i.css(s.containerHeader),children:[t(L,{depth:n.length,className:i.css(s.containerTitle),children:P(o)}),e]}),l=(o||e)&&t("div",{className:i.css(s.containerHeader,s.previewCollectionHeader),children:t(L,{depth:n.length,className:i.css(s.containerTitle),children:P(o)})}),c=a&&l;return p("div",{className:i.css(s.container),children:[c&&p("span",{className:i.css(s.row),children:[t("div",{className:i.css(s.columnLeft),children:a}),t("div",{className:i.css(s.columnRight),children:l})]}),t("div",{className:i.css(n.length>0&&s.contentIndent),children:r})]})},fe=o=>{const{shape:e,data:r,...n}=o;return e.type==="content"?t(ye,{shape:e,data:r,...n}):e.type==="hint"?t(ge,{shape:e,data:r,...n}):e.type==="tags"?t(ve,{shape:e,data:r,...n}):e.type==="array"?t(we,{shape:e,data:r,...n}):e.type==="object"?t(Ce,{shape:e,data:r,...n}):null},z=o=>class extends y.Component{constructor(){super(...arguments),this.state={sticky:!1},this.updateStickiness=()=>{const n=ie.findDOMNode(this).offsetHeight,a=window.innerHeight,l=n>a;l!==this.state.sticky&&this.setState({sticky:l})}}componentDidMount(){this.stickynessTimer=setInterval(this.updateStickiness,1e3),this.updateStickiness()}componentWillUnmount(){clearInterval(this.stickynessTimer)}render(){return t(o,{...this.props,sticky:this.state.sticky})}},ye=z(o=>{const{data:e,path:r,actions:n,apiOptions:a,renderers:l,sticky:c}=o,m=t("div",{className:"framework-perseus",children:u(l).get(r)});return t("span",{children:p("div",{className:i.css(s.row),children:[t("div",{className:i.css(s.columnLeft),children:t("div",{className:i.css(c&&s.sticky),children:t($,{...e,onChange:h=>n.mergeValueAtPath(r,h),apiOptions:a})})}),t("div",{className:i.css(s.columnRight),children:t("div",{className:i.css(c&&s.sticky),children:m})})]})})}),ge=z(o=>{const{data:e,path:r,actions:n,apiOptions:a,renderers:l,sticky:c}=o,m=t("div",{className:"framework-perseus",children:u(l).get(r)});return p("div",{className:i.css(s.row),children:[t("div",{className:i.css(s.columnLeft),children:t("div",{className:i.css(c&&s.sticky),children:t(W,{...e,className:i.css(s.hintEditor),onChange:h=>n.mergeValueAtPath(r,h),apiOptions:a,showTitle:!1,showRemoveButton:!1,showMoveButtons:!1,onRemove:()=>{},onMove:h=>{},isFirst:!0,isLast:!0})})}),t("div",{className:i.css(s.columnRight),children:t("div",{className:i.css(c&&s.sticky),children:m})})]})}),ve=o=>{const{data:e,path:r,actions:n,apiOptions:a}=o,{GroupMetadataEditor:l}=a;return l==null?null:t("div",{className:i.css(s.columnLeft),children:t("div",{className:i.css(s.tagsEditor),children:t(l,{value:e,onChange:c=>n.setValueAtPath(r,c),showTitle:!1})})})},we=o=>{const{shape:e,data:r,path:n,actions:a,...l}=o,c=D(n[n.length-1]),m=j(c),h=e.elementShape.type,C=h==="content"||h==="hint",b=r.map((V,g)=>{const k=n.concat(g),B=[g>0&&t("div",{className:i.css(s.control),children:t(w,{color:"orange",title:"Move up",onClick:()=>a.moveArrayElementUp(k),children:t("div",{className:i.css(s.verticalFlip),children:t(R,{...q})})})},"moveArrayElementUp"),g<r.length-1&&t("div",{className:i.css(s.control),children:t(w,{color:"orange",title:"Move down",onClick:()=>a.moveArrayElementDown(k),children:t(R,{...q})})},"moveArrayElementDown"),t("div",{className:i.css(s.control),children:t(w,{color:"orange",title:"Delete",onClick:()=>a.removeArrayElement(k),children:t(R,{...se})})},"removeArrayElement")];return t("div",{className:i.css(s.arrayElement,!C&&s.arrayElementAndNotLeaf),children:y.createElement(O,{...l,key:g,shape:e.elementShape,data:V,path:k,actions:a,name:`${m} ${g+1}`,controls:B})},g)});return t("div",{children:b})},Ce=o=>{const{shape:e,data:r,path:n,...a}=o,l=Object.keys(e.shape).map(c=>t("div",{className:i.css(s.objectElement),children:t(O,{...a,shape:e.shape[c],data:r[c],path:n.concat(c)})},c));return t("div",{children:l})};class be extends y.Component{constructor(){super(...arguments),this._renderLayout=()=>{const{Layout:e,apiOptions:r,item:n}=this.props;return t(e,{ref:a=>this.layout=a,item:n,apiOptions:r})},this._renderJson=()=>p("div",{children:[t(E,{currentMode:this.props.editorMode,onChange:e=>this.props.onChange({editorMode:e})}),t(re,{multiLine:!0,value:this.props.item,onChange:e=>this.props.onChange({item:e})})]}),this._renderPreview=()=>p("div",{children:[t(E,{currentMode:this.props.editorMode,onChange:e=>this.props.onChange({editorMode:e})}),this._renderLayout()]}),this.mergeValueAtPath=(e,r)=>{this.props.onChange({item:u(this.props.item).merge(f(e),r).freeze()})},this.setValueAtPath=(e,r)=>{this.props.onChange({item:u(this.props.item).set(f(e),r).freeze()})},this.addArrayElement=(e,r)=>{const n=u(this.props.item).get(f(e)).length,a=e.concat(n),l=ee(r);this.props.onChange({item:u(this.props.item).set(f(a),l).freeze()})},this.removeArrayElement=e=>{this.props.onChange({item:u(this.props.item).del(f(e)).freeze()})},this.moveArrayElementDown=e=>{const n=e[e.length-1]+1,a=e.slice(0,-1).concat(n),l=u(this.props.item).get(f(e)),c=u(this.props.item).get(f(a));this.props.onChange({item:u(this.props.item).set(f(e),c).set(f(a),l).freeze()})},this.moveArrayElementUp=e=>{const r=e[e.length-1],n=e.slice(0,-1).concat(r-1);this.moveArrayElementDown(n)},this._renderEdit=()=>{const e={...X.defaults,...this.props.apiOptions},{item:r}=this.props,n=this.props.Layout.shape;return p("div",{className:"perseus-multirenderer-editor",children:[t(E,{currentMode:this.props.editorMode,onChange:a=>this.props.onChange({editorMode:a})}),t(pe,{item:r,shape:n,apiOptions:e,dependencies:{analytics:{onAnalyticsEvent:async()=>{}},useVideo:()=>{}},children:({renderers:a})=>t(O,{shape:n,data:te(r),path:[],actions:this,apiOptions:e,renderers:a})})]})},this.score=()=>{if(this.layout)return this.layout.score()},this.getSerializedState=()=>{if(this.layout)return this.layout.getSerializedState()},this.restoreSerializedState=e=>{this.layout&&this.layout.restoreSerializedState(e)},this._renderContent=()=>{switch(this.props.editorMode){case"json":return this._renderJson();case"preview":return this._renderPreview();case"edit":return this._renderEdit();default:return t(E,{currentMode:this.props.editorMode,onChange:e=>this.props.onChange({editorMode:e})})}}}render(){return t("div",{id:"perseus",children:this._renderContent()})}}const s=i.StyleSheet.create({container:{},editor:{width:"100%"},treePreview:{position:"relative"},verticalFlip:{transform:"scaleY(-1)"},control:{marginLeft:12},containerHeader:{alignItems:"flex-end",display:"flex",flexDirection:"row"},previewCollectionHeader:{marginBottom:16},containerTitle:{flexGrow:1,margin:0},contentIndent:{marginLeft:8},hintEditor:{paddingBottom:0},arrayElement:{marginBottom:16},arrayElementAndNotLeaf:{borderBottom:"1px solid #ccc",":first-child":{borderTop:"1px solid #ccc",paddingTop:16}},objectElement:{marginBottom:16},tagsEditor:{border:"1px solid #ddd",padding:"5px 10px"},row:{display:"flex",position:"relative"},columnLeft:{width:360,marginRight:30,position:"relative"},columnRight:{flex:1,marginLeft:30,position:"relative"},sticky:{position:"sticky",top:33},rowHeading:{position:"sticky",backgroundColor:"white",width:"100%",zIndex:101,top:-1}});be.__docgenInfo={description:"",methods:[{name:"_renderLayout",docblock:null,modifiers:[],params:[],returns:null},{name:"_renderJson",docblock:null,modifiers:[],params:[],returns:null},{name:"_renderPreview",docblock:null,modifiers:[],params:[],returns:null},{name:"mergeValueAtPath",docblock:null,modifiers:[],params:[{name:"path",optional:!1,type:{name:"ReadonlyArray",elements:[{name:"any"}],raw:"ReadonlyArray<any>",alias:"Path"}},{name:"newValue",optional:!1,type:{name:"unknown"}}],returns:null},{name:"setValueAtPath",docblock:null,modifiers:[],params:[{name:"path",optional:!1,type:{name:"ReadonlyArray",elements:[{name:"any"}],raw:"ReadonlyArray<any>",alias:"Path"}},{name:"newValue",optional:!1,type:{name:"unknown"}}],returns:null},{name:"addArrayElement",docblock:null,modifiers:[],params:[{name:"path",optional:!1,type:{name:"ReadonlyArray",elements:[{name:"any"}],raw:"ReadonlyArray<any>",alias:"Path"}},{name:"shape",optional:!1,type:{name:"Shape",alias:"Shape"}}],returns:null},{name:"removeArrayElement",docblock:null,modifiers:[],params:[{name:"path",optional:!1,type:{name:"ReadonlyArray",elements:[{name:"any"}],raw:"ReadonlyArray<any>",alias:"Path"}}],returns:null},{name:"moveArrayElementDown",docblock:null,modifiers:[],params:[{name:"path",optional:!1,type:{name:"ReadonlyArray",elements:[{name:"any"}],raw:"ReadonlyArray<any>",alias:"Path"}}],returns:null},{name:"moveArrayElementUp",docblock:null,modifiers:[],params:[{name:"path",optional:!1,type:{name:"ReadonlyArray",elements:[{name:"any"}],raw:"ReadonlyArray<any>",alias:"Path"}}],returns:null},{name:"_renderEdit",docblock:null,modifiers:[],params:[],returns:null},{name:"score",docblock:null,modifiers:[],params:[],returns:null},{name:"getSerializedState",docblock:null,modifiers:[],params:[],returns:null},{name:"restoreSerializedState",docblock:null,modifiers:[],params:[{name:"state",optional:!1,type:{name:"any"}}],returns:null},{name:"_renderContent",docblock:null,modifiers:[],params:[],returns:null}],displayName:"MultiRendererEditor",props:{Layout:{required:!0,tsType:{name:"intersection",raw:"React.ComponentType<any> & LayoutStatics",elements:[{name:"ReactComponentType",raw:"React.ComponentType<any>",elements:[{name:"any"}]},{name:"LayoutStatics"}]},description:""},apiOptions:{required:!0,tsType:{name:"APIOptions"},description:""},item:{required:!0,tsType:{name:"Item"},description:""},editorMode:{required:!0,tsType:{name:"EditorMode"},description:""},onChange:{required:!0,tsType:{name:"ChangeHandler"},description:""}}};le({displayName:"StatefulEditorPage",propTypes:{componentClass:d.func},getDefaultProps:function(){return{componentClass:J}},getInitialState:function(){return N({}).extend(N.omit(this.props,"componentClass"),{onChange:this.handleChange,ref:"editor"})},componentDidMount:function(){this._isMounted=!0},UNSAFE_componentWillReceiveProps:function(o){this.setState(N(o).pick("apiOptions","imageUploader","developerMode","problemNum","previewDevice","frameSource"))},componentWillUnmount:function(){this._isMounted=!1},getSaveWarnings:function(){return this.refs.editor.getSaveWarnings()},serialize:function(){return this.refs.editor.serialize()},handleChange:function(o,e){this._isMounted&&this.setState(o,e)},render:function(){const o=this.props.componentClass;return t(o,{...this.state})}});Q(ne);Y(G);Z();K();
