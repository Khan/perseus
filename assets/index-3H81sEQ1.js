import{r as u}from"./index-C6mWTJJr.js";let d=function(r){return r.Immediately="schedule-immediately",r.OnDemand="schedule-on-demand",r}({}),a=function(r){return r.Resolve="resolve-on-clear",r.Cancel="cancel-on-clear",r}({}),_=function(r){return r.Reset="reset",r.Passive="passive",r}({});class I{constructor(e,t,n=d.Immediately){if(this._timeoutId=void 0,this._action=void 0,this._timeoutMs=void 0,typeof e!="function")throw new Error("Action must be a function");if(t<0)throw new Error("Timeout period must be >= 0");this._action=e,this._timeoutMs=t,n===d.Immediately&&this.set()}get isSet(){return this._timeoutId!=null}set(){this.isSet&&this.clear(a.Cancel),this._timeoutId=setTimeout(()=>this.clear(a.Resolve),this._timeoutMs)}clear(e=a.Cancel){const t=this._timeoutId;this._timeoutId=null,t!=null&&(clearTimeout(t),e===a.Resolve&&this._action())}}class y{constructor(e,t,n=d.Immediately){if(this._intervalId=void 0,this._action=void 0,this._intervalMs=void 0,typeof e!="function")throw new Error("Action must be a function");if(t<1)throw new Error("Interval period must be >= 1");this._action=e,this._intervalMs=t,n===d.Immediately&&this.set()}get isSet(){return this._intervalId!=null}set(){this.isSet&&this.clear(a.Cancel),this._intervalId=setInterval(()=>this._action(),this._intervalMs)}clear(e=a.Cancel){const t=this._intervalId;this._intervalId=null,t!=null&&(clearInterval(t),e===a.Resolve&&this._action())}}class R{constructor(e,t=d.Immediately){if(this._animationFrameId=void 0,this._action=void 0,typeof e!="function")throw new Error("Action must be a function");this._action=e,t===d.Immediately&&this.set()}get isSet(){return this._animationFrameId!=null}set(){this.isSet&&this.clear(a.Cancel),this._animationFrameId=requestAnimationFrame(e=>this.clear(a.Resolve,e))}clear(e=a.Cancel,t){const n=this._animationFrameId;this._animationFrameId=null,n!=null&&(cancelAnimationFrame(n),e===a.Resolve&&this._action(t||performance.now()))}}class h{constructor(){this._disabled=!1,this._registeredActions=[]}timeout(e,t,n){if(this._disabled)return h.NoopAction;const l=new I(e,t,n==null?void 0:n.schedulePolicy);return this._registeredActions.push(()=>l.clear(n==null?void 0:n.clearPolicy)),l}interval(e,t,n){if(this._disabled)return h.NoopAction;const l=new y(e,t,n==null?void 0:n.schedulePolicy);return this._registeredActions.push(()=>l.clear(n==null?void 0:n.clearPolicy)),l}animationFrame(e,t){if(this._disabled)return h.NoopAction;const n=new R(e,t==null?void 0:t.schedulePolicy);return this._registeredActions.push(()=>n.clear(t==null?void 0:t.clearPolicy)),n}clearAll(){const e=[...this._registeredActions];this._registeredActions=[],e.forEach(t=>t())}disable(){this._disabled=!0,this.clearAll()}}h.NoopAction={set:()=>{},get isSet(){return!1},clear:()=>{}};class A extends u.Component{constructor(...e){super(...e),this._actionScheduler=new h}componentWillUnmount(){this._actionScheduler.disable()}render(){const{children:e}=this.props;return e(this._actionScheduler)}}function v(){return v=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},v.apply(null,arguments)}function p(r){const e=`withActionScheduler(${r.displayName||r.name})`,t=n=>u.createElement(A,null,l=>u.createElement(r,v({},n,{schedule:l})));return t.displayName=e,t}function b(r,e,t={}){const{actionPolicy:n,clearPolicy:l,schedulePolicy:m}=t,o=u.useRef(r),s=u.useRef(null);if(typeof r!="function")throw new Error("Action must be a function");if(r!==o.current&&(o.current=r,n===_.Reset)){var f;(f=s.current)==null||f.set()}return u.useEffect(()=>(s.current=new y(()=>{o.current==null||o.current()},e,m),()=>{var i;(i=s.current)==null||i.clear(l),s.current=null}),[e,l,m]),u.useMemo(()=>({set:()=>{var i;(i=s.current)==null||i.set()},clear:(i=l)=>{var c;(c=s.current)==null||c.clear(i)},get isSet(){var i,c;return(i=(c=s.current)==null?void 0:c.isSet)!=null?i:!1}}),[l])}function S(r,e,t={}){const{actionPolicy:n,clearPolicy:l,schedulePolicy:m}=t,o=u.useRef(r),s=u.useRef(null);if(typeof r!="function")throw new Error("Action must be a function");if(r!==o.current&&(o.current=r,n===_.Reset)){var f;(f=s.current)==null||f.set()}return u.useEffect(()=>(s.current=new I(()=>{o.current==null||o.current()},e,m),()=>{var i;(i=s.current)==null||i.clear(l),s.current=null}),[e,l,m]),u.useMemo(()=>({set:()=>{var i;(i=s.current)==null||i.set()},clear:(i=l)=>{var c;(c=s.current)==null||c.clear(i)},get isSet(){var i,c;return(i=(c=s.current)==null?void 0:c.isSet)!=null?i:!1}}),[l])}export{d as S,S as a,b as u,p as w};
