import{j as s}from"./jsx-runtime-BT65X5dW.js";import{r as l}from"./index-C6mWTJJr.js";import{r as b}from"./index-B1Gws05u.js";import{I as R,V as m,a as T}from"./index-BbSJVDiq.js";import{b as _,c as S}from"./index-Dmud9eLw.js";import{m as N}from"./index-D138DFPZ.js";import{n as P}from"./no-important-DlFk8a1I.js";import{s as i,c as A,a as C,b as K}from"./index-B7Lkas_q.js";import{H as $,B as M}from"./index-B3d1jNQR.js";import{a as O,I as H,x as U}from"./index-BwNAjuSy.js";const V={close:void 0,placement:"top"},x=l.createContext(V);x.displayName="PopoverContext";class G extends l.Component{componentDidMount(){const t=b.findDOMNode(this);t&&this.props.anchorRef(t)}render(){const{children:t,id:e,onClick:o,"aria-controls":n,"aria-expanded":a}=this.props,r={id:e,"aria-controls":n,"aria-expanded":a};if(typeof t=="function"){const c=t({open:o});return l.cloneElement(c,r)}else return l.cloneElement(t,{...t.props,...r,onClick:t.props.onClick?c=>{c.stopPropagation(),t.props.onClick(),o()}:o})}}class W extends l.Component{componentDidUpdate(t){t.placement!==this.props.placement&&this.props.onUpdate(this.props.placement)}render(){const{placement:t,children:e,id:o,isReferenceHidden:n,updateBubbleRef:a,updateTailRef:r,tailOffset:c,style:y,showTail:f,"aria-describedby":p,"aria-labelledby":u,"aria-label":v}=this.props,g=e.props.color;return s.jsx(l.Fragment,{children:s.jsxs(m,{"aria-label":v,"aria-describedby":p,"aria-labelledby":u,id:o,role:"dialog",ref:a,"data-placement":t,style:[n&&I.hide,I[`content-${t}`],y],children:[e,s.jsx(S,{show:f,color:g,updateRef:r,placement:t,offset:c})]})})}}const I=P.StyleSheet.create({hide:{pointerEvents:"none",opacity:0,backgroundColor:"transparent",color:"transparent"},"content-top":{flexDirection:"column"},"content-right":{flexDirection:"row-reverse"},"content-bottom":{flexDirection:"column-reverse"},"content-left":{flexDirection:"row"}}),L='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';function F(d){return Array.from(d.querySelectorAll(L))}function Y(d){return d.matches(L)}class z extends l.Component{componentDidMount(){window.addEventListener("keyup",this._handleKeyup),window.addEventListener("click",this._handleClick)}componentWillUnmount(){window.removeEventListener("keyup",this._handleKeyup),window.removeEventListener("click",this._handleClick)}render(){return null}constructor(...t){super(...t),this.state={isFirstClick:!0},this._handleKeyup=e=>{e.key==="Escape"&&(e.preventDefault(),e.stopPropagation(),this.props.onClose(!0))},this._handleClick=e=>{var n;if(this.state.isFirstClick){this.setState({isFirstClick:!1});return}const o=b.findDOMNode((n=this.props.contentRef)==null?void 0:n.current);if(o&&!o.contains(e.target)){e.preventDefault(),e.stopPropagation();const a=!Y(e.target);this.props.onClose(a)}}}}class B extends l.Component{componentDidMount(){const t=b.findDOMNode(this);t&&this.setInitialFocusableElement(t)}maybeGetInitialFocusElement(t){const{initialFocusId:e}=this.props;return e?t.querySelector(`#${e}`):null}maybeGetFirstFocusableElement(t){const e=F(t);return e.length?e[0]:null}render(){return this.props.children}constructor(...t){super(...t),this.setInitialFocusableElement=e=>{const o=this.maybeGetInitialFocusElement(e)||this.maybeGetFirstFocusableElement(e)||e;o===e&&(e.tabIndex=-1),setTimeout(()=>{o.focus()},0)}}}class J extends l.Component{componentDidMount(){this.addEventListeners()}componentDidUpdate(){this.removeEventListeners(),this.addEventListeners()}componentWillUnmount(){this.changeFocusabilityInsidePopover(!0),this.removeEventListeners()}removeEventListeners(){const{anchorElement:t}=this.props;t&&t.removeEventListener("keydown",this.handleKeydownPreviousFocusableElement),this.nextElementAfterPopover||window.removeEventListener("blur",()=>{this.changeFocusabilityInsidePopover(!0)}),this.firstFocusableElementInPopover&&this.firstFocusableElementInPopover.removeEventListener("keydown",this.handleKeydownFirstFocusableElement),this.lastFocusableElementInPopover&&this.lastFocusableElementInPopover.removeEventListener("keydown",this.handleKeydownLastFocusableElement),this.nextElementAfterPopover&&this.nextElementAfterPopover.removeEventListener("keydown",this.handleKeydownNextFocusableElement)}render(){const{children:t}=this.props;return s.jsx("div",{ref:this.getComponentRootNode,onClick:()=>{this.changeFocusabilityInsidePopover(!0)},onFocus:()=>{this.changeFocusabilityInsidePopover(!0)},onBlur:()=>{this.changeFocusabilityInsidePopover(!1)},children:s.jsx(B,{initialFocusId:this.props.initialFocusId,children:t})})}constructor(...t){super(...t),this.elementsThatCanBeFocusableInsidePopover=[],this.firstFocusableElementInPopover=null,this.lastFocusableElementInPopover=null,this.addEventListeners=()=>{const{anchorElement:e}=this.props;e&&e.addEventListener("keydown",this.handleKeydownPreviousFocusableElement),this.rootNode&&(this.elementsThatCanBeFocusableInsidePopover=F(this.rootNode),this.firstFocusableElementInPopover=this.elementsThatCanBeFocusableInsidePopover[0],this.lastFocusableElementInPopover=this.elementsThatCanBeFocusableInsidePopover[this.elementsThatCanBeFocusableInsidePopover.length-1]),this.nextElementAfterPopover=this.getNextFocusableElement(),this.nextElementAfterPopover||window.addEventListener("blur",()=>{this.changeFocusabilityInsidePopover(!0)}),this.firstFocusableElementInPopover&&this.firstFocusableElementInPopover.addEventListener("keydown",this.handleKeydownFirstFocusableElement),this.lastFocusableElementInPopover&&this.lastFocusableElementInPopover.addEventListener("keydown",this.handleKeydownLastFocusableElement),this.nextElementAfterPopover&&this.nextElementAfterPopover.addEventListener("keydown",this.handleKeydownNextFocusableElement)},this.handleKeydownFirstFocusableElement=e=>{var o;e.key==="Tab"&&e.shiftKey&&(e.preventDefault(),(o=this.props.anchorElement)==null||o.focus())},this.handleKeydownLastFocusableElement=e=>{var o;this.nextElementAfterPopover&&e.key==="Tab"&&!e.shiftKey&&(e.preventDefault(),(o=this.nextElementAfterPopover)==null||o.focus())},this.getNextFocusableElement=()=>{const{anchorElement:e}=this.props;if(!e)return;const n=F(document).filter(r=>this.elementsThatCanBeFocusableInsidePopover.indexOf(r)<0),a=n.indexOf(e);if(a>=0&&a!==n.length-1){const r=a<n.length-1?a+1:0;return n[r]}},this.getComponentRootNode=e=>{if(!e)return;const o=b.findDOMNode(e);if(!o)throw new Error("Assertion error: root node should exist after mount");this.rootNode=o},this.handleFocusPreviousFocusableElement=()=>{this.props.anchorElement&&this.props.anchorElement.focus()},this.changeFocusabilityInsidePopover=(e=!0)=>{const o=e?"0":"-1";this.elementsThatCanBeFocusableInsidePopover.forEach(n=>{n.setAttribute("tabIndex",o)})},this.handleFocusNextFocusableElement=()=>{this.nextElementAfterPopover&&this.nextElementAfterPopover.focus()},this.handleKeydownPreviousFocusableElement=e=>{var o;e.key==="Tab"&&!e.shiftKey&&(e.preventDefault(),(o=this.firstFocusableElementInPopover)==null||o.focus())},this.handleKeydownNextFocusableElement=e=>{var o;e.key==="Tab"&&e.shiftKey&&(e.preventDefault(),(o=this.lastFocusableElementInPopover)==null||o.focus())}}}class Q extends l.Component{static getDerivedStateFromProps(t,e){return{opened:typeof t.opened=="boolean"?t.opened:e.opened}}renderContent(t){const{content:e}=this.props,o=typeof e=="function"?e({close:this.handleClose}):e;return l.cloneElement(o,{ref:this.contentRef,uniqueId:t})}renderPopper(t){const{initialFocusId:e,placement:o,showTail:n,portal:a,"aria-label":r,"aria-describedby":c,rootBoundary:y,viewportPadding:f}=this.props,{anchorElement:p}=this.state,u=c||`${t}-content`,v=r?void 0:`${t}-title`,E=s.jsx(_,{anchorElement:p,placement:o,rootBoundary:y,viewportPadding:f,children:g=>s.jsx(W,{...g,"aria-label":r,"aria-describedby":u,"aria-labelledby":v,id:t,onUpdate:D=>this.setState({placement:D}),showTail:n,children:this.renderContent(t)})});return a?s.jsx(J,{anchorElement:p,initialFocusId:e,children:E}):s.jsx(B,{initialFocusId:e,children:E})}getHost(){return N(this.state.anchorElement)||document.body}renderPortal(t,e){if(!e)return null;const{portal:o}=this.props,n=this.getHost();return o&&n?b.createPortal(this.renderPopper(t),n):this.renderPopper(t)}render(){const{children:t,dismissEnabled:e,id:o}=this.props,{opened:n,placement:a}=this.state;return s.jsxs(x.Provider,{value:{close:this.handleClose,placement:a},children:[s.jsx(R,{id:o,children:r=>s.jsxs(l.Fragment,{children:[s.jsx(G,{anchorRef:this.updateRef,id:`${r}-anchor`,"aria-controls":r,"aria-expanded":n?"true":"false",onClick:this.handleOpen,children:t}),this.renderPortal(r,n)]})}),e&&n&&s.jsx(z,{onClose:this.handleClose,contentRef:this.contentRef})]})}constructor(...t){super(...t),this.state={opened:!!this.props.opened,placement:this.props.placement},this.contentRef=l.createRef(),this.maybeReturnFocus=()=>{const{anchorElement:e}=this.state,{closedFocusId:o}=this.props;if(o){const n=b.findDOMNode(document.getElementById(o));n==null||n.focus();return}e&&e.focus()},this.handleClose=(e=!0)=>{this.setState({opened:!1},()=>{var o,n;(n=(o=this.props).onClose)==null||n.call(o),e&&this.maybeReturnFocus()})},this.handleOpen=()=>{this.props.dismissEnabled&&this.state.opened?this.handleClose(!0):this.setState({opened:!0})},this.updateRef=e=>{e&&this.state.anchorElement!==e&&this.setState({anchorElement:e})}}}Q.defaultProps={placement:"top",showTail:!0,portal:!0,rootBoundary:"viewport"};class j extends l.Component{render(){const{"aria-label":t,style:e,testId:o}=this.props;return s.jsx(x.Consumer,{children:({close:n})=>s.jsx(H,{icon:U,"aria-label":t,onClick:n,kind:"tertiary",actionType:"neutral",style:e,testId:o})})}}j.defaultProps={"aria-label":"Close Popover"};class k extends l.Component{render(){const{"aria-label":t,children:e,closeButtonLight:o,closeButtonLabel:n,closeButtonVisible:a,style:r,testId:c}=this.props;return s.jsxs(m,{testId:c,style:[w.content,r],"aria-label":t,children:[a&&s.jsx(j,{"aria-label":n,style:[w.closeButton,o&&O.inverse],testId:`${c||"popover"}-close-btn`}),e]})}}k.defaultProps={closeButtonLight:!1,closeButtonVisible:!1};const w=P.StyleSheet.create({content:{borderRadius:K.radius.radius_040,border:`solid 1px ${C.border.primary}`,backgroundColor:C.surface.primary,boxShadow:`0 ${i.xSmall_8}px ${i.xSmall_8}px 0 ${A.offBlack8}`,margin:0,maxWidth:i.medium_16*18,padding:i.large_24,overflow:"hidden",justifyContent:"center"},closeButton:{margin:0,position:"absolute",right:i.xxxSmall_4,top:i.xxxSmall_4,zIndex:1}}),X=T("img");class Z extends l.Component{componentDidMount(){const{icon:t,image:e}=this.props;if(e&&t)throw new Error("'image' and 'icon' cannot be used at the same time. You can fix this by either removing 'image' or 'icon' from your instance.")}validateProps({placement:t}){if(this.props.image&&(t==="left"||t==="right"))throw new Error("'image' can only be vertically placed. You can fix this by either changing `placement` to `top` or `bottom` or removing the `image` prop inside `content`.")}render(){const{closeButtonLabel:t,closeButtonVisible:e,content:o,icon:n,image:a,style:r,title:c,testId:y,uniqueId:f}=this.props;return s.jsx(x.Consumer,{children:({close:p,placement:u})=>(this.validateProps({close:p,placement:u}),s.jsxs(k,{closeButtonLight:a&&u==="top",closeButtonLabel:t,closeButtonVisible:e,style:r,testId:y,children:[s.jsxs(m,{style:!!n&&h.withIcon,children:[this.maybeRenderImage({placement:u}),this.maybeRenderIcon(),s.jsxs(m,{style:h.text,children:[s.jsx($,{id:`${f}-title`,style:h.title,children:c}),s.jsx(M,{id:`${f}-content`,children:o})]})]}),this.maybeRenderActions(p)]}))})}constructor(...t){super(...t),this.maybeRenderImage=({placement:e})=>{const{image:o}=this.props;return o?s.jsx(m,{style:[h.image,e==="bottom"&&h.imageToBottom],children:o}):null},this.maybeRenderIcon=()=>{const{icon:e,iconAlt:o}=this.props;return e?s.jsx(m,{style:h.iconContainer,children:typeof e!="string"?e:s.jsx(X,{src:e,style:h.icon,alt:o||""})}):null},this.maybeRenderActions=e=>{const{actions:o}=this.props;return o?s.jsx(m,{style:h.actions,children:typeof o=="function"?o({close:e}):o}):null}}}Z.defaultProps={closeButtonVisible:!1};const h=P.StyleSheet.create({actions:{marginTop:i.large_24,flexDirection:"row",alignItems:"center",justifyContent:"flex-end"},text:{justifyContent:"center"},title:{marginBottom:i.xSmall_8},iconContainer:{alignItems:"center",justifyContent:"center",height:i.xxxLarge_64,width:i.xxxLarge_64,minWidth:i.xxxLarge_64,marginRight:i.medium_16,overflow:"hidden"},icon:{width:"100%"},withIcon:{flexDirection:"row"},image:{marginBottom:i.large_24,marginLeft:-i.large_24,marginRight:-i.large_24,marginTop:-i.large_24,width:`calc(100% + ${i.large_24*2}px)`},imageToBottom:{marginBottom:-i.large_24,marginTop:i.large_24,order:1}});export{Q as P,k as a,Z as b};
