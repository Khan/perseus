import{r as n}from"./index-6oxdNXpR.js";import{r as E}from"./index-9gkyvru-.js";import{a as T,I as _,V as f}from"./index-qqHuISYU.js";import{T as S,a as N}from"./index-yskWdb_J.js";import{m as A}from"./index-qEp884-b.js";import{l as w}from"./index-awljIyHI.js";import{s as l,c as m}from"./index-dmcq622U.js";import{H as K,B as O}from"./index-yN1k6wu6.js";import{I as $,x as M}from"./index-_TZUXKdV.js";function g(){return g=Object.assign?Object.assign.bind():function(a){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var o in e)({}).hasOwnProperty.call(e,o)&&(a[o]=e[o])}return a},g.apply(null,arguments)}const H={close:void 0,placement:"top"},x=n.createContext(H);x.displayName="PopoverContext";class U extends n.Component{componentDidMount(){const t=E.findDOMNode(this);t&&this.props.anchorRef(t)}render(){const{children:t,id:e,onClick:o,"aria-controls":s,"aria-expanded":i}=this.props,r={id:e,"aria-controls":s,"aria-expanded":i};if(typeof t=="function"){const c=t({open:o});return n.cloneElement(c,r)}else return n.cloneElement(t,g({},t.props,r,{onClick:t.props.onClick?c=>{c.stopPropagation(),t.props.onClick(),o()}:o}))}}class V extends n.Component{componentDidUpdate(t){t.placement!==this.props.placement&&this.props.onUpdate(this.props.placement)}render(){const{placement:t,children:e,id:o,isReferenceHidden:s,updateBubbleRef:i,updateTailRef:r,tailOffset:c,style:d,showTail:v,"aria-describedby":h,"aria-labelledby":b,"aria-label":u}=this.props,y=e.props,F=y.emphasized?"blue":y.color;return n.createElement(n.Fragment,null,n.createElement(f,{"aria-label":u,"aria-describedby":h,"aria-labelledby":b,id:o,role:"dialog",ref:i,"data-placement":t,style:[s&&I.hide,I[`content-${t}`],d]},e,n.createElement(N,{show:v,color:F,updateRef:r,placement:t,offset:c})))}}const I=w.StyleSheet.create({hide:{pointerEvents:"none",opacity:0,backgroundColor:"transparent",color:"transparent"},"content-top":{flexDirection:"column"},"content-right":{flexDirection:"row-reverse"},"content-bottom":{flexDirection:"column-reverse"},"content-left":{flexDirection:"row"}}),B='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';function C(a){return Array.from(a.querySelectorAll(B))}function j(a){return a.matches(B)}class G extends n.Component{constructor(...t){super(...t),this.state={isFirstClick:!0},this._handleKeyup=e=>{e.key==="Escape"&&(e.preventDefault(),e.stopPropagation(),this.props.onClose(!0))},this._handleClick=e=>{var o;if(this.state.isFirstClick){this.setState({isFirstClick:!1});return}const s=E.findDOMNode((o=this.props.contentRef)==null?void 0:o.current);if(s&&!s.contains(e.target)){e.preventDefault(),e.stopPropagation();const i=!j(e.target);this.props.onClose(i)}}}componentDidMount(){window.addEventListener("keyup",this._handleKeyup),window.addEventListener("click",this._handleClick)}componentWillUnmount(){window.removeEventListener("keyup",this._handleKeyup),window.removeEventListener("click",this._handleClick)}render(){return null}}class L extends n.Component{constructor(...t){super(...t),this.setInitialFocusableElement=e=>{const o=this.maybeGetInitialFocusElement(e)||this.maybeGetFirstFocusableElement(e)||e;o===e&&(e.tabIndex=-1),setTimeout(()=>{o.focus()},0)}}componentDidMount(){const t=E.findDOMNode(this);t&&this.setInitialFocusableElement(t)}maybeGetInitialFocusElement(t){const{initialFocusId:e}=this.props;return e?t.querySelector(`#${e}`):null}maybeGetFirstFocusableElement(t){const e=C(t);return e.length?e[0]:null}render(){return this.props.children}}class W extends n.Component{constructor(...t){super(...t),this.nextElementAfterPopover=void 0,this.rootNode=void 0,this.elementsThatCanBeFocusableInsidePopover=[],this.firstFocusableElementInPopover=null,this.lastFocusableElementInPopover=null,this.addEventListeners=()=>{const{anchorElement:e}=this.props;e&&e.addEventListener("keydown",this.handleKeydownPreviousFocusableElement),this.rootNode&&(this.elementsThatCanBeFocusableInsidePopover=C(this.rootNode),this.firstFocusableElementInPopover=this.elementsThatCanBeFocusableInsidePopover[0],this.lastFocusableElementInPopover=this.elementsThatCanBeFocusableInsidePopover[this.elementsThatCanBeFocusableInsidePopover.length-1]),this.nextElementAfterPopover=this.getNextFocusableElement(),this.nextElementAfterPopover||window.addEventListener("blur",()=>{this.changeFocusabilityInsidePopover(!0)}),this.firstFocusableElementInPopover&&this.firstFocusableElementInPopover.addEventListener("keydown",this.handleKeydownFirstFocusableElement),this.lastFocusableElementInPopover&&this.lastFocusableElementInPopover.addEventListener("keydown",this.handleKeydownLastFocusableElement),this.nextElementAfterPopover&&this.nextElementAfterPopover.addEventListener("keydown",this.handleKeydownNextFocusableElement)},this.handleKeydownFirstFocusableElement=e=>{if(e.key==="Tab"&&e.shiftKey){var o;e.preventDefault(),(o=this.props.anchorElement)==null||o.focus()}},this.handleKeydownLastFocusableElement=e=>{if(this.nextElementAfterPopover&&e.key==="Tab"&&!e.shiftKey){var o;e.preventDefault(),(o=this.nextElementAfterPopover)==null||o.focus()}},this.getNextFocusableElement=()=>{const{anchorElement:e}=this.props;if(!e)return;const s=C(document).filter(r=>this.elementsThatCanBeFocusableInsidePopover.indexOf(r)<0),i=s.indexOf(e);if(i>=0&&i!==s.length-1){const r=i<s.length-1?i+1:0;return s[r]}},this.getComponentRootNode=e=>{if(!e)return;const o=E.findDOMNode(e);if(!o)throw new Error("Assertion error: root node should exist after mount");this.rootNode=o},this.handleFocusPreviousFocusableElement=()=>{this.props.anchorElement&&this.props.anchorElement.focus()},this.changeFocusabilityInsidePopover=(e=!0)=>{const o=e?"0":"-1";this.elementsThatCanBeFocusableInsidePopover.forEach(s=>{s.setAttribute("tabIndex",o)})},this.handleFocusNextFocusableElement=()=>{this.nextElementAfterPopover&&this.nextElementAfterPopover.focus()},this.handleKeydownPreviousFocusableElement=e=>{if(e.key==="Tab"&&!e.shiftKey){var o;e.preventDefault(),(o=this.firstFocusableElementInPopover)==null||o.focus()}},this.handleKeydownNextFocusableElement=e=>{if(e.key==="Tab"&&e.shiftKey){var o;e.preventDefault(),(o=this.lastFocusableElementInPopover)==null||o.focus()}}}componentDidMount(){this.addEventListeners()}componentDidUpdate(){this.removeEventListeners(),this.addEventListeners()}componentWillUnmount(){this.changeFocusabilityInsidePopover(!0),this.removeEventListeners()}removeEventListeners(){const{anchorElement:t}=this.props;t&&t.removeEventListener("keydown",this.handleKeydownPreviousFocusableElement),this.nextElementAfterPopover||window.removeEventListener("blur",()=>{this.changeFocusabilityInsidePopover(!0)}),this.firstFocusableElementInPopover&&this.firstFocusableElementInPopover.removeEventListener("keydown",this.handleKeydownFirstFocusableElement),this.lastFocusableElementInPopover&&this.lastFocusableElementInPopover.removeEventListener("keydown",this.handleKeydownLastFocusableElement),this.nextElementAfterPopover&&this.nextElementAfterPopover.removeEventListener("keydown",this.handleKeydownNextFocusableElement)}render(){const{children:t}=this.props;return n.createElement("div",{ref:this.getComponentRootNode,onClick:()=>{this.changeFocusabilityInsidePopover(!0)},onFocus:()=>{this.changeFocusabilityInsidePopover(!0)},onBlur:()=>{this.changeFocusabilityInsidePopover(!1)}},n.createElement(L,{initialFocusId:this.props.initialFocusId},t))}}class z extends n.Component{constructor(...t){super(...t),this.state={opened:!!this.props.opened,placement:this.props.placement},this.contentRef=n.createRef(),this.maybeReturnFocus=()=>{const{anchorElement:e}=this.state,{closedFocusId:o}=this.props;if(o){const s=E.findDOMNode(document.getElementById(o));s==null||s.focus();return}e&&e.focus()},this.handleClose=(e=!0)=>{this.setState({opened:!1},()=>{var o,s;(o=(s=this.props).onClose)==null||o.call(s),e&&this.maybeReturnFocus()})},this.handleOpen=()=>{this.props.dismissEnabled&&this.state.opened?this.handleClose(!0):this.setState({opened:!0})},this.updateRef=e=>{e&&this.state.anchorElement!==e&&this.setState({anchorElement:e})}}static getDerivedStateFromProps(t,e){return{opened:typeof t.opened=="boolean"?t.opened:e.opened}}renderContent(t){const{content:e}=this.props,o=typeof e=="function"?e({close:this.handleClose}):e;return n.cloneElement(o,{ref:this.contentRef,uniqueId:t})}renderPopper(t){const{initialFocusId:e,placement:o,showTail:s,portal:i,"aria-label":r,"aria-describedby":c,rootBoundary:d,viewportPadding:v}=this.props,{anchorElement:h}=this.state,b=c||`${t}-content`,u=r?void 0:`${t}-title`,y=n.createElement(S,{anchorElement:h,placement:o,rootBoundary:d,viewportPadding:v},F=>n.createElement(V,g({},F,{"aria-label":r,"aria-describedby":b,"aria-labelledby":u,id:t,onUpdate:R=>this.setState({placement:R}),showTail:s}),this.renderContent(t)));return i?n.createElement(W,{anchorElement:h,initialFocusId:e},y):n.createElement(L,{initialFocusId:e},y)}getHost(){return A(this.state.anchorElement)||document.body}renderPortal(t,e){if(!e)return null;const{portal:o}=this.props,s=this.getHost();return o&&s?E.createPortal(this.renderPopper(t),s):this.renderPopper(t)}render(){const{children:t,dismissEnabled:e,id:o}=this.props,{opened:s,placement:i}=this.state;return n.createElement(x.Provider,{value:{close:this.handleClose,placement:i}},n.createElement(_,{id:o},r=>n.createElement(n.Fragment,null,n.createElement(U,{anchorRef:this.updateRef,id:`${r}-anchor`,"aria-controls":r,"aria-expanded":s?"true":"false",onClick:this.handleOpen},t),this.renderPortal(r,s))),e&&s&&n.createElement(G,{onClose:this.handleClose,contentRef:this.contentRef}))}}z.defaultProps={placement:"top",showTail:!0,portal:!0,rootBoundary:"viewport"};class k extends n.Component{render(){const{light:t,"aria-label":e,style:o,testId:s}=this.props;return n.createElement(x.Consumer,null,({close:i})=>n.createElement($,{icon:M,"aria-label":e,onClick:i,kind:t?"primary":"tertiary",light:t,style:o,testId:s}))}}k.defaultProps={light:!0,"aria-label":"Close Popover"};class D extends n.Component{render(){const{"aria-label":t,children:e,closeButtonLight:o,closeButtonLabel:s,closeButtonVisible:i,color:r,style:c,testId:d}=this.props;return n.createElement(f,{testId:d,style:[P.content,r!=="white"&&P[r],c],"aria-label":t},i&&n.createElement(k,{"aria-label":s,light:o||r!=="white",style:P.closeButton,testId:`${d||"popover"}-close-btn`}),e)}}D.defaultProps={color:"white",closeButtonLight:!1,closeButtonVisible:!1};const P=w.StyleSheet.create({content:{borderRadius:l.xxxSmall_4,border:`solid 1px ${m.offBlack16}`,backgroundColor:m.white,boxShadow:`0 ${l.xSmall_8}px ${l.xSmall_8}px 0 ${m.offBlack8}`,margin:0,maxWidth:l.medium_16*18,padding:l.large_24,overflow:"hidden",justifyContent:"center"},blue:{backgroundColor:m.blue,color:m.white},darkBlue:{backgroundColor:m.darkBlue,color:m.white},closeButton:{margin:0,position:"absolute",right:l.xxxSmall_4,top:l.xxxSmall_4,zIndex:1}}),Y=T("img");class J extends n.Component{constructor(...t){super(...t),this.maybeRenderImage=({placement:e})=>{const{image:o}=this.props;return o?n.createElement(f,{style:[p.image,e==="bottom"&&p.imageToBottom]},o):null},this.maybeRenderIcon=()=>{const{icon:e}=this.props;return e?n.createElement(f,{style:p.iconContainer},typeof e!="string"?e:n.createElement(Y,{src:e,style:p.icon})):null},this.maybeRenderActions=e=>{const{actions:o}=this.props;return o?n.createElement(f,{style:p.actions},typeof o=="function"?o({close:e}):o):null}}componentDidMount(){const{icon:t,image:e}=this.props;if(e&&t)throw new Error("'image' and 'icon' cannot be used at the same time. You can fix this by either removing 'image' or 'icon' from your instance.")}validateProps({placement:t}){if(this.props.image&&(t==="left"||t==="right"))throw new Error("'image' can only be vertically placed. You can fix this by either changing `placement` to `top` or `bottom` or removing the `image` prop inside `content`.")}render(){const{closeButtonLabel:t,closeButtonVisible:e,content:o,emphasized:s=void 0,icon:i,image:r,style:c,title:d,testId:v,uniqueId:h}=this.props;return n.createElement(x.Consumer,null,({close:b,placement:u})=>(this.validateProps({close:b,placement:u}),n.createElement(D,{color:s?"blue":"white",closeButtonLight:r&&u==="top",closeButtonLabel:t,closeButtonVisible:e,style:c,testId:v},n.createElement(f,{style:!!i&&p.withIcon},this.maybeRenderImage({placement:u}),this.maybeRenderIcon(),n.createElement(f,{style:p.text},n.createElement(K,{id:`${h}-title`,style:p.title},d),n.createElement(O,{id:`${h}-content`},o))),this.maybeRenderActions(b))))}}J.defaultProps={closeButtonVisible:!1};const p=w.StyleSheet.create({actions:{marginTop:l.large_24,flexDirection:"row",alignItems:"center",justifyContent:"flex-end"},text:{justifyContent:"center"},title:{marginBottom:l.xSmall_8},iconContainer:{alignItems:"center",justifyContent:"center",height:l.xxxLarge_64,width:l.xxxLarge_64,minWidth:l.xxxLarge_64,marginRight:l.medium_16,overflow:"hidden"},icon:{width:"100%"},withIcon:{flexDirection:"row"},image:{marginBottom:l.large_24,marginLeft:-l.large_24,marginRight:-l.large_24,marginTop:-l.large_24,width:`calc(100% + ${l.large_24*2}px)`},imageToBottom:{marginBottom:-l.large_24,marginTop:l.large_24,order:1}});export{z as P,D as a,J as b};
