import{j as i,a as F,F as I}from"./jsx-runtime-5BUNAZ9W.js";import"./prop-types-6Qz-9GtK.js";import{a as K,c as U,g,m as j}from"./key-translator-TewQj1fb.js";import{C as Z,K as G}from"./mobile-keypad-cY_XnmKN.js";import{M as z,c as J}from"./button-assets-Z9EPvaqZ.js";import{C as X}from"./index-Cz55-Vre.js";import{V as P}from"./index-e4P84RkC.js";import{P as Y,a as Q}from"./index-GPnNv0mI.js";import{c as l,s as A}from"./index-lUErx3pE.js";import{c as ee}from"./index-KZ9xT8RQ.js";import{l as D}from"./index-awljIyHI.js";import{c as te}from"./index-dnMhQZ-1.js";import{_ as re,$ as ae}from"./jquery-yG1GhClm.js";import{r as C}from"./index-4g5l5LRQ.js";import{P as se}from"./i18n-context-SHL040F7.js";var T={exports:{}},V=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(V){var E=new Uint8Array(16);T.exports=function(){return V(E),E}}else{var O=new Array(16);T.exports=function(){for(var e=0,t;e<16;e++)e&3||(t=Math.random()*4294967296),O[e]=t>>>((e&3)<<3)&255;return O}}var L=T.exports,M=[];for(var y=0;y<256;++y)M[y]=(y+256).toString(16).substr(1);function ne(a,e){var t=e||0,r=M;return[r[a[t++]],r[a[t++]],r[a[t++]],r[a[t++]],"-",r[a[t++]],r[a[t++]],"-",r[a[t++]],r[a[t++]],"-",r[a[t++]],r[a[t++]],"-",r[a[t++]],r[a[t++]],r[a[t++]],r[a[t++]],r[a[t++]],r[a[t++]]].join("")}var $=ne,oe=L,ie=$,B,x,k=0,w=0;function le(a,e,t){var r=e&&t||0,s=e||[];a=a||{};var n=a.node||B,o=a.clockseq!==void 0?a.clockseq:x;if(n==null||o==null){var c=oe();n==null&&(n=B=[c[0]|1,c[1],c[2],c[3],c[4],c[5]]),o==null&&(o=x=(c[6]<<8|c[7])&16383)}var p=a.msecs!==void 0?a.msecs:new Date().getTime(),u=a.nsecs!==void 0?a.nsecs:w+1,q=p-k+(u-w)/1e4;if(q<0&&a.clockseq===void 0&&(o=o+1&16383),(q<0||p>k)&&a.nsecs===void 0&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");k=p,w=u,x=o,p+=122192928e5;var m=((p&268435455)*1e4+u)%4294967296;s[r++]=m>>>24&255,s[r++]=m>>>16&255,s[r++]=m>>>8&255,s[r++]=m&255;var f=p/4294967296*1e4&268435455;s[r++]=f>>>8&255,s[r++]=f&255,s[r++]=f>>>24&15|16,s[r++]=f>>>16&255,s[r++]=o>>>8|128,s[r++]=o&255;for(var h=0;h<6;++h)s[r+h]=n[h];return e||ie(s)}var ce=le,de=L,pe=$;function ue(a,e,t){var r=e&&t||0;typeof a=="string"&&(e=a==="binary"?new Array(16):null,a=null),a=a||{};var s=a.random||(a.rng||de)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e)for(var n=0;n<16;++n)e[r+n]=s[n];return e||pe(s)}var me=ue,fe=ce,H=me,S=H;S.v1=fe;S.v4=H;var he=S;const ye=D.StyleSheet.create({srOnly:{border:0,clip:"rect(0,0,0,0)",height:1,margin:-1,overflow:"hidden",padding:0,position:"absolute",width:1}}),ve=(a,e)=>{let t=null;return(...r)=>{t&&clearTimeout(t),t=window.setTimeout(()=>{a(...r)},e)}},v=class v extends C.Component{constructor(){super(...arguments),this.__mathFieldWrapperRef=null,this.__mathField=null,this.state={focused:!1,keypadOpen:this.props.buttonsVisible==="always",cursorContext:Z.NONE},this.insert=e=>{const t=this.mathField(),{locale:r}=this.context,n={...K(r),FRAC:o=>{const c=o.latex();o.typedText("/"),o.latex()===c&&o.cmd("\\frac")}}[e];if(n){n(t,e),t==null||t.focus();return}re(e).isFunction()?e(t):e[0]==="\\"?t==null||t.cmd(e).focus():t==null||t.write(e).focus(),t==null||t.focus()},this.mathField=()=>{var e;if(!this.__mathField&&this.__mathFieldWrapperRef){const{locale:t}=this.context;this.__mathField=U(this.__mathFieldWrapperRef,t,this.props.mathInputStrings,r=>({...r,handlers:{edit:ve(s=>{let n=s.latex();if(n=n.replace(/<>/g,"\\ne"),J(t,this.props.convertDotToTimes)){n=n.replace(/\\cdot/g,"\\times");const o=s.cursor()[j.L];o&&o.ctrlSeq==="\\cdot "&&(s.controller().backspace(),s.cmd("\\times"))}else n=n.replace(/\\times/g,"\\cdot");this.props.value!==n&&this.props.onChange(n),this.setState({cursorContext:g(s)})},100),enter:()=>{this.__mathFieldWrapperRef&&ae(this.__mathFieldWrapperRef).submit()},upOutOf:s=>{s.typedText("^")}}}))}return(e=this.__mathField)==null||e.setAriaLabel(this.props.ariaLabel),this.__mathField},this.focus=()=>{var e;(e=this.mathField())==null||e.focus(),this.setState({focused:!0})},this.blur=()=>this.setState({focused:!1}),this.handleKeypadPress=(e,t)=>{const{locale:r}=this.context,s=K(r)[e],n=this.mathField();n&&(s&&s(n,e),this.setState({cursorContext:g(n)})),t.type==="click"&&this.focus()}}componentDidMount(){var e;(e=this.mathField())==null||e.latex(this.props.value)}openKeypad(){this.props.buttonsVisible!=="never"&&this.setState({keypadOpen:!0})}closeKeypad(){this.setState({keypadOpen:!1})}render(){let e=te({"perseus-math-input":!0,"mq-editable-field":!0,"mq-math-mode":!0});const t=he.v4().slice(0,8);return this.props.className&&(e=e+" "+this.props.className),i(P,{style:[d.outerWrapper,this.state.focused&&d.wrapperFocused,this.props.hasError&&d.wrapperError],children:F("div",{style:{display:"flex",padding:1},onClick:r=>{r.stopPropagation();const s=this.mathField();s&&this.setState({cursorContext:g(s)})},children:[i("span",{className:e,ref:r=>this.__mathFieldWrapperRef=r,onFocus:()=>this.focus(),onBlur:()=>this.blur()}),i(Y,{opened:this.state.keypadOpen,onClose:()=>this.closeKeypad(),dismissEnabled:!0,"aria-label":this.context.strings.mathInputTitle,"aria-describedby":`popover-content-${t}`,content:()=>{var r;return F(I,{children:[i(ee,{id:`popover-content-${t}`,style:ye.srOnly,children:this.context.strings.mathInputDescription}),i(Q,{closeButtonVisible:!0,style:d.popoverContent,children:i(G,{onAnalyticsEvent:this.props.analytics.onAnalyticsEvent,extraKeys:this.props.extraKeys,onClickKey:this.handleKeypadPress,cursorContext:this.state.cursorContext,convertDotToTimes:this.props.convertDotToTimes,...this.props.keypadButtonSets??be((r=this.props)==null?void 0:r.buttonSets)})})]})},children:this.props.buttonsVisible==="never"?i(W,{hovered:!1,focused:!1,active:!1}):i(X,{"aria-label":this.state.keypadOpen?this.context.strings.closeKeypad:this.context.strings.openKeypad,role:"button",onClick:()=>this.state.keypadOpen?this.closeKeypad():this.openKeypad(),children:r=>i(W,{active:this.state.keypadOpen,...r})})})]})})}};v.contextType=se,v.defaultProps={value:"",convertDotToTimes:!1};let R=v;const b=class b extends C.Component{constructor(){super(...arguments),this.inputRef=C.createRef()}blur(){var e;(e=this.inputRef.current)==null||e.blur()}focus(){var e;(e=this.inputRef.current)==null||e.focus()}insert(e){var t;(t=this.inputRef.current)==null||t.insert(e)}render(){return i(R,{...this.props,ref:this.inputRef,mathInputStrings:this.context.strings})}};b.contextType=z,b.defaultProps={ariaLabel:"Math input"};let _=b;const W=({hovered:a,focused:e,active:t})=>{let r;switch(!0){case(e||t):r=l.white;break;case a:r=l.blue;break;default:r=l.offBlack;break}const s=t||e?d.iconActive:d.iconInactive;return i(P,{style:[d.iconContainer,s],children:i("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:r,viewBox:"0 0 256 256",children:i("path",{d:"M112,72a8,8,0,0,1-8,8H40a8,8,0,0,1,0-16h64A8,8,0,0,1,112,72Zm-8,104H80V152a8,8,0,0,0-16,0v24H40a8,8,0,0,0,0,16H64v24a8,8,0,0,0,16,0V192h24a8,8,0,0,0,0-16Zm48,0h64a8,8,0,0,0,0-16H152a8,8,0,0,0,0,16Zm64,16H152a8,8,0,0,0,0,16h64a8,8,0,0,0,0-16Zm-61.66-90.34a8,8,0,0,0,11.32,0L184,83.31l18.34,18.35a8,8,0,0,0,11.32-11.32L195.31,72l18.35-18.34a8,8,0,0,0-11.32-11.32L184,60.69,165.66,42.34a8,8,0,0,0-11.32,11.32L172.69,72,154.34,90.34A8,8,0,0,0,154.34,101.66Z"})})})},be=a=>{const e={};return a&&a.forEach(t=>{switch(t){case"advanced relations":e.advancedRelations=!0;break;case"basic relations":e.basicRelations=!0;break;case"basic+div":e.divisionKey=!0;break;case"logarithms":e.logarithms=!0;break;case"prealgebra":e.preAlgebra=!0;break;case"trig":e.trigonometry=!0;break}}),e},N={borderWidth:2,borderColor:l.blue,margin:-1},d=D.StyleSheet.create({iconContainer:{display:"flex",justifyContent:"center",height:"100%",padding:A.xxxSmall_4,borderRadius:1},iconInactive:{border:"2px solid transparent",backgroundColor:l.offBlack8},iconActive:{border:`2px solid ${l.white}`,backgroundColor:l.offBlack64},outerWrapper:{display:"inline-block",borderStyle:"solid",borderWidth:1,borderColor:l.offBlack50,borderRadius:3,background:l.white,":hover":N},wrapperFocused:N,wrapperError:{borderColor:l.red,background:l.fadedRed8,":hover":{borderColor:l.red}},popoverContent:{padding:0,paddingBottom:A.xxSmall_6,maxWidth:"initial"}});_.__docgenInfo={description:"",methods:[{name:"blur",docblock:null,modifiers:[],params:[],returns:null},{name:"focus",docblock:null,modifiers:[],params:[],returns:null},{name:"insert",docblock:null,modifiers:[],params:[{name:"value",optional:!1,type:{name:"any"}}],returns:null}],displayName:"MathInput",props:{className:{required:!1,tsType:{name:"string"},description:""},value:{required:!0,tsType:{name:"string"},description:""},onChange:{required:!0,tsType:{name:"any"},description:""},convertDotToTimes:{required:!0,tsType:{name:"boolean"},description:""},buttonSets:{required:!1,tsType:{name:"ReadonlyArray",elements:[{name:"union",raw:`| "basic"
| "basic+div"
| "trig"
| "prealgebra"
| "logarithms"
| "basic relations"
| "advanced relations"`,elements:[{name:"literal",value:'"basic"'},{name:"literal",value:'"basic+div"'},{name:"literal",value:'"trig"'},{name:"literal",value:'"prealgebra"'},{name:"literal",value:'"logarithms"'},{name:"literal",value:'"basic relations"'},{name:"literal",value:'"advanced relations"'}]}],raw:`ReadonlyArray<
    | "basic"
    | "basic+div"
    | "trig"
    | "prealgebra"
    | "logarithms"
    | "basic relations"
    | "advanced relations"
>`},description:"@deprecated Use `keypadButtonSets` instead. Maps to `keypadButtonSets`.\n@see keypadButtonSets"},keypadButtonSets:{required:!1,tsType:{name:"signature",type:"object",raw:`{
    advancedRelations?: boolean;
    basicRelations?: boolean;
    divisionKey?: boolean;
    logarithms?: boolean;
    preAlgebra?: boolean;
    trigonometry?: boolean;
}`,signature:{properties:[{key:"advancedRelations",value:{name:"boolean",required:!1}},{key:"basicRelations",value:{name:"boolean",required:!1}},{key:"divisionKey",value:{name:"boolean",required:!1}},{key:"logarithms",value:{name:"boolean",required:!1}},{key:"preAlgebra",value:{name:"boolean",required:!1}},{key:"trigonometry",value:{name:"boolean",required:!1}}]}},description:"Overrides deprecated `buttonSets` prop."},ariaLabel:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'"Math input"',computed:!1}},onFocus:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onBlur:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},hasError:{required:!1,tsType:{name:"boolean"},description:""},extraKeys:{required:!1,tsType:{name:"ReadonlyArray",elements:[{name:"Keys"}],raw:"ReadonlyArray<Keys>"},description:""},buttonsVisible:{required:!1,tsType:{name:"union",raw:'"always" | "never" | "focused"',elements:[{name:"literal",value:'"always"'},{name:"literal",value:'"never"'},{name:"literal",value:'"focused"'}]},description:"Whether to show the keypad buttons.\nThe strings now misleading, but we keep them for backwards compatibility.\n- `focused` means that the keypad **appears on toggle, *off* by default**.\n- `always` means that the keypad **appears on toggle, *on* by default.**\n- `never` means that the keypad is **never shown**."},analytics:{required:!0,tsType:{name:"signature",raw:'PerseusDependenciesV2["analytics"]'},description:""}}};export{_ as M,ye as a};
