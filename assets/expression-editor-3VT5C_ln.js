import{j as n,a}from"./jsx-runtime-5BUNAZ9W.js";import{p as D}from"./util-KY8kJaBW.js";import{a as y,c as x,P as F,E as N}from"./article-renderer-vWtlF3q2.js";import{_ as c}from"./jquery-yG1GhClm.js";import"./version-akiLXZts.js";import{g as C}from"./dependencies-9B_Bv_mA.js";import"./perseus-api-GqFoxb6z.js";import{l as f}from"./multi-renderer-l0GQx02I.js";import"./hints-renderer-_cfyGynV.js";import"./renderer-bN75HO46.js";import"./base-radio-oSiEycJG.js";import{c as E}from"./components-E7mzsreM.js";import"./i18n-context-SHL040F7.js";import{f as I}from"./index-J2t_5nK1.js";import{C as g}from"./index-_rEjQfTM.js";import{r as S}from"./index-4g5l5LRQ.js";import{P as _}from"./index-tvtfaFq4.js";import{R as A}from"./index-jmm5gWkb.js";const l=_,R=y({propTypes:{className:l.string,components:l.arrayOf(l.node).isRequired,onReorder:l.func.isRequired,style:l.any,verify:l.func},getDefaultProps:function(){return{verify:()=>!0}},getInitialState:function(){return{dragging:null,components:this.props.components}},componentDidMount:function(){this._setDragEvents()},UNSAFE_componentWillReceiveProps:function(r){this.setState({components:r.components})},componentDidUpdate:function(){this._setDragEvents()},onDragStart:function(r){this.setState({dragging:r})},onDrop:function(){this.setState({dragging:null}),this.props.onReorder(this.state.components)},onDragEnter:function(r){if(this.state.dragging===r)return;const e=this.state.components.slice(),s=e.splice(this.state.dragging,1);e.splice(r,0,s[0]);const t=this.props.verify(e);return t&&this.setState({dragging:r,components:e}),t},_listenEvent:function(r){r.dataTransfer.setData("hackhackhack","because browsers!")},_cancelEvent:function(r){r.preventDefault()},_setDragEvents:function(){this._dragItems=this._dragItems||[];const r=A.findDOMNode(this).querySelectorAll("[draggable=true]"),e=[],s=[];for(let t=0;t<this._dragItems.length;t++){const i=this._dragItems[t];r.indexOf(i)<0&&e.push(i)}for(let t=0;t<r.length;t++){const i=r[t];this._dragItems.indexOf(i)<0&&s.push(i)}for(let t=0;t<s.length;t++){const i=s[t];i.addEventListener("dragstart",this._listenEvent),i.addEventListener("drop",this._cancelEvent)}for(let t=0;t<e.length;t++){const i=e[t];i.removeEventListener("dragstart",this._listenEvent),i.removeEventListener("drop",this._cancelEvent)}},render:function(){const r=this.state.components.map((e,s)=>n(T,{index:s,component:e,area:this,draggable:e.props.draggable,dragging:s===this.state.dragging},e.key));return n("ol",{className:this.props.className,style:this.props.style,children:r})}}),T=y({propTypes:{area:l.shape({onDragEnter:l.func.isRequired,onDragStart:l.func.isRequired,onDrop:l.func.isRequired}),component:l.node.isRequired,dragging:l.bool.isRequired,draggable:l.bool.isRequired,index:l.number.isRequired},handleDragStart:function(r){r.nativeEvent.dataTransfer.effectAllowed="move",this.props.area.onDragStart(this.props.index)},handleDrop:function(){this.props.area.onDrop(this.props.index)},handleDragEnter:function(r){const e=this.props.area.onDragEnter(this.props.index);r.nativeEvent.dataTransfer.effectAllowed=e?"move":"none"},handleDragOver:function(r){r.preventDefault()},render:function(){let r="sortable-disabled";return this.props.dragging?r="sortable-dragging":this.props.draggable&&(r="sortable-enabled"),n("li",{draggable:this.props.draggable,className:r,onDragStart:this.handleDragStart,onDrop:this.handleDrop,onDragEnter:this.handleDragEnter,onDragOver:this.handleDragOver,children:this.props.component})}}),{InfoTip:p,TextInput:v}=E,w=["basic","trig","prealgebra","logarithms","basic relations","advanced relations"],k=({key:r})=>Number.parseInt(r??""),q=r=>{const e=[];r.forEach(s=>{e[k(s)]=!0});for(let s=0;s<e.length;s++)if(!e[s])return s;return e.length},h=class h extends S.Component{constructor(){super(...arguments),this.serialize=()=>{const e=["value","form","simplify","considered","key"],s=["answerForms","buttonSets","functions","times","visibleLabel","ariaLabel"],t=this.props.answerForms.map(i=>c(i).pick(e));return f(this.props).set(["answerForms"],t).mod([],i=>c(i).pick(s)).freeze()},this.getSaveWarnings=()=>{const e=[];return this.props.answerForms.length===0?e.push("No answers specified"):(this.props.answerForms.some(t=>t.considered==="correct")||e.push("No correct answer specified"),c(this.props.answerForms).each((t,i)=>{if(this.props.value==="")e.push(`Answer ${i+1} is empty`);else{const o=D(t.value,{functions:this.props.functions});o.parsed?t.simplify&&!o.expr.isSimplified()&&e.push(`${t.value} isn't simplified, but is required" +
                            " to be`):e.push(`Couldn't parse ${t.value}`)}})),e},this._newEmptyAnswerForm=()=>({considered:"correct",form:!1,key:q(this.props.answerForms),simplify:!1,value:""}),this.newAnswer=()=>{const e=this.props.answerForms.slice();e.push(this._newEmptyAnswerForm()),this.change({answerForms:e})},this.handleRemoveForm=e=>{const s=this.props.answerForms.slice();s.splice(e,1),this.change({answerForms:s})},this.updateForm=(e,s)=>{const t=f(this.props.answerForms).merge([e],s).freeze();this.change({answerForms:t})},this.handleReorder=e=>{const s=e.map(t=>{const i=c(t.props).pick("considered","form","simplify","value");return i.key=t.key,i});this.change({answerForms:s})},this.handleButtonSet=e=>{const t=w.filter(i=>this.props.buttonSets.includes(i)!==(i===e));this.props.onChange({buttonSets:t})},this.handleToggleDiv=()=>{let e,s;this.props.buttonSets.includes("basic+div")?(e="basic",s="basic+div"):(e="basic+div",s="basic");const t=this.props.buttonSets.filter(i=>i!==s).concat(e);this.change("buttonSets",t)},this.handleTexInsert=e=>{this.refs.expression.insert(e)},this.handleFunctions=e=>{const s={};s.functions=e.target.value.split(/[ ,]+/).filter(I),this.props.onChange(s)}}change(...e){return x.apply(this,e)}render(){const e=this.props.answerForms.map(o=>{const d=k(o),u={times:this.props.times,functions:this.props.functions,buttonSets:this.props.buttonSets,buttonsVisible:"focused",form:o.form,simplify:o.simplify,value:o.value,onChange:m=>this.updateForm(d,m),trackInteraction:()=>{},widgetId:this.props.widgetId+"-"+o.key};return f(o).merge([],{key:d,draggable:!0,onChange:m=>this.updateForm(Number.parseInt(o.key??""),m),onDelete:()=>this.handleRemoveForm(d),expressionProps:u}).freeze()}).map(o=>n(L,{...o},o.key)),s=n(R,{components:e,onReorder:this.handleReorder,className:"answer-options-list"}),t=w.map(o=>{const d=o==="basic",u=this.props.buttonSets.includes(o)||d;return a("label",{className:"button-set-label",children:[n("input",{type:"checkbox",checked:u,disabled:d,onChange:()=>this.handleButtonSet(o)}),o]},o)}),{TeX:i}=C();return t.unshift(a("label",{className:"button-set-label",children:[n("input",{type:"checkbox",onChange:this.handleToggleDiv}),a("span",{className:"show-div-button",children:["show ",n(i,{children:"\\div"})," button"]})]},"show-div")),a("div",{className:"perseus-widget-expression-editor",children:[n("h3",{className:"expression-editor-h3",children:"Global Options"}),a("div",{className:"perseus-widget-row",children:[a("label",{children:["Visible label:"," ",n(v,{value:this.props.visibleLabel,onChange:this.change("visibleLabel")})]}),n(p,{children:n("p",{children:"Optional visible text; strongly encouraged to help learners using dictation software, but can be omitted if the surrounding content provides enough context."})})]}),a("div",{className:"perseus-widget-row",children:[a("label",{children:["Aria label:"," ",n(v,{value:this.props.ariaLabel,onChange:this.change("ariaLabel")})]}),n(p,{children:a("p",{children:["Label text that's read by screen readers. Highly recommend adding a label here to ensure your exercise is accessible. For more information on writting accessible labels, please see"," ",n("a",{href:"https://www.w3.org/WAI/tips/designing/#ensure-that-form-elements-include-clearly-associated-labels",target:"_blank",children:"this article."})]})})]}),a("div",{children:[n(g,{label:"Use Ã— for rendering multiplication instead of a center dot.",checked:this.props.times,onChange:o=>{this.props.onChange({times:o})}}),n(p,{children:n("p",{children:"For pre-algebra problems this option displays multiplication as \\times instead of \\cdot in both the rendered output and the acceptable formats examples."})})]}),a("div",{children:[a("label",{children:["Function variables: ",n("input",{type:"text",defaultValue:this.props.functions.join(" "),onChange:this.handleFunctions})]}),n(p,{children:n("p",{children:'Single-letter variables listed here will be interpreted as functions. This let us know that f(x) means "f of x" and not "f times x".'})})]}),a("div",{children:[n("div",{children:"Button sets:"}),t]}),n("h3",{className:"expression-editor-h3",children:"Answers"}),n("p",{style:{margin:"4px 0"},children:"student responses area matched against these from top to bottom"}),s,n("div",{children:n("button",{className:"simple-button orange",style:{fontSize:13},onClick:this.newAnswer,type:"button",children:"Add new answer"})})]})}};h.widgetName="expression",h.defaultProps={answerForms:[],times:!1,buttonSets:["basic"],functions:["f","g","h"]};let b=h;const O=function(r,e){let s=r.indexOf(e);return s=(s+1)%r.length,r[s]};class L extends S.Component{constructor(){super(...arguments),this.state={deleteFocused:!1},this.handleDeleteBlur=()=>{this.setState({deleteFocused:!1})},this.change=(...e)=>x.apply(this,e),this.handleImSure=()=>{this.props.onDelete()},this.handleDelete=()=>{this.setState({deleteFocused:!0})},this.toggleConsidered=()=>{const e=O(F,this.props.considered);this.change({considered:e})}}render(){let e=null;return this.state.deleteFocused?e=n("button",{type:"button",className:"simple-button orange",onClick:this.handleImSure,onBlur:this.handleDeleteBlur,children:"I'm sure!"}):e=n("button",{type:"button",className:"simple-button orange",onClick:this.handleDelete,children:"Delete"}),a("div",{className:"expression-answer-option",children:[n("div",{className:"answer-handle"}),a("div",{className:"answer-body",children:[a("div",{className:"answer-considered",children:[n("div",{onClick:this.toggleConsidered,className:"answer-status "+this.props.considered,children:this.props.considered}),n("div",{className:"answer-expression",children:n(N,{...this.props.expressionProps})})]}),a("div",{className:"answer-option",children:[n(g,{label:"Answer expression must have the same form.",checked:this.props.form,onChange:s=>{this.props.onChange({form:s})}}),n(p,{children:n("p",{children:"The student's answer must be in the same form. Commutativity and excess negative signs are ignored."})})]}),a("div",{className:"answer-option",children:[n(g,{label:"Answer expression must be fully expanded and simplified.",checked:this.props.simplify,onChange:s=>{this.props.onChange({simplify:s})}}),n(p,{children:n("p",{children:`The student's answer must be fully expanded and simplified. Answering this equation (x^2+2x+1) with this factored equation (x+1)^2 will render this response "Your answer is not fully expanded and simplified."`})})]}),n("div",{className:"remove-container",children:e})]})]})}}b.__docgenInfo={description:"",methods:[{name:"change",docblock:null,modifiers:[],params:[{name:"...args",optional:!1,type:null}],returns:null},{name:"serialize",docblock:null,modifiers:[],params:[],returns:null},{name:"getSaveWarnings",docblock:null,modifiers:[],params:[],returns:null},{name:"_newEmptyAnswerForm",docblock:null,modifiers:[],params:[],returns:null},{name:"newAnswer",docblock:null,modifiers:[],params:[],returns:null},{name:"handleRemoveForm",docblock:null,modifiers:[],params:[{name:"i",optional:!1,type:null}],returns:null},{name:"updateForm",docblock:null,modifiers:[],params:[{name:"i",optional:!1,type:null},{name:"props",optional:!1,type:null}],returns:null},{name:"handleReorder",docblock:null,modifiers:[],params:[{name:"components",optional:!1,type:null}],returns:null},{name:"handleButtonSet",docblock:null,modifiers:[],params:[{name:"changingName",optional:!1,type:null}],returns:null},{name:"handleToggleDiv",docblock:null,modifiers:[],params:[],returns:null},{name:"handleTexInsert",docblock:null,modifiers:[],params:[{name:"str",optional:!1,type:null}],returns:null},{name:"handleFunctions",docblock:null,modifiers:[],params:[{name:"e",optional:!1,type:null}],returns:null}],displayName:"ExpressionEditor",props:{widgetId:{required:!1,tsType:{name:"any"},description:""},value:{required:!1,tsType:{name:"string"},description:""},answerForms:{defaultValue:{value:"[]",computed:!1},required:!1},times:{defaultValue:{value:"false",computed:!1},required:!1},buttonSets:{defaultValue:{value:'["basic"]',computed:!1},required:!1},functions:{defaultValue:{value:'["f", "g", "h"]',computed:!1},required:!1}}};export{b as E};
