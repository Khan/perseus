import{j as a,a as o}from"./jsx-runtime-BGVbfQ2Z.js";import"./article-renderer-k6zfI72Y.js";import{p as v,c as T}from"./unit-kRJG92HA.js";import"./index-eZ2N530f.js";import"./index-V35CFGao.js";import"./index-qhcEwEpg.js";import"./fixed-to-responsive-X0KGwmEJ.js";import{a as k}from"./dependencies-fnqF3NiV.js";import"./video-transcript-link-7IHhb-72.js";import{_ as i}from"./index-default-4_ZsnO94.js";import"./perseus-api-Ly41NhN4.js";import"./multi-renderer-CaCUfJxG.js";import"./hints-renderer-BTmtPB5W.js";import"./renderer-l82xJpkV.js";import"./base-radio-pej-dhXT.js";import{c as w}from"./components-Pg-Ymur2.js";import{U as u,K as f}from"./util-SCSEXrYR.js";import{i as x}from"./constants-5iWyYZaE.js";import{P as n}from"./index-tvtfaFq4.js";import{c as y}from"./index-vV577VS-.js";import{R as N}from"./index-E09jvG0x.js";const{ButtonGroup:R,InfoTip:G,PropCheckBox:m,RangeInput:g}=w,{getDependencies:I}=k,C={url:null,width:0,height:0};function L(e,s){return Math.floor((e[1]-e[0])/s)}const E=y({displayName:"GraphSettings",propTypes:{...v,editableSettings:n.arrayOf(n.oneOf(["canvas","graph","snap","image","measure"])),box:n.arrayOf(n.number),labels:n.arrayOf(n.string),range:n.arrayOf(n.arrayOf(n.number)),step:n.arrayOf(n.number),gridStep:n.arrayOf(n.number),snapStep:n.arrayOf(n.number),valid:n.oneOfType([n.bool,n.string]),backgroundImage:n.object,markings:n.oneOf(["graph","grid","none"]),showProtractor:n.bool,showRuler:n.bool,showTooltips:n.bool,rulerLabel:n.string,rulerTicks:n.number},getDefaultProps:function(){return{editableSettings:["graph","snap","image","measure"],box:[x.defaultBoxSizeSmall,x.defaultBoxSizeSmall],labels:["x","y"],range:[[-10,10],[-10,10]],step:[1,1],gridStep:[1,1],snapStep:[1,1],valid:!0,backgroundImage:C,markings:"graph",showProtractor:!1,showRuler:!1,showTooltips:!1,rulerLabel:"",rulerTicks:10}},getInitialState:function(){return this.stateFromProps(this.props)},componentDidMount:function(){this._isMounted=!0,this.changeGraph=i.debounce(this.changeGraph,300)},UNSAFE_componentWillReceiveProps:function(e){(!i.isEqual(this.props.labels,e.labels)||!i.isEqual(this.props.gridStep,e.gridStep)||!i.isEqual(this.props.snapStep,e.snapStep)||!i.isEqual(this.props.step,e.step)||!i.isEqual(this.props.range,e.range)||!i.isEqual(this.props.backgroundImage,e.backgroundImage))&&this.setState(this.stateFromProps(e))},componentWillUnmount:function(){this._isMounted=!1},stateFromProps:function(e){return{labelsTextbox:e.labels,gridStepTextbox:e.gridStep,snapStepTextbox:e.snapStep,stepTextbox:e.step,rangeTextbox:e.range,backgroundImage:i.clone(e.backgroundImage)}},change(...e){return T.apply(this,e)},changeRulerLabel:function(e){this.change({rulerLabel:e.target.value})},changeRulerTicks:function(e){this.change({rulerTicks:+e.target.value})},changeBackgroundUrl:function(e){if(e.type==="keypress"&&e.key!=="Enter")return;const s=(l,c,p)=>{const r=i.clone(this.props.backgroundImage);r.url=l,r.width=c,r.height=p,this.setState({backgroundImage:r},this.changeGraph)},t=N.findDOMNode(this.refs["bg-url"]).value;t?u.getImageSize(t,(l,c)=>{this._isMounted&&s(t,l,c)}):s(null,0,0)},renderLabelChoices:function(e){return i.map(e,function(s){return a("option",{value:s[1],children:s[0]})})},validRange:function(e){return i.every(e,function(t){return i.isFinite(t)})?e[0]>=e[1]?"Range must have a higher number on the right":!0:"Range must be a valid number"},validateStepValue:function(e){const{step:s,range:t,name:l,minTicks:c,maxTicks:p}=e;if(!i.isFinite(s))return l+" must be a valid number";const r=L(t,s);return r<c?l+" is too large, there must be at least "+c+" ticks.":r>p?l+" is too small, there can be at most "+p+" ticks.":!0},validSnapStep:function(e,s){return this.validateStepValue({step:e,range:s,name:"Snap step",minTicks:5,maxTicks:60})},validGridStep:function(e,s){return this.validateStepValue({step:e,range:s,name:"Grid step",minTicks:3,maxTicks:60})},validStep:function(e,s){return this.validateStepValue({step:e,range:s,name:"Step",minTicks:3,maxTicks:20})},validBackgroundImageSize:function(e){return e.url?e.width<=450&&e.height<=450?!0:"Image must be smaller than 450px x 450px.":!0},validateGraphSettings:function(e,s,t,l,c){const p=this;let r;if(!i.every(e,function(h){return r=p.validRange(h),r===!0})||!i.every(s,function(h,d){return r=p.validStep(h,e[d]),r===!0})||!i.every(t,function(h,d){return r=p.validGridStep(h,e[d]),r===!0})||!i.every(l,function(h,d){return r=p.validSnapStep(h,e[d]),r===!0}))return r;const S=this.validBackgroundImageSize(c);return S!==!0?(r=S,r):!0},changeLabel:function(e,s){const t=s.target.value,l=this.state.labelsTextbox.slice();l[e]=t,this.setState({labelsTextbox:l},this.changeGraph)},changeRange:function(e,s){const t=this.state.rangeTextbox.slice();t[e]=s;const l=this.state.stepTextbox.slice(),c=this.state.gridStepTextbox.slice(),p=this.state.snapStepTextbox.slice(),r=u.scaleFromExtent(t[e],this.props.box[e]);this.validRange(t[e])===!0&&(l[e]=u.tickStepFromExtent(t[e],this.props.box[e]),c[e]=u.gridStepFromTickStep(l[e],r),p[e]=c[e]/2),this.setState({stepTextbox:l,gridStepTextbox:c,snapStepTextbox:p,rangeTextbox:t},this.changeGraph)},changeStep:function(e){this.setState({stepTextbox:e},this.changeGraph)},changeSnapStep:function(e){this.setState({snapStepTextbox:e},this.changeGraph)},changeGridStep:function(e){this.setState({gridStepTextbox:e,snapStepTextbox:i.map(e,function(s){return s/2})},this.changeGraph)},changeGraph:function(){const e=this.state.labelsTextbox,s=i.map(this.state.rangeTextbox,function(b){return i.map(b,Number)}),t=i.map(this.state.stepTextbox,Number),l=this.state.gridStepTextbox,c=this.state.snapStepTextbox,p=this.state.backgroundImage,r=this.validateGraphSettings(s,t,l,c,p);r===!0?this.change({valid:!0,labels:e,range:s,step:t,gridStep:l,snapStep:c,backgroundImage:p}):this.change({valid:r})},render:function(){const e=[f.roundTo(2,u.scaleFromExtent(this.props.range[0],this.props.box[0])),f.roundTo(2,u.scaleFromExtent(this.props.range[1],this.props.box[1]))],{TeX:s}=I();return o("div",{children:[i.contains(this.props.editableSettings,"canvas")&&o("div",{className:"graph-settings",children:[o("div",{className:"perseus-widget-row",children:["Canvas size (x,y pixels)",a(g,{value:this.props.box,onChange:t=>{this.change({box:t})}})]}),o("div",{className:"perseus-widget-row",children:["Scale (px per div):"," ",a(s,{children:"("+e[0]+", "+e[1]+")"})]})]}),i.contains(this.props.editableSettings,"graph")&&o("div",{className:"graph-settings",children:[o("div",{className:"perseus-widget-row",children:[o("div",{className:"perseus-widget-left-col",children:[" ","x Label",a("input",{type:"text",className:"graph-settings-axis-label",ref:"labels-0",onChange:t=>this.changeLabel(0,t),value:this.state.labelsTextbox[0]||""})]}),o("div",{className:"perseus-widget-right-col",children:["y Label",a("input",{type:"text",className:"graph-settings-axis-label",ref:"labels-1",onChange:t=>this.changeLabel(1,t),value:this.state.labelsTextbox[1]||""})]})]}),o("div",{className:"perseus-widget-row",children:[o("div",{className:"perseus-widget-left-col",children:["x Range",a(g,{value:this.state.rangeTextbox[0],onChange:t=>this.changeRange(0,t)})]}),o("div",{className:"perseus-widget-right-col",children:["y Range",a(g,{value:this.state.rangeTextbox[1],onChange:t=>this.changeRange(1,t)})]})]}),o("div",{className:"perseus-widget-row",children:[o("div",{className:"perseus-widget-left-col",children:["Tick Step",a(g,{value:this.state.stepTextbox,onChange:this.changeStep})]}),o("div",{className:"perseus-widget-right-col",children:["Grid Step",a(g,{value:this.state.gridStepTextbox,onChange:this.changeGridStep})]})]}),i.contains(this.props.editableSettings,"snap")&&a("div",{className:"perseus-widget-row",children:o("div",{className:"perseus-widget-left-col",children:["Snap Step",a(g,{value:this.state.snapStepTextbox,onChange:this.changeSnapStep})]})}),o("div",{className:"perseus-widget-row",children:[a("label",{children:"Markings: "}),a(R,{value:this.props.markings,allowEmpty:!1,buttons:[{value:"graph",content:"Graph"},{value:"grid",content:"Grid"},{value:"none",content:"None"}],onChange:this.change("markings")})]}),a("div",{className:"perseus-widget-left-col",children:a(m,{label:"Show tooltips",showTooltips:this.props.showTooltips,onChange:this.change})})]}),i.contains(this.props.editableSettings,"image")&&o("div",{className:"image-settings",children:[a("div",{children:"Background image:"}),o("div",{children:["Url:"," ",a("input",{type:"text",className:"graph-settings-background-url",ref:"bg-url",value:this.state.backgroundImage.url||"",onChange:t=>{const l=i.clone(this.props.backgroundImage);l.url=t.target.value,this.setState({backgroundImage:l})},onKeyPress:this.changeBackgroundUrl,onBlur:this.changeBackgroundUrl}),a(G,{children:a("p",{children:'Create an image in graphie, or use the "Add image" function to create a background.'})})]})]}),i.contains(this.props.editableSettings,"measure")&&o("div",{className:"misc-settings",children:[o("div",{className:"perseus-widget-row",children:[a("div",{className:"perseus-widget-left-col",children:a(m,{label:"Show ruler",showRuler:this.props.showRuler,onChange:this.change})}),a("div",{className:"perseus-widget-right-col",children:a(m,{label:"Show protractor",showProtractor:this.props.showProtractor,onChange:this.change})})]}),this.props.showRuler&&o("div",{children:[a("div",{children:o("label",{children:[" ","Ruler label:"," ",o("select",{onChange:this.changeRulerLabel,value:this.props.rulerLabel,children:[a("option",{value:"",children:"None"}),a("optgroup",{label:"Metric",children:this.renderLabelChoices([["milimeters","mm"],["centimeters","cm"],["meters","m"],["kilometers","km"]])}),a("optgroup",{label:"Imperial",children:this.renderLabelChoices([["inches","in"],["feet","ft"],["yards","yd"],["miles","mi"]])})]})]})}),a("div",{children:o("label",{children:[" ","Ruler ticks:"," ",a("select",{onChange:this.changeRulerTicks,value:this.props.rulerTicks,children:i.map([1,2,4,8,10,16],function(t){return a("option",{value:t,children:t})})})]})})]})]})]})}}),se=E;export{se as G};
