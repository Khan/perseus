import{r as o}from"./index-6oxdNXpR.js";let h=function(r){return r.Immediately="schedule-immediately",r.OnDemand="schedule-on-demand",r}({}),u=function(r){return r.Resolve="resolve-on-clear",r.Cancel="cancel-on-clear",r}({}),_=function(r){return r.Reset="reset",r.Passive="passive",r}({});class I{constructor(e,t,i=h.Immediately){if(this._timeoutId=void 0,this._action=void 0,this._timeoutMs=void 0,typeof e!="function")throw new Error("Action must be a function");if(t<0)throw new Error("Timeout period must be >= 0");this._action=e,this._timeoutMs=t,i===h.Immediately&&this.set()}get isSet(){return this._timeoutId!=null}set(){this.isSet&&this.clear(u.Cancel),this._timeoutId=setTimeout(()=>this.clear(u.Resolve),this._timeoutMs)}clear(e=u.Cancel){const t=this._timeoutId;this._timeoutId=null,t!=null&&(clearTimeout(t),e===u.Resolve&&this._action())}}class y{constructor(e,t,i=h.Immediately){if(this._intervalId=void 0,this._action=void 0,this._intervalMs=void 0,typeof e!="function")throw new Error("Action must be a function");if(t<1)throw new Error("Interval period must be >= 1");this._action=e,this._intervalMs=t,i===h.Immediately&&this.set()}get isSet(){return this._intervalId!=null}set(){this.isSet&&this.clear(u.Cancel),this._intervalId=setInterval(()=>this._action(),this._intervalMs)}clear(e=u.Cancel){const t=this._intervalId;this._intervalId=null,t!=null&&(clearInterval(t),e===u.Resolve&&this._action())}}class R{constructor(e,t=h.Immediately){if(this._animationFrameId=void 0,this._action=void 0,typeof e!="function")throw new Error("Action must be a function");this._action=e,t===h.Immediately&&this.set()}get isSet(){return this._animationFrameId!=null}set(){this.isSet&&this.clear(u.Cancel),this._animationFrameId=requestAnimationFrame(e=>this.clear(u.Resolve,e))}clear(e=u.Cancel,t){const i=this._animationFrameId;this._animationFrameId=null,i!=null&&(cancelAnimationFrame(i),e===u.Resolve&&this._action(t||performance.now()))}}class d{constructor(){this._disabled=!1,this._registeredActions=[]}timeout(e,t,i){if(this._disabled)return d.NoopAction;const s=new I(e,t,i==null?void 0:i.schedulePolicy);return this._registeredActions.push(()=>s.clear(i==null?void 0:i.clearPolicy)),s}interval(e,t,i){if(this._disabled)return d.NoopAction;const s=new y(e,t,i==null?void 0:i.schedulePolicy);return this._registeredActions.push(()=>s.clear(i==null?void 0:i.clearPolicy)),s}animationFrame(e,t){if(this._disabled)return d.NoopAction;const i=new R(e,t==null?void 0:t.schedulePolicy);return this._registeredActions.push(()=>i.clear(t==null?void 0:t.clearPolicy)),i}clearAll(){const e=[...this._registeredActions];this._registeredActions=[],e.forEach(t=>t())}disable(){this._disabled=!0,this.clearAll()}}d.NoopAction={set:()=>{},get isSet(){return!1},clear:()=>{}};class A extends o.Component{constructor(...e){super(...e),this._actionScheduler=new d}componentWillUnmount(){this._actionScheduler.disable()}render(){const{children:e}=this.props;return e(this._actionScheduler)}}function v(){return v=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},v.apply(this,arguments)}function b(r){const e=`withActionScheduler(${r.displayName||r.name})`,t=i=>o.createElement(A,null,s=>o.createElement(r,v({},i,{schedule:s})));return t.displayName=e,t}function g(r,e,t={}){const{actionPolicy:i,clearPolicy:s,schedulePolicy:m}=t,a=o.useRef(r),l=o.useRef(null);if(typeof r!="function")throw new Error("Action must be a function");if(r!==a.current&&(a.current=r,i===_.Reset)){var f;(f=l.current)==null||f.set()}return o.useEffect(()=>(l.current=new y(()=>{a.current==null||a.current()},e,m),()=>{var n;(n=l.current)==null||n.clear(s),l.current=null}),[e,s,m]),o.useMemo(()=>({set:()=>{var n;(n=l.current)==null||n.set()},clear:n=>{var c;(c=l.current)==null||c.clear(n)},get isSet(){var n,c;return(n=(c=l.current)==null?void 0:c.isSet)!=null?n:!1}}),[])}function S(r,e,t={}){const{actionPolicy:i,clearPolicy:s,schedulePolicy:m}=t,a=o.useRef(r),l=o.useRef(null);if(typeof r!="function")throw new Error("Action must be a function");if(r!==a.current&&(a.current=r,i===_.Reset)){var f;(f=l.current)==null||f.set()}return o.useEffect(()=>(l.current=new I(()=>{a.current==null||a.current()},e,m),()=>{var n;(n=l.current)==null||n.clear(s),l.current=null}),[e,s,m]),o.useMemo(()=>({set:()=>{var n;(n=l.current)==null||n.set()},clear:n=>{var c;(c=l.current)==null||c.clear(n)},get isSet(){var n,c;return(n=(c=l.current)==null?void 0:c.isSet)!=null?n:!1}}),[])}export{h as S,S as a,g as u,b as w};
