import{R as tn,S as nn,T as rn,U as sn,v as an,u as Ct,V as Te,Q as te,W as Qe}from"./random-util-wZstT-Qs.js";import{_ as l}from"./underscore-885MUNGo.js";import{P as de,E as me}from"./perseus-error-l3K_anoI.js";import{$ as Z}from"./jquery-5v7aFUvu.js";import{g as on}from"./get-decimal-separator-C5N_K9o2.js";function Ze(t){const e=[1,1];return l(t).each((n,r)=>{let s=0;l(n).each((i,a)=>{i!=null&&i.toString().length&&(s=a+1)}),e[1]=Math.max(e[1],s),s>0&&(e[0]=Math.max(e[0],r+1))}),e}function cn(){return/\[\[☃ ([A-Za-z0-9- ]+)\]\]/g}function ln(t){const e=[],n=cn();let r=n.exec(t);for(;r!==null;)e.push(r[1]),r=n.exec(t);return e}function et(t){return Array.isArray(t)?t.map(et):t}const Ws=function(t,e){return l.object(l.map(t,function(n,r){return[r,n[e]]}))},un=function(t,e){const n={};return Object.keys(t).forEach(r=>{n[r]=e(t[r],r)}),n},hn=!1,fn=t=>{var u;const e=t.type;if(!l.isString(e))throw new de("widget type must be a string, but was: "+e,me.Internal);if(!tn(e))return t;const n=t.version||{major:0,minor:0},r=nn(e);if(n.major>r.major||n.major===r.major&&n.minor>r.minor)return t;let s=l.clone(t.options)||{};const i=rn(e);if(l.keys(s).length!==0)for(let c=n.major+1;c<=r.major;c++)if(i[String(c)])s=i[String(c)](s);else throw new de("No upgrade found for widget. Cannot render.",me.Internal,{metadata:{type:e,fromMajorVersion:c-1,toMajorVersion:c,oldWidgetInfo:JSON.stringify(t)}});s={...sn(e),...s};let o=t.alignment;if((o==null||o==="default")&&(o=(u=an(e))==null?void 0:u[0],!o))throw new de("No default alignment found when upgrading widget",me.Internal,{metadata:{widgetType:e}});let h=t.static;return h==null&&(h=hn),{...t,version:r,graded:t.graded!=null?t.graded:!0,alignment:o,static:h,options:s}};function pn(t){return un(t,(e,n)=>{if(!e.type||!e.alignment){const r={};e.type||(r.type=n.split(" ")[0]),e.alignment||(r.alignment="default"),e={...e,...r}}return fn(e)})}const dn="@khanacademy/kas",mn="__lib_version__";Ct(dn,mn);(function(){var t=function(u,c,f,p){for(f=f||{},p=u.length;p--;f[u[p]]=c);return f},e=[1,11],n=[1,9],r=[8,17],s=[6,11],i=[6,11,13,17],a={trace:function(){},yy:{},symbols_:{error:2,unitvalue:3,magnitude:4,unit:5,EOF:6,float:7,POW:8,int:9,multatoms:10,DIV:11,expatom:12,MUL:13,atom:14,"^":15,nat:16,ATOM:17,FLOAT:18,NAT:19,NEG:20,$accept:0,$end:1},terminals_:{2:"error",6:"EOF",8:"POW",11:"DIV",13:"MUL",15:"^",17:"ATOM",18:"FLOAT",19:"NAT",20:"NEG"},productions_:[0,[3,3],[3,2],[4,3],[4,1],[5,3],[5,1],[10,3],[10,2],[10,1],[12,3],[12,1],[14,1],[7,1],[7,1],[16,1],[9,2],[9,1]],performAction:function(c,f,p,m,d,v,w){var R=v.length-1;switch(d){case 1:return{type:"unitMagnitude",magnitude:v[R-2],unit:v[R-1]};case 2:return{type:"unitStandalone",unit:v[R-1]};case 3:this.$=v[R-2]+"e"+v[R];break;case 4:case 13:case 14:case 15:case 17:this.$=v[R];break;case 5:this.$={num:v[R-2],denom:v[R]};break;case 6:this.$={num:v[R],denom:null};break;case 7:this.$=[v[R-2]].concat(v[R]);break;case 8:this.$=[v[R-1]].concat(v[R]);break;case 9:this.$=[v[R]];break;case 10:this.$={name:v[R-2],pow:v[R]};break;case 11:this.$={name:v[R],pow:1};break;case 12:this.$=c;break;case 16:this.$="-"+v[R];break}},table:[{3:1,4:2,5:3,7:4,10:5,12:8,14:10,16:7,17:e,18:[1,6],19:n},{1:[3]},{5:12,10:5,12:8,14:10,17:e},{6:[1,13]},{8:[1,14],17:[2,4]},{6:[2,6],11:[1,15]},t(r,[2,13]),t(r,[2,14]),t(s,[2,9],{12:8,14:10,10:17,13:[1,16],17:e}),t([6,8,11,13,17],[2,15]),t(i,[2,11],{15:[1,18]}),t([6,11,13,15,17],[2,12]),{6:[1,19]},{1:[2,2]},{9:20,19:[1,22],20:[1,21]},{10:23,12:8,14:10,17:e},{10:24,12:8,14:10,17:e},t(s,[2,8]),{16:25,19:n},{1:[2,1]},{17:[2,3]},{19:[1,26]},{17:[2,17]},{6:[2,5]},t(s,[2,7]),t(i,[2,10]),{17:[2,16]}],defaultActions:{13:[2,2],19:[2,1],20:[2,3],22:[2,17],23:[2,5],26:[2,16]},parseError:function(c,f){if(f.recoverable)this.trace(c);else throw new Error(c)},parse:function(c){var f=this,p=[0],m=[null],d=[],v=this.table,w="",R=0,D=0,_=2,he=1,Pe=d.slice.call(arguments,1),G=Object.create(this.lexer),U={yy:{}};for(var ie in this.yy)Object.prototype.hasOwnProperty.call(this.yy,ie)&&(U.yy[ie]=this.yy[ie]);G.setInput(c,U.yy),U.yy.lexer=G,U.yy.parser=this,typeof G.yylloc>"u"&&(G.yylloc={});var j=G.yylloc;d.push(j);var Ce=G.options&&G.options.ranges;typeof U.yy.parseError=="function"?this.parseError=U.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;function He(){var oe;return oe=G.lex()||he,typeof oe!="number"&&(oe=f.symbols_[oe]||oe),oe}for(var W,Y,b,N,x={},k,T,S,fe;;){if(Y=p[p.length-1],this.defaultActions[Y]?b=this.defaultActions[Y]:((W===null||typeof W>"u")&&(W=He()),b=v[Y]&&v[Y][W]),typeof b>"u"||!b.length||!b[0]){var O="";fe=[];for(k in v[Y])this.terminals_[k]&&k>_&&fe.push("'"+this.terminals_[k]+"'");G.showPosition?O="Parse error on line "+(R+1)+`:
`+G.showPosition()+`
Expecting `+fe.join(", ")+", got '"+(this.terminals_[W]||W)+"'":O="Parse error on line "+(R+1)+": Unexpected "+(W==he?"end of input":"'"+(this.terminals_[W]||W)+"'"),this.parseError(O,{text:G.match,token:this.terminals_[W]||W,line:G.yylineno,loc:j,expected:fe})}if(b[0]instanceof Array&&b.length>1)throw new Error("Parse Error: multiple actions possible at state: "+Y+", token: "+W);switch(b[0]){case 1:p.push(W),m.push(G.yytext),d.push(G.yylloc),p.push(b[1]),W=null,D=G.yyleng,w=G.yytext,R=G.yylineno,j=G.yylloc;break;case 2:if(T=this.productions_[b[1]][1],x.$=m[m.length-T],x._$={first_line:d[d.length-(T||1)].first_line,last_line:d[d.length-1].last_line,first_column:d[d.length-(T||1)].first_column,last_column:d[d.length-1].last_column},Ce&&(x._$.range=[d[d.length-(T||1)].range[0],d[d.length-1].range[1]]),N=this.performAction.apply(x,[w,D,R,U.yy,b[1],m,d].concat(Pe)),typeof N<"u")return N;T&&(p=p.slice(0,-1*T*2),m=m.slice(0,-1*T),d=d.slice(0,-1*T)),p.push(this.productions_[b[1]][0]),m.push(x.$),d.push(x._$),S=v[p[p.length-2]][p[p.length-1]],p.push(S);break;case 3:return!0}}return!0}},o=function(){var u={EOF:1,parseError:function(f,p){if(this.yy.parser)this.yy.parser.parseError(f,p);else throw new Error(f)},setInput:function(c,f){return this.yy=f||this.yy||{},this._input=c,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var c=this._input[0];this.yytext+=c,this.yyleng++,this.offset++,this.match+=c,this.matched+=c;var f=c.match(/(?:\r\n?|\n).*/g);return f?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),c},unput:function(c){var f=c.length,p=c.split(/(?:\r\n?|\n)/g);this._input=c+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-f),this.offset-=f;var m=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),p.length-1&&(this.yylineno-=p.length-1);var d=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:p?(p.length===m.length?this.yylloc.first_column:0)+m[m.length-p.length].length-p[0].length:this.yylloc.first_column-f},this.options.ranges&&(this.yylloc.range=[d[0],d[0]+this.yyleng-f]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+`. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
`+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(c){this.unput(this.match.slice(c))},pastInput:function(){var c=this.matched.substr(0,this.matched.length-this.match.length);return(c.length>20?"...":"")+c.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var c=this.match;return c.length<20&&(c+=this._input.substr(0,20-c.length)),(c.substr(0,20)+(c.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var c=this.pastInput(),f=new Array(c.length+1).join("-");return c+this.upcomingInput()+`
`+f+"^"},test_match:function(c,f){var p,m,d;if(this.options.backtrack_lexer&&(d={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(d.yylloc.range=this.yylloc.range.slice(0))),m=c[0].match(/(?:\r\n?|\n).*/g),m&&(this.yylineno+=m.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:m?m[m.length-1].length-m[m.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+c[0].length},this.yytext+=c[0],this.match+=c[0],this.matches=c,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(c[0].length),this.matched+=c[0],p=this.performAction.call(this,this.yy,this,f,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),p)return p;if(this._backtrack){for(var v in d)this[v]=d[v];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var c,f,p,m;this._more||(this.yytext="",this.match="");for(var d=this._currentRules(),v=0;v<d.length;v++)if(p=this._input.match(this.rules[d[v]]),p&&(!f||p[0].length>f[0].length)){if(f=p,m=v,this.options.backtrack_lexer){if(c=this.test_match(p,d[v]),c!==!1)return c;if(this._backtrack){f=!1;continue}else return!1}else if(!this.options.flex)break}return f?(c=this.test_match(f,d[m]),c!==!1?c:!1):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var f=this.next();return f||this.lex()},begin:function(f){this.conditionStack.push(f)},popState:function(){var f=this.conditionStack.length-1;return f>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(f){return f=this.conditionStack.length-1-Math.abs(f||0),f>=0?this.conditionStack[f]:"INITIAL"},pushState:function(f){this.begin(f)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(f,p,m,d){switch(m){case 0:return 11;case 1:return"(";case 2:return")";case 3:return 8;case 4:return 15;case 5:return 13;case 6:return 18;case 7:return 19;case 8:return 20;case 9:return 17;case 10:return 17;case 11:return 17;case 12:break;case 13:return 6}},rules:[/^(?:\/)/,/^(?:\()/,/^(?:\))/,/^(?:(\*|x|\u00d7|\u2219|\u22c5|\u00b7)\s*10\s*\^)/,/^(?:\^)/,/^(?:\*)/,/^(?:[0-9]+\.[0-9]+)/,/^(?:[0-9]+)/,/^(?:-)/,/^(?:\u00b0( ?)[cCfF])/,/^(?:fl\.? oz\.?)/,/^(?:[\u00b5]?([A-Za-z-]+|[\u2103\u2109\u212b]))/,/^(?:\s+)/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}};return u}();a.lexer=o;function h(){this.yy={}}return h.prototype=a,a.Parser=h,new h})();var Se=function(){var t=function(Y,b,N,x){for(N=N||{},x=Y.length;x--;N[Y[x]]=b);return N},e=[1,7],n=[1,17],r=[1,13],s=[1,14],i=[1,15],a=[1,32],o=[1,22],h=[1,23],u=[1,24],c=[1,25],f=[1,26],p=[1,33],m=[1,27],d=[1,28],v=[1,29],w=[1,30],R=[1,20],D=[1,36],_=[1,37],he=[5,6,8,10,33,35,41,43,45],Pe=[1,39],G=[1,40],U=[5,6,8,10,12,14,16,19,21,22,28,29,30,31,32,33,34,35,37,39,41,42,43,44,45,46],ie=[10,16,19,21,22,28,29,30,31,32,34,37,39,42,43,44,46],j=[5,6,8,10,12,14,16,18,19,21,22,28,29,30,31,32,33,34,35,37,39,41,42,43,44,45,46],Ce={trace:function(){},yy:{},symbols_:{error:2,equation:3,expression:4,SIGN:5,EOF:6,additive:7,"+":8,multiplicative:9,"-":10,triglog:11,"*":12,negative:13,"/":14,trig:15,TRIG:16,trigfunc:17,"^":18,TRIGINV:19,logbase:20,ln:21,log:22,_:23,subscriptable:24,power:25,primitive:26,variable:27,VAR:28,CONST:29,INT:30,FLOAT:31,"{":32,"}":33,"(":34,")":35,function:36,FUNC:37,invocation:38,sqrt:39,"[":40,"]":41,abs:42,"|":43,"LEFT|":44,"RIGHT|":45,FRAC:46,$accept:0,$end:1},terminals_:{2:"error",5:"SIGN",6:"EOF",8:"+",10:"-",12:"*",14:"/",16:"TRIG",18:"^",19:"TRIGINV",21:"ln",22:"log",23:"_",28:"VAR",29:"CONST",30:"INT",31:"FLOAT",32:"{",33:"}",34:"(",35:")",37:"FUNC",39:"sqrt",40:"[",41:"]",42:"abs",43:"|",44:"LEFT|",45:"RIGHT|",46:"FRAC"},productions_:[0,[3,4],[3,2],[3,1],[4,1],[7,3],[7,3],[7,1],[9,2],[9,3],[9,3],[9,1],[13,2],[13,1],[15,1],[17,1],[17,3],[17,1],[20,1],[20,1],[20,3],[11,2],[11,2],[11,1],[25,3],[25,1],[27,1],[24,3],[24,1],[24,1],[24,1],[24,1],[24,3],[24,3],[36,1],[38,4],[38,4],[38,7],[38,4],[38,3],[38,3],[38,4],[26,1],[26,1],[26,7]],performAction:function(b,N,x,k,T,S,fe){var O=S.length-1;switch(T){case 1:return new k.Eq(S[O-3],S[O-2],S[O-1]);case 2:return S[O-1];case 3:return new k.Add([]);case 4:case 7:case 11:case 13:case 15:case 20:case 23:case 25:case 42:case 43:this.$=S[O];break;case 5:this.$=k.Add.createOrAppend(S[O-2],S[O]);break;case 6:this.$=k.Add.createOrAppend(S[O-2],k.Mul.handleNegative(S[O],"subtract"));break;case 8:this.$=k.Mul.fold(k.Mul.createOrAppend(S[O-1],S[O]));break;case 9:this.$=k.Mul.fold(k.Mul.createOrAppend(S[O-2],S[O]));break;case 10:this.$=k.Mul.fold(k.Mul.handleDivide(S[O-2],S[O]));break;case 12:this.$=k.Mul.handleNegative(S[O]);break;case 14:case 17:this.$=[b];break;case 16:this.$=S[O-2].concat(S[O]);break;case 18:this.$=k.Log.natural();break;case 19:this.$=k.Log.common();break;case 21:this.$=k.Trig.create(S[O-1],S[O]);break;case 22:this.$=k.Log.create(S[O-1],S[O]);break;case 24:this.$=new k.Pow(S[O-2],S[O]);break;case 26:case 34:this.$=b;break;case 27:this.$=new k.Var(S[O-2],S[O]);break;case 28:this.$=new k.Var(S[O]);break;case 29:this.$=new k.Const(b.toLowerCase());break;case 30:this.$=k.Int.create(Number(b));break;case 31:this.$=k.Float.create(Number(b));break;case 32:this.$=S[O-1].completeParse();break;case 33:this.$=S[O-1].completeParse().addHint("parens");break;case 35:case 36:this.$=k.Pow.sqrt(S[O-1]);break;case 37:this.$=new k.Pow.nthroot(S[O-1],S[O-4]);break;case 38:case 39:case 40:this.$=new k.Abs(S[O-1]);break;case 41:this.$=new k.Func(S[O-3],S[O-1]);break;case 44:this.$=k.Mul.handleDivide(S[O-4],S[O-1]);break}},table:[{3:1,4:2,6:[1,3],7:4,9:5,10:e,11:8,13:6,15:12,16:n,17:9,19:r,20:10,21:s,22:i,24:18,25:11,26:16,27:21,28:a,29:o,30:h,31:u,32:c,34:f,36:31,37:p,38:19,39:m,42:d,43:v,44:w,46:R},{1:[3]},{5:[1,34],6:[1,35]},{1:[2,3]},t([5,6],[2,4],{8:D,10:_}),t(he,[2,7],{17:9,20:10,25:11,15:12,26:16,24:18,38:19,27:21,36:31,11:38,12:Pe,14:G,16:n,19:r,21:s,22:i,28:a,29:o,30:h,31:u,32:c,34:f,37:p,39:m,42:d,44:w,46:R}),t(U,[2,11]),{10:e,11:8,13:41,15:12,16:n,17:9,19:r,20:10,21:s,22:i,24:18,25:11,26:16,27:21,28:a,29:o,30:h,31:u,32:c,34:f,36:31,37:p,38:19,39:m,42:d,43:v,44:w,46:R},t(U,[2,13]),{10:e,11:8,13:42,15:12,16:n,17:9,19:r,20:10,21:s,22:i,24:18,25:11,26:16,27:21,28:a,29:o,30:h,31:u,32:c,34:f,36:31,37:p,38:19,39:m,42:d,43:v,44:w,46:R},{10:e,11:8,13:43,15:12,16:n,17:9,19:r,20:10,21:s,22:i,24:18,25:11,26:16,27:21,28:a,29:o,30:h,31:u,32:c,34:f,36:31,37:p,38:19,39:m,42:d,43:v,44:w,46:R},t(U,[2,23]),t(ie,[2,15],{18:[1,44]}),t(ie,[2,17]),t(ie,[2,18]),t(ie,[2,19],{23:[1,45]}),t(U,[2,25],{18:[1,46]}),t([10,16,18,19,21,22,28,29,30,31,32,34,37,39,42,43,44,46],[2,14]),t(j,[2,42]),t(j,[2,43]),{32:[1,47]},t(j,[2,28],{23:[1,48]}),t(j,[2,29]),t(j,[2,30]),t(j,[2,31]),{7:49,9:5,10:e,11:8,13:6,15:12,16:n,17:9,19:r,20:10,21:s,22:i,24:18,25:11,26:16,27:21,28:a,29:o,30:h,31:u,32:c,34:f,36:31,37:p,38:19,39:m,42:d,43:v,44:w,46:R},{7:50,9:5,10:e,11:8,13:6,15:12,16:n,17:9,19:r,20:10,21:s,22:i,24:18,25:11,26:16,27:21,28:a,29:o,30:h,31:u,32:c,34:f,36:31,37:p,38:19,39:m,42:d,43:v,44:w,46:R},{32:[1,52],34:[1,51],40:[1,53]},{34:[1,54]},{7:55,9:5,10:e,11:8,13:6,15:12,16:n,17:9,19:r,20:10,21:s,22:i,24:18,25:11,26:16,27:21,28:a,29:o,30:h,31:u,32:c,34:f,36:31,37:p,38:19,39:m,42:d,43:v,44:w,46:R},{7:56,9:5,10:e,11:8,13:6,15:12,16:n,17:9,19:r,20:10,21:s,22:i,24:18,25:11,26:16,27:21,28:a,29:o,30:h,31:u,32:c,34:f,36:31,37:p,38:19,39:m,42:d,43:v,44:w,46:R},{34:[1,57]},t([5,6,8,10,12,14,16,18,19,21,22,23,28,29,30,31,32,33,34,35,37,39,41,42,43,44,45,46],[2,26]),{34:[2,34]},{4:58,7:4,9:5,10:e,11:8,13:6,15:12,16:n,17:9,19:r,20:10,21:s,22:i,24:18,25:11,26:16,27:21,28:a,29:o,30:h,31:u,32:c,34:f,36:31,37:p,38:19,39:m,42:d,43:v,44:w,46:R},{1:[2,2]},{9:59,10:e,11:8,13:6,15:12,16:n,17:9,19:r,20:10,21:s,22:i,24:18,25:11,26:16,27:21,28:a,29:o,30:h,31:u,32:c,34:f,36:31,37:p,38:19,39:m,42:d,43:v,44:w,46:R},{9:60,10:e,11:8,13:6,15:12,16:n,17:9,19:r,20:10,21:s,22:i,24:18,25:11,26:16,27:21,28:a,29:o,30:h,31:u,32:c,34:f,36:31,37:p,38:19,39:m,42:d,43:v,44:w,46:R},t(U,[2,8]),{10:e,11:8,13:61,15:12,16:n,17:9,19:r,20:10,21:s,22:i,24:18,25:11,26:16,27:21,28:a,29:o,30:h,31:u,32:c,34:f,36:31,37:p,38:19,39:m,42:d,43:v,44:w,46:R},{10:e,11:8,13:62,15:12,16:n,17:9,19:r,20:10,21:s,22:i,24:18,25:11,26:16,27:21,28:a,29:o,30:h,31:u,32:c,34:f,36:31,37:p,38:19,39:m,42:d,43:v,44:w,46:R},t(U,[2,12]),t(U,[2,21]),t(U,[2,22]),{10:e,11:8,13:63,15:12,16:n,17:9,19:r,20:10,21:s,22:i,24:18,25:11,26:16,27:21,28:a,29:o,30:h,31:u,32:c,34:f,36:31,37:p,38:19,39:m,42:d,43:v,44:w,46:R},{24:64,27:21,28:a,29:o,30:h,31:u,32:c,34:f},{10:e,11:8,13:65,15:12,16:n,17:9,19:r,20:10,21:s,22:i,24:18,25:11,26:16,27:21,28:a,29:o,30:h,31:u,32:c,34:f,36:31,37:p,38:19,39:m,42:d,43:v,44:w,46:R},{7:66,9:5,10:e,11:8,13:6,15:12,16:n,17:9,19:r,20:10,21:s,22:i,24:18,25:11,26:16,27:21,28:a,29:o,30:h,31:u,32:c,34:f,36:31,37:p,38:19,39:m,42:d,43:v,44:w,46:R},{24:67,27:21,28:a,29:o,30:h,31:u,32:c,34:f},{8:D,10:_,33:[1,68]},{8:D,10:_,35:[1,69]},{7:70,9:5,10:e,11:8,13:6,15:12,16:n,17:9,19:r,20:10,21:s,22:i,24:18,25:11,26:16,27:21,28:a,29:o,30:h,31:u,32:c,34:f,36:31,37:p,38:19,39:m,42:d,43:v,44:w,46:R},{7:71,9:5,10:e,11:8,13:6,15:12,16:n,17:9,19:r,20:10,21:s,22:i,24:18,25:11,26:16,27:21,28:a,29:o,30:h,31:u,32:c,34:f,36:31,37:p,38:19,39:m,42:d,43:v,44:w,46:R},{7:72,9:5,10:e,11:8,13:6,15:12,16:n,17:9,19:r,20:10,21:s,22:i,24:18,25:11,26:16,27:21,28:a,29:o,30:h,31:u,32:c,34:f,36:31,37:p,38:19,39:m,42:d,43:v,44:w,46:R},{7:73,9:5,10:e,11:8,13:6,15:12,16:n,17:9,19:r,20:10,21:s,22:i,24:18,25:11,26:16,27:21,28:a,29:o,30:h,31:u,32:c,34:f,36:31,37:p,38:19,39:m,42:d,43:v,44:w,46:R},{8:D,10:_,43:[1,74]},{8:D,10:_,45:[1,75]},{7:76,9:5,10:e,11:8,13:6,15:12,16:n,17:9,19:r,20:10,21:s,22:i,24:18,25:11,26:16,27:21,28:a,29:o,30:h,31:u,32:c,34:f,36:31,37:p,38:19,39:m,42:d,43:v,44:w,46:R},{6:[1,77]},t(he,[2,5],{17:9,20:10,25:11,15:12,26:16,24:18,38:19,27:21,36:31,11:38,12:Pe,14:G,16:n,19:r,21:s,22:i,28:a,29:o,30:h,31:u,32:c,34:f,37:p,39:m,42:d,44:w,46:R}),t(he,[2,6],{17:9,20:10,25:11,15:12,26:16,24:18,38:19,27:21,36:31,11:38,12:Pe,14:G,16:n,19:r,21:s,22:i,28:a,29:o,30:h,31:u,32:c,34:f,37:p,39:m,42:d,44:w,46:R}),t(U,[2,9]),t(U,[2,10]),t(ie,[2,16]),t(ie,[2,20]),t(U,[2,24]),{8:D,10:_,33:[1,78]},t(j,[2,27]),t(j,[2,32]),t(j,[2,33]),{8:D,10:_,35:[1,79]},{8:D,10:_,33:[1,80]},{8:D,10:_,41:[1,81]},{8:D,10:_,35:[1,82]},t(j,[2,39]),t(j,[2,40]),{8:D,10:_,35:[1,83]},{1:[2,1]},{32:[1,84]},t(j,[2,35]),t(j,[2,36]),{32:[1,85]},t(j,[2,38]),t(j,[2,41]),{7:86,9:5,10:e,11:8,13:6,15:12,16:n,17:9,19:r,20:10,21:s,22:i,24:18,25:11,26:16,27:21,28:a,29:o,30:h,31:u,32:c,34:f,36:31,37:p,38:19,39:m,42:d,43:v,44:w,46:R},{7:87,9:5,10:e,11:8,13:6,15:12,16:n,17:9,19:r,20:10,21:s,22:i,24:18,25:11,26:16,27:21,28:a,29:o,30:h,31:u,32:c,34:f,36:31,37:p,38:19,39:m,42:d,43:v,44:w,46:R},{8:D,10:_,33:[1,88]},{8:D,10:_,33:[1,89]},t(j,[2,44]),t(j,[2,37])],defaultActions:{3:[2,3],33:[2,34],35:[2,2],77:[2,1]},parseError:function(b,N){if(N.recoverable)this.trace(b);else throw new Error(b)},parse:function(b){var N=this,x=[0],k=[null],T=[],S=this.table,fe="",O=0,oe=0,Kt=2,dt=1,Qt=T.slice.call(arguments,1),H=Object.create(this.lexer),ve={yy:{}};for(var $e in this.yy)Object.prototype.hasOwnProperty.call(this.yy,$e)&&(ve.yy[$e]=this.yy[$e]);H.setInput(b,ve.yy),ve.yy.lexer=H,ve.yy.parser=this,typeof H.yylloc>"u"&&(H.yylloc={});var Be=H.yylloc;T.push(Be);var Zt=H.options&&H.options.ranges;typeof ve.yy.parseError=="function"?this.parseError=ve.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;function en(){var Re;return Re=H.lex()||dt,typeof Re!="number"&&(Re=N.symbols_[Re]||Re),Re}for(var K,xe,ee,Xe,ke={},De,ce,mt,Ve;;){if(xe=x[x.length-1],this.defaultActions[xe]?ee=this.defaultActions[xe]:((K===null||typeof K>"u")&&(K=en()),ee=S[xe]&&S[xe][K]),typeof ee>"u"||!ee.length||!ee[0]){var Ye="";Ve=[];for(De in S[xe])this.terminals_[De]&&De>Kt&&Ve.push("'"+this.terminals_[De]+"'");H.showPosition?Ye="Parse error on line "+(O+1)+`:
`+H.showPosition()+`
Expecting `+Ve.join(", ")+", got '"+(this.terminals_[K]||K)+"'":Ye="Parse error on line "+(O+1)+": Unexpected "+(K==dt?"end of input":"'"+(this.terminals_[K]||K)+"'"),this.parseError(Ye,{text:H.match,token:this.terminals_[K]||K,line:H.yylineno,loc:Be,expected:Ve})}if(ee[0]instanceof Array&&ee.length>1)throw new Error("Parse Error: multiple actions possible at state: "+xe+", token: "+K);switch(ee[0]){case 1:x.push(K),k.push(H.yytext),T.push(H.yylloc),x.push(ee[1]),K=null,oe=H.yyleng,fe=H.yytext,O=H.yylineno,Be=H.yylloc;break;case 2:if(ce=this.productions_[ee[1]][1],ke.$=k[k.length-ce],ke._$={first_line:T[T.length-(ce||1)].first_line,last_line:T[T.length-1].last_line,first_column:T[T.length-(ce||1)].first_column,last_column:T[T.length-1].last_column},Zt&&(ke._$.range=[T[T.length-(ce||1)].range[0],T[T.length-1].range[1]]),Xe=this.performAction.apply(ke,[fe,oe,O,ve.yy,ee[1],k,T].concat(Qt)),typeof Xe<"u")return Xe;ce&&(x=x.slice(0,-1*ce*2),k=k.slice(0,-1*ce),T=T.slice(0,-1*ce)),x.push(this.productions_[ee[1]][0]),k.push(ke.$),T.push(ke._$),mt=S[x[x.length-2]][x[x.length-1]],x.push(mt);break;case 3:return!0}}return!0}},He=function(){var Y={EOF:1,parseError:function(N,x){if(this.yy.parser)this.yy.parser.parseError(N,x);else throw new Error(N)},setInput:function(b,N){return this.yy=N||this.yy||{},this._input=b,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var b=this._input[0];this.yytext+=b,this.yyleng++,this.offset++,this.match+=b,this.matched+=b;var N=b.match(/(?:\r\n?|\n).*/g);return N?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),b},unput:function(b){var N=b.length,x=b.split(/(?:\r\n?|\n)/g);this._input=b+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-N),this.offset-=N;var k=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),x.length-1&&(this.yylineno-=x.length-1);var T=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:x?(x.length===k.length?this.yylloc.first_column:0)+k[k.length-x.length].length-x[0].length:this.yylloc.first_column-N},this.options.ranges&&(this.yylloc.range=[T[0],T[0]+this.yyleng-N]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+`. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
`+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(b){this.unput(this.match.slice(b))},pastInput:function(){var b=this.matched.substr(0,this.matched.length-this.match.length);return(b.length>20?"...":"")+b.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var b=this.match;return b.length<20&&(b+=this._input.substr(0,20-b.length)),(b.substr(0,20)+(b.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var b=this.pastInput(),N=new Array(b.length+1).join("-");return b+this.upcomingInput()+`
`+N+"^"},test_match:function(b,N){var x,k,T;if(this.options.backtrack_lexer&&(T={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(T.yylloc.range=this.yylloc.range.slice(0))),k=b[0].match(/(?:\r\n?|\n).*/g),k&&(this.yylineno+=k.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:k?k[k.length-1].length-k[k.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+b[0].length},this.yytext+=b[0],this.match+=b[0],this.matches=b,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(b[0].length),this.matched+=b[0],x=this.performAction.call(this,this.yy,this,N,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),x)return x;if(this._backtrack){for(var S in T)this[S]=T[S];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var b,N,x,k;this._more||(this.yytext="",this.match="");for(var T=this._currentRules(),S=0;S<T.length;S++)if(x=this._input.match(this.rules[T[S]]),x&&(!N||x[0].length>N[0].length)){if(N=x,k=S,this.options.backtrack_lexer){if(b=this.test_match(x,T[S]),b!==!1)return b;if(this._backtrack){N=!1;continue}else return!1}else if(!this.options.flex)break}return N?(b=this.test_match(N,T[k]),b!==!1?b:!1):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var N=this.next();return N||this.lex()},begin:function(N){this.conditionStack.push(N)},popState:function(){var N=this.conditionStack.length-1;return N>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(N){return N=this.conditionStack.length-1-Math.abs(N||0),N>=0?this.conditionStack[N]:"INITIAL"},pushState:function(N){this.begin(N)},stateStackSize:function(){return this.conditionStack.length},options:{flex:!0},performAction:function(N,x,k,T){switch(k){case 0:break;case 1:break;case 2:break;case 3:return"INT";case 4:return"FLOAT";case 5:return"^";case 6:return"*";case 7:return"*";case 8:return"*";case 9:return"*";case 10:return"/";case 11:return"/";case 12:return"-";case 13:return"-";case 14:return"+";case 15:return"^";case 16:return"(";case 17:return")";case 18:return"(";case 19:return")";case 20:return"[";case 21:return"]";case 22:return"{";case 23:return"}";case 24:return"{";case 25:return"}";case 26:return"_";case 27:return"|";case 28:return"LEFT|";case 29:return"RIGHT|";case 30:return"!";case 31:return"SIGN";case 32:return x.yytext="<=","SIGN";case 33:return x.yytext=">=","SIGN";case 34:return x.yytext="<=","SIGN";case 35:return x.yytext=">=","SIGN";case 36:return x.yytext="<>","SIGN";case 37:return x.yytext="<>","SIGN";case 38:return x.yytext="<>","SIGN";case 39:return x.yytext="<>","SIGN";case 40:return x.yytext="<=","SIGN";case 41:return x.yytext=">=","SIGN";case 42:return"FRAC";case 43:return"FRAC";case 44:return"sqrt";case 45:return"abs";case 46:return"ln";case 47:return"log";case 48:return"TRIG";case 49:return"TRIG";case 50:return"TRIG";case 51:return"TRIG";case 52:return x.yytext="sin","TRIG";case 53:return x.yytext="cos","TRIG";case 54:return x.yytext="tan","TRIG";case 55:return x.yytext="csc","TRIG";case 56:return x.yytext="sec","TRIG";case 57:return x.yytext="cot","TRIG";case 58:return x.yytext="arcsin","TRIG";case 59:return x.yytext="arccos","TRIG";case 60:return x.yytext="arctan","TRIG";case 61:return x.yytext="arccsc","TRIG";case 62:return x.yytext="arcsec","TRIG";case 63:return x.yytext="arccot","TRIG";case 64:return"TRIGINV";case 65:return"TRIGINV";case 66:return x.yytext="sinh","TRIG";case 67:return x.yytext="cosh","TRIG";case 68:return x.yytext="tanh","TRIG";case 69:return x.yytext="csch","TRIG";case 70:return x.yytext="sech","TRIG";case 71:return x.yytext="tanh","TRIG";case 72:return"CONST";case 73:return x.yytext="pi","CONST";case 74:return x.yytext="pi","CONST";case 75:return"VAR";case 76:return x.yytext="theta","VAR";case 77:return x.yytext="theta","VAR";case 78:return"VAR";case 79:return x.yytext="phi","VAR";case 80:return x.yytext="phi","VAR";case 81:return N.symbolLexer(x.yytext);case 82:return"EOF";case 83:return"INVALID";case 84:console.log(x.yytext);break}},rules:[/^(?:\s+)/,/^(?:\\space)/,/^(?:\\ )/,/^(?:[0-9]+\.?)/,/^(?:([0-9]+)?\.[0-9]+)/,/^(?:\*\*)/,/^(?:\*)/,/^(?:\\cdot|·)/,/^(?:\\times|×)/,/^(?:\\ast)/,/^(?:\/)/,/^(?:\\div|÷)/,/^(?:-)/,/^(?:−)/,/^(?:\+)/,/^(?:\^)/,/^(?:\()/,/^(?:\))/,/^(?:\\left\()/,/^(?:\\right\))/,/^(?:\[)/,/^(?:\])/,/^(?:\{)/,/^(?:\})/,/^(?:\\left\{)/,/^(?:\\right\})/,/^(?:_)/,/^(?:\|)/,/^(?:\\left\|)/,/^(?:\\right\|)/,/^(?:\!)/,/^(?:<=|>=|<>|<|>|=)/,/^(?:\\le)/,/^(?:\\ge)/,/^(?:\\leq)/,/^(?:\\geq)/,/^(?:=\/=)/,/^(?:\\ne)/,/^(?:\\neq)/,/^(?:≠)/,/^(?:≤)/,/^(?:≥)/,/^(?:\\frac)/,/^(?:\\dfrac)/,/^(?:sqrt|\\sqrt)/,/^(?:abs|\\abs)/,/^(?:ln|\\ln)/,/^(?:log|\\log)/,/^(?:sin|cos|tan)/,/^(?:csc|sec|cot)/,/^(?:sinh|cosh|tanh)/,/^(?:csch|sech|coth)/,/^(?:\\sin)/,/^(?:\\cos)/,/^(?:\\tan)/,/^(?:\\csc)/,/^(?:\\sec)/,/^(?:\\cot)/,/^(?:\\arcsin)/,/^(?:\\arccos)/,/^(?:\\arctan)/,/^(?:\\arccsc)/,/^(?:\\arcsec)/,/^(?:\\arccot)/,/^(?:arcsin|arccos|arctan)/,/^(?:arccsc|arcsec|arccot)/,/^(?:\\sinh)/,/^(?:\\cosh)/,/^(?:\\tanh)/,/^(?:\\csch)/,/^(?:\\sech)/,/^(?:\\coth)/,/^(?:pi)/,/^(?:π)/,/^(?:\\pi)/,/^(?:theta)/,/^(?:θ)/,/^(?:\\theta)/,/^(?:phi)/,/^(?:φ)/,/^(?:\\phi)/,/^(?:[a-zA-Z])/,/^(?:$)/,/^(?:.)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84],inclusive:!0}}};return Y}();Ce.lexer=He;function W(){this.yy={}}return W.prototype=Ce,Ce.Parser=W,new W}();const gt=function(t){return t!==t},gn=function(t,e){var n=e-t;return Math.random()*n+t};var yt=12,vt=9;function Ne(t,e){const n=[],r=[];return l.forEach(t,(s,i,a)=>{e(s,i,a)?n.push(s):r.push(s)}),[n,r]}function yn(t){return t instanceof ae}const _e=function(t){return t instanceof z};function vn(t){return t instanceof C}function Je(t){return t instanceof y?t.terms:[t]}class ae{constructor(){this.hints={parens:!1}}construct(e){const n=this.func,r=new n(...e);if(typeof r>"u")throw new Error("constructor function returning undefined");return r}recurse(e,...n){var r=this.args().map(function(s){return l.isString(s)||l.isNumber(s)?s:s==null?void 0:s[e].apply(s,n)});return this.construct(r)}eval(e={},n){throw new Error("Abstract method - must override for expr: "+this.print())}codegen(){throw new Error("Abstract method - must override for expr: "+this.print())}compile(){var e=this.codegen();try{return new Function("vars","return "+e+";")}catch{throw new Error("Function did not compile: "+e)}}asTex(e){e=e||{},l.defaults(e,{display:!0,dynamic:!0,times:!1});let n=this.tex();return e.display&&(n="\\displaystyle "+n),e.dynamic&&(n=n.replace(/\(/g,"\\left("),n=n.replace(/\)/g,"\\right)")),e.times&&(n=n.replace(/\\cdot/g,"\\times")),n}name(){return this.func.name}repr(){return this.name()+"("+this.args().map(function(e){return l.isString(e)||l.isNumber(e)?e:e==null?void 0:e.repr()}).join(",")+")"}strip(){return this.recurse("strip")}normalize(){return this.recurse("normalize")}expand(){return this.recurse("expand")}factor(e){return this.recurse("factor",e)}collect(e){return this.recurse("collect",e)}equals(e){return this.normalize().print()===e.normalize().print()}simplify(e){e={once:!1,...e};var n=this.factor(e),r=n.collect(e);n.equals(r)&&(r=this.collect(e));var s=r.expand(),i=s.collect(e);s.equals(i)&&(i=r.collect(e));var a=i;return e.once||this.equals(a)?a:a.simplify(e)}isSimplified(){return this.equals(this.simplify())}exprArgs(){return this.args().filter(yn)}getVars(e){return l.uniq(l.flatten(l.invoke(this.exprArgs(),"getVars",e))).sort()}getConsts(){return l.uniq(l.flatten(l.invoke(this.exprArgs(),"getConsts"))).sort()}getUnits(){return l.flatten(l.invoke(this.exprArgs(),"getUnits"))}is(e){return this instanceof e}has(e){return this instanceof e?!0:l.any(this.exprArgs(),function(n){return n.has(e)})}raiseToThe(e,n){return new P(this,e)}isSubtract(){return!1}isDivide(){return!1}isRoot(){return!1}needsExplicitMul(){return this.exprArgs()[0].needsExplicitMul()}sameVars(e){var n=this.getVars(),r=e.getVars(),s=function(h,u){return!l.difference(h,u).length},i=function(h){return l.uniq(l.invoke(h,"toLowerCase")).sort()},a=s(n,r),o=s(i(n),i(r));return{equal:a,equalIgnoringCase:o}}compare(e){if(e instanceof Oe)return!1;var n=l.union(this.getVars(!0),e.getVars(!0)),r=function(m,d){return Math.abs(m)<1||Math.abs(d)<1?Math.abs(m-d):Math.abs(1-m/d)},s=function(m,d){var v=r(m,d);return m===d||gt(m)&&gt(d)||v<Math.pow(10,-vt)};if(!n.length&&!this.has(J)&&!e.has(J))return s(this.eval(),e.eval());var i=this.collect(),a=e.collect(),o=this.getUnits(),h=e.getUnits();if(!l.isEqual(o,h))return!1;for(var u=0;u<yt;u++){var c={},f=Math.pow(10,1+Math.floor(3*u/yt)),p=u%2===0;l.each(n,function(d){c[d]=p?gn(-f,f):l.random(-f,f)});let m;if(i.has(pe)||a.has(pe)||i.has(J)||a.has(J)){const d=i.partialEval(c),v=a.partialEval(c);m=d.simplify().equals(v.simplify())}else{const d=i.eval(c),v=a.eval(c);m=s(d,v)}if(!m)return!1}return!0}partialEval(e){return this instanceof J?this:this.has(pe)?this instanceof pe?new pe(this.symbol,this.arg.partialEval(e)):this.recurse("partialEval",e):new B(+this.eval(e).toFixed(vt)).collect()}sameForm(e){return this.strip().equals(e.strip())}findGCD(e){return this.equals(e)?e:q}getDenominator(){return q}asMul(){return new y(q,this)}isPositive(){throw new Error("Abstract method - must override for expr: "+this.print())}isNegative(){return!1}asPositiveFactor(){return this.isPositive()?this:q}addHint(e){if(!e)return this;var n=this.construct(this.args());return n.hints=l.clone(this.hints),n.hints[e]=!0,n}completeParse(){return this.recurse("completeParse")}abs(){throw new Error("Abstract method - must override for expr: "+this.print())}negate(){return new y(ue,this)}}class qe extends ae{constructor(...e){super(),e.length===1?this.terms=e[0]:this.terms=e}args(){return this.terms}normalize(){var e=l.sortBy(l.invoke(this.terms,"normalize"),n=>n.print());return new this.func(e)}expand(){return this.recurse("expand").flatten()}partition(){var[e,n]=Ne(this.terms,r=>r instanceof I);return[new this.func(e),new this.func(n)]}flatten(){var e=this,n=l.reject(this.terms,a=>a.equals(e.identity));if(n.length===0)return e.identity;if(n.length===1)return n[0];const[r,s]=Ne(n,a=>a instanceof e.func);var i=s.concat(l.flatten(l.pluck(r,"terms"),!0));return new e.func(i)}isPositive(){var e=l.invoke(this.terms,"collect");return l.all(l.invoke(e,"isPositive"))}replace(e,n){const r=e instanceof ae?l.indexOf(this.terms,e):e;var s=[];Array.isArray(n)?s=n:n&&(s=[n]);var i=this.terms.slice(0,r).concat(s).concat(this.terms.slice(r+1));return new this.func(i)}remove(e){return this.replace(e)}getDenominator(){return new y(l.invoke(this.terms,"getDenominator")).flatten()}}class z extends qe{constructor(){super(...arguments),this.identity=Ae,this.func=z}eval(e={},n){return l.reduce(this.terms,(r,s)=>r+s.eval(e,n),0)}codegen(){return l.map(this.terms,e=>"("+e.codegen()+")").join(" + ")||"0"}print(){return l.invoke(this.terms,"print").join("+")}tex(){let e="";return l.each(this.terms,n=>{!e||n.isSubtract()?e+=n.tex():e+="+"+n.tex()}),e}collect(e){var n=l.invoke(this.terms,"collect",e),r=[];l.each(n,a=>{if(a instanceof y){var o=a.partition();r.push([o[1].flatten(),o[0].reduce(e)])}else a instanceof I?r.push([q,a]):r.push([a,q])});var s=l.groupBy(r,a=>a[0].normalize().print()),i=l.compact(l.map(s,a=>{var o=a[0][0],h=new z(l.zip.apply(l,a)[1]),u=h.reduce(e);return new y(u,o).collect(e)}));return new z(i).flatten()}factor(e={keepNegative:!1}){const n=this.terms.map(o=>o.collect());let r;n[0]instanceof y?r=n[0].terms:r=[n[0]],l.each(l.rest(this.terms),o=>{r=l.map(r,h=>o.findGCD(h))}),!e.keepNegative&&this.isNegative()&&r.push(ue);const s=new y(r).flatten().collect(),i=n.map(o=>y.handleDivide(o,s).simplify()),a=new z(i).flatten();return y.createOrAppend(s,a).flatten()}reduce(e){return l.reduce(this.terms,(n,r)=>n.add(r,e),this.identity)}needsExplicitMul(){return!1}isNegative(){var e=l.invoke(this.terms,"collect");return l.all(l.invoke(e,"isNegative"))}negate(){return new z(l.invoke(this.terms,"negate"))}static createOrAppend(e,n){return e instanceof z?new z(e.terms.concat(n)):new z(e,n)}}class y extends qe{constructor(){super(...arguments),this.identity=q,this.func=y}eval(e={},n){return l.reduce(this.terms,(r,s)=>r*s.eval(e,n),1)}codegen(){return l.map(this.terms,e=>"("+e.codegen()+")").join(" * ")||"0"}print(){return l.map(this.terms,e=>e instanceof z?"("+e.print()+")":e.print()).join("*")}getUnits(){var e=l(this.terms).chain().map(n=>n.getUnits()).flatten().value();return e.sort((n,r)=>n.unit.localeCompare(r.unit)),e}tex(){for(var e=" \\cdot ",n=l.groupBy(this.terms,d=>d.isDivide()?"inverse":d instanceof I?"number":"other"),r=n.inverse||[],s=n.number||[],i=n.other||[],a="",o,h=0;h<s.length;h++){var u=s[h]instanceof C&&!(s[h]instanceof M);if(u&&i.length>0&&r.length>0){var c=s.slice();c.splice(h,1);var f=c.concat(r).concat(i);return s[h].tex()+new y(f).tex()}}if(s=l.compact(l.map(s,d=>{var v=!d.hints.fraction||r.length>0;if(d instanceof C&&!(d instanceof M)&&v){r.push(new P(new M(d.d),ge));var w=new M(d.n);return w.hints=d.hints,l.any(d.hints)?w:null}else return d})),s.length===0&&i.length===1)o=i[0].tex();else{var p="";l.each(s,d=>{d.hints.subtract&&d.hints.entered?(a+="-",p+=(p?e:"")+d.abs().tex()):d instanceof M&&d.n===-1&&(d.hints.negate||d.hints.subtract)?a+="-":p+=(p?e:"")+d.tex()}),l.each(i,d=>{d.needsExplicitMul()?p+=(p?e:"")+d.tex():d instanceof z?p+="("+d.tex()+")":p+=d.tex()}),o=p||"1"}if(r.length){var m=new y(l.invoke(r,"asDivide")).flatten().tex();return a+"\\frac{"+o+"}{"+m+"}"}else return a+o}strip(){var e=l.map(this.terms,n=>n instanceof I?n.abs():n.strip());return new y(e).flatten()}expand(){const e=function(u){return u instanceof P&&u.exp.isNegative()},n=function(u){return e(u)&&_e(u.base)},r=this.recurse("expand").flatten(),s=Je(r),i=l.any(s,_e),a=l.any(s,n);if(!(i||a))return r;let[o,h]=Ne(s,e);if(i){const[u,c]=Ne(h,_e),f=l.reduce(u,function(m,d){return l.reduce(m,function(v,w){return v.concat(l.map(d.terms,R=>w.concat(R)))},[])},[[]]),p=l.map(f,function(m){return new y(c.concat(m)).flatten()});h=[new z(p)]}if(a){const u=new y(l.invoke(o,"getDenominator")).flatten();o=[new P(u.expand(),ge)]}return new y(h.concat(o)).flatten()}factor(e){var n=this.recurse("factor",e).flatten();if(!(n instanceof y))return n;var[r,s]=Ne(n.terms,o=>o instanceof C);const i=l.reduce(r,(o,h)=>({n:o.n*h.n,d:o.d*h.d}),{n:1,d:1}),a=i.d===1?new M(i.n):new C(i.n,i.d);return new y(s.concat(a)).flatten()}collect(e){var n=this.recurse("collect",e).partition(),r=n[0].reduce(e);if(r.eval()===0)return Ae;const s=n[1].flatten();if(!(s instanceof y))return new y(r,s).flatten();const i=s.terms;var a=[];l.each(i,w=>{w instanceof P?a.push([w.base,w.exp]):a.push([w,q])});var o=l.groupBy(a,w=>w[0].normalize().print()),h=l.compact(l.map(o,w=>{var R=w[0][0],D=new z(l.zip.apply(l,w)[1]),_=D.collect(e);return _ instanceof I&&_.eval()===0?null:[R,_]}));const u=l.groupBy(h,w=>w[0]instanceof F&&w[0].isBasic()?"trig":w[0]instanceof X?"log":"expr");let c=u.trig||[],f=u.log||[];const p=u.expr||[];if(c.length>1){var m=l.groupBy(c,w=>w[0].arg.normalize().print());c=[],l.each(m,w=>{const R=w[0][0].arg;let D={sin:Ae,cos:Ae};l.each(w,_=>{D[_[0].type]=_[1]}),y.handleNegative(D.sin).collect(e).equals(D.cos)&&(D.cos.isNegative()?D={tan:D.sin}:D={cot:D.cos}),l.each(D,(_,he)=>{c.push([new F(he,R),_])})})}if(f.length>1){var d=l.groupBy(f,w=>w[0].base.normalize().print());f=[],l.each(d,w=>{w.length===2&&y.handleNegative(w[0][1]).collect(e).equals(w[1][1])?w[0][1].isNegative()?f.push([new X(w[0][0].power,w[1][0].power),w[1][1]]):f.push([new X(w[1][0].power,w[0][0].power),w[0][1]]):f=f.concat(w)})}var v=l.map([...c,...f,...p],w=>new P(w[0],w[1]).collect(e));return new y([r].concat(v)).flatten()}isSubtract(){return l.any(this.terms,e=>e instanceof I&&!!e.hints.subtract)}factorIn(e){var n=this.partition(),r=n[0].terms,s=r.length&&l.all(r,a=>a.n>0);if(s){var i=r[0].negate();return i.hints=r[0].hints,this.replace(r[0],i.addHint(e))}else return new y([I.negativeOne(e)].concat(this.terms))}factorOut(){var e=!1,n=l.compact(l.map(this.terms,r=>!e&&r instanceof I&&r.hints.divide?(e=!0,r.n!==-1?r.negate():null):r));return n.length===1?n[0]:new y(n)}reduce(e){return l.reduce(this.terms,(n,r)=>n.mul(r,e),this.identity)}findGCD(e){return new y(l.invoke(this.terms,"findGCD",e)).flatten()}asMul(){return this}asPositiveFactor(){if(this.isPositive())return this;{const e=Je(this.collect()).map(n=>n.asPositiveFactor());return new y(e).flatten()}}isNegative(){const e=Je(this.collect()).map(n=>n.isNegative());return l.any(e)}fold(){return y.fold(this)}negate(){var e=r=>r instanceof I;const n=l.find(this.terms,e);return n?this.replace(n,n.negate()):new y([ue].concat(this.terms))}static handleNegative(e,n){if(e instanceof I&&e.n>0){var r=e.negate();return r.hints=e.hints,r.addHint(n)}else return e instanceof y?e.factorIn(n):new y(I.negativeOne(n),e)}static handleDivide(e,n){if(n instanceof y){var r=y.handleDivide(e,n.terms[0]),s=new y(l.rest(n.terms)).flatten();return y.handleDivide(r,s)}var i=p=>p instanceof M,a=p=>p instanceof C;if(i(n)&&e instanceof y&&l.any(e.terms,i)){var o=e.terms.slice().reverse(),h=o.find(a);if(!i(h))return new y(e.terms.concat([new C(1,n.n).addHint("fraction")]));var u=new C(h.n,n.n);return u.hints=h.hints,h===o[0]&&(u=u.addHint("fraction")),h.n<0&&n.n<0?(u.d=-u.d,e.replace(h,[ue,u])):e.replace(h,u)}var c=(p,m)=>{if(m instanceof M){if(p instanceof M)return p.n<0&&m.n<0?[ue,new C(p.n,-m.n).addHint("fraction")]:[new C(p.n,m.n).addHint("fraction")];var d=new C(1,m.eval());return m.eval()<0?[p,d.addHint("negate")]:[p,d]}else{var v;if(m instanceof F&&m.exp){var w=m.exp;m.exp=void 0,m=new P(m,w)}return m instanceof P?v=new P(m.base,y.handleNegative(m.exp,"divide")):v=new P(m,ge),p instanceof M&&p.n===1?[v]:[p,v]}};if(e instanceof y){var f=c(l.last(e.terms),n);return new y(l.initial(e.terms).concat(f))}else{var f=c(e,n);return new y(f).flatten()}}static fold(e){if(e instanceof y){var n=l.find(l.initial(e.terms),p=>(p instanceof F||p instanceof X)&&!!p.hints.open);if(n){const p=l.last(e.terms);if(n.hints.parens||p.hints.parens||p.has(F)||p.has(X))n.hints.open=!1;else{const m=n instanceof F?F.create([n.type,n.exp],y.createOrAppend(n.arg,p).fold()):X.create(n.base,y.createOrAppend(n.power,p).fold()),d=l.indexOf(e.terms,n);return d===0?m:new y(e.terms.slice(0,d).concat(m)).fold()}}var r=e.partition(),s=r[0].terms,i=p=>p.n>0,a=p=>p.n===-1&&!!p.hints.negate,o=function(p){return i(p)||a(p)};const c=s.find(i),f=s.find(a);if(s.length>1&&f&&c&&l.every(s,o)){var h=l.indexOf(e.terms,f),u=l.indexOf(e.terms,c);if(h<u)return e.replace(u,e.terms[u].negate()).remove(h)}}return e}static createOrAppend(e,n){return e instanceof y?new y(e.terms.concat(n)):new y(e,n)}}const V=class V extends ae{constructor(e,n){super(),this.func=V,this.base=e,this.exp=n}args(){return[this.base,this.exp]}eval(e={},n){var r=this.base.eval(e,n),s=this.exp.eval(e,n);if(r<0){var i=this.exp.simplify();if(i instanceof B){var a=i.n,o=(a-+a.toFixed()).toString().length-2,h=Math.pow(10,o),u=new C(a*h,h);i=u.simplify()}if(i instanceof C){var c=Math.abs(i.d)%2===1;if(c){var f=Math.abs(i.n)%2===1,p=f?-1:1;return p*Math.pow(-1*r,s)}}}return Math.pow(r,s)}getUnits(){return this.base.getUnits().map(e=>({unit:e.unit,pow:e.pow*this.exp.n}))}codegen(){return"Math.pow("+this.base.codegen()+", "+this.exp.codegen()+")"}print(){var e=this.base.print();return(this.base instanceof qe||this.base instanceof V)&&(e="("+e+")"),e+"^("+this.exp.print()+")"}tex(){if(this.isDivide())return"\\frac{1}{"+this.asDivide().tex()+"}";if(this.isRoot()&&vn(this.exp)){if(this.exp.n!==1)throw new Error("Node marked with hint 'root' does not have exponent of form 1/x.");return this.exp.d===2?"\\sqrt{"+this.base.tex()+"}":"\\sqrt["+this.exp.d+"]{"+this.base.tex()+"}"}else if(this.base instanceof F&&!this.base.isInverse()&&this.exp instanceof I&&this.exp.isSimple()&&this.exp.eval()>=0){var e=this.base.texSplit();return e[0]+"^{"+this.exp.tex()+"}"+e[1]}else{var n=this.base.tex();return this.base instanceof qe||this.base instanceof V||this.base instanceof I&&!this.base.isSimple()?n="("+n+")":(this.base instanceof F||this.base instanceof X)&&(n="["+n+"]"),n+"^{"+this.exp.tex()+"}"}}needsExplicitMul(){return this.isRoot()?!1:this.base.needsExplicitMul()}expand(){var e=this.recurse("expand");if(e.base instanceof y){var n=l.map(e.base.terms,o=>new V(o,e.exp));return new y(n).expand()}else if(e.base instanceof z&&e.exp instanceof M&&e.exp.abs().eval()>1){var r=e.exp.eval()>0,s=e.exp.abs().eval(),i=function(f){return r?f:new V(f,ge)};const o={1:e.base};for(var a=2;a<=s;a*=2){const f=new y(o[a/2],o[a/2]);o[a]=f.expand().collect()}if(s in o)return i(o[s]);let h=l.map(s.toString(2).split(""),function(f,p,m){return Number(f)*Math.pow(2,m.length-p-1)});h=l.without(h,0);const u=[];for(const f of h)f in o&&u.push(o[f]);const c=new y(u).expand().collect();return i(c)}else if(e.exp instanceof z){const o=l.map(e.exp.terms,h=>new V(e.base,h).expand());return new y(o).expand()}else return e}factor(){var e=this.recurse("factor");if(e.base instanceof y){var n=l.map(e.base.terms,r=>r instanceof M&&e.exp.equals(ge)?new C(1,r.n):new V(r,e.exp));return new y(n)}else return e}collect(e){if(this.base instanceof V){const s=this.base.base,i=y.createOrAppend(this.base.exp,this.exp);return new V(s,i).collect(e)}const n=this.recurse("collect",e),r=function(s){return s instanceof X&&s.base.equals(n.base)};if(n.exp instanceof I&&n.exp.eval()===0)return q;if(n.exp instanceof I&&n.exp.eval()===1)return n.base;if(r(n.exp))return n.exp.power;if(n.exp instanceof y&&l.any(n.exp.terms,r)){const s=n.exp.terms.find(r),i=s.power,a=n.exp.remove(s).flatten();return new V(i,a).collect(e)}else if(n.base instanceof I&&n.exp instanceof I){if(e&&e.preciseFloats){const s=n.exp.asRational(),i=n.base.getDecimalPlaces();if(new V(n.base,new C(1,s.d)).collect().getDecimalPlaces()>i){const h=new V(n.base,new M(s.n)).collect();return new V(h,new C(1,s.d))}}return n.base.raiseToThe(n.exp,e)}else return n}isDivide(){var e=function(n){return n instanceof I&&!!n.hints.divide};return e(this.exp)||this.exp instanceof y&&l.any(this.exp.terms,e)}asDivide(){if(this.exp instanceof I){if(this.exp.eval()===-1)return this.base;var e=this.exp.negate();return e.hints=l.clone(this.exp.hints),e.hints.divide=!1,new V(this.base,e)}else{if(this.exp instanceof y)return new V(this.base,this.exp.factorOut());throw new Error("called asDivide() on an Expr that wasn't a Num or Mul")}}isRoot(){return this.exp instanceof C&&!!this.exp.hints.root}isSquaredTrig(){return this.base instanceof F&&!this.base.isInverse()&&this.exp instanceof I&&this.exp.eval()===2}getDenominator(){if(this.exp instanceof I&&this.exp.eval()===-1)return y.createOrAppend(this.base,this.base.getDenominator()).flatten();if(this.exp.isNegative()){var e=new V(this.base,y.handleNegative(this.exp).collect());return y.createOrAppend(e,e.collect().getDenominator()).flatten()}else return this.base instanceof I?new V(this.base.getDenominator(),this.exp).collect():q}findGCD(e){const[n,r]=e instanceof V?[e.base,e.exp]:[e,q];if(this.base.equals(n)){if(this.exp.equals(r))return this;if(this.exp instanceof I&&r instanceof I)return new V(this.base,I.min(this.exp,r)).collect();if(this.exp instanceof I||r instanceof I)return q;var s=this.exp.asMul().partition(),i=r.asMul().partition();if(s[1].equals(i[1])){var a=I.min(s[0].reduce(),i[0].reduce()),o=new y(a,s[1].flatten()).flatten();return new V(n,o).collect()}}return q}isPositive(){if(this.base.isPositive())return!0;var e=this.exp.simplify();return e instanceof M&&e.eval()%2===0}asPositiveFactor(){if(this.isPositive())return this;var e=this.exp.simplify();if(e instanceof M){var n=e.eval();if(n>2)return new V(this.base,new M(n-1));if(n<-2)return new V(this.base,new M(n+1))}return q}static sqrt(e){return new V(e,wn)}};V.nthroot=function(e,n){var r=y.fold(y.handleDivide(new M(1),n));return new V(e,r.addHint("root"))};let P=V;class X extends ae{constructor(e,n){super(),this.func=X,this.base=e,this.power=n,this.hints={...this.hints,open:!1}}args(){return[this.base,this.power]}eval(e={},n){return Math.log(this.power.eval(e,n))/Math.log(this.base.eval(e,n))}codegen(){return"(Math.log("+this.power.codegen()+") / Math.log("+this.base.codegen()+"))"}print(){var e="("+this.power.print()+")";return this.isNatural()?"ln"+e:"log_("+this.base.print()+") "+e}tex(){var e="("+this.power.tex()+")";return this.isNatural()?"\\ln"+e:"\\log_{"+this.base.tex()+"}"+e}collect(e){var n=this.recurse("collect",e);return n.power instanceof I&&n.power.eval()===1?Ae:n.base.equals(n.power)?q:n.power instanceof P&&n.power.base.equals(n.base)?n.power.exp:n}expand(){var e=this.recurse("expand");if(e.power instanceof y){var n=l.map(e.power.terms,r=>new X(e.base,r).expand());return new z(n)}else return e.power instanceof P?new y(e.power.exp,new X(e.base,e.power.base).expand()).flatten():e.isNatural()?e:y.handleDivide(new X(be.e,e.power),new X(be.e,e.base))}isPositive(){var e=this.collect();return e instanceof X&&e.base instanceof I&&e.power instanceof I?this.eval()>0:!1}needsExplicitMul(){return!1}isNatural(){return this.base.equals(be.e)}static natural(){return be.e}static common(){return bn}static create(e,n){var r=new X(e,n);return n.hints.parens||(r=r.addHint("open")),r}}class F extends ae{constructor(e,n){super(),this.func=F,this.functions={sin:{eval:Math.sin,codegen:"Math.sin((",tex:"\\sin",expand:()=>this},cos:{eval:Math.cos,codegen:"Math.cos((",tex:"\\cos",expand:()=>this},tan:{eval:Math.tan,codegen:"Math.tan((",tex:"\\tan",expand:()=>y.handleDivide(F.sin(this.arg),F.cos(this.arg))},csc:{eval:r=>1/Math.sin(r),codegen:"(1/Math.sin(",tex:"\\csc",expand:()=>y.handleDivide(q,F.sin(this.arg))},sec:{eval:r=>1/Math.cos(r),codegen:"(1/Math.cos(",tex:"\\sec",expand:()=>y.handleDivide(q,F.cos(this.arg))},cot:{eval:r=>1/Math.tan(r),codegen:"(1/Math.tan(",tex:"\\cot",expand:()=>y.handleDivide(F.cos(this.arg),F.sin(this.arg))},arcsin:{eval:Math.asin,codegen:"Math.asin((",tex:"\\arcsin"},arccos:{eval:Math.acos,codegen:"Math.acos((",tex:"\\arccos"},arctan:{eval:Math.atan,codegen:"Math.atan((",tex:"\\arctan"},arccsc:{eval:r=>Math.asin(1/r),codegen:"Math.asin(1/(",tex:"\\operatorname{arccsc}"},arcsec:{eval:r=>Math.acos(1/r),codegen:"Math.acos(1/(",tex:"\\operatorname{arcsec}"},arccot:{eval:r=>Math.atan(1/r),codegen:"Math.atan(1/(",tex:"\\operatorname{arccot}"},sinh:{eval:r=>(Math.exp(r)-Math.exp(-r))/2,codegen:r=>"((Math.exp("+r+") - Math.exp(-("+r+"))) / 2)",tex:"\\sinh",expand:()=>this},cosh:{eval:r=>(Math.exp(r)+Math.exp(-r))/2,codegen:r=>"((Math.exp("+r+") + Math.exp(-("+r+"))) / 2)",tex:"\\cosh",expand:()=>this},tanh:{eval:r=>(Math.exp(r)-Math.exp(-r))/(Math.exp(r)+Math.exp(-r)),codegen:r=>"((Math.exp("+r+") - Math.exp(-("+r+"))) / (Math.exp("+r+") + Math.exp(-("+r+"))))",tex:"\\tanh",expand:()=>y.handleDivide(F.sinh(this.arg),F.cosh(this.arg))},csch:{eval:r=>2/(Math.exp(r)-Math.exp(-r)),codegen:r=>"(2 / (Math.exp("+r+") - Math.exp(-("+r+"))))",tex:"\\csch",expand:()=>y.handleDivide(q,F.sinh(this.arg))},sech:{eval:r=>2/(Math.exp(r)+Math.exp(-r)),codegen:r=>"(2 / (Math.exp("+r+") + Math.exp(-("+r+"))))",tex:"\\sech",expand:()=>y.handleDivide(q,F.cosh(this.arg))},coth:{eval:r=>(Math.exp(r)+Math.exp(-r))/(Math.exp(r)-Math.exp(-r)),codegen:r=>"((Math.exp("+r+") + Math.exp(-("+r+"))) / (Math.exp("+r+") - Math.exp(-("+r+"))))",tex:"\\coth",expand:()=>y.handleDivide(F.cosh(this.arg),F.sinh(this.arg))}},this.type=e,this.arg=n,this.hints={...this.hints,open:!1}}args(){return[this.type,this.arg]}isEven(){return l.contains(["cos","sec"],this.type)}isInverse(){return this.type.indexOf("arc")===0}isBasic(){return l.contains(["sin","cos"],this.type)}eval(e={},n){var r=this.functions[this.type].eval,s=this.arg.eval(e,n);return r(s)}codegen(){var e=this.functions[this.type].codegen;if(typeof e=="function")return e(this.arg.codegen());if(typeof e=="string")return e+this.arg.codegen()+"))";throw new Error("codegen not implemented for "+this.type)}print(){return this.type+"("+this.arg.print()+")"}tex(){var e=this.functions[this.type].tex,n="("+this.arg.tex()+")";return e+n}texSplit(){var e=this.functions[this.type].tex,n="("+this.arg.tex()+")";return[e,n]}isPositive(){var e=this.collect();return e instanceof F&&e.arg instanceof I?this.eval()>0:!1}completeParse(){if(this.exp){var e=new P(this,this.exp);return this.exp=void 0,e}else return this}needsExplicitMul(){return!1}expand(){var e=this.recurse("expand");if(e.isInverse())return e;var n=e.functions[e.type].expand;return l.bind(n,e)()}collect(e){var n=this.recurse("collect",e);if(!n.isInverse()&&n.arg.isNegative()){const r=n.arg instanceof I?n.arg.abs():y.handleDivide(n.arg,ue).collect(e);return n.isEven()?new F(n.type,r):new y(ue,new F(n.type,r))}else return n}static create(e,n){var r=e[0],s=e[1];s&&s.equals(ue)&&(r="arc"+r,s=void 0);var i=new F(r,n);return n.hints.parens||(i=i.addHint("open")),s&&(i.exp=s),i}static sin(e){return new F("sin",e)}static cos(e){return new F("cos",e)}static sinh(e){return new F("sinh",e)}static cosh(e){return new F("cosh",e)}}class Fe extends ae{constructor(e){super(),this.func=Fe,this.arg=e}args(){return[this.arg]}eval(e={},n){return Math.abs(this.arg.eval(e,n))}codegen(){return"Math.abs("+this.arg.codegen()+")"}print(){return"abs("+this.arg.print()+")"}tex(){return"\\left|"+this.arg.tex()+"\\right|"}collect(e){var n=this.recurse("collect",e);if(n.arg.isPositive())return n.arg;if(n.arg instanceof I)return n.arg.abs();if(n.arg instanceof y){var r=l.groupBy(n.arg.terms,i=>i.isPositive()?"positive":i instanceof I?"number":"other"),s=r.positive.concat(l.invoke(r.number,"abs"));return r.other.length&&s.push(new Fe(new y(r.other).flatten())),new y(s).flatten()}else return n}expand(){var e=this.recurse("expand");if(e.arg instanceof y){var n=l.map(e.arg.terms,r=>new Fe(r));return new y(n)}else return e}isPositive(){return!0}}class Oe extends ae{constructor(e,n,r){super(),this.func=Oe,this.signs={"=":" = ","<":" < ",">":" > ","<>":" \\ne ","<=":" \\le ",">=":" \\ge "},this.left=e,this.type=n,this.right=r}args(){return[this.left,this.type,this.right]}needsExplicitMul(){return!1}print(){return this.left.print()+this.type+this.right.print()}tex(){return this.left.tex()+this.signs[this.type]+this.right.tex()}normalize(){var e=this.recurse("normalize");return l.contains([">",">="],e.type)?new Oe(e.right,e.type.replace(">","<"),e.left):e}asExpr(e=!1){var n=h=>h instanceof I&&h.isSimple()&&h.eval()===0;let r=[];this.left instanceof z?r=l.clone(this.left.terms):n(this.left)||(r=[this.left]),this.right instanceof z?r=r.concat(this.right.negate().terms):n(this.right)||r.push(this.right.negate());var s=!this.isEquality();r=l.invoke(r,"collect",{preciseFloats:!0});for(var i=0;i<r.length;i++){var a=r[i].getDenominator();s&&!a.isPositive()&&(a=a.asPositiveFactor()),a.equals(q)||(r=l.map(r,h=>y.createOrAppend(h,a).simplify({once:!0,preciseFloats:!0})))}var o=new z(r).flatten();return e?o:this.divideThrough(o)}divideThrough(e){const n=!this.isEquality(),r=e.simplify({once:!0}),s=r.factor({keepNegative:n});if(!(s instanceof y))return e;const i=s.terms,a=p=>!!p.getVars().length,o=p=>p.equals(q),[h,u]=Ne(i,_e);if(h.length&&this.isEquality())return new y(h).flatten();let c=u;h.length||(c=l.reject(c,a)),n&&(c=l.invoke(c,"asPositiveFactor")),c=l.reject(c,o),c=l.map(c,p=>new P(p,ge));const f=new y(i.concat(c)).collect();return f.equals(s)?r:f}isEquality(){return l.contains(["=","<>"],this.type)}compare(e){if(!(e instanceof Oe))return!1;var n=this.normalize(),r=e.normalize();if(n.type!==r.type)return!1;var s=n.divideThrough(n.asExpr(!0).collect()),i=r.divideThrough(r.asExpr(!0).collect());return n.isEquality()?s.compare(i)||s.compare(y.handleNegative(i)):s.compare(i)}sameForm(e){var n=this.normalize(),r=e.normalize(),s=n.left.sameForm(r.left)&&n.right.sameForm(r.right);return n.isEquality()?s||n.left.sameForm(r.right)&&n.right.sameForm(r.left):s}isSimplified(){var e=this.asExpr(!0),n=this.divideThrough(e).simplify();return e.equals(n)&&this.left.isSimplified()&&this.right.isSimplified()}solveLinearEquationForVariable(e){var n=this.asExpr();if(!(n instanceof z)||n.terms.length!==2)throw new Error("Can only handle linear equations of the form a + bx (= 0)");var r=o=>o.has(je)&&l.contains(o.getVars(),e.symbol);const s=r(n.terms[0]),i=s?y.handleNegative(n.terms[1]):y.handleNegative(n.terms[0]),a=s?y.handleDivide(n.terms[0],e):y.handleDivide(n.terms[1],e);return y.handleDivide(i,a).simplify()}}class Me extends ae{needsExplicitMul(){return!1}findGCD(e){return e instanceof Me||e instanceof I?this.equals(e)?this:q:e.findGCD(this)}}class pe extends Me{constructor(e,n){super(),this.func=pe,this.symbol=e,this.arg=n}args(){return[this.symbol,this.arg]}print(){return this.symbol+"("+this.arg.print()+")"}tex(){return this.symbol+"("+this.arg.tex()+")"}eval(e={},n){var r=this.arg,s=e[this.symbol],i=l.extend(l.clone(e),{x:r.eval(e,n)}),a=Ie(s,n);return a.parsed?a.expr.eval(i,n):a}codegen(){return'vars["'+this.symbol+'"]('+this.arg.codegen()+")"}getUnits(){return this.arg.getUnits()}getVars(e){return e?this.arg.getVars():l.union(this.arg.getVars(),[this.symbol]).sort()}getConsts(){return this.arg.getConsts()}}class je extends Me{constructor(e,n){super(),this.func=je,this.symbol=e,this.subscript=n}args(){return[this.symbol,this.subscript]}exprArgs(){return[]}recurse(){return this}print(){var e="";return this.subscript&&(e="_("+this.subscript.print()+")"),this.symbol+e}prettyPrint(){var e=this.subscript;return e&&(e instanceof I||e instanceof Me)?this.symbol+"_"+e.print():this.print()}tex(){var e="";this.subscript&&(e="_{"+this.subscript.tex()+"}");var n=this.symbol.length>1?"\\":"";return n+this.symbol+e}repr(){return"Var("+this.print()+")"}eval(e={},n){return e[this.prettyPrint()]}codegen(){return'vars["'+this.prettyPrint()+'"]'}getVars(){return[this.prettyPrint()]}isPositive(){return!1}}const we=class we extends Me{constructor(e){super(),this.func=we,this.symbol=e}args(){return[this.symbol]}recurse(){return this}eval(e={},n){return this.symbol==="pi"?Math.PI:this.symbol==="e"?Math.E:void 0}codegen(){return this.symbol==="pi"?"Math.PI":this.symbol==="e"?"Math.E":void 0}print(){return this.symbol}tex(){return this.symbol==="pi"?"\\pi ":this.symbol==="e"?"e":void 0}isPositive(){return this.eval()>0}abs(){return this.eval()>0?this:y.handleNegative(this)}getConsts(){return[this.print()]}};we.e=new we("e"),we.pi=new we("pi");let be=we;class I extends ae{constructor(){super(),this.n=0,this.hints={...this.hints,negate:!1,subtract:!1,divide:!1,root:!1,fraction:!1,entered:!1}}repr(){return this.print()}strip(){return this.abs()}recurse(){return this}codegen(){return this.print()}isSubtract(){return!!this.hints.subtract}needsExplicitMul(){return!0}isPositive(){return this.eval()>0}isNegative(){return this.eval()<0}asPositiveFactor(){return this.isPositive()?this:this.abs()}getDecimalPlaces(){var e=(""+this.n).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return e?Math.max(0,(e[1]?e[1].length:0)-(e[2]?+e[2]:0)):0}static negativeOne(e){return e==="subtract"?xn:e==="divide"?ge:ue}static findGCD(e,n){var r;if(e=Math.abs(e),n=Math.abs(n),e!==Math.floor(e)||n!==Math.floor(n))return 1;for(;n;)r=e%n,e=n,n=r;return e}static min(...e){return l.min(e,n=>n.eval())}static max(...e){return l.max(e,n=>n.eval())}}class C extends I{constructor(e,n){super(),this.func=C;var r=e,s=n;s<0&&(r=-r,s=-s),this.n=r,this.d=s}args(){return[this.n,this.d]}eval(){return this.n/this.d}print(){return this.n.toString()+"/"+this.d.toString()}tex(){var e="\\frac{"+Math.abs(this.n).toString()+"}{"+this.d.toString()+"}";return this.n<0?"-"+e:e}add(e,n){return e instanceof C?new C(this.n*e.d+this.d*e.n,this.d*e.d).collect():e.add(this,n)}mul(e,n){return e instanceof C?new C(this.n*e.n,this.d*e.d).collect():e.mul(this,n)}collect(){var e=I.findGCD(this.n,this.d),n=this.n/e,r=this.d/e;return r===1?new M(n):new C(n,r)}negate(){return new C(-this.n,this.d)}abs(){return new C(Math.abs(this.n),this.d)}findGCD(e){if(e instanceof C){var n=I.findGCD(this.n*e.d,e.n*this.d),r=this.d*e.d;return new C(n,r).collect()}else return e instanceof M?new C(I.findGCD(this.n,e.n),this.d):e.findGCD(this)}raiseToThe(e){if(e instanceof M){var n=e.eval()>0,r=e.abs().eval(),s=Math.pow(this.n,r),i=Math.pow(this.d,r);return n?new C(s,i).collect():new C(i,s).collect()}else return new B(this.eval()).raiseToThe(e)}getDenominator(){return new M(this.d)}isSimple(){return!1}asRational(){return this}}class M extends C{constructor(e){super(e,1),this.func=M}args(){return[this.n]}print(){return this.n.toString()}tex(){return this.n.toString()}negate(){return new M(-this.n)}abs(){return new M(Math.abs(this.n))}isSimple(){return!0}findGCD(e){return e instanceof M?new M(I.findGCD(this.n,e.n)):e.findGCD(this)}static create(e){return new M(e).addHint("entered")}}class B extends I{constructor(e){super(),this.func=B,this.n=e}args(){return[this.n]}eval(){return this.n}print(){return this.n.toString()}tex(){return this.n.toString()}add(e,n){return n&&n.preciseFloats?B.toDecimalPlaces(this.n+e.eval(),Math.max(this.getDecimalPlaces(),e.getDecimalPlaces())):new B(this.n+e.eval()).collect()}mul(e,n){return n&&n.preciseFloats?B.toDecimalPlaces(this.n*e.eval(),this.getDecimalPlaces()+e.getDecimalPlaces()):new B(this.n*e.eval()).collect()}collect(e){return this}negate(){return new B(-this.n)}abs(){return new B(Math.abs(this.n))}findGCD(e){return e instanceof I?new B(I.findGCD(this.eval(),e.eval())).collect():e.findGCD(this)}raiseToThe(e,n){return n&&n.preciseFloats&&e instanceof M&&e.n>1?B.toDecimalPlaces(new P(this,e).eval(),this.getDecimalPlaces()*e.n):new B(new P(this,e).eval()).collect()}asRational(){var e=this.n.toString().split(".");if(e.length===1)return new C(this.n,1);var n=Number(e.join("")),r=Math.pow(10,e[1].length);return new C(n,r).collect()}getDenominator(){return this.asRational().getDenominator()}isSimple(){return!0}static create(e){return new B(e).addHint("entered")}static toDecimalPlaces(e,n){return new B(+e.toFixed(Math.min(n,20))).collect()}}const ue=new M(-1).addHint("negate"),xn=new M(-1).addHint("subtract"),ge=new M(-1).addHint("divide"),wn=new C(1,2).addHint("root"),Ae=new M(0),q=new M(1),bn=new M(10);var En=function(t,e){throw new Error(e.loc.first_column)};Se.yy={Add:z,Mul:y,Pow:P,Log:X,Trig:F,Eq:Oe,Abs:Fe,Func:pe,Const:be,Var:je,Int:M,Float:B,parseError:En,constants:["e"],symbolLexer:function(t){return l.contains(Se.yy.constants,t)?"CONST":l.contains(Se.yy.functions,t)?"FUNC":"VAR"}};const Ie=function(t,e){try{e&&e.functions?Se.yy.functions=l.without(e.functions,"i"):Se.yy.functions=[],e&&e.decimal_separator&&(t=t.split(e.decimal_separator).join("."));var n=Se.parse(t).completeParse();return{parsed:!0,expr:n}}catch(r){return{parsed:!1,error:r.message}}};class J extends Me{constructor(e){super(),this.func=J,this.symbol=e}args(){return[this.symbol]}recurse(){return this}eval(e={},n){return 1}getUnits(){return[{unit:this.symbol,pow:1}]}codegen(){return"1"}print(){return this.symbol}tex(){return this.symbol}collect(e){if(l(Mn).has(this.symbol))return this;if(l(xt).has(this.symbol))return xt[this.symbol].conversion;throw new Error("could not understand unit: "+this.symbol)}}var Mn={m:new J("m"),g:new J("g"),s:new J("s"),A:new J("A"),K:new J("K"),mol:new J("mol"),cd:new J("cd")};new P(new M(10),new M(-18)),new P(new M(10),new M(-15)),new P(new M(10),new M(-12)),new P(new M(10),new M(-9)),new P(new M(10),new M(-6)),new P(new M(10),new M(-3)),new P(new M(10),new M(-2)),new P(new M(10),new M(-1)),new M(10),new P(new M(10),new M(2)),new P(new M(10),new M(3)),new P(new M(10),new M(6)),new P(new M(10),new M(9)),new P(new M(10),new M(12)),new P(new M(10),new M(15)),new P(new M(10),new M(18)),new P(new M(10),new M(27));const L="hasPrefixes",E="hasntPrefixes",g=function(t,e){var n=t.split("|"),r=n[0].trim(),s=n[1].trim(),i=q;r!==""&&(i=Ie(r).expr);var a=s.split("/"),o=[i];return a[0]&&a[0].split(" ").filter(h=>h!=="").forEach(h=>o.push(new J(h))),a[1]&&a[1].split(" ").filter(h=>h!=="").forEach(h=>o.push(new P(new J(h),ge))),{conversion:new y(o),prefixes:e}};var xt={Da:g("1.6605388628 x 10^-24 | g",L),u:g("| Da",E),meter:g("| m",E),meters:g("| m",E),in:g("254 / 10000 | m",E),ft:g("3048  / 10000 | m",E),yd:g("9144  / 10000 | m",E),mi:g("1609344 / 1000 | m",E),ly:g("9.4607 x 10^15 | m",E),nmi:g("1852 | m",E),Å:g("10^-10 | m",E),pc:g("3.0857 x 10^16 | m",E),min:g("60 | s",E),hr:g("3600 | s",E),sec:g("| s",E),day:g("86400 | s",E),wk:g("604800 | s",E),fortnight:g("14 | day",E),shake:g("10^-8 | s",E),olympiad:g("126200000 | s",E),"°C":g("1 | K",E),"°F":g("5/9 | K",E),"°R":g("5/9 | K",E),e:g("1.6021765314 x 10^-19 | C",E),c:g("299792458 | m / s",E),kn:g("514/1000 | m / s",E),kt:g("| kn",E),knot:g("| kn",E),J:g("| N m",L),BTU:g("1060 | J",E),cal:g("4184 / 1000 | J",L),eV:g("1.602176514 x 10^-19 | J",L),erg:g("10^−7 | J",L),W:g("| J / s",L),"H-e":g("80 | W",E),N:g("1000 | g m / s s",L),lb:g("4448221615 / 1000000000 | N",E),dyn:g("10^-5 | N",E),Pa:g("1 | N / m m m",L),bar:g("10^5 | Pa",L),"㏔":g("1/1000 | bar",E),"㍴":g("| bar",E),atm:g("101325 | Pa",E),Torr:g("1/760 | atm",E),mmHg:g("| Torr",E),ha:g("10^4 | m m",E),b:g("10^−28 | m m",L),barn:g("| b",L),acre:g("4046.87 | m m",E),skilodge:g("10^-31 | m m",E),outhouse:g("10^-34 | m m",E),shed:g("10^-52 | m m",E),L:g("1/1000 | m m m",L),gal:g("3785/1000 | L",L),cup:g("1/16 | gal",E),qt:g("1/4 | gal",E),quart:g("| qt",E),p:g("1/8 | gal",E),pt:g("| p",E),pint:g("| p",E),"fl oz":g("1/8 | cup",E),"fl. oz.":g("1/8 | cup",E),tbsp:g("1/16 | cup",E),tsp:g("1/3 | tbsp",E),rev:g("2 pi | rad",E),deg:g("180 pi | rad",E),"°":g("| deg",E),arcminute:g("1/60 | deg",E),arcsec:g("1/3600 | deg",E),Hu:g("1000 | dB",L),dozen:g("12 |",E),mol:g("6.0221412927 x 10^23 |",L),"%":g("1/100 |",E),percent:g("| %",E),ppm:g("1/1000000 |",E),V:g("1000 | g m m / s s C",L),C:g("| A s",L),ampere:g("| A",E),Ω:g("| V / A",L),ohm:g("| Ω",E),F:g("| C / V",L),H:g("| ohm s",L),T:g("1000 | g / C s",L),Wb:g("1000 | g m m / C s",L),lm:g("pi x 10^4 | cd / m m",E),lx:g("| lm / m m",E),nit:g("| cd / m m",E),sb:g("10^4 | cd / m m",E),stilb:g("1 | sb",E),apostilb:g("1 / pi x 10^(-4) | sb",E),blondel:g("| apostilb",E),asb:g("| apostilb",E),la:g("| lm",E),Lb:g("| lm",E),sk:g("10^-7 | lm",E),skot:g("| sk",E),bril:g("10^-11 | lm",E),Hz:g("| / s",L)};const wt=function(t,e,n={}){const s={...{form:!1,simplify:!1},...n},i=t.sameVars(e);if(!i.equal){let a;return i.equalIgnoringCase?a="Check your variables; one or more are using the wrong case (upper or lower).":a="Check your variables; you may have used the wrong letter for one or more of them.",{equal:!1,wrongVariableCase:i.equalIgnoringCase,wrongVariableNames:!i.equalIgnoringCase,message:a}}return t.compare(e)?s.form&&!t.sameForm(e)?{equal:!1,message:"Your answer is not in the correct form."}:s.simplify&&!t.isSimplified()?{equal:!1,message:"Your answer is not fully expanded and simplified."}:{equal:!0,message:null}:{equal:!1,message:null}},kn="@khanacademy/kmath",Rn="__lib_version__";Ct(kn,Rn);const Ft=1e-9,Sn=Math.pow(2,-42);function Nn(t){return l.isNumber(t)&&!l.isNaN(t)}function ye(t,e,n){return t==null||e==null?t===e:t===e?!0:(n==null&&(n=Ft),Math.abs(t-e)<n)}function Hs(t,e){return ye(t,0,e)?0:Math.abs(t)/t}function On(t,e){return ye(Math.round(t),t,e)}function $s(t,e){const n=Math.pow(10,e);return Math.round(t*n)/n}function In(t,e){return Math.round(t/e)*e}function Tn(t,e){return Math.floor(t/e)*e}function Pn(t,e){return Math.ceil(t/e)*e}function bt(t,e=Sn,n=1e3){let r=[1,0],s=[0,1],i=Math.floor(t),a=t-i;for(;s[0]<=n;){if(ye(r[0]/s[0],t,e))return[r[0],s[0]];r=[i*r[0]+r[1],r[0]],s=[i*s[0]+s[1],s[0]],i=Math.floor(1/a),a=1/a-i}return[t,1]}function At(t){return t.reduce((e,n)=>e+n,0)}function Cn(t){return t.reduce((e,n)=>e*n,1)}function Ue(...t){const e=Math.min(...t.map(r=>r.length)),n=[];for(let r=0;r<e;r++)n.push(t.map(s=>s[r]));return n}function Fn(t,e){return!Array.isArray(t)||e!==void 0&&t.length!==e?!1:t.every(Nn)}function Bs(t){return ot(t,1/it(t))}function it(t){return Math.sqrt(tt(t,t))}function tt(t,e){const r=Ue(t,e).map(Cn);return At(r)}function at(...t){return Ue(...t).map(At)}function Le(t,e){return Ue(t,e).map(n=>n[0]-n[1])}function Xs(t){return t.map(e=>-e)}function ot(t,e){return t.map(n=>n*e)}function An(t,e,n){return t.length===e.length&&Ue(t,e).every(r=>ye(r[0],r[1],n))}function Dn(t){const e=it(t);let n=Math.atan2(t[1],t[0]);return n<0&&(n+=2*Math.PI),[e,n]}function Vn(t){const e=Dn(t);return[e[0],e[1]*180/Math.PI]}function _n(t,e=0){return[t*Math.cos(e),t*Math.sin(e)]}function Ln(t,e=0){return _n(t,e*Math.PI/180)}function Ys(t,e){const n=Vn(t),r=n[1]+e;return Ln(n[0],r)}function qn(t,e){const n=tt(t,e)/tt(e,e);return ot(e,n)}function Gn(t,e){return t.map((n,r)=>In(n,e[r]||e))}function zn(t,e){return t.map((n,r)=>Tn(n,e[r]||e))}function jn(t,e){return t.map((n,r)=>Pn(n,e[r]||e))}function Js(t,e){return it(Le(t,e))}function Ks(t,e){const n=Le(e[1],e[0]),r=Le(t,e[0]),s=qn(r,n),i=Le(ot(s,2),r);return at(e[0],i)}const Qs=Fn,Zs=at,ei=at,Un=An,ti=Gn,ni=zn,ri=jn;function ct(t){return Te(t,0)?0:t>0?1:-1}function We(t,e,n){return(e[0]-t[0])*(n[1]-t[1])-(n[0]-t[0])*(e[1]-t[1])}function Wn(t,e,n){return Te(We(t,e,n),0)}function Hn(t,e,n){return n[0]<=Math.max(t[0],e[0])&&n[0]>=Math.min(t[0],e[0])&&n[1]<=Math.max(t[1],e[1])&&n[1]>=Math.min(t[1],e[1])}function Dt(t,e){const n=[[t[0],t[1],e[0]],[t[0],t[1],e[1]],[e[0],e[1],t[0]],[e[0],e[1],t[1]]],r=l.map(n,function(s){return ct(We(...s))});if(r[0]!==r[1]&&r[2]!==r[3])return!0;for(let s=0;s<4;s++)if(r[s]===0&&Hn(...n[s]))return!0;return!1}function $n(t){for(let e=0;e<t.length;e++)for(let n=e+1;n<t.length;n++){if(Un(t[e],t[n]))return!0;const r=(e+1)%t.length,s=(n+1)%t.length;if(r===n||s===e)continue;const i=[t[e],t[r]],a=[t[n],t[s]];if(Dt(i,a))return!0}return!1}function Ge(t,e){return l.map(l.zip(t,e),function(n){return n[0]-n[1]})}function Bn(t){return[-t[0],-t[1]]}function Vt(t){const e=l.zip(t,t.slice(1).concat(t.slice(0,1))),n=l.map(e,function(r){const s=r[0],i=r[1];return(i[0]-s[0])*(i[1]+s[1])});return ur(n)>0}function ze(t){return Math.sqrt(l.reduce(t,function(e,n){return e+Math.pow(n,2)},0))}function Xn(t,e){return l.reduce(l.zip(t,e),function(n,r){return n+r[0]*r[1]},0)}function Et(t){return l.zip(t,Ee(t)).map(function(n){return ze(Ge(...n))})}function nt(t){const e=l.zip(Ee(t,-1),t,Ee(t,1)),n=l.map(e,function(s){const i=Ge(s[1],s[0]),a=Ge(s[2],s[1]),o=Math.acos(Xn(i,a)/(ze(i)*ze(a)));return ct(We(...s))>0?o:-o}),r=l.reduce(n,function(s,i){return s+i},0);return l.map(n,function(s){return r>0?Math.PI-s:Math.PI+s})}function Yn(t,e,n){if(t.length!==e.length)return!1;const r=t.length,s=nt(t),i=nt(e),a=Et(t),o=Et(e);for(let h=0;h<2*r;h++){let u=i.slice(),c=o.slice();if(h>=r&&(u.reverse(),c.reverse(),c=Ee(c,1)),u=Ee(u,h),c=Ee(c,h),te(s,u)){const f=l.zip(a,c),p=l.map(f,function(v){return v[0]/v[1]}),m=l.all(p,function(v){return Te(p[0],v)}),d=l.all(f,function(v){return ye(v[0],v[1],n)});if(m&&d)return!0}}return!1}function Jn(t,e,n){return Math.acos((t*t+e*e-n*n)/(2*t*e))*180/Math.PI}function Kn([t,e,n,r]){t<0&&(t*=-1,e*=-1,n*=-1);const s=2*Math.PI;for(e<0&&(e*=-1,n*=-1,n+=s/2);n>0;)n-=s;for(;n<0;)n+=s;return[t,e,n,r]}function Ee(t,e){return e=typeof e>"u"?1:e%t.length,t.slice(e).concat(t.slice(0,e))}function Qn(t,e){if(Te(t[0],e[0]))return"x = "+t[0].toFixed(3);const n=(e[1]-t[1])/(e[0]-t[0]),r=t[1]-n*t[0];return"y = "+n.toFixed(3)+"x + "+r.toFixed(3)}function _t(t,e){const n=t[0][0],r=t[0][1],s=t[1][0],i=t[1][1],a=e[0][0],o=e[0][1],h=e[1][0],u=e[1][1],c=(n-s)*(o-u)-(r-i)*(a-h);if(Math.abs(c)<1e-9)return null;const f=((n*i-r*s)*(a-h)-(n-s)*(a*u-o*h))/c,p=((n*i-r*s)*(o-u)-(r-i)*(a*u-o*h))/c;return[f,p]}function Zn(t,e){const n=_t(t,e);if(n===null)return"Lines are parallel";const[r,s]=n;return"Intersection: ("+r.toFixed(3)+", "+s.toFixed(3)+")"}const er=Object.freeze(Object.defineProperty({__proto__:null,angleMeasures:nt,canonicalSineCoefficients:Kn,ccw:We,clockwise:Vt,collinear:Wn,getLineEquation:Qn,getLineIntersection:_t,getLineIntersectionString:Zn,intersects:Dt,lawOfCosines:Jn,magnitude:ze,polygonSidesIntersect:$n,reverseVector:Bn,rotate:Ee,sign:ct,similar:Yn,vector:Ge},Symbol.toStringTag,{value:"Module"}));function tr(t){return t/180*Math.PI}function nr(t){const e=t/Math.PI*180;return Number(e.toPrecision(15))}function rr([t,e]){return Math.atan2(e,t)*180/Math.PI}function sr(t,e){return typeof t=="number"&&(t=[t,t]),e=e*Math.PI/180,[t[0]*Math.cos(e),t[1]*Math.sin(e)]}const rt=(t,e)=>{const n=t[0]-e[0],r=t[1]-e[1];return!n&&!r?0:(180+Math.atan2(-r,-n)*180/Math.PI+360)%360},ir=(t,e=!1)=>{const n=[...t],i=!Vt([n[0],n[2],n[1]])||e?n.reverse():n,a=rt(i[0],i[1]),o=rt(i[2],i[1]);return(a+360-o)%360},ar=Object.freeze(Object.defineProperty({__proto__:null,calculateAngleInDegrees:rr,convertDegreesToRadians:tr,convertRadiansToDegrees:nr,getAngleFromVertex:rt,getClockwiseAngle:ir,polar:sr},Symbol.toStringTag,{value:"Module"}));function or(t){const e=t[0],n=t[1],r=n[1]-e[1],s=Math.PI/(2*(n[0]-e[0])),i=e[0]*s,a=e[1];return[r,s,i,a]}function cr(t){const e=t[0],n=t[1],r=t[2],s=(e[0]-n[0])*(e[0]-r[0])*(n[0]-r[0]);if(s===0)return;const i=(r[0]*(n[1]-e[1])+n[0]*(e[1]-r[1])+e[0]*(r[1]-n[1]))/s,a=(r[0]*r[0]*(e[1]-n[1])+n[0]*n[0]*(r[1]-e[1])+e[0]*e[0]*(n[1]-r[1]))/s,o=(n[0]*r[0]*(n[0]-r[0])*e[1]+r[0]*e[0]*(r[0]-e[0])*n[1]+e[0]*n[0]*(e[0]-n[0])*r[1])/s;return[i,a,o]}const lr=Object.freeze(Object.defineProperty({__proto__:null,getQuadraticCoefficients:cr,getSinusoidCoefficients:or},Symbol.toStringTag,{value:"Module"})),$={cleanMath:function(t){return typeof t=="string"?t.replace(/\+\s*-/g,"- ").replace(/-\s*-/g,"+ ").replace(/\^1/g,""):t},bound:function(t){return t===0?t:t<0?-$.bound(-t):Math.max(1e-6,Math.min(t,1e20))},factorial:function(t){return t<=1?t:t*$.factorial(t-1)},getGCD:function(t,e){if(arguments.length>2){const r=[].slice.call(arguments,1);return $.getGCD(t,$.getGCD(...r))}let n;for(t=Math.abs(t),e=Math.abs(e);e;)n=t%e,t=e,e=n;return t},getLCM:function(t,e){if(arguments.length>2){const n=[].slice.call(arguments,1);return $.getLCM(t,$.getLCM(...n))}return Math.abs(t*e)/$.getGCD(t,e)},primes:[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97],isPrime:function(t){if(t<=1)return!1;if(t<101)return!!Z.grep($.primes,function(e,n){return Math.abs(e-t)<=.5}).length;if(t<=1||t>2&&t%2===0)return!1;for(let e=3,n=Math.sqrt(t);e<=n;e+=2)if(t%e===0)return!1;return!0},getPrimeFactorization:function(t){if(t===1)return[];if($.isPrime(t))return[t];const e=Math.sqrt(t);for(let n=2;n<=e;n++)if(t%n===0)return Z.merge($.getPrimeFactorization(n),$.getPrimeFactorization(t/n))},roundToNearest:function(t,e){return Math.round(e/t)*t},roundTo:function(t,e){const n=Math.pow(10,t).toFixed(5);return Math.round((e*n).toFixed(5))/n},toFixedApprox:function(t,e){const n=t.toFixed(e);return ye(+n,t)?n:"\\approx "+n},roundToApprox:function(t,e){const n=$.roundTo(e,t);return ye(n,t)?String(n):$.toFixedApprox(t,e)},toFraction:function(t,e){if(e==null&&(e=Math.pow(2,-46)),t<0||t>1){let h=t%1;h+=h<0?1:0;const u=$.toFraction(h,e);return u[0]+=Math.round(t-h)*u[1],u}if(Math.abs(Math.round(Number(t))-t)<=e)return[Math.round(t),1];let n=0,r=1,s=1,i=1,a=1,o=2;for(;;){if(Math.abs(Number(a/o)-t)<=e)return[a,o];a/o<t?(n=a,r=o):(s=a,i=o),a=n+s,o=r+i}},getNumericFormat:function(t){if(t=Z.trim(t),t=t.replace(/\u2212/,"-").replace(/([+-])\s+/g,"$1"),t.match(/^[+-]?\d+$/))return"integer";if(t.match(/^[+-]?\d+\s+\d+\s*\/\s*\d+$/))return"mixed";const e=t.match(/^[+-]?(\d+)\s*\/\s*(\d+)$/);return e?parseFloat(e[1])>parseFloat(e[2])?"improper":"proper":t.replace(/[,. ]/g,"").match(/^\d+$/)?"decimal":t.match(/(pi?|\u03c0|t(?:au)?|\u03c4|pau)/)?"pi":null},toNumericString:function(t,e){if(t==null)return"";if(t===0)return"0";if(e==="percent")return t*100+"%";if(e==="pi"){const n=bt(t/Math.PI),r=Math.abs(n[0]),s=n[1];if(On(r))return(t<0?"-":"")+(r===1?"":r)+"π"+(s===1?"":"/"+s)}if(l(["proper","improper","mixed","fraction"]).contains(e)){const n=bt(t),r=Math.abs(n[0]),s=n[1],i=t<0?"-":"";if(s===1)return i+r;if(e==="mixed"){const a=r%s,o=(r-a)/s;return i+(o?o+" ":"")+a+"/"+s}return i+r+"/"+s}return String(t)}};function ur(t){return t.reduce(hr,0)}function hr(t,e){return t+e}const fr="MISSING_PERCENT_ERROR",pr="NEEDS_TO_BE_SIMPLIFIED_ERROR",dr="APPROXIMATED_PI_ERROR",mr="EXTRA_SYMBOLS_ERROR",gr="WRONG_CASE_ERROR",yr="WRONG_LETTER_ERROR",vr="MULTIPLICATION_SIGN_ERROR",xr="INVALID_SELECTION_ERROR",wr="CHOOSE_CORRECT_NUM_ERROR",br="NOT_NONE_ABOVE_ERROR",Er="FILL_ALL_CELLS_ERROR",ne={MISSING_PERCENT_ERROR:fr,NEEDS_TO_BE_SIMPLIFIED_ERROR:pr,APPROXIMATED_PI_ERROR:dr,EXTRA_SYMBOLS_ERROR:mr,WRONG_CASE_ERROR:gr,WRONG_LETTER_ERROR:yr,MULTIPLICATION_SIGN_ERROR:vr,INVALID_SELECTION_ERROR:xr,CHOOSE_CORRECT_NUM_ERROR:wr,NOT_NONE_ABOVE_ERROR:br,FILL_ALL_CELLS_ERROR:Er},Mr=Math.pow(2,-42),re={predicate:{defaultForms:"integer, proper, improper, mixed, decimal",createValidatorFunctional:function(t,e){e=l.extend({simplify:"required",ratio:!1,forms:re.predicate.defaultForms},e);let n;l.isArray(e.forms)?n=e.forms:n=e.forms.split(/\s*,\s*/),e.inexact===void 0&&(e.maxError=0),e.maxError=+e.maxError+Mr,l.contains(n,"percent")&&(n=l.without(n,"percent"),n.push("percent"));const r=function(i){i=i.replace(/\u2212/,"-").replace(/([+-])\s+/g,"$1").replace(/(^\s*)|(\s*$)/gi,"");const a=i.match(/^([+-]?\d+)\s*\/\s*([+-]?\d+)$/),o=i.match(/^([+-]?)\\frac\{([+-]?\d+)\}\{([+-]?\d+)\}$/),h=parseInt(i,10);if(a||o){let u,c,f=!0;return a?(u=parseFloat(a[1]),c=parseFloat(a[2])):(u=parseFloat(o[2]),o[1]==="-"&&(u<0&&(f=!1),u=-u),c=parseFloat(o[3])),f=f&&c>0&&(e.ratio||c!==1)&&$.getGCD(u,c)===1,[{value:u/c,exact:f}]}return!isNaN(h)&&""+h===i?[{value:h,exact:!0}]:[]},s={integer:function(i){const a=s.decimal(i),o=s.decimal(i,1);return a[0].value!=null&&a[0].value===o[0].value||a[1].value!=null&&a[1].value===o[1].value?a:[]},proper:function(i){return Z.map(r(i),function(a){return Math.abs(a.value)<1?[a]:[]})},improper:function(i){return i.includes("/")||i.match(/\\(d?frac)/)?Z.map(r(i),function(o){return Math.abs(o.value)>=1?[o]:[]}):[]},pi:function(i){let a,o=[];if(i=i.replace(/\u2212/,"-"),a=i.match(/^([+-]?)\s*(\\?pi|p|\u03c0|\\?tau|t|\u03c4|pau)$/i))o=[{value:parseFloat(a[1]+"1"),exact:!0}];else if(a=i.match(/^([+-]?\s*\d+\s*(?:\/\s*[+-]?\s*\d+)?)\s*\*?\s*(\\?pi|p|\u03c0|\\?tau|t|\u03c4|pau)$/i))o=r(a[1]);else if(a=i.match(/^([+-]?)\s*(\d+)\s*([+-]?\d+)\s*\/\s*([+-]?\d+)\s*\*?\s*(\\?pi|p|\u03c0|\\?tau|t|\u03c4|pau)$/i)){const u=parseFloat(a[1]+"1"),c=parseFloat(a[2]),f=parseFloat(a[3]),p=parseFloat(a[4]),m=f<p&&$.getGCD(f,p)===1;o=[{value:u*(c+f/p),exact:m}]}else if(a=i.match(/^([+-]?\s*\d+)\s*\*?\s*(\\?pi|p|\u03c0|\\?tau|t|\u03c4|pau)\s*(?:\/\s*([+-]?\s*\d+))?$/i))o=r(a[1]+"/"+a[3]);else if(a=i.match(/^([+-]?)\s*\*?\s*(\\?pi|p|\u03c0|\\?tau|t|\u03c4|pau)\s*(?:\/\s*([+-]?\d+))?$/i))o=r(a[1]+"1/"+a[3]);else if(i==="0")o=[{value:0,exact:!0}];else if(a=i.match(/^(.+)\s*\*?\s*(\\?pi|p|\u03c0|\\?tau|t|\u03c4|pau)$/i))o=s.decimal(a[1]);else{o=l.reduce(re.predicate.defaultForms.split(/\s*,\s*/),function(f,p){return f.concat(s[p](i))},[]);let u=!1;const c=parseFloat(i);if(!isNaN(c)&&c!==parseInt(i)){const f=Math.PI/12,p=f*Math.round(c/f);Math.abs(c-p)<.01&&(u=!0)}else i.match(/\/\s*7/)&&(u=!0);return u&&l.each(o,function(f){f.piApprox=!0}),o}let h=Math.PI;return i.match(/\\?tau|t|\u03c4/)&&(h=Math.PI*2),i.match(/pau/)&&(h=Math.PI*1.5),Z.each(o,function(u,c){c.value*=h}),o},coefficient:function(i){let a=[];return i=i.replace(/\u2212/,"-"),i===""?a=[{value:1,exact:!0}]:i==="-"&&(a=[{value:-1,exact:!0}]),a},log:function(i){let a,o=[];return i=i.replace(/\u2212/,"-"),i=i.replace(/[ \(\)]/g,""),(a=i.match(/^log\s*(\S+)\s*$/i))?o=s.decimal(a[1]):i==="0"&&(o=[{value:0,exact:!0}]),o},percent:function(i){i=Z.trim(i);let a=!1;i.indexOf("%")===i.length-1&&(i=Z.trim(i.substring(0,i.length-1)),a=!0);const o=s.decimal(i);return Z.each(o,function(h,u){u.exact=a,u.value=u.value/100}),o},mixed:function(i){const a=i.replace(/\u2212/,"-").replace(/([+-])\s+/g,"$1").match(/^([+-]?)(\d+)\s+(\d+)\s*\/\s*(\d+)$/);if(a){const o=parseFloat(a[1]+"1"),h=parseFloat(a[2]),u=parseFloat(a[3]),c=parseFloat(a[4]),f=u<c&&$.getGCD(u,c)===1;return[{value:o*(h+u/c),exact:f}]}return[]},decimal:function(i,a=1e10){const o=function(u){u=Z.trim(u);const c=u.replace(/\u2212/,"-").replace(/([+-])\s+/g,"$1").match(/^([+-]?(?:\d{1,3}(?:[, ]?\d{3})*\.?|\d{0,3}(?:[, ]?\d{3})*\.(?:\d{3}[, ]?)*\d{1,3}))$/),f=u.match(/^0[0,]*,/);if(c&&!f){let p=parseFloat(c[1].replace(/[, ]/g,""));return e.inexact===void 0&&(p=Math.round(p*a)/a),p}},h=function(u){return u=u.replace(/([\.,])/g,function(c,f){return f==="."?",":"."}),o(u)};return[{value:o(i),exact:!0},{value:h(i),exact:!0}]}};return function(i){const a=e.fallback!=null?""+e.fallback:"";i=Z.trim(i)||a;const o={empty:i==="",correct:!1,message:null,guess:i};if(Z.each(n,function(h,u){const c=s[u](i);for(let f=0,p=c.length;f<p;f++){const m=c[f].value,d=c[f].exact,v=c[f].piApprox;if(t(m,e.maxError))return d||e.simplify==="optional"?(o.correct=!0,o.message=e.message||null,o.empty=!1):u==="percent"?(o.empty=!0,o.message=ne.MISSING_PERCENT_ERROR):(e.simplify!=="enforced"&&(o.empty=!0),o.message=ne.NEEDS_TO_BE_SIMPLIFIED_ERROR),!1;v&&t(m,Math.abs(m*.001))&&(o.empty=!0,o.message=ne.APPROXIMATED_PI_ERROR)}}),o.correct===!1){let h=!1;if(l.each(s,function(u){l.any(u(i),function(f){return f.value!=null&&!l.isNaN(f.value)})&&(h=!0)}),!h)return o.empty=!0,o.message=ne.EXTRA_SYMBOLS_ERROR,o}return o}}},number:{convertToPredicate:function(t,e){const n=parseFloat(t);return[function(r,s){return Math.abs(r-n)<s},Z.extend({},e,{type:"predicate"})]},createValidatorFunctional:function(t,e){return re.predicate.createValidatorFunctional(...re.number.convertToPredicate(t,e))}},expression:{parseSolution:function(t,e){let n=Ie(t,e);if(n.parsed){if(e.simplified&&!n.expr.isSimplified())throw new de("The provided solution ("+t+") isn't fully expanded and simplified.",me.InvalidInput);n=n.expr}else throw new de("The provided solution ("+t+") didn't parse.",me.InvalidInput);return n},createValidatorFunctional:function(t,e){return function(n){const r={empty:!1,correct:!1,message:null,guess:n,ungraded:!1};if(!n)return r.empty=!0,r;const s=Ie(n,e);if(!s.parsed)return r.empty=!0,r;typeof t=="string"&&(t=re.expression.parseSolution(t,e));const i=wt(s.expr,t,e);if(i.equal)r.correct=!0;else if(i.wrongVariableNames||i.wrongVariableCase)r.ungraded=!0,r.message=i.wrongVariableCase?ne.WRONG_CASE_ERROR:ne.WRONG_LETTER_ERROR,r.suppressAlmostThere=!0;else if(i.message)r.message=i.message;else{const a=Ie(n.replace(/[xX]/g,"*"),e);if(a.parsed){const o=wt(a.expr,t,e);o.equal?(r.ungraded=!0,r.message=ne.MULTIPLICATION_SIGN_ERROR):o.message&&(r.message=o.message+" Also, I'm a computer. I only understand multiplication if you use an asterisk (*) as the multiplication sign.")}}return r}}}};function kr(t,e){let n=!0;return e.values.forEach((r,s)=>{t.values[s]!==r&&(n=!1)}),{type:"points",earned:n?1:0,total:1,message:null}}function Rr(t,e){return e.items.some((r,s)=>t.values[s]==null)?{type:"invalid",message:ne.INVALID_SELECTION_ERROR}:null}function Sr(t){return t.status==="correct"?{type:"points",earned:1,total:1,message:t.message||null}:t.status==="incorrect"?{type:"points",earned:0,total:1,message:t.message||null}:{type:"invalid",message:"Keep going, you're not there yet!"}}function Nr(t,e){return{type:"points",earned:e.choices[t.value-1].correct?1:0,total:1,message:null}}function Or(t){return t.value===0?{type:"invalid",message:null}:null}function Ir(t,e,n){const r=l.clone(e);l.extend(r,{decimal_separator:on(n)});const s=u=>{const c=Ie(u.value,e);if(!c.parsed)throw new de("Unable to parse solution answer for expression",me.InvalidInput,{metadata:{rubric:JSON.stringify(e)}});return re.expression.createValidatorFunctional(c.expr,l({}).extend(r,{simplify:u.simplify,form:u.form}))};let i,a,o=!0,h;for(const u of e.answerForms||[]){const c=s(u);if(!c)continue;const f=c(t);if(f.correct){i=u,a=f.message||"";break}o=o&&f.empty,u.considered==="correct"&&f.ungraded&&!h&&(h=f)}return i?i.considered==="ungraded"?{type:"invalid",message:a}:{type:"points",earned:i.considered==="correct"?1:0,total:1,message:a}:h?{type:"invalid",message:h.message,suppressAlmostThere:h.suppressAlmostThere}:o?{type:"invalid",message:null}:{type:"points",earned:0,total:1}}function Tr(t){return t===""?{type:"invalid",message:null}:null}function Mt(t){if(t.coords!=null){if(t.type==="exponential"||t.type==="logarithm")return Qe(t.type).getCoefficients(t.coords,t.asymptote);if(t.type==="linear"||t.type==="quadratic"||t.type==="absolute_value"||t.type==="sinusoid"||t.type==="tangent")return Qe(t.type).getCoefficients(t.coords);throw new de("Invalid grapher type",me.InvalidInput)}}function Pr(t,e){if(t.type!==e.correct.type)return{type:"points",earned:0,total:1,message:null};if(t.coords==null)return{type:"invalid",message:null};const n=Qe(t.type),r=Mt(t),s=Mt(e.correct);return r==null||s==null?{type:"invalid",message:null}:n.areEqual(r,s)?{type:"points",earned:1,total:1,message:null}:{type:"points",earned:0,total:1,message:null}}function Cr(t){return t.status==="correct"?{type:"points",earned:1,total:1,message:t.message||null}:t.status==="incorrect"?{type:"points",earned:0,total:1,message:t.message||null}:{type:"invalid",message:"Keep going, you're not there yet!"}}const{collinear:Q,canonicalSineCoefficients:kt,similar:Ke,clockwise:Fr}=er,{getClockwiseAngle:Ar}=ar,{getSinusoidCoefficients:Rt,getQuadraticCoefficients:St}=lr;function Dr(t,e){if(t.type==="none"&&e.correct.type==="none")return{type:"points",earned:0,total:0,message:null};const n=!!(t.coords||t.center&&t.radius);if(t.type===e.correct.type&&n){if(t.type==="linear"&&e.correct.type==="linear"&&t.coords!=null){const r=t.coords,s=e.correct.coords;if(Q(s[0],s[1],r[0])&&Q(s[0],s[1],r[1]))return{type:"points",earned:1,total:1,message:null}}else if(t.type==="linear-system"&&e.correct.type==="linear-system"&&t.coords!=null){const r=t.coords,s=e.correct.coords;if(Q(s[0][0],s[0][1],r[0][0])&&Q(s[0][0],s[0][1],r[0][1])&&Q(s[1][0],s[1][1],r[1][0])&&Q(s[1][0],s[1][1],r[1][1])||Q(s[0][0],s[0][1],r[1][0])&&Q(s[0][0],s[0][1],r[1][1])&&Q(s[1][0],s[1][1],r[0][0])&&Q(s[1][0],s[1][1],r[0][1]))return{type:"points",earned:1,total:1,message:null}}else if(t.type==="quadratic"&&e.correct.type==="quadratic"&&t.coords!=null){const r=St(t.coords),s=St(e.correct.coords);if(te(r,s))return{type:"points",earned:1,total:1,message:null}}else if(t.type==="sinusoid"&&e.correct.type==="sinusoid"&&t.coords!=null){const r=Rt(t.coords),s=Rt(e.correct.coords),i=kt(r),a=kt(s);if(te(i,a))return{type:"points",earned:1,total:1,message:null}}else if(t.type==="circle"&&e.correct.type==="circle"){if(te(t.center,e.correct.center)&&Te(t.radius,e.correct.radius))return{type:"points",earned:1,total:1,message:null}}else if(t.type==="point"&&e.correct.type==="point"&&t.coords!=null){let r=e.correct.coords;if(r==null)throw new Error("Point graph rubric has null coords");const s=t.coords.slice();if(r=r.slice(),s==null||s.sort(),r.sort(),te(s,r))return{type:"points",earned:1,total:1,message:null}}else if(t.type==="polygon"&&e.correct.type==="polygon"&&t.coords!=null){const r=t.coords.slice(),s=e.correct.coords.slice();let i;if(e.correct.match==="similar"?i=Ke(r,s,Number.POSITIVE_INFINITY):e.correct.match==="congruent"?i=Ke(r,s,Ft):e.correct.match==="approx"?i=Ke(r,s,.1):(r.sort(),s.sort(),i=te(r,s)),i)return{type:"points",earned:1,total:1,message:null}}else if(t.type==="segment"&&e.correct.type==="segment"&&t.coords!=null){let r=et(t.coords),s=et(e.correct.coords);if(r=l.invoke(r,"sort").sort(),s=l.invoke(s,"sort").sort(),te(r,s))return{type:"points",earned:1,total:1,message:null}}else if(t.type==="ray"&&e.correct.type==="ray"&&t.coords!=null){const r=t.coords,s=e.correct.coords;if(te(r[0],s[0])&&Q(s[0],s[1],r[1]))return{type:"points",earned:1,total:1,message:null}}else if(t.type==="angle"&&e.correct.type==="angle"){const r=t.coords,s=e.correct.coords,i=e.correct.allowReflexAngles;if(!r)return{type:"invalid",message:null};const h=Fr([r[0],r[2],r[1]])&&!i?r.slice().reverse():r;let u;if(e.correct.match==="congruent"){const c=l.map([h,s],function(f){return f?Ar(f,i):!1});u=Te(...c)}else u=te(h[1],s[1])&&Q(s[1],s[0],h[0])&&Q(s[1],s[2],h[2]);if(u)return{type:"points",earned:1,total:1,message:null}}}return!n||l.isEqual(t,e.graph)?{type:"invalid",message:null}:{type:"points",earned:0,total:1,message:null}}function Vr(t,e){const n={hasAnswers:!1,isCorrect:!1};return t&&t.length>0&&(n.hasAnswers=!0),e.length>0?t&&t.length===e.length&&(n.isCorrect=t.every(r=>e.includes(r))):(!t||t.length===0)&&(n.isCorrect=!0),n}function _r(t,e){let n=0;for(let r=0;r<t.markers.length;r++)Vr(t.markers[r].selected,e.markers[r].answers).isCorrect&&n++;return{type:"points",earned:n===t.markers.length?1:0,total:1,message:null}}function Lr(t,e){return{type:"points",earned:l.isEqual(t.left,e.left)&&l.isEqual(t.right,e.right)?1:0,total:1,message:null}}function qr(t,e){const n=e.answers,r=t.answers,s=Ze(n),i=Ze(r),a=s[0]!==i[0]||s[1]!==i[1],o=re.number.createValidatorFunctional;let h=null,u=!1;return l(i[0]).times(c=>{l(i[1]).times(f=>{if(!a){const m=o(n[c][f],{simplify:!0})(r[c][f]);m.message&&(h=m.message),m.correct||(u=!0)}})}),a?{type:"points",earned:0,total:1,message:null}:{type:"points",earned:u?0:1,total:1,message:h}}function Gr(t){const e=t.answers,n=Ze(e);for(let r=0;r<n[0];r++)for(let s=0;s<n[1];s++)if(e[r][s]==null||e[r][s].toString().length===0)return{type:"invalid",message:ne.FILL_ALL_CELLS_ERROR};return null}function zr(t,e){const n=e.range,r=e.initialX!=null?e.initialX:n[0],s=e.isInequality?"ge":"eq",i=e.correctRel||"eq";return ye(t.numLinePosition,e.correctX||0)&&i===t.rel?{type:"points",earned:1,total:1,message:null}:t.numLinePosition===r&&t.rel===s?{type:"invalid",message:null}:{type:"points",earned:0,total:1,message:null}}function jr(t){const e=t.divisionRange,n=t.numDivisions>e[1]||t.numDivisions<e[0];return t.isTickCrtl&&n?{type:"invalid",message:"Number of divisions is outside the allowed range."}:null}function Ur(t,e){let n=0;for(let r=e,s=t.length;r<s;r++){const i=t[r];if(i==="{"?n++:i==="}"&&n--,n<0)return r}return t.length}function Nt(t,e,n){const r=t.indexOf("{",e);if(r===-1)return{endpoint:t.length,expression:""};const s=r+1,i=Ur(t,s),a=t.substring(s,i),o=Lt(a,n);return{endpoint:i,expression:o}}function Ot(t,e){const n="\\dfrac",s=t.indexOf("\\frac",e),i=t.indexOf(n,e);return s>-1&&i>-1?Math.min(s,i):s>-1?s:i>-1?i:-1}function Lt(t,e){if(!t)return"";let n="",r=0,s=Ot(t,r);for(;s>-1;){n+=t.substring(r,s),r=s;const i=Nt(t,r,e);r=i.endpoint+1;const a=Nt(t,r,e);r=a.endpoint+1,n.length&&(n+=" "),n+=e(i.expression,a.expression),s=Ot(t,r)}return n+=t.slice(r),n}function qt(t){return Lt(t,function(r,s){return r+"/"+s}).replace("\\%","%")}const Wr=[{title:"Integers",value:"integer",content:"6"},{title:"Decimals",value:"decimal",content:"0.75"},{title:"Proper fractions",value:"proper",content:"⅗"},{title:"Improper fractions",value:"improper",content:"⁷⁄₄"},{title:"Mixed numbers",value:"mixed",content:"1¾"},{title:"Numbers with π",value:"pi",content:"π"}];function Hr(t,e){if(!(typeof t=="string"&&t.endsWith("%")))return t;const n=parseFloat(t.slice(0,-1));return isNaN(n)?t:e?n/100:n}function $r(t,e){const n=Wr.map(u=>u.value).filter(u=>u!=="pi"),r=u=>{const c=`${u.value}`,f=[...u.answerForms??[]];return(!u.strict||f.length===0)&&f.push(...n),re.number.createValidatorFunctional(c,{message:u.message,simplify:u.status==="correct"?u.simplify:"optional",inexact:!0,maxError:u.maxError,forms:f})},s=qt(t.currentValue),i=e.answers.filter(u=>u.status==="correct").every(u=>u.value!=null&&Math.abs(u.value)<=1);let a=s;e.coefficient&&(a?a==="-"&&(a=-1):a=1);const o=e.answers.map(u=>{const f=r(u)(Hr(a,i));return{...u,score:f}}).find(u=>u.score.correct||u.status==="correct"&&u.score.empty),h=(o==null?void 0:o.status)==="correct"?o.score:{empty:(o==null?void 0:o.status)==="ungraded",correct:(o==null?void 0:o.status)==="correct",message:(o==null?void 0:o.message)??null,guess:a};return h.empty?{type:"invalid",message:h.message}:{type:"points",earned:h.correct?1:0,total:1,message:h.message}}function Br(t,e){return{type:"points",earned:l.isEqual(t.current,e.correctOptions.map(r=>r.content))?1:0,total:1,message:null}}function Xr(t){return t.current.length===0?{type:"invalid",message:null}:null}function Yr(t,e){return{type:"points",earned:te(t,e.correct)?1:0,total:1,message:null}}function Jr(t,e){return te(t,e.starting)?{type:"invalid",message:null}:null}function Kr(t,e){const n=t.choicesSelected.reduce((a,o)=>a+(o?1:0),0),r=e.choices.reduce((a,o)=>o.correct?a+1:a,0);return r>1&&n!==r?{type:"invalid",message:ne.CHOOSE_CORRECT_NUM_ERROR}:e.choices.some((a,o)=>a.isNoneOfTheAbove&&t.choicesSelected[o])&&n>1?{type:"invalid",message:ne.NOT_NONE_ABOVE_ERROR}:{type:"points",earned:t.choicesSelected.every((a,o)=>{let h;return e.choices[o].isNoneOfTheAbove?h=e.choices.every((u,c)=>o===c||!u.correct):h=!!e.choices[o].correct,h===a})?1:0,total:1,message:null}}function Qr(t){return t.choicesSelected.reduce((n,r)=>n+(r?1:0),0)===0?{type:"invalid",message:null}:null}function Zr(t,e){return{type:"points",earned:te(t.options,e.correct)?1:0,total:1,message:null}}function es(t){return t.changed?null:{type:"invalid",message:null}}const st=function(t){return t.filter(function(e){return e.some(n=>n)})};function Gt(t){const e=st(t);return e.some(function(r){return r.some(function(s){return s===""})})||!e.length?{type:"invalid",message:null}:null}function ts(t,e){const n=Gt(t);if(n!=null)return n;const r=st(t),s=st(e.answers);if(r.length!==s.length)return{type:"points",earned:0,total:1,message:null};const i=re.number.createValidatorFunctional;let a=null;return{type:"points",earned:s.every(function(h){for(let u=0;u<r.length;u++)if(r[u].every(function(p,m){const d=h[m],w=i(d,{simplify:!0})(p);return w.message&&(a=w.message),w.correct}))return r.splice(u,1),!0;return!1})?1:0,total:1,message:a}}const ns={number:{name:"Numbers",forms:"integer, decimal, proper, improper, mixed"},decimal:{name:"Decimals",forms:"decimal"},integer:{name:"Integers",forms:"integer"},rational:{name:"Fractions and mixed numbers",forms:"integer, proper, improper, mixed"},improper:{name:"Improper numbers (no mixed)",forms:"integer, proper, improper"},mixed:{name:"Mixed numbers (no improper)",forms:"integer, proper, mixed"},percent:{name:"Numbers or percents",forms:"integer, decimal, proper, improper, mixed, percent"},pi:{name:"Numbers with pi",forms:"pi"}};function rs(t,e){e.answerType==null&&(e.answerType="number");const n=`${e.value}`,r=re.number.createValidatorFunctional(n,{simplify:e.simplify,inexact:e.inexact||void 0,maxError:e.maxError,forms:ns[e.answerType].forms}),s=qt(t.currentValue),i=r(s);return i.empty?{type:"invalid",message:i.message}:{type:"points",earned:i.correct?1:0,total:1,message:i.message}}function se(t=0){return{type:"points",earned:t,total:t,message:null}}function ss(t,e,n){const r=Ut(e.widgets,Object.keys(e.widgets),t,n);return jt(r)}function is(t,e,n,r){return e.filter(s=>{const i=t[s];if(!i||i.static===!0)return!1;const a=zt(i.type),o=n[s],h=i.options,u=a==null?void 0:a(o,h,r);if(u)return hs(u)})}function as(t,e,n){return is(e.widgets,Object.keys(e.widgets),t,n).length===0?null:{type:"invalid",message:null}}function os(t){let e=0;for(let n=0;n<t.markers.length;n++){const r=t.markers[n].selected;r&&r.length>0&&e++}return e!==t.markers.length?{type:"invalid",message:null}:null}function cs(t){return t.currentValue==null||t.currentValue===""?{type:"invalid",message:""}:null}function It(t,e){const n=cs(t);return n??{type:"points",earned:t.currentValue===e.value?1:0,total:1,message:""}}const lt={};function A(t,e,n){lt[t]={scorer:e,validator:n}}const zt=t=>{var e;return((e=lt[t])==null?void 0:e.validator)??null},ls=t=>{var e;return((e=lt[t])==null?void 0:e.scorer)??null};A("categorizer",kr,Rr);A("cs-program",Sr);A("dropdown",Nr,Or);A("expression",Ir,Tr);A("grapher",Pr);A("group",ss,as);A("iframe",Cr);A("input-number",rs);A("interactive-graph",Dr);A("label-image",_r,os);A("matcher",Lr);A("matrix",qr,Gr);A("mock-widget",It,It);A("number-line",zr,jr);A("numeric-input",$r);A("orderer",Br,Xr);A("plotter",Yr,Jr);A("radio",Kr,Qr);A("sorter",Zr,es);A("table",ts,Gt);A("deprecated-standin",()=>se(1));A("measurer",()=>se(1));A("definition",se);A("explanation",se);A("image",se);A("interaction",se);A("molecule",se);A("passage",se);A("passage-ref",se);A("passage-ref-target",se);A("video",se);const us={type:"points",earned:0,total:0,message:null};function hs(t){return t.type==="invalid"&&(!t.message||t.message.length===0)}function fs(t,e){let n;if(t.type==="points"&&e.type==="points")return t.message&&e.message&&t.message!==e.message?n=null:n=t.message||e.message,{type:"points",earned:t.earned+e.earned,total:t.total+e.total,message:n};if(t.type==="points"&&e.type==="invalid")return e;if(t.type==="invalid"&&e.type==="points")return t;if(t.type==="invalid"&&e.type==="invalid")return t.message&&e.message&&t.message!==e.message?n=null:n=t.message||e.message,{type:"invalid",message:n};throw new de("PerseusScore with unknown type encountered",me.InvalidInput,{metadata:{scoreA:JSON.stringify(t),scoreB:JSON.stringify(e)}})}function jt(t){return Object.values(t).reduce(fs,us)}function si(t,e,n){const r=ln(t.content),s=Ut(t.widgets,r,e,n);return jt(s)}function Ut(t,e,n,r){const s=pn(t),i=e.filter(o=>{const h=s[o],u=(h==null?void 0:h.graded)==null||h.graded,c=!!(h!=null&&h.static);return u&&!c}),a={};return i.forEach(o=>{const h=s[o];if(!h)return;const u=n[o],c=zt(h.type),f=ls(h.type),p=(c==null?void 0:c(u,h.options,r))??(f==null?void 0:f(u,h.options,r));p!=null&&(a[o]=p)}),a}const Wt=/^web\+graphie:/,Ht=/^file\+graphie:/;function ut(t){return $t(t)?Bt(t):t}function $t(t){return Wt.test(t)||Ht.test(t)}function ht(t){return t.replace(Wt,"https:").replace(Ht,"file:")}function Bt(t){return ht(t)+".svg"}function ps(t){return ht(t)+"-data.json"}async function ds(t){const e=new Image;return new Promise((n,r)=>{e.onload=()=>{n([e.naturalWidth,e.naturalHeight])},e.onerror=r,e.src=ut(t)})}let Tt=!1;const Xt=function(t,e,n){return Array.isArray(t)?l.map(t,function(r){return Xt(r,e)}):e.call(n,t)};function ms(t,e){return t==null||e==null?t==null==(e==null):t.length===e.length&&t.every((n,r)=>e[r]===n)}const Yt=/^\[\[\u2603 (([a-z-]+) ([0-9]+))\]\]/,gs=/^([a-z-]+) ([0-9]+)$/,ys=new RegExp(Yt.source+"$"),vs="☃",xs="x".split(/(.)/g).length?function(t,e){return t.split(e)}:function(t,e){const n=[];let r=e.lastIndex=0,s;for(;s=e.exec(t);){const i=s;n.push(t.slice(r,i.index)),n.push(...i.slice(1)),r=i.index+i[0].length}return n.push(t.slice(r)),n};function ws(t,e){let n;return re.predicate.createValidatorFunctional(function(s){return n=s,!0},{simplify:"optional",inexact:!0,forms:"integer, proper, improper, pi, log, mixed, decimal"})(t),n}function bs(t){return l(t).times(function(){return""})}function Es(t,e,n,r){const s=ft(e,n),a=t*s>30;return{scale:s,tickStep:t/r,unityLabel:a}}function Ms(t,e,n){return l(2).times(function(r){const s=ft(t[r],n);return Jt(e[r],s)})}function ks(t){return[t[0]/2,t[1]/2]}function Jt(t,e){const n=t*e,r=t,s=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),i=Math.floor(r/s);if(n<25)return t;if(n<50)return i===5?t:t/2;if(i===1)return t/2;if(i===2)return t/4;if(i===5)return t/5}function ft(t,e){const n=t[1]-t[0];return e/n}function Rs(t,e){const n=t[1]-t[0];let r;15<n&&n<=20?r=23:n>100||n<5?r=10:r=16;const s=e/500,i=r*s;return pt(n,i)}function pt(t,e){let n=Math.pow(10,Math.floor(Math.log(t/e)/Math.LN10));const r=e/t*n;return r<=.15?n*=10:r<=.35?n*=5:r<=.75&&(n*=2),n}const Pt=(t,e)=>{const n=e[1]-e[0],r=n/t;return r<=10?t:r<=20?t*2:pt(n,10)};function Ss(t,e){return[Pt(t[0],e[0]),Pt(t[1],e[1])]}function Ns(t){t=t||window.location.search.substring(1);const e={},n=/\+/g,r=/([^&=]+)=?([^&]*)/g,s=function(a){return decodeURIComponent(a.replace(n," "))};let i;for(;i=r.exec(t);){const a=i;e[s(a[1])]=s(a[2])}return e}function Os(t,e,n){n=encodeURIComponent(n);const r=new RegExp("([?&])"+e+"=.*?(&|$)","i"),s=t.indexOf("?")!==-1?"&":"?";return t.match(r)?t.replace(r,"$1"+e+"="+n+"$2"):t+s+e+"="+n}function Is(t){return encodeURIComponent(t).replace(/['()!]/g,window.escape).replace(/\*/g,"%2A")}const le={pointerDown:!1,currentTouchIdentifier:null};function Ts(){Object.assign(le,{pointerDown:!1,currentTouchIdentifier:null})}function Ps(t){let e;if(le.pointerDown){if(le.currentTouchIdentifier!=null){const r=t.changedTouches?t.changedTouches.length:0;for(let s=0;s<r;s++)t.changedTouches[s].identifier===le.currentTouchIdentifier&&(e=t.changedTouches[s])}else e=t;const n=t.type==="touchend"||t.type==="touchcancel";e&&n&&(le.pointerDown=!1,le.currentTouchIdentifier=null)}else le.pointerDown=!0,t.changedTouches?(e=t.changedTouches[0],le.currentTouchIdentifier=e.identifier):e=t;if(e)return{left:e.pageX,top:e.pageY}}const Cs=()=>{try{const t=Object.defineProperty({},"passive",{get:function(){Tt=!0}});window.addEventListener("testPassive",null,t),window.removeEventListener("testPassive",null,t)}catch{}return Tt};function Fs(t){t.stopPropagation()}function As(t,e){const n=new Image;n.onload=function(){var r;n.width===0&&n.height===0?((r=document.body)==null||r.appendChild(n),l.defer(function(){var s;e(n.clientWidth,n.clientHeight),(s=document.body)==null||s.removeChild(n)})):e(n.width,n.height)},n.src=ut(t)}function Ds(t){const e=t.value,n=t.selectionStart-1,r=Math.max(e.lastIndexOf(`
`,n),e.lastIndexOf(" ",n))+1;return{string:e.substring(r,n+1),pos:{start:r,end:n}}}function Vs(t,e){t.selectionStart=e,t.selectionEnd=e}const _s={getWordBeforeCursor:Ds,moveCursor:Vs},Ls=t=>t.startsWith("$")&&t.endsWith("$")?t.slice(1,-1):t,ii={inputPathsEqual:ms,nestedMap:Xt,rWidgetRule:Yt,rTypeFromWidgetId:gs,rWidgetParts:ys,snowman:vs,split:xs,firstNumericalParse:ws,stringArrayOfSize:bs,gridDimensionConfig:Es,getGridStep:Ms,snapStepFromGridStep:ks,scaleFromExtent:ft,tickStepFromExtent:Rs,gridStepFromTickStep:Jt,tickStepFromNumTicks:pt,constrainedTickStepsFromTickSteps:Ss,parseQueryString:Ns,updateQueryString:Os,strongEncodeURIComponent:Is,touchHandlers:le,resetTouchHandlers:Ts,extractPointerLocation:Ps,supportsPassiveEvents:Cs,captureScratchpadTouchStart:Fs,getImageSize:As,getImageSizeModern:ds,getRealImageUrl:ut,isLabeledSVG:$t,getBaseUrl:ht,getSvgUrl:Bt,getDataUrl:ps,textarea:_s,unescapeMathMode:Ls};export{ei as A,ti as B,ri as C,ni as D,Ws as E,un as F,is as G,Ut as H,jt as I,Kr as J,$ as K,Ks as L,_t as M,lr as N,Vr as O,Hs as P,bt as Q,In as R,ii as U,On as a,ye as b,ar as c,Le as d,An as e,Ze as f,pn as g,Qs as h,ns as i,at as j,ot as k,it as l,Js as m,Ln as n,Bs as o,Ie as p,Vn as q,$s as r,si as s,Zs as t,fn as u,er as v,Un as w,Ys as x,Xs as y,Ue as z};
