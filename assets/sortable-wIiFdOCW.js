import{j as m,a as T,F as k}from"./jsx-runtime-BGVbfQ2Z.js";import{l as D,R as q,p as S}from"./renderer-Fr2bdwqO.js";import{C as F}from"./index-iPN1eFIx.js";import{l as C}from"./index-awljIyHI.js";import{$ as u}from"./jquery-5v7aFUvu.js";import{r as P}from"./index-qhcEwEpg.js";import{R as M}from"./index-E09jvG0x.js";import{_ as a}from"./index-default-4_ZsnO94.js";import{g as L}from"./dependencies-fnqF3NiV.js";import{C as E}from"./perseus-api-Ly41NhN4.js";import{U as v}from"./util-G-g1AweO.js";var I=(f=>(f.HORIZONTAL="horizontal",f.VERTICAL="vertical",f))(I||{});const U=(f,t)=>{const e=f.offsetParent();return{top:t.top+e.scrollTop(),left:t.left+e.scrollLeft()}};class N extends P.Component{render(){const{layout:t}=this.props,e=C.css(l.card,l.placeholder,t==="horizontal"&&l.horizontalCard),s={width:this.props.width,height:this.props.height};return this.props.margin!=null&&(s.margin=this.props.margin),m("li",{className:e,style:s})}}const R=class R extends P.Component{constructor(){super(...arguments),this.animationFrameRequest=null,this.state={startPosition:{left:0,top:0},startMouse:{left:0,top:0},mouse:{left:0,top:0},dragging:!1},this.getCurrentPosition=()=>({left:this.state.startPosition.left+this.state.mouse.left-this.state.startMouse.left,top:this.state.startPosition.top+this.state.mouse.top-this.state.startMouse.top}),this.bindMouseMoveUp=()=>{this.isMouseMoveUpBound=!0,u(document).on("mousemove",this.onMouseMove),u(document).on("mouseup",this.onMouseUp)},this.unbindMouseMoveUp=()=>{this.isMouseMoveUpBound=!1,u(document).off("mousemove",this.onMouseMove),u(document).off("mouseup",this.onMouseUp)},this.onMouseDown=t=>{if(this.props.state!=="static"||!(t.button===0||t.touches!=null&&t.touches.length===1))return;t.preventDefault();const e=v.extractPointerLocation(t);this.animationFrameRequest=requestAnimationFrame(()=>{const s=u(M.findDOMNode(this)),i=s.position(),n=U(s,i);e&&this._mounted&&this.setState({startPosition:n,startMouse:e,mouse:e,dragging:!0},function(){this.bindMouseMoveUp(),this.props.onMouseDown()})})},this.onMouseMove=t=>{if(this.props.state!=="dragging"||!this.state.dragging)return;t.preventDefault();const s=v.extractPointerLocation(t);s&&(this.animationFrameRequest=requestAnimationFrame(()=>{this.setState({mouse:s},this.props.onMouseMove)}))},this.onMouseUp=t=>{if(this.props.state!=="dragging"||!this.state.dragging)return;t.preventDefault(),v.extractPointerLocation(t)&&(this.setState({dragging:!1}),this.unbindMouseMoveUp(),this.props.onMouseUp())}}componentDidMount(){this._mounted=!0,this.isMouseMoveUpBound=!1,document.addEventListener("touchmove",this.onMouseMove,v.supportsPassiveEvents()?{passive:!1}:!1)}componentWillUnmount(){this._mounted=!1,this.isMouseMoveUpBound&&this.unbindMouseMoveUp(),this.animationFrameRequest&&cancelAnimationFrame(this.animationFrameRequest),document.removeEventListener("touchmove",this.onMouseMove)}render(){const{includePadding:t,layout:e,state:s}=this.props;let i=C.css(l.card,l.draggable,e==="horizontal"&&l.horizontalCard,e==="vertical"&&l.verticalCard,s==="dragging"&&l.dragging,s==="disabled"&&l.disabled,!t&&l.unpaddedCard)+" "+E.INTERACTIVE+" perseus-sortable-draggable";t||(i+=" perseus-sortable-draggable-unpadded");const n={position:"static"};return(this.props.state==="dragging"||this.props.state==="animating")&&a.extend(n,{position:"absolute"},this.getCurrentPosition()),this.props.width&&(n.width=this.props.width+1),this.props.height&&(n.height=this.props.height),this.props.margin!=null&&(n.margin=this.props.margin),m("li",{className:i,style:n,onMouseDown:this.onMouseDown,onTouchStart:this.onMouseDown,onTouchMove:this.onMouseMove,onTouchEnd:this.onMouseUp,onTouchCancel:this.onMouseUp,children:m(q,{content:this.props.content,linterContext:S(this.props.linterContext,"draggable"),onRender:this.props.onRender})})}componentDidUpdate(t){if(this.props.state!==t.state)if(this.props.state==="animating"&&this.props.endPosition){const e=this.getCurrentPosition(),s=15*Math.sqrt(Math.sqrt(Math.pow(this.props.endPosition.left-e.left,2)+Math.pow(this.props.endPosition.top-e.top,2)));u(M.findDOMNode(this)).animate(this.props.endPosition,{duration:Math.max(s,1),complete:this.props.onAnimationEnd})}else this.props.state==="static"&&u(M.findDOMNode(this)).finish()}};R.defaultProps={includePadding:!0,type:"static",linterContext:D};let w=R;const g=class g extends P.Component{constructor(t){super(t),this.remeasureItems=a.debounce(()=>{this.setState({items:g.clearItemMeasurements(this.state.items)})},20),this.state={items:g.itemsFromProps(this.props),texRendererLoaded:!1}}UNSAFE_componentWillReceiveProps(t){const e=this.props;a.isEqual(t.options,e.options)?(t.layout!==e.layout||t.padding!==e.padding||t.disabled!==e.disabled||!a.isEqual(t.constraints,e.constraints))&&this.setState({items:g.clearItemMeasurements(this.state.items)}):this.setState({items:g.itemsFromProps(t)})}componentDidUpdate(){this.state.items.length&&!this.state.items[0].width&&!this.state.items[0].height&&setTimeout(()=>{this.measureItems()},0)}static itemsFromProps(t){const e=t.disabled?"disabled":"static";return t.options.map((s,i)=>({option:s,key:i,state:e,width:0,height:0}))}static clearItemMeasurements(t){return t.map(e=>({...e,width:0,height:0}))}measureItems(){let t=[...this.state.items];const e=a.map(t,function(h){return u(M.findDOMNode(this.refs[h.key]))},this),s=a.invoke(e,"outerWidth"),i=a.invoke(e,"outerHeight"),{constraints:n,layout:d}=this.props;let r=null;n!=null&&n.width?r=a.max(s.concat(n.width)):d==="vertical"&&(r=a.max(s));let o=null;n!=null&&n.height?o=a.max(i.concat(n.height)):d==="horizontal"&&(o=a.max(i)),t=a.map(t,function(h,p){return h.width=r||s[p],h.height=o||i[p],h}),this.setState({items:t},()=>{this.props.onMeasure&&this.props.onMeasure({widths:s,heights:i})})}render(){var d,r;if(this.props.waitForTexRendererToLoad&&!this.state.texRendererLoaded){const{TeX:o}=L();return T(k,{children:[m(F,{}),m("div",{style:{display:"none"},children:m(o,{onRender:()=>this.setState({texRendererLoaded:!0}),children:"1"})})]})}const t=[],{layout:e}=this.props,s=C.css(l.sortable)+" perseus-sortable",i=((d=this.props.constraints)==null?void 0:d.width)||e==="vertical",n=((r=this.props.constraints)==null?void 0:r.height)||e==="horizontal";return a.each(this.state.items,function(o,h,p){const c=h===p.length-1,y=o.state==="static"||o.state==="disabled";let b;this.props.layout==="horizontal"?b="0 "+this.props.margin+"px 0 0":this.props.layout==="vertical"&&(b="0 0 "+this.props.margin+"px 0"),t.push(m(w,{content:o.option,state:o.state,ref:o.key,width:i?o.width:void 0,height:n?o.height:void 0,layout:e,includePadding:this.props.padding,margin:c&&y?0:b,endPosition:o.endPosition,linterContext:S(this.props.linterContext,"sortable"),onRender:this.remeasureItems,onMouseDown:this.onMouseDown.bind(this,o.key),onMouseMove:this.onMouseMove.bind(this,o.key),onMouseUp:this.onMouseUp.bind(this,o.key),onTouchMove:this.onMouseMove.bind(this,o.key),onTouchEnd:this.onMouseUp.bind(this,o.key),onTouchCancel:this.onMouseUp.bind(this,o.key),onAnimationEnd:this.onAnimationEnd.bind(this,o.key)},o.key)),(o.state==="dragging"||o.state==="animating")&&t.push(m(N,{ref:"placeholder_"+o.key,width:o.width,height:o.height,layout:e,margin:c?0:b},"placeholder_"+o.key))},this),m("ul",{className:s,children:t})}onMouseDown(t){const e=a.map(this.state.items,function(s){return s.key===t&&(s.state="dragging"),s});this.setState({items:e})}moveOptionToIndex(t,e){const{items:s}=this.state;if(e<0||e>s.length)throw new Error(`index ${e} out of bounds`);const i=a.clone(s),n=s.filter(r=>r.option===t)[0];if(n==null)throw new Error(`option ${t} not found`);const d=s.findIndex(r=>r.key===n.key);i.splice(d,1),i.splice(e,0,n),this.setState({items:i}),this.props.onChange&&this.props.onChange({})}onMouseMove(t){const e=u(M.findDOMNode(this.refs[t])),s=u(M.findDOMNode(this)),i=a.clone(this.state.items),n=a.findWhere(this.state.items,{key:t}),d=this.props.margin||0,r=a.indexOf(i,n);let o=0;if(i.splice(r,1),this.props.layout==="horizontal"){const h=e.offset().left-s.offset().left;let p=0,c;a.each(i,function(y){c=y.width,h>p+c/2&&(o+=1),p+=c+d})}else{const h=e.offset().top-s.offset().top;let p=0,c;a.each(i,function(y){c=y.height,h>p+c/2&&(o+=1),p+=c+d})}o!==r&&(i.splice(o,0,n),this.setState({items:i}))}onMouseUp(t){const e=requestAnimationFrame(()=>{const s=a.map(this.state.items,function(i){if(i.key===t){i.state="animating";const n=u(M.findDOMNode(this.refs["placeholder_"+t])),d=n.position(),r=U(n,d);i.endPosition=r}return i},this);this.setState({items:s}),this.props.onChange&&this.props.onChange({})});this.animationFrameRequest=e}onAnimationEnd(t){const e=a.map(this.state.items,function(s){return s.key===t&&(s.state="static"),s});this.setState({items:e})}getOptions(){return a.pluck(this.state.items,"option")}};g.defaultProps={layout:"horizontal",padding:!0,disabled:!1,constraints:{},onMeasure:function(){},margin:5,onChange:function(){},linterContext:D,waitForTexRendererToLoad:!0};let x=g;const l=C.StyleSheet.create({sortable:{boxSizing:"border-box",float:"left",padding:0,margin:0},card:{boxSizing:"border-box",background:"#fff",border:"1px solid #ddd",borderRadius:4,cursor:"pointer",minWidth:25,minHeight:44,padding:10,listStyleType:"none",userSelect:"none",touchAction:"none"},placeholder:{background:"#ddd",border:"1px solid #ccc"},draggable:{textAlign:"center"},horizontalCard:{float:"left",cursor:"ew-resize"},verticalCard:{maxWidth:"100%",cursor:"ns-resize"},unpaddedCard:{padding:0},dragging:{background:"#ffedcd",opacity:.8},disabled:{backgroundColor:"inherit",border:"1px solid transparent",cursor:"default"}});try{x.displayName="Sortable",x.__docgenInfo={description:"",displayName:"Sortable",props:{constraints:{defaultValue:{value:"{}"},description:"",name:"constraints",required:!1,type:{name:"{ width: number; height: number; } | Record<any, any>"}},disabled:{defaultValue:{value:"false"},description:"",name:"disabled",required:!1,type:{name:"boolean"}},layout:{defaultValue:{value:"Layout.HORIZONTAL"},description:"",name:"layout",required:!1,type:{name:"enum",value:[{value:'"horizontal"'},{value:'"vertical"'}]}},margin:{defaultValue:{value:"5"},description:"",name:"margin",required:!1,type:{name:"number"}},onChange:{defaultValue:{value:"function () {}"},description:"",name:"onChange",required:!1,type:{name:"(arg1: any) => void"}},onMeasure:{defaultValue:{value:"function () {}"},description:"",name:"onMeasure",required:!1,type:{name:"(arg1: { widths: readonly number[]; heights: readonly number[]; }) => void"}},padding:{defaultValue:{value:"true"},description:"",name:"padding",required:!1,type:{name:"boolean"}},linterContext:{defaultValue:{value:"PerseusLinter.linterContextDefault"},description:"",name:"linterContext",required:!1,type:{name:"LinterContextProps"}},options:{defaultValue:null,description:"",name:"options",required:!0,type:{name:"readonly string[]"}},waitForTexRendererToLoad:{defaultValue:{value:"true"},description:"",name:"waitForTexRendererToLoad",required:!1,type:{name:"boolean"}}}}}catch{}export{I as L,x as S};
