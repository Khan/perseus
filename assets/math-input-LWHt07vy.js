import{j as r,a as b}from"./jsx-runtime-BGVbfQ2Z.js";import"./prop-types-DjsU4y1t.js";import{c as k,g as p,k as f,m as v}from"./key-translator-M5qX6vAz.js";import{C,K as g}from"./index-S-YHCjun.js";import{c as x}from"./button-assets-K2ZoY3Yc.js";import{C as _}from"./index-4JcgVDnF.js";import{C as o,f as S}from"./index-hYQ6Pa3_.js";import{V as y}from"./index-eZ2N530f.js";import{_ as c}from"./index-V35CFGao.js";import{P as T,a as E}from"./index-rfwWDdTV.js";import{S as u}from"./index-SM3muJE2.js";import{l as w}from"./index-awljIyHI.js";import{c as V}from"./index-awCzqCwC.js";import{$ as F}from"./jquery-5v7aFUvu.js";import{r as B}from"./index-qhcEwEpg.js";import{_ as q}from"./index-default-4_ZsnO94.js";const K=(s,t)=>{let e=null;return(...a)=>{e&&clearTimeout(e),e=window.setTimeout(()=>{s(...a)},t)}},I={...f,FRAC:s=>{const t=s.latex();s.typedText("/"),s.latex()===t&&s.cmd("\\frac")}},d=class d extends B.Component{constructor(){super(...arguments),this.__mathFieldWrapperRef=null,this.__mathField=null,this.state={focused:!1,keypadOpen:this.props.buttonsVisible==="always",cursorContext:C.NONE},this.insert=t=>{const e=this.mathField(),a=I[t];if(a){a(e,t),e==null||e.focus();return}q(t).isFunction()?t(e):t[0]==="\\"?e==null||e.cmd(t).focus():e==null||e.write(t).focus(),e==null||e.focus()},this.mathField=()=>(!this.__mathField&&this.__mathFieldWrapperRef&&(this.__mathField=k(this.__mathFieldWrapperRef,t=>({...t,handlers:{edit:K(e=>{let a=e.latex();if(a=a.replace(/<>/g,"\\ne"),x(this.props.convertDotToTimes)){a=a.replace(/\\cdot/g,"\\times");const i=e.cursor()[v.L];i&&i.ctrlSeq==="\\cdot "&&(e.controller().backspace(),e.cmd("\\times"))}else a=a.replace(/\\times/g,"\\cdot");this.props.value!==a&&this.props.onChange(a),this.setState({cursorContext:p(e)})},100),enter:()=>{this.__mathFieldWrapperRef&&F(this.__mathFieldWrapperRef).submit()},upOutOf:e=>{e.typedText("^")}}}))),this.__mathField),this.focus=()=>{var t;(t=this.mathField())==null||t.focus(),this.setState({focused:!0})},this.blur=()=>this.setState({focused:!1}),this.handleKeypadPress=(t,e)=>{const a=f[t],i=this.mathField();i&&(a&&a(i,t),this.setState({cursorContext:p(i)})),e.type==="click"&&this.focus()}}componentDidMount(){var t;(t=this.mathField())==null||t.latex(this.props.value)}openKeypad(){this.props.buttonsVisible!=="never"&&this.setState({keypadOpen:!0})}closeKeypad(){this.setState({keypadOpen:!1})}render(){let t=V({"perseus-math-input":!0,"mq-editable-field":!0,"mq-math-mode":!0});return this.props.className&&(t=t+" "+this.props.className),r(y,{style:[n.outerWrapper,this.state.focused&&n.wrapperFocused,this.props.hasError&&n.wrapperError],children:b("div",{style:{display:"flex",padding:1},onClick:e=>{e.stopPropagation();const a=this.mathField();a&&this.setState({cursorContext:p(a)})},children:[r("span",{className:t,ref:e=>this.__mathFieldWrapperRef=e,"aria-label":this.props.labelText,onFocus:()=>this.focus(),onBlur:()=>this.blur()}),r(T,{opened:this.state.keypadOpen,onClose:()=>this.closeKeypad(),dismissEnabled:!0,content:()=>{var e;return r(E,{closeButtonVisible:!0,style:n.popoverContent,children:r(g,{onAnalyticsEvent:this.props.analytics.onAnalyticsEvent,extraKeys:this.props.extraKeys,onClickKey:this.handleKeypadPress,cursorContext:this.state.cursorContext,convertDotToTimes:this.props.convertDotToTimes,...this.props.keypadButtonSets??A((e=this.props)==null?void 0:e.buttonSets)})})},children:this.props.buttonsVisible==="never"?r(h,{hovered:!1,focused:!1,active:!1}):r(_,{"aria-label":this.state.keypadOpen?c("close math keypad"):c("open math keypad"),"aria-checked":this.state.keypadOpen,role:"switch",onClick:()=>this.state.keypadOpen?this.closeKeypad():this.openKeypad(),children:e=>r(h,{active:this.state.keypadOpen,...e})})})]})})}};d.defaultProps={value:"",convertDotToTimes:!1};let l=d;const h=({hovered:s,focused:t,active:e})=>{let a;switch(!0){case(t||e):a=o.white;break;case s:a=o.blue;break;default:a=o.offBlack;break}const i=e||t?n.iconActive:n.iconInactive;return r(y,{style:[n.iconContainer,i],children:r("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:a,viewBox:"0 0 256 256",children:r("path",{d:"M112,72a8,8,0,0,1-8,8H40a8,8,0,0,1,0-16h64A8,8,0,0,1,112,72Zm-8,104H80V152a8,8,0,0,0-16,0v24H40a8,8,0,0,0,0,16H64v24a8,8,0,0,0,16,0V192h24a8,8,0,0,0,0-16Zm48,0h64a8,8,0,0,0,0-16H152a8,8,0,0,0,0,16Zm64,16H152a8,8,0,0,0,0,16h64a8,8,0,0,0,0-16Zm-61.66-90.34a8,8,0,0,0,11.32,0L184,83.31l18.34,18.35a8,8,0,0,0,11.32-11.32L195.31,72l18.35-18.34a8,8,0,0,0-11.32-11.32L184,60.69,165.66,42.34a8,8,0,0,0-11.32,11.32L172.69,72,154.34,90.34A8,8,0,0,0,154.34,101.66Z"})})})},A=s=>{const t={};return s&&s.forEach(e=>{switch(e){case"advanced relations":t.advancedRelations=!0;break;case"basic relations":t.basicRelations=!0;break;case"basic+div":t.divisionKey=!0;break;case"logarithms":t.logarithms=!0;break;case"prealgebra":t.preAlgebra=!0;break;case"trig":t.trigonometry=!0;break}}),t},m={borderWidth:2,borderColor:o.blue,margin:-1},n=w.StyleSheet.create({iconContainer:{display:"flex",justifyContent:"center",height:"100%",padding:u.xxxSmall_4,borderRadius:1},iconInactive:{backgroundColor:o.offBlack8},iconActive:{backgroundColor:o.offBlack64},outerWrapper:{display:"inline-block",borderStyle:"solid",borderWidth:1,borderColor:o.offBlack50,borderRadius:3,background:o.white,":hover":m},wrapperFocused:m,wrapperError:{borderColor:o.red,background:S(o.red,.08),":hover":{borderColor:o.red}},popoverContent:{padding:0,paddingBottom:u.xxSmall_6,maxWidth:"initial"}});try{l.displayName="MathInput",l.__docgenInfo={description:"",displayName:"MathInput",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},value:{defaultValue:{value:""},description:"",name:"value",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"any"}},convertDotToTimes:{defaultValue:{value:"false"},description:"",name:"convertDotToTimes",required:!1,type:{name:"boolean"}},buttonSets:{defaultValue:null,description:"@deprecated Use `keypadButtonSets` instead. Maps to `keypadButtonSets`.\n@see keypadButtonSets",name:"buttonSets",required:!1,type:{name:"LegacyButtonSets"}},keypadButtonSets:{defaultValue:null,description:"Overrides deprecated `buttonSets` prop.",name:"keypadButtonSets",required:!1,type:{name:"KeypadButtonSets"}},labelText:{defaultValue:null,description:"",name:"labelText",required:!1,type:{name:"string"}},onFocus:{defaultValue:null,description:"",name:"onFocus",required:!1,type:{name:"(() => void)"}},onBlur:{defaultValue:null,description:"",name:"onBlur",required:!1,type:{name:"(() => void)"}},hasError:{defaultValue:null,description:"",name:"hasError",required:!1,type:{name:"boolean"}},extraKeys:{defaultValue:null,description:"",name:"extraKeys",required:!1,type:{name:'readonly ("PLUS" | "MINUS" | "NEGATIVE" | "TIMES" | "DIVIDE" | "DECIMAL" | "PERIOD" | "PERCENT" | "CDOT" | "EQUAL" | "NEQ" | "GT" | "LT" | "GEQ" | "LEQ" | "FRAC_INCLUSIVE" | "FRAC_EXCLUSIVE" | ... 96 more ... | "LOG_B")[]'}},buttonsVisible:{defaultValue:null,description:"Whether to show the keypad buttons.\nThe strings now misleading, but we keep them for backwards compatibility.\n- `focused` means that the keypad **appears on toggle, *off* by default**.\n- `always` means that the keypad **appears on toggle, *on* by default.**\n- `never` means that the keypad is **never shown**.",name:"buttonsVisible",required:!1,type:{name:"enum",value:[{value:'"always"'},{value:'"never"'},{value:'"focused"'}]}},analytics:{defaultValue:null,description:"",name:"analytics",required:!0,type:{name:"{ onAnalyticsEvent: AnalyticsEventHandlerFn; }"}}}}}catch{}export{l as M};
