import{j as d}from"./jsx-runtime-63Ea5SlK.js";import{U as k}from"./util-_iDv4tVD.js";import{G as M,m as p,S as _}from"./svg-image-1rx1Oqc_.js";import{_ as u,$ as h}from"./jquery-yG1GhClm.js";import{r as w}from"./index-6oxdNXpR.js";import{c as q}from"./asset-context-H6Iqp7Gi.js";import{i as x}from"./constants-iPV6vHZm.js";const C={url:null},G={fontStyle:"italic",fontWeight:"bold",fontSize:"32px",width:"100%",height:"100%",textAlign:"center",backgroundColor:"white",position:"absolute",zIndex:1,transition:"opacity .25s ease-in-out"},R={position:"relative",top:"25%"};function D(y,s){return Math.floor((y[1]-y[0])/s)}const v=class v extends w.Component{constructor(){super(...arguments),this.graphieDivRef=w.createRef(),this.reset=()=>{this._setupGraphie(!1)},this.graphie=()=>this._graphie,this.pointsFromNormalized=(s,e)=>{const n=this;return u.map(s,function(a){return u.map(a,function(i,o){const l=n.props.range[o];if(e)return l[0]+(l[1]-l[0])*i;const m=n.props.step[o],t=D(l,m),c=Math.round(i*t);return l[0]+m*c})})},this._setupGraphie=s=>{if(this._hasSetupGraphieThisUpdate)return;const e=this.graphieDivRef.current;h(e).empty();const n=this.props.labels.map(r=>k.unescapeMathMode(r)),a=this.props.range,i=this._graphie=M.createGraphie(e),o=this._getGridConfig();i.snap=this.props.snapStep,this.props.markings==="graph"?(i.graphInit({range:a,scale:p(o,r=>r.scale),axisArrows:"<->",labelFormat:function(r){return"\\small{"+r+"}"},gridStep:this.props.gridStep,tickStep:p(o,r=>r.tickStep),labelStep:1,unityLabels:p(o,r=>r.unityLabel),isMobile:this.props.isMobile}),i.label([0,a[1][1]],n[1],this.props.isMobile?"below right":"above"),i.label([a[0][1],0],n[0],this.props.isMobile?"above left":"right")):this.props.markings==="grid"?i.graphInit({range:a,scale:p(o,r=>r.scale),gridStep:this.props.gridStep,axes:!1,ticks:!1,labels:!1,isMobile:this.props.isMobile}):this.props.markings==="none"&&i.init({range:a,scale:p(o,r=>r.scale),isMobile:this.props.isMobile});const l=.5,m=0;let t;if(this.props.instructions){t=h("<div/>"),u.each(G,function(f,g){t.css(g,f)}),t.css("opacity",l);const r=h("<span/>",{text:this.props.instructions});u.each(R,function(f,g){r.css(g,f)}),t.append(r),h(e).append(t)}else t=void 0;const c=t||this.props.onMouseDown?u.bind(function(r){t&&(t.remove(),t=null),this.props.onMouseDown(r)},this):void 0,T=t?function(){t&&t.css("opacity",m)}:void 0,S=t?function(){t&&t.css("opacity",l)}:void 0;i.addMouseLayer({onClick:this.props.onClick,onMouseDown:c,onMouseOver:T,onMouseOut:S,onMouseMove:this.props.onMouseMove,allowScratchpad:!0,setDrawingAreaAvailable:this.props.setDrawingAreaAvailable}),this._updateProtractor(),this._updateRuler(),this._hasSetupGraphieThisUpdate=!0,!s&&this.props.onGraphieUpdated&&this.props.onGraphieUpdated(i)},this._getGridConfig=()=>p(this.props.step,(s,e)=>k.gridDimensionConfig(s,this.props.range[e],this.props.box[e],this.props.gridStep[e])),this._updateProtractor=()=>{if(this.protractor&&this.protractor.remove(),this.props.showProtractor){const s=this.pointsFromNormalized([[.5,.05]])[0];this.protractor=this._graphie.protractor(s)}},this._updateRuler=()=>{if(this.ruler&&this.ruler.remove(),this.props.showRuler){const s=this.pointsFromNormalized([[.5,.25]])[0],e=this._graphie.range[0][1]-this._graphie.range[0][0];this.ruler=this._graphie.ruler({center:s,label:this.props.rulerLabel,pixelsPerUnit:this._graphie.scale[0],ticksPerUnit:this.props.rulerTicks,units:Math.round(.8*e)})}},this.toJSON=()=>u.pick(this.props,"range","step","markings","labels","backgroundImage","showProtractor","showRuler","rulerLabel","rulerTicks","gridStep","snapStep")}componentDidMount(){this._setupGraphie(!0)}UNSAFE_componentWillReceiveProps(s){const e=["labels","range","step","markings","showProtractor","showRuler","rulerLabel","rulerTicks","gridStep","snapStep"],n=this;u.each(e,function(a){u.isEqual(n.props[a],s[a])||(n._shouldSetupGraphie=!0)})}componentDidUpdate(){this._hasSetupGraphieThisUpdate=!1,this._shouldSetupGraphie&&(this._setupGraphie(!1),this._shouldSetupGraphie=!1)}render(){let s;const e=this.props.backgroundImage;if(e.url){const n=this.props.box[0]/x.defaultBoxSize;s=d.jsx(q.Consumer,{children:({setAssetStatus:a})=>d.jsx(_,{src:e.url,width:e.width,height:e.height,scale:n,responsive:!1,setAssetStatus:a})})}else s=null;return d.jsxs("div",{className:"graphie-container above-scratchpad",style:{width:this.props.box[0],height:this.props.box[1]},onMouseOut:this.onMouseOut,onMouseOver:this.onMouseOver,onClick:this.onClick,children:[s,d.jsx("div",{className:"graphie",ref:this.graphieDivRef})]})}};v.defaultProps={labels:["x","y"],range:[[-10,10],[-10,10]],step:[1,1],gridStep:[1,1],snapStep:[.5,.5],markings:"graph",backgroundImage:C,showProtractor:!1,showRuler:!1,rulerLabel:"",rulerTicks:10,isMobile:!1};let b=v;b.__docgenInfo={description:"",methods:[{name:"reset",docblock:null,modifiers:[],params:[],returns:null},{name:"graphie",docblock:null,modifiers:[],params:[],returns:null},{name:"pointsFromNormalized",docblock:null,modifiers:[],params:[{name:"coordsList",optional:!1,type:null},{name:"noSnap",optional:!1,type:null}],returns:null},{name:"_setupGraphie",docblock:null,modifiers:[],params:[{name:"initialMount",optional:!1,type:null}],returns:null},{name:"_getGridConfig",docblock:null,modifiers:[],params:[],returns:null},{name:"_updateProtractor",docblock:null,modifiers:[],params:[],returns:null},{name:"_updateRuler",docblock:null,modifiers:[],params:[],returns:null},{name:"toJSON",docblock:null,modifiers:[],params:[],returns:null}],displayName:"Graph",props:{box:{required:!0,tsType:{name:"tuple",raw:"[number, number]",elements:[{name:"number"},{name:"number"}]},description:""},labels:{required:!1,tsType:{name:"ReadonlyArray",elements:[{name:"string"}],raw:"ReadonlyArray<string>"},description:"",defaultValue:{value:'["x", "y"]',computed:!1}},range:{required:!1,tsType:{name:"tuple",raw:"[Coord, Coord]",elements:[{name:"tuple",raw:"[number, number]",elements:[{name:"number"},{name:"number"}]},{name:"tuple",raw:"[number, number]",elements:[{name:"number"},{name:"number"}]}]},description:"",defaultValue:{value:`[
    [-10, 10],
    [-10, 10],
]`,computed:!1}},step:{required:!1,tsType:{name:"tuple",raw:"[number, number]",elements:[{name:"number"},{name:"number"}]},description:"",defaultValue:{value:"[1, 1]",computed:!1}},gridStep:{required:!1,tsType:{name:"tuple",raw:"[number, number]",elements:[{name:"number"},{name:"number"}]},description:"",defaultValue:{value:"[1, 1]",computed:!1}},snapStep:{required:!1,tsType:{name:"tuple",raw:"[number, number]",elements:[{name:"number"},{name:"number"}]},description:"",defaultValue:{value:"[0.5, 0.5]",computed:!1}},markings:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'"graph"',computed:!1}},backgroundImage:{required:!1,tsType:{name:"signature",type:"object",raw:`{
    // The URL of the image
    url: string | null | undefined;
    // The width of the image
    width?: number;
    // The height of the image
    height?: number;
    // The top offset of the image
    // NOTE: perseus_data.go says this is required, but nullable, even though
    // it isn't necessary at all.
    top?: number;
    // The left offset of the image
    // NOTE: perseus_data.go says this is required, but nullable, even though
    // it isn't necessary at all.
    left?: number;
    // The scale of the image
    // NOTE: perseus_data.go says this is required, but nullable, even though
    // it isn't necessary at all.
    // Yikes, production data as this as both a number (1) and string ("1")
    scale?: number | string;
    // The bottom offset of the image
    // NOTE: perseus_data.go says this is required, but nullable, even though
    // it isn't necessary at all.
    bottom?: number;
}`,signature:{properties:[{key:"url",value:{name:"union",raw:"string | null | undefined",elements:[{name:"string"},{name:"null"},{name:"undefined"}],required:!0}},{key:"width",value:{name:"number",required:!1}},{key:"height",value:{name:"number",required:!1}},{key:"top",value:{name:"number",required:!1}},{key:"left",value:{name:"number",required:!1}},{key:"scale",value:{name:"union",raw:"number | string",elements:[{name:"number"},{name:"string"}],required:!1}},{key:"bottom",value:{name:"number",required:!1}}]}},description:"",defaultValue:{value:`{
    url: null,
}`,computed:!1}},showProtractor:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},showRuler:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},rulerLabel:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'""',computed:!1}},rulerTicks:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"10",computed:!1}},instructions:{required:!1,tsType:{name:"string"},description:""},isMobile:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},onGraphieUpdated:{required:!1,tsType:{name:"signature",type:"function",raw:"(graphie: any) => void",signature:{arguments:[{type:{name:"any"},name:"graphie"}],return:{name:"void"}}},description:""},onClick:{required:!1,tsType:{name:"signature",type:"function",raw:"(Coord) => void",signature:{arguments:[{name:"Coord"}],return:{name:"void"}}},description:""},onMouseDown:{required:!1,tsType:{name:"signature",type:"function",raw:"(Coord) => void",signature:{arguments:[{name:"Coord"}],return:{name:"void"}}},description:""},onMouseMove:{required:!1,tsType:{name:"signature",type:"function",raw:"(Coord) => void",signature:{arguments:[{name:"Coord"}],return:{name:"void"}}},description:""},setDrawingAreaAvailable:{required:!1,tsType:{name:"signature",type:"function",raw:"(boolean) => void",signature:{arguments:[{name:"boolean"}],return:{name:"void"}}},description:""}}};export{b as G};
