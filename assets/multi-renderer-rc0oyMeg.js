import{a as Q}from"./version-akiLXZts.js";import{w as X}from"./article-renderer-8Bw0MV81.js";import{r as Y,i as Z,l as ee,R as L,p as U}from"./renderer-z9rWSR-h.js";import{j as a,a as f}from"./jsx-runtime-BGVbfQ2Z.js";import{l as x}from"./index-awljIyHI.js";import{r as c}from"./index-qhcEwEpg.js";import{_ as C}from"./index-default-4_ZsnO94.js";import{c as te}from"./asset-context-pmjKTqqL.js";import{P as G}from"./i18n-context-9-s9cJ--.js";import{D as $}from"./dependencies-fnqF3NiV.js";import{H as T}from"./hints-renderer-FaPMGqg5.js";import{o as ne,K as u}from"./svg-image-xT-AdWRe.js";import{A as re}from"./perseus-api-BF68z3pH.js";import{U as g}from"./util-WvQWLN3r.js";import{B as M}from"./button-group-eBTrRsKy.js";import{I as y}from"./inline-icon-MJBS_-2U.js";import{b as se,d as ie,e as ae,f as oe,c as le}from"./icon-paths-AuJwhOz7.js";import{l as R}from"./unit-uxf7imOh.js";import{P as m,E as p,L as ue}from"./perseus-error-OpXxk17X.js";const de="@khanacademy/perseus",pe="__lib_version__";Q(de,pe);const ce={major:0,minor:1};Y(X);const he=Z();he["::renderer::"]=ce;const me={onRendered:s=>{}},fe=c.createContext(me),{mapObject:ge}=ne,F=class F extends c.Component{constructor(e){super(e),this._handleFocusChange=(t,n)=>{t!=null?this._setCurrentFocus(t):this._onRendererBlur(n)},this.handleInteractWithWidget=t=>{var r,i;const n=C.difference(this.state.questionHighlightedWidgets,[t]);this.setState({questionCompleted:!1,questionHighlightedWidgets:n}),(i=(r=this.props.apiOptions)==null?void 0:r.interactionCallback)==null||i.call(r,this.questionRenderer.getUserInputForWidgets())},this.setAssetStatus=(t,n)=>{const r={...this.state.assetStatuses,[t]:n};this.setState({assetStatuses:r})},this.state={questionCompleted:!1,questionHighlightedWidgets:[],assetStatuses:{}},this._fullyRendered=!1}componentDidMount(){this._currentFocus=null,this._fullyRendered=!1}UNSAFE_componentWillReceiveProps(e){this.setState({questionHighlightedWidgets:[]})}componentDidUpdate(e,t){if(this.props.apiOptions.answerableCallback){const n=this.questionRenderer.emptyWidgets().length===0,{answerableCallback:r}=this.props.apiOptions;r&&r(n)}this._fullyRendered||Object.values(this.state.assetStatuses).every(Boolean)&&(this._fullyRendered=!0,this.props.onRendered(!0))}componentWillUnmount(){this.blurTimeoutID!=null&&(clearTimeout(this.blurTimeoutID),this.blurTimeoutID=null)}_setCurrentFocus(e){const{apiOptions:{isMobile:t,onFocusChange:n},keypadElement:r}=this.props,i=this._currentFocus;this._currentFocus=e;const l=this.getInputPaths(),o=this._currentFocus&&l.some(d=>g.inputPathsEqual(d,this._currentFocus));n!=null&&setTimeout(()=>{const d=r==null?void 0:r.getDOMNode(),v=d&&o?d.getBoundingClientRect().height:0;n(this._currentFocus,i,v,o&&this.questionRenderer.getDOMNodeForPath(e))},0),r&&t&&(o?r.activate():r.dismiss())}_onRendererBlur(e){const t=this._currentFocus;C.isEqual(e,t)&&(this.blurTimeoutID=setTimeout(()=>{C.isEqual(this._currentFocus,t)&&this._setCurrentFocus(null)},0))}_setWidgetProps(e,t,n){this.questionRenderer._setWidgetProps(e,t,n)}setInputValue(e,t,n){return this.questionRenderer.setInputValue(e,t,n)}focusPath(e){return this.questionRenderer.focusPath(e)}blurPath(e){return this.questionRenderer.blurPath(e)}getDOMNodeForPath(e){return this.questionRenderer.getDOMNodeForPath(e)}getGrammarTypeForPath(e){return this.questionRenderer.getGrammarTypeForPath(e)}getInputPaths(){return this.questionRenderer.getInputPaths()}focus(){return this.questionRenderer.focus()}blur(){this._currentFocus&&this.blurPath(this._currentFocus)}getNumHints(){return this.props.item.hints.length}scoreInput(){const e=this.questionRenderer.guessAndScore(),t=e[0],n=e[1],r=[t,[]],i=g.keScoreFromPerseusScore(n,r,this.questionRenderer.getSerializedState()),l=this.questionRenderer.emptyWidgets();return this.setState({questionCompleted:i.correct,questionHighlightedWidgets:l}),i}getWidgetIds(){return this.questionRenderer.getWidgetIds()}scoreWidgets(){const e=this.questionRenderer.scoreWidgets(),t=this.questionRenderer.getUserInputForWidgets(),n=this.questionRenderer.getSerializedState();return ge(e,(r,i)=>g.keScoreFromPerseusScore(r,t[i],n))}getSerializedState(){return{question:this.questionRenderer.getSerializedState(),hints:this.hintsRenderer.getSerializedState()}}restoreSerializedState(e,t){let n=2;const r=()=>{--n,t&&n===0&&t()};this.questionRenderer.restoreSerializedState(e.question,r),this.hintsRenderer.restoreSerializedState(e.hints,r)}showRationalesForCurrentlySelectedChoices(){this.questionRenderer.showRationalesForCurrentlySelectedChoices()}deselectIncorrectSelectedChoices(){this.questionRenderer.deselectIncorrectSelectedChoices()}render(){const e={...re.defaults,...this.props.apiOptions,onFocusChange:this._handleFocusChange},t={assetStatuses:this.state.assetStatuses,setAssetStatus:this.setAssetStatus},n=a(te.Provider,{value:t,children:a(L,{keypadElement:this.props.keypadElement,problemNum:this.props.problemNum,onInteractWithWidget:this.handleInteractWithWidget,highlightedWidgets:this.state.questionHighlightedWidgets,apiOptions:e,questionCompleted:this.state.questionCompleted,reviewMode:this.props.reviewMode,showSolutions:this.props.showSolutions,ref:i=>{i!=null&&(this.questionRenderer=i)},content:this.props.item.question.content,widgets:this.props.item.question.widgets,images:this.props.item.question.images,linterContext:U(this.props.linterContext,"question"),strings:this.context.strings,...this.props.dependencies})}),r=a(T,{hints:this.props.item.hints,hintsVisible:this.props.hintsVisible,apiOptions:e,ref:i=>this.hintsRenderer=i,linterContext:U(this.props.linterContext,"hints"),strings:this.context.strings});return a($.Provider,{value:this.props.dependencies,children:f("div",{children:[a("div",{children:n}),a("div",{className:e.isMobile?void 0:x.css(ye.hintsContainer),children:r})]})})}};F.contextType=G,F.defaultProps={apiOptions:{},linterContext:ee,onRendered:e=>{}};let b=F;const ye=x.StyleSheet.create({hintsContainer:{marginLeft:50}}),Ge=c.forwardRef((s,e)=>a(fe.Consumer,{children:({onRendered:t})=>a(b,{...s,onRendered:t,ref:e})}));try{b.displayName="ServerItemRenderer",b.__docgenInfo={description:"",displayName:"ServerItemRenderer",props:{apiOptions:{defaultValue:{value:"{} as any"},description:"",name:"apiOptions",required:!1,type:{name:"Readonly<{ isArticle?: boolean; onInputError?: ((widgetId: any, value: string, message?: string | null) => unknown) | undefined; onFocusChange?: ((newFocusPath: FocusPath, oldFocusPath: FocusPath, keypadHeight?: number | undefined, focusedElement?: HTMLElement | undefined) => unknown) | undef..."}},hintsVisible:{defaultValue:null,description:"",name:"hintsVisible",required:!1,type:{name:"number"}},item:{defaultValue:null,description:"",name:"item",required:!0,type:{name:"PerseusItem"}},linterContext:{defaultValue:{value:"PerseusLinter.linterContextDefault"},description:"",name:"linterContext",required:!1,type:{name:"LinterContextProps"}},problemNum:{defaultValue:null,description:"",name:"problemNum",required:!1,type:{name:"number"}},reviewMode:{defaultValue:null,description:"",name:"reviewMode",required:!1,type:{name:"boolean"}},keypadElement:{defaultValue:null,description:"",name:"keypadElement",required:!1,type:{name:"KeypadAPI | null"}},dependencies:{defaultValue:null,description:"",name:"dependencies",required:!0,type:{name:"PerseusDependenciesV2"}},showSolutions:{defaultValue:null,description:"",name:"showSolutions",required:!1,type:{name:"enum",value:[{value:'"none"'},{value:'"all"'},{value:'"selected"'}]}},onRendered:{defaultValue:{value:"(isRendered: boolean) => {}"},description:"",name:"onRendered",required:!1,type:{name:"(isRendered: boolean) => void"}}}}}catch{}try{serveritemrenderer.displayName="serveritemrenderer",serveritemrenderer.__docgenInfo={description:"",displayName:"serveritemrenderer",props:{apiOptions:{defaultValue:null,description:"",name:"apiOptions",required:!1,type:{name:"Readonly<{ isArticle?: boolean; onInputError?: ((widgetId: any, value: string, message?: string | null) => unknown) | undefined; onFocusChange?: ((newFocusPath: FocusPath, oldFocusPath: FocusPath, keypadHeight?: number | undefined, focusedElement?: HTMLElement | undefined) => unknown) | undef..."}},linterContext:{defaultValue:null,description:"",name:"linterContext",required:!1,type:{name:"LinterContextProps"}},problemNum:{defaultValue:null,description:"",name:"problemNum",required:!1,type:{name:"number"}},keypadElement:{defaultValue:null,description:"",name:"keypadElement",required:!1,type:{name:"KeypadAPI | null"}},reviewMode:{defaultValue:null,description:"",name:"reviewMode",required:!1,type:{name:"boolean"}},showSolutions:{defaultValue:null,description:"",name:"showSolutions",required:!1,type:{name:"enum",value:[{value:'"none"'},{value:'"all"'},{value:'"selected"'}]}},hintsVisible:{defaultValue:null,description:"",name:"hintsVisible",required:!1,type:{name:"number"}},item:{defaultValue:null,description:"",name:"item",required:!0,type:{name:"PerseusItem"}},dependencies:{defaultValue:null,description:"",name:"dependencies",required:!0,type:{name:"PerseusDependenciesV2"}}}}}catch{}const A=class A extends c.Component{render(){return a(M,{value:this.props.value,allowEmpty:!1,buttons:[{value:"",content:a("span",{children:"—"})},{value:"->",content:a("span",{children:"→"})}],onChange:this.props.onChange})}};A.defaultProps={value:""};let w=A;try{w.displayName="ArrowPicker",w.__docgenInfo={description:"",displayName:"ArrowPicker",props:{value:{defaultValue:{value:""},description:"",name:"value",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(values: { [key: string]: any; }, callback?: (() => unknown) | null | undefined, silent?: boolean | undefined) => unknown"}}}}}catch{}const _e=[u.BLACK,u.BLUE,u.GREEN,u.PINK,u.PURPLE,u.RED,u.GRAY],Se=[u.LIGHT_BLUE,u.LIGHT_ORANGE,u.LIGHT_PINK,u.LIGHT_GREEN,u.LIGHT_PURPLE,u.LIGHT_RED,"#fff"],O=class O extends c.Component{render(){const e=this.props.lightColors?Se:_e;return a(M,{value:this.props.value,allowEmpty:!1,buttons:C.map(e,t=>({value:t,content:f("span",{children:[a("span",{className:"colorpicker-circle",style:{background:t}})," "]})})),onChange:this.props.onChange})}};O.defaultProps={value:u.BLACK,lightColors:!1};let I=O;try{I.displayName="ColorPicker",I.__docgenInfo={description:"",displayName:"ColorPicker",props:{lightColors:{defaultValue:{value:"false"},description:"",name:"lightColors",required:!1,type:{name:"boolean"}},value:{defaultValue:{value:"black"},description:"",name:"value",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(values: { [key: string]: any; }, callback?: (() => unknown) | null | undefined, silent?: boolean | undefined) => unknown"}}}}}catch{}const z=class z extends c.Component{render(){return a(M,{value:this.props.value,allowEmpty:!1,buttons:[{value:"",content:a("span",{children:"—"})},{value:"-",content:a("span",{children:"–––"})},{value:"- ",content:a("span",{children:"–  –"})},{value:".",content:a("span",{children:"····"})},{value:". ",content:a("span",{children:"· · ·"})}],onChange:this.props.onChange})}};z.defaultProps={value:""};let P=z;try{P.displayName="DashPicker",P.__docgenInfo={description:"",displayName:"DashPicker",props:{value:{defaultValue:{value:""},description:"",name:"value",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(values: { [key: string]: any; }, callback?: (() => unknown) | null | undefined, silent?: boolean | undefined) => unknown"}}}}}catch{}const H=class H extends c.Component{constructor(e){super(e),this.toggle=t=>{t.preventDefault(),this.setState({show:!this.state.show})},this.state={show:e.initiallyVisible}}render(){return f("div",{className:"perseus-interaction-element",children:[f("a",{href:"#",className:"perseus-interaction-element-title "+(this.state.show?"open":"closed"),onClick:this.toggle,children:[this.state.show?a(y,{...se}):a(y,{...ie}),this.props.title]}),f("div",{className:"perseus-interaction-element-content "+(this.state.show?"enter":"leave"),children:[this.props.children,(this.props.onUp!=null||this.props.onDown!=null||this.props.onDelete!=null)&&f("div",{className:"edit-controls",children:[this.props.onUp!=null&&a("button",{onClick:this.props.onUp,children:a(y,{...ae})}),this.props.onDown!=null&&a("button",{onClick:this.props.onDown,children:a(y,{...oe})}),this.props.onDelete!=null&&a("button",{onClick:this.props.onDelete,children:a(y,{...le})})]})]})]})}};H.defaultProps={initiallyVisible:!1,title:"More"};let V=H;try{V.displayName="ElementContainer",V.__docgenInfo={description:"",displayName:"ElementContainer",props:{initiallyVisible:{defaultValue:{value:"false"},description:"",name:"initiallyVisible",required:!1,type:{name:"boolean"}},onDelete:{defaultValue:null,description:"",name:"onDelete",required:!1,type:{name:"(() => void | null)"}},onDown:{defaultValue:null,description:"",name:"onDown",required:!1,type:{name:"(() => void | null)"}},onUp:{defaultValue:null,description:"",name:"onUp",required:!1,type:{name:"(() => void | null)"}},title:{defaultValue:{value:"More"},description:"",name:"title",required:!1,type:{name:"string | ReactElement<any, string | JSXElementConstructor<any>>"}}}}}catch{}const be={type:"content"},B={type:"hint"},ve={type:"tags"},K=s=>({type:"array",elementShape:s}),Re=s=>({type:"object",shape:s}),Ce=K(B),h={content:be,hint:B,hints:Ce,tags:ve,arrayOf:K,shape:Re};class _{constructor(e,t,n){this.content=e,this.hint=t,this.tags=n,this.array=q}setContentMapper(e){return new _(e,this.hint,this.tags)}setHintMapper(e){return new _(this.content,e,this.tags)}setTagsMapper(e){return new _(this.content,this.hint,e)}setArrayMapper(e){return new W(this.content,this.hint,this.tags,e)}mapTree(e,t){return E(e,t,[],this)}}class W{constructor(e,t,n,r){this.content=e,this.hint=t,this.tags=n,this.array=r}setArrayMapper(e){return new W(this.content,this.hint,this.tags,e)}mapTree(e,t){return E(e,t,[],this)}}function q(s){return s}function S(){return new _(q,q,q)}function E(s,e,t,n){if(e.type==="content"){const r=s;return n.content(r,e,t)}if(e.type==="hint"){const r=s;return n.hint(r,e,t)}if(e.type==="tags"){const r=s;return n.tags(r,e,t)}if(e.type==="array"){const r=s;if(!Array.isArray(r))throw new m(`Invalid object of type "${typeof r}" found at path ${["<root>"].concat(t).join(".")}. Expected array.`,p.Internal);const i=e.elementShape,l=r.map((o,d)=>E(o,i,t.concat(d),n));return n.array(l,r,e,t)}if(e.type==="object"){const r=s;if(r&&typeof r!="object")throw new m(`Invalid object of type "${typeof r}" found at path ${["<root>"].concat(t).join(".")}. Expected "object" type.`,p.InvalidInput);const i=e.shape;if(!i)throw new m(`Unexpected shape ${JSON.stringify(e)} at path ${["<root>"].concat(t).join(".")}.`,p.InvalidInput);const l={};return Object.keys(i).forEach(o=>{if(!(o in r))throw new m(`Key "${o}" is missing from shape at path ${["<root>"].concat(t).join(".")}.`,p.InvalidInput);l[o]=E(r[o],i[o],t.concat(o),n)}),l}throw new m(`unexpected shape type ${e.type}`,p.InvalidInput)}function J(s){if(s.type==="content")return{__type:"content",content:"",images:{},widgets:{}};if(s.type==="hint")return{__type:"hint",replace:!1,content:"",images:{},widgets:{}};if(s.type==="tags")return[];if(s.type==="array")return[];if(s.type==="object"){const e=s.shape,t={};return Object.keys(e).forEach(n=>{t[n]=J(e[n])}),t}throw new m(`unexpected shape type ${s.type}`,p.InvalidInput)}function $e(s){return qe(J(s))}function Be(s,e,t){const n=D(s);S().setContentMapper(t).mapTree(n,e)}function Ke(s,e,t){const n=D(s);S().setHintMapper(t).mapTree(n,e)}function Je(s){const e=D(s);return N(e)}function N(s){if(Array.isArray(s))return s.length?typeof s[0]=="string"?h.tags:h.arrayOf(N(s[0])):h.arrayOf(h.content);if(typeof s=="object"&&(s.__type==="content"||s.__type==="item"))return h.content;if(typeof s=="object"&&s.__type==="hint")return h.hint;if(typeof s=="object"){const e={};return Object.keys(s).forEach(t=>{e[t]=N(s[t])}),h.shape(e)}throw new m(`unexpected multi-item node ${JSON.stringify(s)}`,p.InvalidInput)}function D(s){return s._multi}function qe(s){return{_multi:s}}const j=class j extends c.Component{constructor(e){super(e),this._handleSerializedStateUpdated=(t,n)=>{const{onSerializedStateUpdated:r}=this.props;if(r){const i=this._getSerializedState(this.props.serializedState);r(R(i).set(t,n).freeze())}},this.rendererDataTreeMapper=S().setContentMapper((t,n,r)=>this._makeContentRendererData(t,r)).setHintMapper(t=>this._makeHintRendererData(t)).setTagsMapper(t=>null),this.getRenderersMapper=S().setContentMapper(t=>t.makeRenderer()).setHintMapper(t=>t.makeRenderer()).setArrayMapper((t,n,r)=>this._annotateRendererArray(t,n,r)),this.state=this._tryMakeRendererState(this.props)}UNSAFE_componentWillReceiveProps(e){e.item!==this.props.item&&this.setState(this._tryMakeRendererState(e))}_tryMakeRendererState(e){try{return{rendererDataTree:this._makeRendererDataTree(e.item,e.shape),renderError:null}}catch(t){return ue.error("Error building tree state",p.Internal,{cause:t}),{rendererDataTree:null,renderError:t}}}_getRendererProps(){const{item:e,children:t,shape:n,serializedState:r,onSerializedStateUpdated:i,...l}=this.props;return{...l,strings:this.context.strings}}_makeContentRendererData(e,t){const n={ref:null,makeRenderer:null},r=o=>n.ref=o,i=o=>this._findWidgets(n,o),l=o=>this._handleSerializedStateUpdated(t,o);return n.makeRenderer=()=>a(L,{...this._getRendererProps(),...e,ref:r,findExternalWidgets:i,serializedState:this.props.serializedState?R(this.props.serializedState).get(t):null,onSerializedStateUpdated:l}),n}_makeHintRendererData(e){const t=n=>this._findWidgets({},n);return{hint:e,findExternalWidgets:t,ref:null,makeRenderer:()=>a(T,{...this._getRendererProps(),findExternalWidgets:t,hints:[e]})}}_makeRendererDataTree(e,t){const n=D(e);return this.rendererDataTreeMapper.mapTree(n,t)}_findWidgets(e,t){const n=[];return this._mapRenderers(r=>{e!==r&&r.ref&&n.push(...r.ref.findInternalWidgets(t))}),n}_mapRenderers(e){const{rendererDataTree:t}=this.state;return t?S().setContentMapper(e).setHintMapper(e).mapTree(t,this.props.shape):null}_scoreFromRef(e){if(!e)return null;const[t,n]=e.guessAndScore();let r;return e.getSerializedState&&(r=e.getSerializedState()),g.keScoreFromPerseusScore(n,t,r)}getScores(){return this._mapRenderers(e=>this._scoreFromRef(e.ref))}score(){const e=[],t=[],n=this._mapRenderers(i=>{var l;return i.ref?(i.ref.getSerializedState&&t.push(i.ref.getSerializedState()),e.push(i.ref.score()),(l=i.ref)==null?void 0:l.getUserInput()):null}),r=e.reduce(g.combineScores);return g.keScoreFromPerseusScore(r,n,t)}_getSerializedState(e){return this._mapRenderers((t,n,r)=>t.ref?t.ref.getSerializedState():e?R(e).get(r):null)}restoreSerializedState(e,t){let n=0;const r=()=>{n--,t&&n===0&&t()};this._mapRenderers((i,l,o)=>{var v;if(!i.ref)return;const d=R(e).get(o);d&&(n++,(v=i.ref)==null||v.restoreSerializedState(d,r))})}_annotateRendererArray(e,t,n){if(n.elementShape.type==="hint"){const r=t;e=[...e],e.firstN=i=>a(T,{...this._getRendererProps(),findExternalWidgets:r[0]?r[0].findExternalWidgets:void 0,hints:r.map(l=>l.hint),hintsVisible:i})}return e}_getRenderers(){return this.getRenderersMapper.mapTree(this.state.rendererDataTree,this.props.shape)}render(){return this.state.renderError?a("div",{className:x.css(we.error),children:this.context.strings.errorRendering({error:String(this.state.renderError)})}):a($.Provider,{value:this.props.dependencies,children:this.props.children({renderers:this._getRenderers()})})}};j.contextType=G;let k=j;const we=x.StyleSheet.create({error:{color:"red"}});try{k.displayName="MultiRenderer",k.__docgenInfo={description:"",displayName:"MultiRenderer",props:{item:{defaultValue:null,description:"",name:"item",required:!0,type:{name:"Item"}},shape:{defaultValue:null,description:"",name:"shape",required:!0,type:{name:"Shape"}},serializedState:{defaultValue:null,description:"",name:"serializedState",required:!1,type:{name:"any"}},onSerializedStateUpdated:{defaultValue:null,description:"",name:"onSerializedStateUpdated",required:!1,type:{name:"((state: any) => void)"}},onInteractWithWidget:{defaultValue:null,description:"",name:"onInteractWithWidget",required:!1,type:{name:"((id: string) => void)"}},apiOptions:{defaultValue:null,description:"",name:"apiOptions",required:!1,type:{name:"Readonly<{ isArticle?: boolean; onInputError?: ((widgetId: any, value: string, message?: string | null) => unknown) | undefined; onFocusChange?: ((newFocusPath: FocusPath, oldFocusPath: FocusPath, keypadHeight?: number | undefined, focusedElement?: HTMLElement | undefined) => unknown) | undef..."}},reviewMode:{defaultValue:null,description:"",name:"reviewMode",required:!1,type:{name:"boolean | null"}},dependencies:{defaultValue:null,description:"",name:"dependencies",required:!0,type:{name:"PerseusDependenciesV2"}}}}}catch{}export{w as A,I as C,P as D,V as E,k as M,b as S,Ke as a,$e as b,S as c,D as d,J as e,Be as f,ce as g,Je as i,Ge as r,h as s};
