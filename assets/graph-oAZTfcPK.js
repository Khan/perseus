import{j as v,a as _}from"./jsx-runtime-BGVbfQ2Z.js";import{U as M}from"./util-EDQcR2F7.js";import{G as w,m as u,S as x}from"./svg-image-13Ni6RTr.js";import{$ as c}from"./jquery-5v7aFUvu.js";import{r as q}from"./index-qhcEwEpg.js";import{R as G}from"./index-E09jvG0x.js";import{_ as l}from"./index-default-4_ZsnO94.js";import{c as C}from"./asset-context-pmjKTqqL.js";import{i as V}from"./constants-I_nlPaPx.js";const D={url:null},U={fontStyle:"italic",fontWeight:"bold",fontSize:"32px",width:"100%",height:"100%",textAlign:"center",backgroundColor:"white",position:"absolute",zIndex:1,transition:"opacity .25s ease-in-out"},I={position:"relative",top:"25%"};function P(m,r){return Math.floor((m[1]-m[0])/r)}const y=class y extends q.Component{constructor(){super(...arguments),this.reset=()=>{this._setupGraphie(!1)},this.graphie=()=>this._graphie,this.pointsFromNormalized=(r,e)=>{const o=this;return l.map(r,function(i){return l.map(i,function(a,n){const p=o.props.range[n];if(e)return p[0]+(p[1]-p[0])*a;const h=o.props.step[n],t=P(p,h),f=Math.round(a*t);return p[0]+h*f})})},this._setupGraphie=r=>{if(this._hasSetupGraphieThisUpdate)return;const e=G.findDOMNode(this.refs.graphieDiv);c(e).empty();const o=this.props.labels.map(s=>M.unescapeMathMode(s)),i=this.props.range,a=this._graphie=w.createGraphie(e),n=this._getGridConfig();a.snap=this.props.snapStep,this.props.markings==="graph"?(a.graphInit({range:i,scale:u(n,s=>s.scale),axisArrows:"<->",labelFormat:function(s){return"\\small{"+s+"}"},gridStep:this.props.gridStep,tickStep:u(n,s=>s.tickStep),labelStep:1,unityLabels:u(n,s=>s.unityLabel),isMobile:this.props.isMobile}),a.label([0,i[1][1]],o[1],this.props.isMobile?"below right":"above"),a.label([i[0][1],0],o[0],this.props.isMobile?"above left":"right")):this.props.markings==="grid"?a.graphInit({range:i,scale:u(n,s=>s.scale),gridStep:this.props.gridStep,axes:!1,ticks:!1,labels:!1,isMobile:this.props.isMobile}):this.props.markings==="none"&&a.init({range:i,scale:u(n,s=>s.scale),isMobile:this.props.isMobile});const p=.5,h=0;let t;if(this.props.instructions){t=c("<div/>"),l.each(U,function(g,b){t.css(b,g)}),t.css("opacity",p);const s=c("<span/>",{text:this.props.instructions});l.each(I,function(g,b){s.css(b,g)}),t.append(s),c(e).append(t)}else t=void 0;const f=t||this.props.onMouseDown?l.bind(function(s){t&&(t.remove(),t=null),this.props.onMouseDown(s)},this):void 0,S=t?function(){t&&t.css("opacity",h)}:void 0,k=t?function(){t&&t.css("opacity",p)}:void 0;a.addMouseLayer({onClick:this.props.onClick,onMouseDown:f,onMouseOver:S,onMouseOut:k,onMouseMove:this.props.onMouseMove,allowScratchpad:!0,setDrawingAreaAvailable:this.props.setDrawingAreaAvailable}),this._updateProtractor(),this._updateRuler(),this._hasSetupGraphieThisUpdate=!0,!r&&this.props.onGraphieUpdated&&this.props.onGraphieUpdated(a)},this._getGridConfig=()=>u(this.props.step,(r,e)=>M.gridDimensionConfig(r,this.props.range[e],this.props.box[e],this.props.gridStep[e])),this._updateProtractor=()=>{if(this.protractor&&this.protractor.remove(),this.props.showProtractor){const r=this.pointsFromNormalized([[.5,.05]])[0];this.protractor=this._graphie.protractor(r)}},this._updateRuler=()=>{if(this.ruler&&this.ruler.remove(),this.props.showRuler){const r=this.pointsFromNormalized([[.5,.25]])[0],e=this._graphie.range[0][1]-this._graphie.range[0][0];this.ruler=this._graphie.ruler({center:r,label:this.props.rulerLabel,pixelsPerUnit:this._graphie.scale[0],ticksPerUnit:this.props.rulerTicks,units:Math.round(.8*e)})}},this.toJSON=()=>l.pick(this.props,"range","step","markings","labels","backgroundImage","showProtractor","showRuler","rulerLabel","rulerTicks","gridStep","snapStep")}componentDidMount(){this._setupGraphie(!0)}UNSAFE_componentWillReceiveProps(r){const e=["labels","range","step","markings","showProtractor","showRuler","rulerLabel","rulerTicks","gridStep","snapStep"],o=this;l.each(e,function(i){l.isEqual(o.props[i],r[i])||(o._shouldSetupGraphie=!0)})}componentDidUpdate(){this._hasSetupGraphieThisUpdate=!1,this._shouldSetupGraphie&&(this._setupGraphie(!1),this._shouldSetupGraphie=!1)}render(){let r;const e=this.props.backgroundImage;if(e.url){const o=this.props.box[0]/V.defaultBoxSize;r=v(C.Consumer,{children:({setAssetStatus:i})=>v(x,{src:e.url,width:e.width,height:e.height,scale:o,responsive:!1,setAssetStatus:i})})}else r=null;return _("div",{className:"graphie-container above-scratchpad",style:{width:this.props.box[0],height:this.props.box[1]},onMouseOut:this.onMouseOut,onMouseOver:this.onMouseOver,onClick:this.onClick,children:[r,v("div",{className:"graphie",ref:"graphieDiv"})]})}};y.defaultProps={labels:["x","y"],range:[[-10,10],[-10,10]],step:[1,1],gridStep:[1,1],snapStep:[.5,.5],markings:"graph",backgroundImage:D,showProtractor:!1,showRuler:!1,rulerLabel:"",rulerTicks:10,isMobile:!1};let d=y;try{d.displayName="Graph",d.__docgenInfo={description:"",displayName:"Graph",props:{box:{defaultValue:null,description:"",name:"box",required:!0,type:{name:"[number, number]"}},labels:{defaultValue:{value:'["x", "y"]'},description:"",name:"labels",required:!1,type:{name:"readonly string[]"}},range:{defaultValue:{value:`[
            [-10, 10],
            [-10, 10],
        ]`},description:"",name:"range",required:!1,type:{name:"[Coord, Coord]"}},step:{defaultValue:{value:"[1, 1]"},description:"",name:"step",required:!1,type:{name:"[number, number]"}},gridStep:{defaultValue:{value:"[1, 1]"},description:"",name:"gridStep",required:!1,type:{name:"[number, number]"}},snapStep:{defaultValue:{value:"[0.5, 0.5]"},description:"",name:"snapStep",required:!1,type:{name:"[number, number]"}},markings:{defaultValue:{value:"graph"},description:"",name:"markings",required:!1,type:{name:"string"}},backgroundImage:{defaultValue:{value:`{
    url: null,
}`},description:"",name:"backgroundImage",required:!1,type:{name:"PerseusImageBackground"}},showProtractor:{defaultValue:{value:"false"},description:"",name:"showProtractor",required:!1,type:{name:"boolean"}},showRuler:{defaultValue:{value:"false"},description:"",name:"showRuler",required:!1,type:{name:"boolean"}},rulerLabel:{defaultValue:{value:""},description:"",name:"rulerLabel",required:!1,type:{name:"string"}},rulerTicks:{defaultValue:{value:"10"},description:"",name:"rulerTicks",required:!1,type:{name:"number"}},instructions:{defaultValue:null,description:"",name:"instructions",required:!1,type:{name:"string"}},isMobile:{defaultValue:{value:"false"},description:"",name:"isMobile",required:!1,type:{name:"boolean"}},onGraphieUpdated:{defaultValue:null,description:"",name:"onGraphieUpdated",required:!1,type:{name:"((graphie: any) => void)"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"((Coord: any) => void)"}},onMouseDown:{defaultValue:null,description:"",name:"onMouseDown",required:!1,type:{name:"((Coord: any) => void)"}},onMouseMove:{defaultValue:null,description:"",name:"onMouseMove",required:!1,type:{name:"((Coord: any) => void)"}},setDrawingAreaAvailable:{defaultValue:null,description:"",name:"setDrawingAreaAvailable",required:!1,type:{name:"((boolean: any) => void)"}}}}}catch{}export{d as G};
