import{j as p,a as pe}from"./jsx-runtime-BGVbfQ2Z.js";import{a as Te}from"./version-akiLXZts.js";import{P as L,E as x}from"./perseus-error-l3K_anoI.js";import{P as D}from"./index-tvtfaFq4.js";import{e as ot}from"./index-J2t_5nK1.js";import{c as _e}from"./index-dnMhQZ-1.js";import{$ as lt}from"./jquery-5v7aFUvu.js";import{r as W}from"./index-qhcEwEpg.js";import{R as Ie}from"./index-E09jvG0x.js";import{_ as c,d as ct}from"./index-default-4_ZsnO94.js";import{c as ye}from"./asset-context-pmjKTqqL.js";import{L as B,S as ut,o as dt}from"./svg-image-ImGr8npy.js";import{T as Oe}from"./tex-SwZEYYPF.js";import{Z as ht}from"./zoomable-QW77xrsT.js";import{Z as pt}from"./zoomable-tex-LJgLrbXQ.js";import{g as X,D as gt}from"./dependencies-fnqF3NiV.js";import{A as ft,C as ve}from"./perseus-api-BF68z3pH.js";import{L as mt}from"./lint-4QkP-VXi.js";import{U as re}from"./util-Kf-UsGkl.js";import{f as yt,t as vt,u as wt,z as bt}from"./constants-I_nlPaPx.js";class V{static parse(t){return new ge(t).parse()}match(t){throw new L("Selector subclasses must implement match()",x.NotAllowed)}toString(){return"Unknown selector class"}}class ge{constructor(t){t=t.trim().replace(/\s+/g," "),this.tokens=t.match(ge.TOKENS)||[],this.tokenIndex=0}nextToken(){return this.tokens[this.tokenIndex]||""}consume(){this.tokenIndex++}isIdentifier(){const t=this.tokens[this.tokenIndex][0];return t>="a"&&t<="z"||t>="A"&&t<="Z"}skipSpace(){for(;this.nextToken()===" ";)this.consume()}parse(){const t=this.parseTreeSelector();let e=this.nextToken();if(!e)return t;const r=[t];for(;e;){if(e===",")this.consume();else throw new we("Expected comma");r.push(this.parseTreeSelector()),e=this.nextToken()}return new kt(r)}parseTreeSelector(){this.skipSpace();let t=this.parseNodeSelector();for(;;){const e=this.nextToken();if(!e||e===",")break;if(e===" ")this.consume(),t=new St(t,this.parseNodeSelector());else if(e===">")this.consume(),t=new xt(t,this.parseNodeSelector());else if(e==="+")this.consume(),t=new Et(t,this.parseNodeSelector());else if(e==="~")this.consume(),t=new Rt(t,this.parseNodeSelector());else throw new we("Unexpected token: "+e)}return t}parseNodeSelector(){this.skipSpace();const t=this.nextToken();if(t==="*")return this.consume(),new _t;if(this.isIdentifier())return this.consume(),new It(t);throw new we("Expected node type")}}ge.TOKENS=/([a-zA-Z][\w-]*)|(\d+)|[^\s]|(\s(?=[a-zA-Z\*]))/g;class we extends Error{constructor(t){super(t)}}class kt extends V{constructor(t){super(),this.selectors=t}match(t){for(let e=0;e<this.selectors.length;e++){const i=this.selectors[e].match(t);if(i)return i}return null}toString(){let t="";for(let e=0;e<this.selectors.length;e++)t+=e>0?", ":"",t+=this.selectors[e].toString();return t}}class _t extends V{match(t){return[t.currentNode()]}toString(){return"*"}}class It extends V{constructor(t){super(),this.type=t}match(t){const e=t.currentNode();return e.type===this.type?[e]:null}toString(){return this.type}}class fe extends V{constructor(t,e){super(),this.left=t,this.right=e}}class St extends fe{constructor(t,e){super(t,e)}match(t){const e=this.right.match(t);if(e)for(t=t.clone();t.hasParent();){t.goToParent();const r=this.left.match(t);if(r)return r.concat(e)}return null}toString(){return this.left.toString()+" "+this.right.toString()}}class xt extends fe{constructor(t,e){super(t,e)}match(t){const e=this.right.match(t);if(e&&t.hasParent()){t=t.clone(),t.goToParent();const r=this.left.match(t);if(r)return r.concat(e)}return null}toString(){return this.left.toString()+" > "+this.right.toString()}}class Et extends fe{constructor(t,e){super(t,e)}match(t){const e=this.right.match(t);if(e&&t.hasPreviousSibling()){t=t.clone(),t.goToPreviousSibling();const r=this.left.match(t);if(r)return r.concat(e)}return null}toString(){return this.left.toString()+" + "+this.right.toString()}}class Rt extends fe{constructor(t,e){super(t,e)}match(t){const e=this.right.match(t);if(e)for(t=t.clone();t.hasPreviousSibling();){t.goToPreviousSibling();const r=this.left.match(t);if(r)return r.concat(e)}return null}toString(){return this.left.toString()+" ~ "+this.right.toString()}}const M=class M{constructor(t,e,r,i,s,a){if(!r&&!i)throw new L("Lint rules must have a selector or pattern",x.InvalidInput,{metadata:{name:t}});this.name=t||"unnamed rule",this.severity=e||M.Severity.BULK_WARNING,this.selector=r||M.DEFAULT_SELECTOR,this.pattern=i||null,typeof s=="function"?(this.lint=s,this.message=null):(this.lint=(...o)=>this._defaultLintFunction(...o),this.message=s),this.applies=a||function(){return!0}}static makeRule(t){return new M(t.name,t.severity,t.selector?V.parse(t.selector):null,M.makePattern(t.pattern),t.lint||t.message,t.applies)}check(t,e,r,i){const s=this.selector.match(e);if(!s)return null;let a;if(this.pattern?a=r.match(this.pattern):a=M.FakePatternMatch(r,r,0),!a)return null;try{const o=this.lint(e,r,s,a,i);return o?typeof o=="string"?{rule:this.name,severity:this.severity,message:o,start:0,end:r.length}:{rule:this.name,severity:this.severity,message:o.message,start:o.start,end:o.end}:null}catch(o){return{rule:"lint-rule-failure",message:`Exception in rule ${this.name}: ${o.message}
Stack trace:
${o.stack}`,start:0,end:r.length}}}_defaultLintFunction(t,e,r,i,s){return{message:this.message||"",start:i.index,end:i.index+i[0].length}}static makePattern(t){if(!t)return null;if(t instanceof RegExp)return t;if(t[0]==="/"){const e=t.lastIndexOf("/"),r=t.substring(1,e),i=t.substring(e+1);return new RegExp(r,i)}return new RegExp(t)}static FakePatternMatch(t,e,r){const i=[e];return i.index=r,i.input=t,i}};M.Severity={ERROR:1,WARNING:2,GUIDELINE:3,BULK_WARNING:4};let d=M;d.DEFAULT_SELECTOR=V.parse("text");const Nt=/\/\/([^\/]+)/;function Tt(n){if(!n)return"";const t=n.match(Nt);return t?t[1]:""}const Pt=d.makeRule({name:"absolute-url",severity:d.Severity.GUIDELINE,selector:"link, image",lint:function(n,t,e,r){const i=e[0].target,s=Tt(i);if(s==="khanacademy.org"||s.endsWith(".khanacademy.org"))return`Don't use absolute URLs:
When linking to KA content or images, omit the
https://www.khanacademy.org URL prefix.
Use a relative URL beginning with / instead.`}}),At=d.makeRule({name:"blockquoted-math",severity:d.Severity.WARNING,selector:"blockQuote math, blockQuote blockMath",message:`Blockquoted math:
math should not be indented.`}),Ct=d.makeRule({name:"blockquoted-widget",severity:d.Severity.WARNING,selector:"blockQuote widget",message:`Blockquoted widget:
widgets should not be indented.`}),Lt=d.makeRule({name:"double-spacing-after-terminal",severity:d.Severity.BULK_WARNING,selector:"paragraph",pattern:/[.!\?] {2}/i,message:`Use a single space after a sentence-ending period, or
any other kind of terminal punctuation.`}),Wt=d.makeRule({name:"extra-content-spacing",selector:"paragraph",pattern:/\s+$/,applies:function(n){return n.contentType==="article"},message:"No extra whitespace at the end of content blocks."}),Ot=d.makeRule({name:"heading-level-1",severity:d.Severity.WARNING,selector:"heading",lint:function(n,t,e,r){if(e[0].level===1)return`Don't use level-1 headings:
Begin headings with two or more # characters.`}}),Mt=d.makeRule({name:"heading-level-skip",severity:d.Severity.WARNING,selector:"heading ~ heading",lint:function(n,t,e,r){const i=e[1],s=e[0];if(i.level>s.level+1)return`Skipped heading level:
this heading is level ${i.level} but
the previous heading was level ${s.level}`}}),Ft=d.makeRule({name:"heading-sentence-case",severity:d.Severity.GUIDELINE,selector:"heading",pattern:/^\W*[a-z]/,message:`First letter is lowercase:
the first letter of a heading should be capitalized.`}),Dt={and:!0,nor:!0,but:!0,the:!0,for:!0};function Ut(n){const t=n[0];return t===t.toUpperCase()}const zt=d.makeRule({name:"heading-title-case",severity:d.Severity.GUIDELINE,selector:"heading",pattern:/[^\s:]\s+[A-Z]+[a-z]/,locale:"en",lint:function(n,t,e,r){let s=t.trim().split(/\s+/);if(s.shift(),s=s.filter(a=>a.length>2&&!Dt.hasOwnProperty(a)),s.length>=3&&s.every(a=>Ut(a)))return`Title-case heading:
This heading appears to be in title-case, but should be sentence-case.
Only capitalize the first letter and proper nouns.`}}),qt=d.makeRule({name:"image-alt-text",severity:d.Severity.WARNING,selector:"image",lint:function(n,t,e,r){const i=e[0];if(!i.alt||!i.alt.trim())return`Images should have alt text:
for accessibility, all images should have alt text.
Specify alt text inside square brackets after the !.`;if(i.alt.length<8)return`Images should have alt text:
for accessibility, all images should have descriptive alt text.
This image's alt text is only ${i.alt.length} characters long.`}}),$t=d.makeRule({name:"image-in-table",severity:d.Severity.BULK_WARNING,selector:"table image",message:`Image in table:
do not put images inside of tables.`}),jt=d.makeRule({name:"image-spaces-around-urls",severity:d.Severity.ERROR,selector:"image",lint:function(n,t,e,r,i){const a=e[0].target;if(i&&i.content){const o=i.content.indexOf(a);if(o===-1)return;if(i.content[o-1]!=="("||i.content[o+a.length]!==")")return`Whitespace before or after image url:
For images, don't include any space or newlines after '(' or before ')'.
Whitespace in image URLs causes translation difficulties.`}}}),Bt=d.makeRule({name:"image-widget",severity:d.Severity.WARNING,selector:"widget",lint:function(n,t,e,r,i){if(n.currentNode().widgetType!=="image")return;const s=i&&i.widgets&&i.widgets[n.currentNode().id];if(!s)return;const a=s.options.alt;if(!a)return`Images should have alt text:
for accessibility, all images should have a text description.
Add a description in the "Alt Text" box of the image widget.`;if(a.trim().length<8)return`Images should have alt text:
for accessibility, all images should have descriptive alt text.
This image's alt text is only ${a.trim().length} characters long.`;if(s.options.caption&&s.options.caption.match(/[^\\]\$/))return`No math in image captions:
Don't include math expressions in image captions.`}}),Vt=d.makeRule({name:"link-click-here",severity:d.Severity.WARNING,selector:"link",pattern:/click here/i,message:`Inappropriate link text:
Do not use the words "click here" in links.`}),Gt=d.makeRule({name:"long-paragraph",severity:d.Severity.GUIDELINE,selector:"paragraph",pattern:/^.{501,}/,lint:function(n,t,e,r){return`Paragraph too long:
This paragraph is ${t.length} characters long.
Shorten it to 500 characters or fewer.`}}),Ht=d.makeRule({name:"math-adjacent",severity:d.Severity.WARNING,selector:"blockMath+blockMath",message:`Adjacent math blocks:
combine the blocks between \\begin{align} and \\end{align}`}),Kt=d.makeRule({name:"math-align-extra-break",severity:d.Severity.WARNING,selector:"blockMath",pattern:/(\\{2,})\s*\\end{align}/,message:`Extra space at end of block:
Don't end an align block with backslashes`}),Jt=d.makeRule({name:"math-align-linebreaks",severity:d.Severity.WARNING,selector:"blockMath",pattern:/\\begin{align}[\s\S]*\\\\[\s\S]+\\end{align}/,lint:function(n,t,e,r){let i=r[0];for(;i.length;){const s=i.indexOf("\\\\");if(s===-1)return null;i=i.substring(s+2);const a=i.match(/^\s*\\\\\s*(?!\\\\)/);if(!a)return"Use four backslashes between lines of an align block";i=i.substring(a[0].length)}}}),Xt=d.makeRule({name:"math-empty",severity:d.Severity.WARNING,selector:"math, blockMath",pattern:/^$/,message:"Empty math: don't use $$ in your markdown."}),Zt=d.makeRule({name:"math-font-size",severity:d.Severity.GUIDELINE,selector:"math, blockMath",pattern:/\\(tiny|Tiny|small|large|Large|LARGE|huge|Huge|scriptsize|normalsize)\s*{/,message:`Math font size:
Don't change the default font size with \\Large{} or similar commands`}),Qt=d.makeRule({name:"math-frac",severity:d.Severity.GUIDELINE,selector:"math, blockMath",pattern:/\\frac[ {]/,message:"Use \\dfrac instead of \\frac in your math expressions."}),Yt=d.makeRule({name:"math-nested",severity:d.Severity.ERROR,selector:"math, blockMath",pattern:/\\text{[^$}]*\$[^$}]*\$[^}]*}/,message:`Nested math:
Don't nest math expressions inside \\text{} blocks`}),en=d.makeRule({name:"math-starts-with-space",severity:d.Severity.GUIDELINE,selector:"math, blockMath",pattern:/^\s*(~|\\qquad|\\quad|\\,|\\;|\\:|\\ |\\!|\\enspace|\\phantom)/,message:`Math starts with space:
math should not be indented. Do not begin math expressions with
LaTeX space commands like ~, \\;, \\quad, or \\phantom`}),tn=d.makeRule({name:"math-text-empty",severity:d.Severity.WARNING,selector:"math, blockMath",pattern:/\\text{\s*}/,message:"Empty \\text{} block in math expression"}),nn=d.makeRule({name:"math-without-dollars",severity:d.Severity.GUIDELINE,pattern:/\\\w+{[^}]*}|{|}/,message:`This looks like LaTeX:
did you mean to put it inside dollar signs?`}),rn=d.makeRule({name:"nested-lists",severity:d.Severity.WARNING,selector:"list list",message:`Nested lists:
nested lists are hard to read on mobile devices;
do not use additional indentation.`}),sn=d.makeRule({name:"table-missing-cells",severity:d.Severity.WARNING,selector:"table",lint:function(n,t,e,r){const i=e[0],s=i.header.length,a=i.cells.map(o=>o.length);for(let o=0;o<a.length;o++)if(a[o]!==s)return`Table rows don't match header:
The table header has ${s} cells, but
Row ${o+1} has ${a[o]} cells.`}}),an=d.makeRule({name:"unbalanced-code-delimiters",severity:d.Severity.ERROR,pattern:/[`~]+/,message:`Unbalanced code delimiters:
code blocks should begin and end with the same type and number of delimiters`}),on=d.makeRule({name:"unescaped-dollar",severity:d.Severity.ERROR,selector:"unescapedDollar",message:`Unescaped dollar sign:
Dollar signs must appear in pairs or be escaped as \\$`}),ln=d.makeRule({name:"widget-in-table",severity:d.Severity.BULK_WARNING,selector:"table widget",message:`Widget in table:
do not put widgets inside of tables.`}),cn=[Pt,At,Ct,Lt,Wt,Ot,Mt,Ft,zt,qt,$t,Vt,Gt,Ht,Kt,Jt,Xt,Zt,Qt,Yt,en,tn,rn,sn,on,ln,nn,an,jt,Bt];class ${constructor(t){this.root=t}static isNode(t){return t&&typeof t=="object"&&typeof t.type=="string"}static isTextNode(t){return $.isNode(t)&&t.type==="text"&&typeof t.content=="string"}traverse(t){this._traverse(this.root,new Pe(this.root),t)}_traverse(t,e,r){let i="";if($.isNode(t)){const s=t;e._containers.push(s),e._ancestors.push(s),typeof s.content=="string"&&(i=s.content),Object.keys(s).forEach(o=>{if(o==="type")return;const l=s[o];l&&typeof l=="object"&&(e._indexes.push(o),i+=this._traverse(l,e,r),e._indexes.pop())}),e._currentNode=e._ancestors.pop(),e._containers.pop(),r(s,e,i)}else if(Array.isArray(t)){const s=t;e._containers.push(s);let a=0;for(;a<s.length;)e._indexes.push(a),i+=this._traverse(s[a],e,r),a=e._indexes.pop()+1;e._containers.pop()}return i}}class Pe{constructor(t){this.root=t,this._currentNode=null,this._containers=new Z,this._indexes=new Z,this._ancestors=new Z}currentNode(){return this._currentNode||this.root}parent(){return this._ancestors.top()}ancestors(){return this._ancestors.values()}nextSibling(){const t=this._containers.top();if(!t||!Array.isArray(t))return null;const e=this._indexes.top();return t.length>e+1?t[e+1]:null}previousSibling(){const t=this._containers.top();if(!t||!Array.isArray(t))return null;const e=this._indexes.top();return e>0?t[e-1]:null}removeNextSibling(){const t=this._containers.top();if(t&&Array.isArray(t)){const e=this._indexes.top();if(t.length>e+1)return t.splice(e+1,1)[0]}return null}replace(...t){const e=this._containers.top();if(!e)throw new L("Can't replace the root of the tree",x.Internal);if(Array.isArray(e)){const r=this._indexes.top();e.splice(r,1,...t),this._indexes.pop(),this._indexes.push(r+t.length-1)}else{const r=this._indexes.top();t.length===0?delete e[r]:t.length===1?e[r]=t[0]:e[r]=t}}hasPreviousSibling(){return Array.isArray(this._containers.top())&&this._indexes.top()>0}goToPreviousSibling(){if(!this.hasPreviousSibling())throw new L("goToPreviousSibling(): node has no previous sibling",x.Internal);this._currentNode=this.previousSibling();const t=this._indexes.pop();this._indexes.push(t-1)}hasParent(){return this._ancestors.size()!==0}goToParent(){if(!this.hasParent())throw new L("goToParent(): node has no ancestor",x.NotAllowed);for(this._currentNode=this._ancestors.pop();this._containers.size()&&this._containers.top()[this._indexes.top()]!==this._currentNode;)this._containers.pop(),this._indexes.pop()}clone(){const t=new Pe(this.root);return t._currentNode=this._currentNode,t._containers=this._containers.clone(),t._indexes=this._indexes.clone(),t._ancestors=this._ancestors.clone(),t}equals(t){return this.root===t.root&&this._currentNode===t._currentNode&&this._containers.equals(t._containers)&&this._indexes.equals(t._indexes)&&this._ancestors.equals(t._ancestors)}}class Z{constructor(t){this.stack=t?t.slice(0):[]}push(t){this.stack.push(t)}pop(){return this.stack.pop()}top(){return this.stack[this.stack.length-1]}values(){return this.stack.slice(0)}size(){return this.stack.length}toString(){return this.stack.toString()}clone(){return new Z(this.stack)}equals(t){if(!t||!t.stack||t.stack.length!==this.stack.length)return!1;for(let e=0;e<this.stack.length;e++)if(this.stack[e]!==t.stack[e])return!1;return!0}}const un="@khanacademy/perseus-linter",dn="__lib_version__";Te(un,dn);const Gr=D.shape({contentType:D.string,highlightLint:D.bool,paths:D.arrayOf(D.string),stack:D.arrayOf(D.string)}),He={contentType:"",highlightLint:!1,paths:[],stack:[]},hn=cn.filter(n=>n.severity<d.Severity.BULK_WARNING);function pn(n,t,e,r=hn){const i=[],s=new $(n);s.traverse((l,u,h)=>{if($.isTextNode(l)){let g=u.nextSibling();for(;$.isTextNode(g);)l.content+=g.content,u.removeNextSibling(),g=u.nextSibling()}});let a=[],o=!1;return s.traverse((l,u,h)=>{const g=[],w=r.filter(f=>f.applies(t)),k=[...t.stack];k.push(l.type);const S={...t,stack:k.join(".")};if(w.forEach(f=>{const v=f.check(l,u,h,S);v&&((v.start||v.end)&&(v.target=h.substring(v.start,v.end)),i.push(v),e&&g.push(v))}),!!e&&(l.type==="table"?(a.length&&g.push(...a),o=!1,a=[]):o||(o=u.ancestors().some(f=>f.type==="table")),o&&g.length&&a.push(...g),g.length))if(g.sort((f,v)=>f.severity-v.severity),l.type!=="text"||g.length>1)u.replace({type:"lint",content:l,message:g.map(f=>f.message).join(`

`),ruleName:g[0].rule,blockHighlight:S.blockHighlight,insideTable:o,severity:g[0].severity});else{const f=l.content,v=g[0],E=v.start||0,T=v.end||f.length,F=f.substring(0,E),R=f.substring(E,T),te=f.substring(T),ne=[];F&&ne.push({type:"text",content:F}),ne.push({type:"lint",content:{type:"text",content:R},message:v.message,ruleName:v.rule,insideTable:o,severity:v.severity}),te&&ne.push({type:"text",content:te}),u.replace(...ne)}}),i}function gn(n,t){const e=n.stack||[];return{...n,stack:e.concat(t)}}const fn={activeDefinitionId:null,setActiveDefinitionId:()=>{}},Ke=W.createContext(fn);class ce extends W.Component{constructor(){super(...arguments),this.state={activeDefinitionId:null},this.setActiveDefinitionId=t=>{this.setState(e=>({activeDefinitionId:t}))}}render(){const{children:t}=this.props,{activeDefinitionId:e}=this.state,{setActiveDefinitionId:r}=this;return p(Ke.Provider,{value:{activeDefinitionId:e,setActiveDefinitionId:r},children:t})}}const Me=Ke.Consumer;try{ce.displayName="DefinitionProvider",ce.__docgenInfo={description:"",displayName:"DefinitionProvider",props:{}}}catch{}try{Me.displayName="DefinitionConsumer",Me.__docgenInfo={description:"",displayName:"DefinitionConsumer",props:{}}}catch{}class C extends W.Component{constructor(t){super(t),this.state={error:""}}componentDidCatch(t,e){var r,i;this.setState({error:t.toString()}),(i=(r=this.props).onError)==null||i.call(r,t,e),B.error("Unhandled Perseus error: "+t.message,x.Internal,{cause:t,loggedMetadata:{componentStack:e&&"componentStack"in e?e.componentStack:"componentStack not provided",...this.props.metadata}})}render(){return this.state.error?pe("svg",{height:"16",width:"16",viewBox:"0 0 16 16",role:"img",children:[p("title",{children:"Rendering Error!"}),p("path",{d:"m8 16c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm0-3c0.55 0 1-0.45 1-1s-0.45-1-1-1-1 0.45-1 1 0.45 1 1 1zm0-9c-0.55 0-1 0.45-1 1v4c0 0.55.45 1 1 1s1-0.45 1-1v-4c0-0.55-0.45-1-1-1z",fill:"#d92916",fillRule:"evenodd"})]}):this.props.children}}try{C.displayName="ErrorBoundary",C.__docgenInfo={description:"",displayName:"ErrorBoundary",props:{metadata:{defaultValue:null,description:"",name:"metadata",required:!1,type:{name:"Record<string, string>"}},onError:{defaultValue:null,description:"",name:"onError",required:!1,type:{name:"((error: Error, info: any) => void)"}}}}}catch{}function mn(){}class yn{constructor(t,e,r,i){this._track=s=>{this._tracked&&!this.setting||(this._tracked=!0,this.trackApi({type:this.widgetType,id:this.widgetID,...s}))},t?(this._tracked=!1,this.trackApi=t,this.widgetType=e,this.widgetID=r,this.setting=i,this.track=this._track):this.track=mn}}const vn="@khanacademy/simple-markdown",wn="__lib_version__";Te(vn,wn);var bn=/\r\n?/g,kn=/\t/g,_n=/\f/g,Je=function(n){return n.replace(bn,`
`).replace(_n,"").replace(kn,"    ")},Xe=function(n,t){var e=n||{};if(t!=null)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Ze=function(n,t){var e=Object.keys(n).filter(function(a){var o=n[a];if(o==null||o.match==null)return!1;var l=o.order;return(typeof l!="number"||!isFinite(l))&&typeof console<"u"&&console.warn("simple-markdown: Invalid order for rule `"+a+"`: "+String(l)),!0});e.sort(function(a,o){var l=n[a],u=n[o],h=l.order,g=u.order;if(h!==g)return h-g;var w=l.quality?0:1,k=u.quality?0:1;return w!==k?w-k:a<o?-1:a>o?1:0});var r,i=function(a,o){var l=[];for(o=o||r,r=o;a;){var u=null,h=null,g=null,w=NaN,k=0,S=e[0],f=n[S];do{var v=f.order,E=o.prevCapture==null?"":o.prevCapture[0],T=f.match(a,o,E);if(T){var F=f.quality?f.quality(T,o,E):0;F<=w||(u=S,h=f,g=T,w=F)}k++,S=e[k],f=n[S]}while(f&&(!g||f.order===v&&f.quality));if(h==null||g==null)throw new Error("Could not find a matching rule for the below content. The rule with highest `order` should always match content provided to it. Check the definition of `match` for '"+e[e.length-1]+`'. It seems to not match the following source:
`+a);if(g.index)throw new Error("`match` must return a capture starting at index 0 (the current parse index). Did you forget a ^ at the start of the RegExp?");var R=h.parse(g,i,o);if(Array.isArray(R))Array.prototype.push.apply(l,R);else{if(R==null||typeof R!="object")throw new Error(`parse() function returned invalid parse result: '${R}'`);R.type==null&&(R.type=u),l.push(R)}o.prevCapture=g,a=a.substring(o.prevCapture[0].length)}return l},s=function(a,o){return r=Xe(o,t),!r.inline&&!r.disableAutoBlockNewlines&&(a=a+`

`),r.prevCapture=null,i(Je(a),r)};return s},N=function(n){var t=function(e,r,i){return r.inline?n.exec(e):null};return t.regex=n,t},A=function(n){var t=function(e,r){return r.inline?null:n.exec(e)};return t.regex=n,t},Se=function(n){var t=function(e,r){return n.exec(e)};return t.regex=n,t},In=typeof Symbol=="function"&&Symbol.for&&Symbol.for("react.element")||60103,b=function(n,t,e){var r={$$typeof:In,type:n,key:t??void 0,ref:null,props:e,_owner:null};return r},_=function(n,t,e,r){e=e||{},r=typeof r<"u"?r:!0;var i="";for(var s in e){var a=e[s];Object.prototype.hasOwnProperty.call(e,s)&&a&&(i+=" "+j(s)+'="'+j(a)+'"')}var o="<"+n+i+">";return r?o+t+"</"+n+">":o},Sn={},J=function(n){if(n==null)return null;try{var t=new URL(n,"https://localhost").protocol;if(t.indexOf("javascript:")===0||t.indexOf("vbscript:")===0||t.indexOf("data:")===0)return null}catch{return null}return n},xn=/[<>&"']/g,En={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#x27;","/":"&#x2F;","`":"&#96;"},j=function(n){return String(n).replace(xn,function(t){return En[t]})},Rn=/\\([^0-9A-Za-z\s])/g,xe=function(n){return n.replace(Rn,"$1")},ue=function(n,t,e){var r=e.inline||!1;e.inline=!0;var i=n(t,e);return e.inline=r,i},Nn=function(n,t,e){var r=e.inline||!1;e.inline=!1;var i=n(t+`

`,e);return e.inline=r,i},ie=function(n,t,e){return{content:ue(t,n[1],e)}},be=function(){return{}},de="(?:[*+-]|\\d+\\.)",Qe="( *)("+de+") +",Fe=new RegExp("^"+Qe),Tn=new RegExp(Qe+"[^\\n]*(?:\\n(?!\\1"+de+` )[^\\n]*)*(
|$)`,"gm"),Ye=/\n{2,}$/,Pn=/^ (?= *`)|(` *) $/g,An=Ye,De=/ *\n+$/,Cn=new RegExp("^( *)("+de+`) [\\s\\S]+?(?:
{2,}(?! )(?!\\1`+de+` )\\n*|\\s*
*$)`),Ln=/(?:^|\n)( *)$/,se=function(){var n=/^ *\| *| *\| *$/g,t=/ *$/,e=/^ *-+: *$/,r=/^ *:-+: *$/,i=/^ *:-+ *$/,s=function(h){return e.test(h)?"right":r.test(h)?"center":i.test(h)?"left":null},a=function(h,g,w,k){k&&(h=h.replace(n,""));var S=h.trim().split("|");return S.map(s)},o=function(h,g,w,k){var S=w.inTable;w.inTable=!0;var f=g(h.trim(),w);w.inTable=S;var v=[[]];return f.forEach(function(E,T){E.type==="tableSeparator"?(!k||T!==0&&T!==f.length-1)&&v.push([]):(E.type==="text"&&(f[T+1]==null||f[T+1].type==="tableSeparator")&&(E.content=E.content.replace(t,"")),v[v.length-1].push(E))}),v},l=function(h,g,w,k){var S=h.trim().split(`
`);return S.map(function(f){return o(f,g,w,k)})},u=function(h){return function(g,w,k){k.inline=!0;var S=o(g[1],w,k,h),f=a(g[2],w,k,h),v=l(g[3],w,k,h);return k.inline=!1,{type:"table",header:S,align:f,cells:v}}};return{parseTable:u(!0),parseNpTable:u(!1),TABLE_REGEX:/^ *(\|.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/,NPTABLE_REGEX:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/}}(),ae="(?:\\[[^\\]]*\\]|[^\\[\\]]|\\](?=[^\\[]*\\]))*",Ue=`\\s*<?((?:\\([^)]*\\)|[^\\s\\\\]|\\\\.)*?)>?(?:\\s+['"]([\\s\\S]*?)['"])?\\s*`,Wn=/mailto:/i,ze=function(n,t,e){var r=(n[2]||n[1]).replace(/\s+/g," ").toLowerCase();if(t._defs&&t._defs[r]){var i=t._defs[r];e.target=i.target,e.title=i.title}return t._refs=t._refs||{},t._refs[r]=t._refs[r]||[],t._refs[r].push(e),e},y=0,ee={Array:{react:function(n,t,e){for(var r=e.key,i=[],s=0,a=0;s<n.length;s++,a++){e.key=""+s;var o=n[s];if(o.type==="text")for(o={type:"text",content:o.content};s+1<n.length&&n[s+1].type==="text";s++)o.content+=n[s+1].content;i.push(t(o,e))}return e.key=r,i},html:function(n,t,e){for(var r="",i=0,s=0;i<n.length;i++){var a=n[i];if(a.type==="text")for(a={type:"text",content:a.content};i+1<n.length&&n[i+1].type==="text";i++)a.content+=n[i+1].content;r+=t(a,e)}return r}},heading:{order:y++,match:A(/^ *(#{1,6})([^\n]+?)#* *(?:\n *)+\n/),parse:function(n,t,e){return{level:n[1].length,content:ue(t,n[2].trim(),e)}},react:function(n,t,e){return b("h"+n.level,e.key,{children:t(n.content,e)})},html:function(n,t,e){return _("h"+n.level,t(n.content,e))}},nptable:{order:y++,match:A(se.NPTABLE_REGEX),parse:se.parseNpTable,react:null,html:null},lheading:{order:y++,match:A(/^([^\n]+)\n *(=|-){3,} *(?:\n *)+\n/),parse:function(n,t,e){return{type:"heading",level:n[2]==="="?1:2,content:ue(t,n[1],e)}},react:null,html:null},hr:{order:y++,match:A(/^( *[-*_]){3,} *(?:\n *)+\n/),parse:be,react:function(n,t,e){return b("hr",e.key,{"aria-hidden":!0})},html:function(n,t,e){return'<hr aria-hidden="true">'}},codeBlock:{order:y++,match:A(/^(?:    [^\n]+\n*)+(?:\n *)+\n/),parse:function(n,t,e){var r=n[0].replace(/^    /gm,"").replace(/\n+$/,"");return{lang:void 0,content:r}},react:function(n,t,e){var r=n.lang?"markdown-code-"+n.lang:void 0;return b("pre",e.key,{children:b("code",null,{className:r,children:n.content})})},html:function(n,t,e){var r=n.lang?"markdown-code-"+n.lang:void 0,i=_("code",j(n.content),{class:r});return _("pre",i)}},fence:{order:y++,match:A(/^ *(`{3,}|~{3,}) *(?:(\S+) *)?\n([\s\S]+?)\n?\1 *(?:\n *)+\n/),parse:function(n,t,e){return{type:"codeBlock",lang:n[2]||void 0,content:n[3]}},react:null,html:null},blockQuote:{order:y++,match:A(/^( *>[^\n]+(\n[^\n]+)*\n*)+\n{2,}/),parse:function(n,t,e){var r=n[0].replace(/^ *> ?/gm,"");return{content:t(r,e)}},react:function(n,t,e){return b("blockquote",e.key,{children:t(n.content,e)})},html:function(n,t,e){return _("blockquote",t(n.content,e))}},list:{order:y++,match:function(n,t){var e=t.prevCapture==null?"":t.prevCapture[0],r=Ln.exec(e),i=t._list||!t.inline;return r&&i?(n=r[1]+n,Cn.exec(n)):null},parse:function(n,t,e){var r=n[2],i=r.length>1,s=i?+r:void 0,a=n[0].replace(An,`
`).match(Tn),o=!1,l=a.map(function(u,h){var g=Fe.exec(u),w=g?g[0].length:0,k=new RegExp("^ {1,"+w+"}","gm"),S=u.replace(k,"").replace(Fe,""),f=h===a.length-1,v=S.indexOf(`

`)!==-1,E=v||f&&o;o=E;var T=e.inline,F=e._list;e._list=!0;var R;E?(e.inline=!1,R=S.replace(De,`

`)):(e.inline=!0,R=S.replace(De,""));var te=t(R,e);return e.inline=T,e._list=F,te});return{ordered:i,start:s,items:l}},react:function(n,t,e){var r=n.ordered?"ol":"ul";return b(r,e.key,{start:n.start,children:n.items.map(function(i,s){return b("li",""+s,{children:t(i,e)})})})},html:function(n,t,e){var r=n.items.map(function(a){return _("li",t(a,e))}).join(""),i=n.ordered?"ol":"ul",s={start:n.start};return _(i,r,s)}},def:{order:y++,match:A(/^ *\[([^\]]+)\]: *<?([^\s>]*)>?(?: +["(]([^\n]+)[")])? *\n(?: *\n)*/),parse:function(n,t,e){var r=n[1].replace(/\s+/g," ").toLowerCase(),i=n[2],s=n[3];return e._refs&&e._refs[r]&&e._refs[r].forEach(function(a){a.target=i,a.title=s}),e._defs=e._defs||{},e._defs[r]={target:i,title:s},{def:r,target:i,title:s}},react:function(){return null},html:function(){return""}},table:{order:y++,match:A(se.TABLE_REGEX),parse:se.parseTable,react:function(n,t,e){var r=function(a){return n.align[a]==null?{}:{textAlign:n.align[a]}},i=n.header.map(function(a,o){return b("th",""+o,{style:r(o),scope:"col",children:t(a,e)})}),s=n.cells.map(function(a,o){return b("tr",""+o,{children:a.map(function(l,u){return b("td",""+u,{style:r(u),children:t(l,e)})})})});return b("table",e.key,{children:[b("thead","thead",{children:b("tr",null,{children:i})}),b("tbody","tbody",{children:s})]})},html:function(n,t,e){var r=function(l){return n.align[l]==null?"":"text-align:"+n.align[l]+";"},i=n.header.map(function(l,u){return _("th",t(l,e),{style:r(u),scope:"col"})}).join(""),s=n.cells.map(function(l){var u=l.map(function(h,g){return _("td",t(h,e),{style:r(g)})}).join("");return _("tr",u)}).join(""),a=_("thead",_("tr",i)),o=_("tbody",s);return _("table",a+o)}},newline:{order:y++,match:A(/^(?:\n *)*\n/),parse:be,react:function(n,t,e){return`
`},html:function(n,t,e){return`
`}},paragraph:{order:y++,match:A(/^((?:[^\n]|\n(?! *\n))+)(?:\n *)+\n/),parse:ie,react:function(n,t,e){return b("div",e.key,{className:"paragraph",children:t(n.content,e)})},html:function(n,t,e){var r={class:"paragraph"};return _("div",t(n.content,e),r)}},escape:{order:y++,match:N(/^\\([^0-9A-Za-z\s])/),parse:function(n,t,e){return{type:"text",content:n[1]}},react:null,html:null},tableSeparator:{order:y++,match:function(n,t){return t.inTable?/^ *\| */.exec(n):null},parse:function(){return{type:"tableSeparator"}},react:function(){return" | "},html:function(){return" &vert; "}},autolink:{order:y++,match:N(/^<([^: >]+:\/[^ >]+)>/),parse:function(n,t,e){return{type:"link",content:[{type:"text",content:n[1]}],target:n[1]}},react:null,html:null},mailto:{order:y++,match:N(/^<([^ >]+@[^ >]+)>/),parse:function(n,t,e){var r=n[1],i=n[1];return Wn.test(i)||(i="mailto:"+i),{type:"link",content:[{type:"text",content:r}],target:i}},react:null,html:null},url:{order:y++,match:N(/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/),parse:function(n,t,e){return{type:"link",content:[{type:"text",content:n[1]}],target:n[1],title:void 0}},react:null,html:null},link:{order:y++,match:N(new RegExp("^\\[("+ae+")\\]\\("+Ue+"\\)")),parse:function(n,t,e){var r={content:t(n[1],e),target:xe(n[2]),title:n[3]};return r},react:function(n,t,e){return b("a",e.key,{href:J(n.target),title:n.title,children:t(n.content,e)})},html:function(n,t,e){var r={href:J(n.target),title:n.title};return _("a",t(n.content,e),r)}},image:{order:y++,match:N(new RegExp("^!\\[("+ae+")\\]\\("+Ue+"\\)")),parse:function(n,t,e){var r={alt:n[1],target:xe(n[2]),title:n[3]};return r},react:function(n,t,e){return b("img",e.key,{src:J(n.target),alt:n.alt,title:n.title})},html:function(n,t,e){var r={src:J(n.target),alt:n.alt,title:n.title};return _("img","",r,!1)}},reflink:{order:y++,match:N(new RegExp("^\\[("+ae+")\\]\\s*\\[([^\\]]*)\\]")),parse:function(n,t,e){return ze(n,e,{type:"link",content:t(n[1],e)})},react:null,html:null},refimage:{order:y++,match:N(new RegExp("^!\\[("+ae+")\\]\\s*\\[([^\\]]*)\\]")),parse:function(n,t,e){return ze(n,e,{type:"image",alt:n[1]})},react:null,html:null},em:{order:y,match:N(new RegExp("^\\b_((?:__|\\\\[\\s\\S]|[^\\\\_])+?)_\\b|^\\*(?=\\S)((?:\\*\\*|\\\\[\\s\\S]|\\s+(?:\\\\[\\s\\S]|[^\\s\\*\\\\]|\\*\\*)|[^\\s\\*\\\\])+?)\\*(?!\\*)")),quality:function(n){return n[0].length+.2},parse:function(n,t,e){return{content:t(n[2]||n[1],e)}},react:function(n,t,e){return b("em",e.key,{children:t(n.content,e)})},html:function(n,t,e){return _("em",t(n.content,e))}},strong:{order:y,match:N(/^\*\*((?:\\[\s\S]|[^\\])+?)\*\*(?!\*)/),quality:function(n){return n[0].length+.1},parse:ie,react:function(n,t,e){return b("strong",e.key,{children:t(n.content,e)})},html:function(n,t,e){return _("strong",t(n.content,e))}},u:{order:y++,match:N(/^__((?:\\[\s\S]|[^\\])+?)__(?!_)/),quality:function(n){return n[0].length},parse:ie,react:function(n,t,e){return b("u",e.key,{children:t(n.content,e)})},html:function(n,t,e){return _("u",t(n.content,e))}},del:{order:y++,match:N(/^~~(?=\S)((?:\\[\s\S]|~(?!~)|[^\s~\\]|\s(?!~~))+?)~~/),parse:ie,react:function(n,t,e){return b("del",e.key,{children:t(n.content,e)})},html:function(n,t,e){return _("del",t(n.content,e))}},inlineCode:{order:y++,match:N(/^(`+)([\s\S]*?[^`])\1(?!`)/),parse:function(n,t,e){return{content:n[2].replace(Pn,"$1")}},react:function(n,t,e){return b("code",e.key,{children:n.content})},html:function(n,t,e){return _("code",j(n.content))}},br:{order:y++,match:Se(/^ {2,}\n/),parse:be,react:function(n,t,e){return b("br",e.key,Sn)},html:function(n,t,e){return"<br>"}},text:{order:y++,match:Se(/^[\s\S]+?(?=[^0-9A-Za-z\s\u00c0-\uffff]|\n\n| {2,}\n|\w+:\S|$)/),parse:function(n,t,e){return{content:n[0]}},react:function(n,t,e){return n.content},html:function(n,t,e){return j(n.content)}}},On=function(n,t){!t&&typeof console<"u"&&console.warn("simple-markdown ruleOutput should take 'react' or 'html' as the second argument.");var e=function(r,i,s){return n[r.type][t](r,i,s)};return e},Mn=function(n){var t=function(e,r){if(r=r||{},Array.isArray(e)){for(var i=r.key,s=[],a=null,o=0;o<e.length;o++){r.key=""+o;var l=t(e[o],r);typeof l=="string"&&typeof a=="string"?(a=a+l,s[s.length-1]=a):(s.push(l),a=l)}return r.key=i,s}else return n(e,t,r)};return t},Fn=function(n){var t=function(e,r){return r=r||{},Array.isArray(e)?e.map(function(i){return t(i,r)}).join(""):n(e,t,r)};return t},Ae=function(n,t,e={}){if(!t)throw new Error("simple-markdown: outputFor: `property` must be defined. if you just upgraded, you probably need to replace `outputFor` with `reactFor`");var r,i=n.Array||ee.Array,s=i[t];if(!s)throw new Error("simple-markdown: outputFor: to join nodes of type `"+t+"` you must provide an `Array:` joiner rule with that type, Please see the docs for details on specifying an Array rule.");var a=s,o=function(u,h){return h=h||r,r=h,Array.isArray(u)?a(u,o,h):n[u.type][t](u,o,h)},l=function(u,h){return r=Xe(h,e),o(u,r)};return l},me=Ze(ee),Ce=function(n,t){return t=t||{},t.inline=!1,me(n,t)},Dn=function(n,t){return t=t||{},t.inline=!0,me(n,t)},qe=function(n,t){var e=Ye.test(n);return t=t||{},t.inline=!e,me(n,t)},Ee=Ae(ee,"react"),et=Ae(ee,"html"),tt=function(n,t){return Ee(Ce(n,t),t)},Un=function(n,t){return et(Ce(n,t),t)},zn=function(n){var t={};for(var e in n)e!=="source"&&Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e]);return t.children=tt(n.source),b("div",null,t)},m={defaultRules:ee,parserFor:Ze,outputFor:Ae,inlineRegex:N,blockRegex:A,anyScopeRegex:Se,parseInline:ue,parseBlock:Nn,markdownToReact:tt,markdownToHtml:Un,ReactMarkdown:zn,defaultBlockParse:Ce,defaultInlineParse:Dn,defaultImplicitParse:qe,defaultReactOutput:Ee,defaultHtmlOutput:et,preprocess:Je,sanitizeText:j,sanitizeUrl:J,unescapeUrl:xe,htmlTag:_,reactElement:b,defaultRawParse:me,ruleOutput:On,reactFor:Mn,htmlFor:Fn,defaultParse:function(...n){return typeof console<"u"&&console.warn("defaultParse is deprecated, please use `defaultImplicitParse`"),qe.apply(null,n)},defaultOutput:function(...n){return typeof console<"u"&&console.warn("defaultOutput is deprecated, please use `defaultReactOutput`"),Ee.apply(null,n)}};const qn={fence:{match:m.defaultRules.fence.match,order:1,parse:(n,t,e)=>({type:"codeBlock",lang:n[2]||void 0,content:n[3]})},paragraph:{match:m.defaultRules.paragraph.match,order:2,parse:(n,t,e)=>({content:n[1]})}},$n=m.parserFor(qn),jn=n=>{const t=n.replace(/^\n\s*\n/,"")+`

`;return $n(t,{inline:!1}).map(e=>e.content)},Bn=n=>n.join(`

`),$e={parseToArray:jn,joinFromArray:Bn},Vn="@khanacademy/pure-markdown",Gn="__lib_version__";Te(Vn,Gn);const Hn=/^\[\[\u2603 (([a-z-]+) ([0-9]+))\]\]/,nt=(n,t,e)=>{const r=n.length;let i=0;if(e){if(t.inline)return null;for(;i<r&&n[i]===" ";)i++}if(!(i<r&&n[i]==="$"))return null;i++;const s=i;let a=0;for(;i<r;){const o=n[i];if(o==="\\")i++;else if(a<=0&&o==="$"){let l=i+1;if(e){const u=/^(?: *\n){2,}/.exec(n.slice(l));l=u?l+u[0].length:null}return l?[n.substring(0,l),n.substring(s,i)]:null}else if(o==="{")a++;else if(o==="}")a--;else if(o===`
`&&n[i-1]===`
`)return null;i++}return null},Kn=(n,t)=>nt(n,t,!1),Jn=(n,t)=>nt(n,t,!0),Xn=new RegExp("^\\|\\| +(.*) +\\|\\| *\\n("+m.defaultRules.nptable.match.regex.source.substring(1)+")"),Zn=m.blockRegex(/^(crwdns.*)\n\s*\n/),P={...m.defaultRules,columns:{order:-2,match:m.blockRegex(/^([\s\S]*\n\n)={5,}\n\n([\s\S]*)/),parse:(n,t,e)=>({col1:t(n[1],e),col2:t(n[2],e)})},crowdinId:{order:-1,match:(n,t,e)=>t.isJipt?Zn(n,t,e):null,parse:(n,t,e)=>({id:n[1]})},titledTable:{order:m.defaultRules.nptable.order-.5,match:m.blockRegex(Xn),parse:(n,t,e)=>{const r=m.parseInline(t,n[1],e),i=n.slice(2),s=m.defaultRules.nptable.parse(i,t,e);return{title:r,table:s}}},widget:{order:m.defaultRules.link.order-.75,match:m.inlineRegex(Hn),parse:(n,t,e)=>({id:n[1],widgetType:n[2]})},blockMath:{order:m.defaultRules.codeBlock.order+.5,match:Jn,parse:(n,t,e)=>({content:n[1]})},math:{order:m.defaultRules.link.order-.25,match:Kn,parse:(n,t,e)=>({content:n[1]})},unescapedDollar:{order:m.defaultRules.link.order-.24,match:m.inlineRegex(/^(?!\\)\$/),parse:(n,t,e)=>({})},fence:{...m.defaultRules.fence,parse:(n,t,e)=>{const r=m.defaultRules.fence.parse(n,t,e);return r.lang==="alt"?{type:"codeBlock",lang:"alt",content:t(r.content+`

`,e)}:r}},blockQuote:{...m.defaultRules.blockQuote,match:m.blockRegex(/^ *>[^\n]+(\n( *>)?[^\n]+)*\n{2,}/)},lint:{order:1e3,match:n=>null,parse:(n,t,e)=>({})}};m.parserFor(P);const Q={...P,columns:{...P.columns,react:(n,t,e)=>pe("div",{className:"perseus-two-columns",children:[p("div",{className:"perseus-column",children:p("div",{className:"perseus-column-content",children:t(n.col1,e)})}),p("div",{className:"perseus-column",children:p("div",{className:"perseus-column-content",children:t(n.col2,e)})})]},e.key)},crowdinId:{...P.crowdinId,react:(n,t,e)=>n.id},table:{...P.table,react:function(n,t,e){const r=m.defaultRules.table.react(n,t,e);return e.isMobile?W.cloneElement(r,{tabIndex:0}):r}},titledTable:{...P.titledTable,react:(n,t,e)=>{var i;let r;if(!n.table)r="//invalid table//";else if(n.table.type==="lint")((i=n.table.content)==null?void 0:i.type)==="table"?r=Q.lint.react({...n.table,content:{...n,table:n.table.content}},t,{...e,unwrapTitledTableContents:!0}):r=Q.lint.react(n.table,t,e);else{const s=m.defaultRules.table.react(n.table,t,e),a=p("caption",{className:"perseus-table-title",children:t(n.title,e)},"caption");r=W.cloneElement(s,null,[a,...s.props.children])}return e.unwrapTitledTableContents?r:p("div",{className:"perseus-titled-table",children:r},e.key)}},widget:{...P.widget,react:(n,t,e)=>p("em",{children:`[Widget: ${n.id}]`},e.key)},blockMath:{...P.blockMath,react:(n,t,e)=>{const{TeX:r}=X();return p(r,{children:n.content},e.key)}},math:{...P.math,react:(n,t,e)=>{const{TeX:r}=X();return p(r,{children:n.content},e.key)}},unescapedDollar:{...P.unescapedDollar,react:(n,t,e)=>"$"},link:{...P.link,react:function(n,t,e){const r=m.defaultRules.link.react(n,t,e),i=r.props.href;let s=null;(i?i.match(/https?:\/\/[^\/]*khanacademy.org|^\//):!1)||(s="noopener noreferrer");const o={...r.props,target:"_blank",href:i,rel:s};return e.baseElements&&e.baseElements.Link?e.baseElements.Link(o):W.cloneElement(r,o)}},codeBlock:{...P.codeBlock,react:(n,t,e)=>n.lang==="alt"?p("div",{className:"perseus-markdown-alt perseus-sr-only",children:t(n.content,e)},e.key):m.defaultRules.codeBlock.react(n,t,e)},lint:{...P.lint,react:(n,t,e)=>p(mt,{message:n.message,ruleName:n.ruleName,inline:Qn(n.content),blockHighlight:n.blockHighlight,insideTable:n.insideTable,severity:n.severity,children:t(n.content,e)})}};function Qn(n){return!!(n&&n.type&&Yn.hasOwnProperty(n.type))}const Yn={text:!0,math:!0,unescapedDollar:!0,link:!0,img:!0,strong:!0,u:!0,em:!0,del:!0,code:!0},rt=m.parserFor(Q),it=(n,t)=>{const e=n+`

`;return rt(e,{...t,inline:!1})},er=(n,t)=>rt(n,{...t,inline:!0}),O=(n,t)=>{c.isArray(n)?c.each(n,e=>O(e,t)):c.isObject(n)&&(t(n),n.type==="table"?(O(n.header,t),O(n.cells,t)):n.type==="list"?O(n.items,t):n.type==="titledTable"?O(n.table,t):n.type==="columns"?(O(n.col1,t),O(n.col2,t)):c.isArray(n.content)&&O(n.content,t))},Re=n=>{if(c.isArray(n))return c.flatten(c.map(n,Re));if(n.content&&c.isString(n.content))return n.type.toLowerCase().indexOf("code")!==-1?["",n.content,""]:[n.content.replace(/\s+/g," ")];const t=c.chain(n).values().flatten().filter(r=>r!=null&&c.has(r,"type")).value();if(!t.length)return[];const e=Re(t);if(n.type==="paragraph"&&e.length){e[0]=e[0].replace(/^\s+/,"");const r=e.length-1;e[r]=e[r].replace(/\s+$/,"")}return e},tr=n=>{const t=it(n);return Re(t).join("").length},q={characterCount:tr,traverseContent:O,parse:it,parseInline:er,reactFor:m.reactFor,ruleOutput:m.ruleOutput(Q,"react"),basicOutput:m.reactFor(m.ruleOutput(Q,"react")),sanitizeUrl:m.sanitizeUrl};class Ne extends W.Component{render(){const t=this.props.className?"paragraph "+this.props.className:"paragraph";return p("div",{className:this.props.inline?this.props.className??void 0:t,"data-perseus-component-index":this.props.translationIndex,"data-perseus-paragraph-index":this.props.paragraphIndex,children:this.props.children})}}try{Ne.displayName="QuestionParagraph",Ne.__docgenInfo={description:"",displayName:"QuestionParagraph",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string | null"}},translationIndex:{defaultValue:null,description:"",name:"translationIndex",required:!0,type:{name:"number"}},paragraphIndex:{defaultValue:null,description:"",name:"paragraphIndex",required:!1,type:{name:"number"}},inline:{defaultValue:null,description:"",name:"inline",required:!1,type:{name:"boolean"}}}}}catch{}const nr=1e3;class rr{constructor(){this.previousContent=null,this.runLinter=ct((t,e)=>{if(!(typeof KA>"u")&&t!==this.previousContent){if(this.previousContent=t,t===""){e([]);return}fetch("/api/internal/translations/lint_poentry?preview=1&lang=en",{headers:{"Content-Type":"application/json"},body:JSON.stringify({msgid:t,msgstr:t,format:"perseus_text",filename:""}),method:"POST"}).then(r=>r.status>=400?{status:"error",message:"Could not run i18n linter."}:r.json(),r=>({status:"error",message:"Could not run i18n linter."})).then(r=>{r.status==="error"?e(["Some part of this text makes it untranslatable. The specific message from the i18n linter was: "+r.message.replace(/\n/g," ")]):e([])})}},nr)}applyLintErrors(t,e){if(e.length){const r=e.join(`

`);t.unshift({content:{type:"text",content:""},insideTable:!1,message:r,ruleName:"legacy-error",severity:d.Severity.ERROR,type:"lint"})}}}const ir=n=>n.replace(/\{align[*]?\}/g,"{aligned}").replace(/[\u00a0]/g," "),{interactiveSizes:oe}=yt,sr=vt,ar=wt,U={SMALL:"small",MEDIUM:"medium",LARGE:"large",XLARGE:"xlarge"},st=n=>n?n<=sr?U.SMALL:n<=ar?U.MEDIUM:U.LARGE:U.MEDIUM,or=n=>n===U.SMALL?[oe.defaultBoxSizeSmall,oe.defaultBoxSizeSmall]:[oe.defaultBoxSize,oe.defaultBoxSize],Hr=Object.freeze(Object.defineProperty({__proto__:null,containerSizeClass:U,getClassFromWidth:st,getInteractiveBoxFromSizeClass:or},Symbol.toStringTag,{value:"Module"})),je="block",lr=["default"],cr=!1,ur="",dr=!1,I={},z={},at=(n,t)=>{I[n]=t},Kr=n=>{n.forEach(t=>{at(t.name,t)}),vr()},G=(n,t)=>{const e=I[t];if(!e){const r=`Failed to replace ${n} with ${t}`;throw new L(r,x.Internal)}at(n,e)},Jr=()=>{G("transformer","deprecated-standin"),G("lights-puzzle","deprecated-standin"),G("reaction-diagram","deprecated-standin"),G("sequence","deprecated-standin"),G("simulator","deprecated-standin")},Xr=n=>{n.forEach(t=>{if(!t.widgetName)throw new L(`Editor ${t.displayName} doesn't have a widgetName property`,x.Internal);z[t.widgetName]=t})},H=(n,t)=>{const e=z[t];if(!e&&B){const r=`Failed to replace editor ${n} with ${t}`;B.error(r,x.Internal);return}z[n]=e},Zr=()=>{H("transformer","deprecated-standin"),H("lights-puzzle","deprecated-standin"),H("reaction-diagram","deprecated-standin"),H("sequence","deprecated-standin"),H("simulator","deprecated-standin")},hr=n=>{var t,e,r;return c.has(I,n)?(t=I[n])!=null&&t.getWidget?(r=(e=I[n]).getWidget)==null?void 0:r.call(e):I[n].widget:null},Qr=n=>c.has(z,n)?z[n]:null,pr=n=>{if(I[n])return I[n].version||{major:0,minor:0}},Yr=()=>{const n={};return c.each(c.keys(I),function(t){n[t]=pr(t)}),n},ei=()=>c.pick(I,c.reject(c.keys(I),function(n){return I[n].hidden})),ti=()=>c.keys(I),gr=n=>{const t=n.type;if(!c.isString(t))throw new L("widget type must be a string, but was: "+t,x.Internal);const e=I[t];if(e==null)return n;const r=n.version||{major:0,minor:0},i=e.version||{major:0,minor:0};if(r.major>i.major||r.major===i.major&&r.minor>i.minor)return n;let s=c.clone(n.options)||{};const a=e.propUpgrades||{};if(c.keys(s).length!==0)for(let h=r.major+1;h<=i.major;h++)a[String(h)]?s=a[String(h)](s):B.error("No upgrade found for widget. Cannot render.",x.Internal,{loggedMetadata:{type:t,fromMajorVersion:h-1,toMajorVersion:h}});s={...t in z?z[t].defaultProps:{},...s};let l=n.alignment;(l==null||l==="default")&&(l=mr(t)[0]);let u=n.static;return u==null&&(u=cr),c.extend({},n,{version:i,graded:n.graded!=null?n.graded:!0,alignment:l,static:u,options:s})},fr=(n,t,e)=>{const r=n.type,i=I[r];if(i==null)return n;let s;return n.static?s=wr(r)||c.identity:s=i.transform||c.identity,s(n.options,t,e)},mr=n=>{const t=I[n];return t&&t.supportedAlignments||lr},yr=n=>{const t=I[n];let e;return t?(t.getDefaultAlignment?e=t.getDefaultAlignment():e=t.defaultAlignment,e||je):je},Be=["block","inline-block","inline","float-left","float-right","full-width"],vr=()=>{c.each(I,function(n){if(n.defaultAlignment&&!c.contains(Be,n.defaultAlignment))throw new L("Widget '"+n.displayName+"' has an invalid defaultAlignment value: "+n.defaultAlignment,x.InvalidInput);if(n.supportedAlignments){const t=c.difference(n.supportedAlignments,Be);if(t.length)throw new L("Widget '"+n.displayName+"' has an invalid value for supportedAlignments: "+t.join(" "),x.InvalidInput)}})},ni=n=>{const t=I[n];return t&&t.staticTransform!=null},wr=n=>{const t=I[n];return t&&t.staticTransform},br=n=>{const t=I[n];return t&&t.tracking||ur},kr=n=>{const t=I[n];return t&&t.isLintable||dr},Le=class Le extends W.Component{constructor(){super(...arguments),this.widgetRef=W.createRef(),this.state={sizeClass:U.MEDIUM,widgetProps:this.props.initialProps},this.getWidget=()=>this.widgetRef.current,this.replaceWidgetProps=t=>{this.setState({widgetProps:t})}}componentDidMount(){if(this.state.widgetProps.apiOptions.isMobile){const t=Ie.findDOMNode(this).offsetWidth;this.setState({sizeClass:st(t)})}}render(){let t=_e({"perseus-widget-container":!0,"widget-highlight":this.props.shouldHighlight,"widget-nohighlight":!this.props.shouldHighlight,"perseus-widget__definition":this.props.type==="definition"});const e=this.props.type,r=hr(e);if(r==null)return console.warn(`Widget type '${e}' not found!`),p("div",{className:t});let i=this.state.widgetProps.alignment;i==="default"&&(i=yr(e)),t+=" widget-"+i;const s=this.state.widgetProps.apiOptions,a=this.state.widgetProps.static||s.readOnly,o={position:"relative",overflow:"visible"},l={width:"100%",height:"100%",position:"absolute",top:0,left:0,zIndex:bt},u=kr(e)?this.props.linterContext:{...this.props.linterContext,highlightLint:!1};return p("div",{className:t,style:a?o:{},children:p(gt.Consumer,{children:({analytics:h})=>pe(C,{metadata:{widget_type:e,widget_id:this.props.id},onError:()=>{h.onAnalyticsEvent({type:"perseus:widget-rendering-error",payload:{widgetType:e,widgetId:this.props.id}})},children:[p(r,{...this.state.widgetProps,linterContext:u,containerSizeClass:this.state.sizeClass,ref:this.widgetRef}),a&&p("div",{style:l})]})})})}UNSAFE_componentWillReceiveProps(t){if(this.props.type!==t.type)throw new Error("WidgetContainer can't change widget type; set a different key instead to recreate the container.")}shouldComponentUpdate(t,e){return this.props.shouldHighlight!==t.shouldHighlight||this.props.type!==t.type||this.state.widgetProps!==e.widgetProps||this.state.sizeClass!==e.sizeClass}};Le.defaultProps={linterContext:He};let Y=Le;try{Y.displayName="WidgetContainer",Y.__docgenInfo={description:"",displayName:"WidgetContainer",props:{shouldHighlight:{defaultValue:null,description:"",name:"shouldHighlight",required:!0,type:{name:"boolean"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},initialProps:{defaultValue:null,description:"",name:"initialProps",required:!0,type:{name:"any"}},linterContext:{defaultValue:{value:`{
    contentType: "",
    highlightLint: false,
    paths: [] as ReadonlyArray<any>,
    stack: [] as ReadonlyArray<any>,
}`},description:"",name:"linterContext",required:!1,type:{name:"LinterContextProps"}}}}}catch{}const{mapObject:ke,mapObjectFromArray:_r}=dt,Ir=/\S/,Sr=/(web\+graphie|https):\/\/[^\s]*/,K=()=>{},Ve=["content","problemNum","widgets"],le=n=>"container:"+n,xr=function(n,t){return n===null||t===null?n===t:c.every(n,(e,r)=>{if(t!=null)return c.isEqual(e,t[r])})},We=class We extends W.Component{constructor(t){super(t),this._widgetContainers=new Map,this.getApiOptions=()=>({...ft.defaults,...this.props.apiOptions}),this._getInitialWidgetState=e=>{const r=this._getAllWidgetsInfo(e);return{widgetInfo:r,widgetProps:this._getAllWidgetsStartProps(r,e)}},this._getAllWidgetsInfo=e=>ke(e.widgets,(r,i)=>{if(!r.type||!r.alignment){const s={};r.type||(s.type=i.split(" ")[0]),r.alignment||(s.alignment="default"),r=c.extend({},r,s)}return gr(r)}),this._getAllWidgetsStartProps=(e,r)=>{var l;const{apiOptions:i,problemNum:s}=r,a={},{strings:o}=this.props;return ot(e).forEach(([u,h])=>{a[u]=fr(h,o,s)}),(l=i==null?void 0:i.onWidgetStartProps)==null||l.call(i,a),a},this._getDefaultWidgetInfo=e=>{const r=re.rTypeFromWidgetId.exec(e);return r==null?{}:{type:r[1],graded:!0,options:{}}},this._getWidgetInfo=e=>this.state.widgetInfo[e]||this._getDefaultWidgetInfo(e),this.renderWidget=(e,r,i)=>{const s=this.state.widgetInfo[r];if(s&&s.alignment==="full-width"&&(i.foundFullWidth=!0),s){const a=s&&s.type||e,o=c.contains(this.props.highlightedWidgets,r);return p(Y,{id:r,ref:l=>{const u=le(r);l!=null?this._widgetContainers.set(u,l):this._widgetContainers.delete(u)},type:a,initialProps:this.getWidgetProps(r),shouldHighlight:o,linterContext:gn(this.props.linterContext,"widget")},le(r))}return null},this.getWidgetProps=e=>{const r=this.getApiOptions(),i=this.state.widgetProps[e]||{},s=this.state.widgetInfo[e],a=this.props.reviewMode&&s?s.options:null;this._interactionTrackers||(this._interactionTrackers={});let o=this._interactionTrackers[e];return o||(o=this._interactionTrackers[e]=new yn(r.trackInteraction,s&&s.type,e,br(s&&s.type))),{...i,widgetId:e,alignment:s&&s.alignment,static:s&&s.static&&!this.props.problemNum,problemNum:this.props.problemNum,apiOptions:this.getApiOptions(),keypadElement:this.props.keypadElement,questionCompleted:this.props.questionCompleted,showSolutions:this.props.showSolutions,onFocus:c.partial(this._onWidgetFocus,e),onBlur:c.partial(this._onWidgetBlur,e),findWidgets:this.findWidgets,reviewModeRubric:a,onChange:(l,u,h=!1)=>{this._setWidgetProps(e,l,u,h)},trackInteraction:o.track,isLastUsedWidget:e===this.state.lastUsedWidgetId}},this.getSerializedState=e=>ke(e||this.state.widgetProps,(r,i)=>{const s=this.getWidgetInstance(i);return s&&s.getSerializedState?s.getSerializedState():r}),this.restoreSerializedState=(e,r)=>{const i=c.keys(e),s=c.keys(this.state.widgetProps);if(i.length!==s.length||c.intersection(i,s).length!==i.length){B.error("Refusing to restore bad serialized state:",x.Internal,{loggedMetadata:{serializedState:JSON.stringify(e),currentProps:JSON.stringify(this.state.widgetProps)}});return}let a=1;const o=()=>{--a,r&&a===0&&r()};this.setState({widgetProps:ke(e,(l,u)=>{const h=this.getWidgetInstance(u);if(h&&h.restoreSerializedState){++a;const g=h.restoreSerializedState(l,o);return c.extend({},this.state.widgetProps[u],g)}return l})},()=>{setTimeout(o,0)})},this.showRationalesForCurrentlySelectedChoices=()=>{Object.keys(this.props.widgets).forEach(e=>{const r=this.getWidgetInstance(e);r&&r.showRationalesForCurrentlySelectedChoices&&r.showRationalesForCurrentlySelectedChoices(this._getWidgetInfo(e).options)})},this.deselectIncorrectSelectedChoices=()=>{Object.keys(this.props.widgets).forEach(e=>{const r=this.getWidgetInstance(e);r&&r.deselectIncorrectSelectedChoices&&r.deselectIncorrectSelectedChoices()})},this.findInternalWidgets=e=>{let r;if(typeof e=="string")if(e.indexOf(" ")!==-1){const s=e;r=(a,o,l)=>a===s}else{const s=e;r=(a,o,l)=>o.type===s}else r=e;return this.widgetIds.filter(s=>{const a=this._getWidgetInfo(s),o=this.getWidgetInstance(s);return r(s,a,o)}).map(this.getWidgetInstance)},this.findWidgets=e=>[...this.findInternalWidgets(e),...this.props.findExternalWidgets(e)],this.getWidgetInstance=e=>{const r=this._widgetContainers.get(le(e));return r?r.getWidget():null},this._onWidgetFocus=(e,r=[])=>{if(!c.isArray(r))throw new L("widget props.onFocus focusPath must be an Array, but was"+JSON.stringify(r),x.Internal);this._setCurrentFocus([e].concat(r))},this._onWidgetBlur=(e,r)=>{const i=this._currentFocus,s=[e].concat(r);c.isEqual(s,i)&&c.defer(()=>{c.isEqual(this._currentFocus,i)&&this._setCurrentFocus(null)})},this.getContent=(e,r)=>r.jiptContent||e.content,this.shouldRenderJiptPlaceholder=(e,r)=>X().JIPT.useJIPT&&r.jiptContent==null&&e.content.indexOf("crwdns")!==-1,this.replaceJiptContent=(e,r)=>{if(r==null)this.setState({jiptContent:e});else{/^\s*(`{3,}|~{3,})\s*(\S+)?\s*\n([\s\S]+?)\s*\1\s*$/.test(e)||(/\S\n\s*\n\S/.test(e)?e="$\\large{\\red{\\text{Please translate each paragraph to a single paragraph.}}}$":/^\s*$/.test(e)&&(e="$\\large{\\red{\\text{Translated paragraph is currently empty}}}$"));const s=this.getContent(this.props,this.state),a=$e.parseToArray(s);a[r]=e,this.setState({jiptContent:$e.joinFromArray(a)})}},this.outputMarkdown=(e,r)=>{if(c.isArray(e)){const a=r.key,o=[];let l=!1;for(let u=0;u<e.length;u++){r.key=u,r.paragraphIndex=u;const h=this.outputMarkdown(e[u],r),g=typeof h=="string";typeof h=="string"&&l?o[o.length-1]+=h:o.push(h),l=g}return r.key=a,o}this._foundTextNodes=!1,r.foundFullWidth=!1;const i=this.outputNested(e,r);let s;return this.translationIndex!=null?s=null:s=_e({"perseus-paragraph-centered":!this._foundTextNodes,"perseus-paragraph-full-width":r.foundFullWidth&&e.content.length===1}),p(Ne,{className:s,translationIndex:this.translationIndex,paragraphIndex:r.paragraphIndex,inline:this.props.inline,children:p(C,{children:i})},r.key)},this.outputNested=(e,r)=>{if(c.isArray(e)){const i=r.key,s=[];let a=!1;for(let o=0;o<e.length;o++){r.key=o;const l=this.outputNested(e[o],r),u=typeof l=="string";typeof l=="string"&&a?s[s.length-1]+=l:s.push(l),a=u}return r.key=i,s}return this.outputNode(e,this.outputNested,r)},this.outputNode=(e,r,i)=>{const s=this.getApiOptions(),a=s.imagePlaceholder;if(e.type==="widget"){const o=s.widgetPlaceholder;return o||(this._foundTextNodes=!0,c.contains(this.widgetIds,e.id)?p("span",{className:"renderer-widget-error",children:["Widget [[","☃"," ",e.id,"]] already exists."].join("")},i.key):(this.widgetIds.push(e.id),this.renderWidget(e.widgetType,e.id,i)))}if(e.type==="blockMath"){const o=ir(e.content),l={overflowX:"auto",overflowY:"hidden",paddingTop:10,paddingBottom:10,marginTop:-10,marginBottom:-10};if(s.isMobile){const h={marginLeft:-16,marginRight:-16},g={paddingLeft:16,paddingRight:16},w={...l,...Ge.mobileZoomableParentFix};return p("div",{className:"perseus-block-math",style:h,children:p(C,{children:p("div",{className:"perseus-block-math-inner",style:{...w,...g},children:p(pt,{children:o})})})},i.key)}return p("div",{className:"perseus-block-math",children:p(C,{children:p("div",{className:"perseus-block-math-inner",style:l,children:p(ye.Consumer,{children:({setAssetStatus:u})=>p(Oe,{setAssetStatus:u,children:o})})})})},i.key)}if(e.type==="math"){const o=e.content.replace(/\{align[*]?\}/g,"{aligned}");return p("span",{style:{whiteSpace:"nowrap"},children:pe(C,{children:[p("span",{}),p(ye.Consumer,{children:({setAssetStatus:l})=>p(Oe,{onRender:this.props.onRender,setAssetStatus:l,children:o})}),p("span",{})]})},i.key)}if(e.type==="image"){if(a)return a;const o=c.has(this.props.images,e.target)?this.props.images[e.target]:null,l=!i.inTable;return p(C,{children:p(ye.Consumer,{children:({setAssetStatus:u})=>p(ut,{setAssetStatus:u,src:q.sanitizeUrl(e.target),alt:e.alt,title:e.title,responsive:l,onUpdate:this.props.onRender,zoomToFullSizeOnMobile:s.isMobile&&s.isArticle,...o})})},i.key)}if(e.type==="columns")return this._isTwoColumn=!0,p(C,{children:q.ruleOutput(e,r,i)},i.key);if(e.type==="text")return Ir.test(e.content)&&(this._foundTextNodes=!0),a&&Sr.test(e.content)?a:e.content;if(e.type==="table"||e.type==="titledTable"){const o=q.ruleOutput(e,r,{...i,isMobile:s.isMobile,inTable:!0});if(!s.isMobile)return o;const l=16,u={marginLeft:-l,marginRight:-l},g={...{paddingLeft:0,paddingRight:0},...Ge.mobileZoomableParentFix},w=p("div",{style:{...g,overflowX:"auto"},children:p(C,{children:p(ht,{animateHeight:!0,children:o})})});return p("div",{style:u,children:w})}return p(C,{children:q.ruleOutput(e,r,i)},i.key)},this.handleRender=e=>{const r=this.props.onRender,i=e.onRender;if(r!==K||i!==K){const s=lt(Ie.findDOMNode(this)).find("img");i!==K&&s.off("load",i),r!==K&&s.on("load",r)}r()},this._setCurrentFocus=e=>{const r=this.getApiOptions();if(!xr(e,this._currentFocus)){const i=this._currentFocus;i&&this.blurPath(i),this._currentFocus=e,r.onFocusChange(this._currentFocus,i)}},this.focus=()=>{let e,r;for(let i=0;i<this.widgetIds.length;i++){const s=this.widgetIds[i],a=this.getWidgetInstance(s),o=a&&a.focus&&a.focus();if(o){e=s,r=o;break}}if(e){let i;return typeof r=="object"?(i=[e].concat(r.path||[]),B.error("Renderer received a focus result of type 'object' instead of the expected type 'boolean'",x.Internal,{loggedMetadata:{focusResult:JSON.stringify(r),currentProps:JSON.stringify(this.state.widgetProps)}})):i=[e],this._setCurrentFocus(i),!0}},this.getDOMNodeForPath=e=>{const r=c.first(e),i=c.rest(e),s=this.getWidgetInstance(r),a=s&&s.getDOMNodeForPath;if(a)return a(i);if(i.length===0)return Ie.findDOMNode(s)},this.getGrammarTypeForPath=e=>{const r=c.first(e),i=c.rest(e),s=this.getWidgetInstance(r);if(s&&s.getGrammarTypeForPath)return s.getGrammarTypeForPath(i)},this.getInputPaths=()=>{const e=[];return c.each(this.widgetIds,r=>{const i=this.getWidgetInstance(r);if(i&&i.getInputPaths){const s=i.getInputPaths();c.each(s,a=>{const o=[r].concat(a);e.push(o)})}}),e},this.focusPath=e=>{if(c.isEqual(this._currentFocus,e))return;this._currentFocus&&this.blurPath(this._currentFocus);const r=c.first(e),i=c.rest(e),s=this.getWidgetInstance(r);s&&s.focusInputPath&&s.focusInputPath(i)},this.blurPath=e=>{if(!c.isEqual(this._currentFocus,e))return;const r=c.first(e),i=c.rest(e);if(this.getWidgetInstance(r)){const a=this.getWidgetInstance(r);a&&a.blurInputPath&&a.blurInputPath(i)}},this.blur=()=>{this._currentFocus&&this.blurPath(this._currentFocus)},this.serialize=()=>{const e={};return c.each(this.state.widgetInfo,function(r,i){const a=this.getWidgetInstance(i).serialize();c.isEmpty(a)||(e[i]=a)},this),e},this.emptyWidgets=()=>c.filter(this.widgetIds,e=>{const r=this._getWidgetInfo(e);if(r.static)return!1;const i=this.getWidgetInstance(e);if(i&&i.simpleValidate){const s=i.simpleValidate(r.options,null);return re.scoreIsEmpty(s)}}),this._setWidgetProps=(e,r,i,s)=>{this.setState(a=>{const o={...a.widgetProps,[e]:{...a.widgetProps[e],...r}},l=s?a.lastUsedWidgetId:e;return s||this.props.onSerializedStateUpdated(this.getSerializedState(o)),{lastUsedWidgetId:l,widgetProps:o}},()=>{setTimeout(()=>{const a=i&&i();s||this.props.onInteractWithWidget(e),a!==!1&&this._setCurrentFocus([e])},0)})},this.setInputValue=(e,r,i)=>{var l;const s=c.first(e),a=c.rest(e),o=this.getWidgetInstance(s);(l=o==null?void 0:o.setInputValue)==null||l.call(o,a,r,i)},this.getUserInput=()=>this.widgetIds.map(e=>{const r=this.getWidgetInstance(e);if(r&&r.getUserInput)return r.getUserInput()}),this.getWidgetIds=()=>this.widgetIds,this.getUserInputForWidgets=()=>_r(this.widgetIds,e=>{const r=this.getWidgetInstance(e);if(r&&r.getUserInput)return r.getUserInput()}),this.scoreWidgets=()=>{const e=this.state.widgetInfo,r=this.getApiOptions().onInputError,i=c.filter(this.widgetIds,a=>{const o=e[a],l=(o==null?void 0:o.graded)==null||o.graded,u=!!(o!=null&&o.static);return l&&!u}),s={};return c.each(i,a=>{const o=e[a],l=this.getWidgetInstance(a);l&&l.simpleValidate&&(s[a]=l.simpleValidate({...o==null?void 0:o.options,scoring:!0},r))}),s},this.score=()=>c.reduce(this.scoreWidgets(),re.combineScores,re.noScore),this.guessAndScore=()=>{const e=this.getUserInput(),r=this.score();return[e,r]},this.examples=()=>{const e=this.widgetIds,r=c.compact(c.map(e,s=>{const a=this.getWidgetInstance(s);return a!=null&&a.examples?a.examples():null}));return!r.length||!c.all(r,function(s){return c.isEqual(r[0],s)})?null:r[0]},this.handletranslationLintErrors=e=>{this._isMounted&&this.setState({translationLintErrors:e})},this._translationLinter=new rr,this.state={jiptContent:null,translationLintErrors:[],lastUsedWidgetId:null,...this._getInitialWidgetState(t)}}componentDidMount(){this._isMounted=!0,this.handleRender({}),this._currentFocus=null,this.props.serializedState&&this.restoreSerializedState(this.props.serializedState),this.props.linterContext.highlightLint&&this._translationLinter.runLinter(this.props.content,this.handletranslationLintErrors)}UNSAFE_componentWillReceiveProps(t){c.isEqual(c.pick(this.props,Ve),c.pick(t,Ve))||this.setState(this._getInitialWidgetState(t))}shouldComponentUpdate(t,e){if(this.props.alwaysUpdate)return!0;const r=!c.isEqual(this.state,e);return!c.isEqual(this.props,t)||r}UNSAFE_componentWillUpdate(t,e){const r=this.shouldRenderJiptPlaceholder(this.props,this.state),i=this.shouldRenderJiptPlaceholder(t,e),s=this.getContent(this.props,this.state),a=this.getContent(t,e),o=this.props.highlightedWidgets,l=t.highlightedWidgets;this.reuseMarkdown=!r&&!i&&s===a&&c.isEqual(this.state.translationLintErrors,e.translationLintErrors)&&(!this.props.linterContext.highlightLint||c.isEqual(this.props.widgets,t.widgets))&&this.props.linterContext.highlightLint===t.linterContext.highlightLint&&o===l}componentDidUpdate(t,e){this.handleRender(t),c.each(this.widgetIds,r=>{const i=this._widgetContainers.get(le(r));i&&i.replaceWidgetProps(this.getWidgetProps(r))}),this.props.serializedState&&!c.isEqual(this.props.serializedState,this.getSerializedState())&&this.restoreSerializedState(this.props.serializedState),this.props.linterContext.highlightLint&&this._translationLinter.runLinter(this.props.content,this.handletranslationLintErrors)}componentWillUnmount(){this.widgetIds=[],this.translationIndex!=null&&X().rendererTranslationComponents.removeComponentAtIndex(this.translationIndex),this._isMounted=!1}render(){const t=this.getApiOptions();if(this.reuseMarkdown)return this.lastRenderedMarkdown;const e=this.getContent(this.props,this.state);if(this.widgetIds=[],this.shouldRenderJiptPlaceholder(this.props,this.state)&&(this.translationIndex||(this.translationIndex=X().rendererTranslationComponents.addComponent(this)),!t.isArticle))return p(ce,{children:p("div",{"data-perseus-component-index":this.translationIndex,children:e})});this._isTwoColumn=!1;const r=this.props.inline?q.parseInline(e,{isJipt:this.translationIndex!=null}):q.parse(e,{isJipt:this.translationIndex!=null});if(this.props.linterContext.highlightLint){const a={content:this.props.content,widgets:this.props.widgets,...this.props.linterContext};pn(r,a,!0),this._translationLinter.applyLintErrors(r,[...this.state.translationLintErrors,...this.props.legacyPerseusLint||[]])}const i=this.outputMarkdown(r,{baseElements:t.baseElements}),s=_e({[ve.RENDERER]:!0,[ve.RESPONSIVE_RENDERER]:!0,[ve.TWO_COLUMN_RENDERER]:this._isTwoColumn});return this.lastRenderedMarkdown=p(ce,{children:p("div",{className:s,children:i})}),this.lastRenderedMarkdown}};We.defaultProps={content:"",widgets:{},images:{},highlightedWidgets:[],questionCompleted:!1,showSolutions:"none",onRender:K,onInteractWithWidget:function(){},findExternalWidgets:()=>[],alwaysUpdate:!1,reviewMode:!1,serializedState:null,onSerializedStateUpdated:()=>{},linterContext:He};let he=We;const Ge={mobileZoomableParentFix:{transform:"translate3d(0,0,0)"}};try{he.displayName="Renderer",he.__docgenInfo={description:"",displayName:"Renderer",props:{analytics:{defaultValue:null,description:"",name:"analytics",required:!1,type:{name:"{ onAnalyticsEvent: AnalyticsEventHandlerFn; }"}},apiOptions:{defaultValue:null,description:"",name:"apiOptions",required:!1,type:{name:"Readonly<{ isArticle?: boolean; onInputError?: ((widgetId: any, value: string, message?: string | null) => unknown) | undefined; onFocusChange?: ((newFocusPath: FocusPath, oldFocusPath: FocusPath, keypadHeight?: number | undefined, focusedElement?: HTMLElement | undefined) => unknown) | undef..."}},alwaysUpdate:{defaultValue:{value:"false"},description:"",name:"alwaysUpdate",required:!1,type:{name:"boolean"}},findExternalWidgets:{defaultValue:{value:"() => []"},description:"",name:"findExternalWidgets",required:!1,type:{name:"any"}},highlightedWidgets:{defaultValue:{value:"[]"},description:"",name:"highlightedWidgets",required:!1,type:{name:"readonly any[]"}},images:{defaultValue:{value:"{}"},description:"",name:"images",required:!1,type:{name:"{ [key: string]: PerseusImageDetail; }"}},keypadElement:{defaultValue:null,description:"",name:"keypadElement",required:!1,type:{name:"any"}},onInteractWithWidget:{defaultValue:{value:"function () {}"},description:"",name:"onInteractWithWidget",required:!1,type:{name:"(id: string) => void"}},onRender:{defaultValue:{value:"() => {}"},description:"",name:"onRender",required:!1,type:{name:"(node?: any) => void"}},problemNum:{defaultValue:null,description:"",name:"problemNum",required:!1,type:{name:"number"}},questionCompleted:{defaultValue:{value:"false"},description:"",name:"questionCompleted",required:!1,type:{name:"boolean"}},reviewMode:{defaultValue:{value:"false"},description:"",name:"reviewMode",required:!1,type:{name:"boolean | null"}},showSolutions:{defaultValue:{value:"none"},description:'If set to "all", all rationales or solutions will be shown. If set to\n"selected", soltions will only be shown for selected choices. If set to\n"none", solutions will not be shown-- equivalent to `undefined`.',name:"showSolutions",required:!1,type:{name:"enum",value:[{value:'"none"'},{value:'"all"'},{value:'"selected"'}]}},content:{defaultValue:{value:""},description:"",name:"content",required:!1,type:{name:"string"}},serializedState:{defaultValue:{value:"null"},description:"",name:"serializedState",required:!1,type:{name:"any"}},onSerializedStateUpdated:{defaultValue:{value:"() => {}"},description:`Callback which is called when serialized state changes with the new
serialized state.`,name:"onSerializedStateUpdated",required:!1,type:{name:"(serializedState: { [key: string]: any; }) => unknown"}},linterContext:{defaultValue:{value:"PerseusLinter.linterContextDefault"},description:`If linterContext.highlightLint is true, then content will be passed to
the linter and any warnings will be highlighted in the rendered output.`,name:"linterContext",required:!1,type:{name:"LinterContextProps"}},legacyPerseusLint:{defaultValue:null,description:"",name:"legacyPerseusLint",required:!1,type:{name:"readonly string[]"}},widgets:{defaultValue:{value:"{}"},description:"",name:"widgets",required:!1,type:{name:"PerseusWidgetsMap"}},inline:{defaultValue:null,description:"Skip adding paragraph class",name:"inline",required:!1,type:{name:"boolean"}},strings:{defaultValue:null,description:"",name:"strings",required:!0,type:{name:"PerseusStrings"}}}}}catch{}export{Me as D,$e as J,q as P,he as R,Hr as S,Jr as a,Qr as b,ei as c,ti as d,yr as e,pr as f,mr as g,ir as h,Xr as i,Zr as j,Yr as k,He as l,or as m,Gr as n,m as o,gn as p,Kr as r,ni as s,gr as u};
