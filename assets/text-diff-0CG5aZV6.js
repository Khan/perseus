import{j as c}from"./jsx-runtime-63Ea5SlK.js";import"./article-renderer-ykubqYof.js";import{_ as d}from"./index-default-4_ZsnO94.js";import"./index-VBBZE5E5.js";import"./util-Deofanvy.js";import"./jquery-5v7aFUvu.js";import"./phet-simulation-gyYpJmt5.js";import"./dependencies-CP7Uh8Kq.js";import"./perseus-api-DO0X8arb.js";import"./server-item-renderer-aqPUpo65.js";import"./hints-renderer-sybyDKMJ.js";import"./renderer--yoXpbTs.js";import"./base-radio--V7cZxuU.js";import{c as K}from"./components-oyR2hNaw.js";import"./i18n-context-YAdgKrxn.js";import"./svg-image-dQmvqixs.js";import"./index-smZ6iCr_.js";import{c as q}from"./index-dnMhQZ-1.js";import{P as C}from"./index-IiwcBdIZ.js";import{r as G}from"./index-6oxdNXpR.js";function A(t){return{newPos:t.newPos,components:t.components.slice(0)}}function U(t){for(var e=[],s=0;s<t.length;s++)t[s]&&e.push(t[s]);return e}function Q(t){var e=t;return e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/"/g,"&quot;"),e}var w=function(t){this.ignoreWhitespace=t};w.prototype={diff:function(t,e){if(e===t)return[{value:e}];if(!e)return[{value:t,removed:!0}];if(!t)return[{value:e,added:!0}];e=this.tokenize(e),t=this.tokenize(t);var s=e.length,r=t.length,a=s+r,i=[{newPos:-1,components:[]}],n=this.extractCommon(i[0],e,t,0);if(i[0].newPos+1>=s&&n+1>=r)return i[0].components;for(var p=1;p<=a;p++)for(var o=-1*p;o<=p;o+=2){var f,u=i[o-1],l=i[o+1];n=(l?l.newPos:0)-o,u&&(i[o-1]=void 0);var m=u&&u.newPos+1<s,v=l&&0<=n&&n<r;if(!m&&!v){i[o]=void 0;continue}!m||v&&u.newPos<l.newPos?(f=A(l),this.pushComponent(f.components,t[n],void 0,!0)):(f=A(u),f.newPos++,this.pushComponent(f.components,e[f.newPos],!0,void 0));var n=this.extractCommon(f,e,t,o);if(f.newPos+1>=s&&n+1>=r)return f.components;i[o]=f}},pushComponent:function(t,e,s,r){var a=t[t.length-1];a&&a.added===s&&a.removed===r?t[t.length-1]={value:this.join(a.value,e),added:s,removed:r}:t.push({value:e,added:s,removed:r})},extractCommon:function(t,e,s,r){for(var a=e.length,i=s.length,n=t.newPos,p=n-r;n+1<a&&p+1<i&&this.equals(e[n+1],s[p+1]);)n++,p++,this.pushComponent(t.components,e[n],void 0,void 0);return t.newPos=n,p},equals:function(t,e){var s=/\S/;return this.ignoreWhitespace&&!s.test(t)&&!s.test(e)?!0:t===e},join:function(t,e){return t+e},tokenize:function(t){return t}};var Y=new w,V=new w(!0),X=new w;V.tokenize=X.tokenize=function(t){return U(t.split(/(\s+|\b)/))};var _=new w(!0);_.tokenize=function(t){return U(t.split(/([{}:;,]|\s+)/))};var R=new w;R.tokenize=function(t){for(var e=[],s=t.split(/^/m),r=0;r<s.length;r++){var a=s[r],i=s[r-1];a==`
`&&i&&i[i.length-1]==="\r"?e[e.length-1]+=`
`:a&&e.push(a)}return e};const $={Diff:w,diffChars:function(t,e){return Y.diff(t,e)},diffWords:function(t,e){return V.diff(t,e)},diffWordsWithSpace:function(t,e){return X.diff(t,e)},diffLines:function(t,e){return R.diff(t,e)},diffCss:function(t,e){return _.diff(t,e)},createPatch:function(t,e,s,r,a){var i=[];i.push("Index: "+t),i.push("==================================================================="),i.push("--- "+t+(typeof r>"u"?"":"	"+r)),i.push("+++ "+t+(typeof a>"u"?"":"	"+a));var n=R.diff(e,s);n[n.length-1].value||n.pop(),n.push({value:"",lines:[]});function p(j){return j.map(function(E){return" "+E})}function o(j,E,k){var I=n[n.length-2],B=E===n.length-2,J=E===n.length-3&&(k.added!==I.added||k.removed!==I.removed);!/\n$/.test(k.value)&&(B||J)&&j.push("\\ No newline at end of file")}for(var f=0,u=0,l=[],m=1,v=1,x=0;x<n.length;x++){var g=n[x],h=g.lines||g.value.replace(/\n$/,"").split(`
`);if(g.lines=h,g.added||g.removed){if(!f){var z=n[x-1];f=m,u=v,z&&(l=p(z.lines.slice(-4)),f-=l.length,u-=l.length)}l.push.apply(l,h.map(function(j){return(g.added?"+":"-")+j})),o(l,x,g),g.added?v+=h.length:m+=h.length}else{if(f)if(h.length<=8&&x<n.length-2)l.push.apply(l,p(h));else{var L=Math.min(h.length,4);i.push("@@ -"+f+","+(m-f+L)+" +"+u+","+(v-u+L)+" @@"),i.push.apply(i,l),i.push.apply(i,p(h.slice(0,L))),h.length<=4&&o(i,x,g),f=0,u=0,l=[]}m+=h.length,v+=h.length}}return i.join(`
`)+`
`},applyPatch:function(t,e){for(var s=e.split(`
`),r=[],a=!1,i=!1,n=s[0][0]==="I"?4:0;n<s.length;n++)if(s[n][0]==="@"){var p=s[n].split(/@@ -(\d+),(\d+) \+(\d+),(\d+) @@/);r.unshift({start:p[3],oldlength:p[2],oldlines:[],newlength:p[4],newlines:[]})}else s[n][0]==="+"?r[0].newlines.push(s[n].substr(1)):s[n][0]==="-"?r[0].oldlines.push(s[n].substr(1)):s[n][0]===" "?(r[0].newlines.push(s[n].substr(1)),r[0].oldlines.push(s[n].substr(1))):s[n][0]==="\\"&&(s[n-1][0]==="+"?a=!0:s[n-1][0]==="-"&&(i=!0));for(var o=t.split(`
`),n=r.length-1;n>=0;n--){for(var f=r[n],u=0;u<f.oldlength;u++)if(o[f.start-1+u]!==f.oldlines[u])return!1;Array.prototype.splice.apply(o,[f.start-1,+f.oldlength].concat(f.newlines))}if(a)for(;!o[o.length-1];)o.pop();else i&&o.push("");return o.join(`
`)},convertChangesToXML:function(t){for(var e=[],s=0;s<t.length;s++){var r=t[s];r.added?e.push("<ins>"):r.removed&&e.push("<del>"),e.push(Q(r.value)),r.added?e.push("</ins>"):r.removed&&e.push("</del>")}return e.join("")},convertChangesToDMP:function(t){for(var e=[],s,r=0;r<t.length;r++)s=t[r],e.push([s.added?1:s.removed?-1:0,s.value]);return e}},Z=function(t){const e=[];let s=[];return d.each(t,r=>{const a=r.value.split(`
`);d.each(a,(i,n)=>{n>0&&(e.push(s),s=[]);const o=d.extend({},r,{value:i});s.push(o)})}),s.length&&e.push(s),e},H=function(t){return t.added?"added":t.removed?"removed":"unchanged"},P=t=>d.map(t.value,e=>({value:e,status:H(t)})),S=function(t,e){return d.flatten(d.map(t,e),!0)},y=new $.Diff;y.tokenize=t=>d.map(t,e=>[e]);y.join=(t,e)=>t.concat(e);y.equals=d.isEqual;const ee=t=>S(t,P),te=function(t,e){const s=y.diff(t,e),r=ee(s);return{before:d.filter(r,a=>a.status!=="added"),after:d.filter(r,a=>a.status!=="removed")}},{SvgImage:se}=K,W="before",b="after",ne=/http.*?\.png|web\+graphie[^)]*/g,M=function(t){return t.match(ne)||[]},O=function(t,e,s){return t.added?e:t.removed?s:""},T=class T extends G.Component{render(){return c.jsx("div",{children:d.map(this.props.images,(e,s)=>{const r=q({image:!0,"image-unchanged":e.status==="unchanged","image-added":e.status==="added","image-removed":e.status==="removed"});return c.jsx("div",{children:c.jsx("div",{className:r,children:c.jsx(se,{src:e.value,title:e.value})})},s)})})}};T.propTypes={images:C.arrayOf(C.shape({})).isRequired};let D=T;const N=class N extends G.Component{constructor(){super(...arguments),this.state={collapsed:this.props.before===this.props.after},this.handleExpand=()=>{this.setState({collapsed:!1})}}UNSAFE_componentWillReceiveProps(e){this.setState({collapsed:e.before===e.after})}render(){const e=$.diffWords(this.props.before,this.props.after),s=Z(e),r=M(this.props.before),a=M(this.props.after),i=te(r,a),n=d.map(s,o=>{const f={};return f.before=d(o).map(function(u,l){return c.jsx("span",{className:O(u,"not-present","removed dark"),children:u.value},l)}),f.after=d(o).map(function(u,l){return c.jsx("span",{className:O(u,"added dark","not-present"),children:u.value},l)}),f}),p=q({"diff-row":!0,collapsed:this.state.collapsed});return c.jsxs("div",{children:[c.jsx("div",{className:"diff-header",children:this.props.title}),c.jsx("div",{className:"diff-header",children:this.props.title}),c.jsx("div",{className:"diff-body ui-helper-clearfix",children:d.map([W,b],(o,f)=>c.jsxs("div",{className:"diff-row "+o,children:[!this.state.collapsed&&d.map(n,(u,l)=>{const m=u[o].length>1,v=q({"diff-line":!0,added:o===b&&m,removed:o===W&&m});return c.jsx("div",{className:v,children:u[o]},l)}),!this.state.collapsed&&c.jsx(D,{images:i[o]})]},f))}),d.map([W,b],(o,f)=>c.jsx("div",{className:p+" "+o,onClick:this.handleExpand,children:this.state.collapsed&&c.jsx("span",{children:c.jsxs("span",{className:"expand-button",children:[" ","[ show unmodified ]"," "]})})},f))]})}};N.propTypes={after:C.string,before:C.string,title:C.string.isRequired},N.defaultProps={after:"",before:""};let F=N;F.__docgenInfo={description:"",methods:[{name:"handleExpand",docblock:null,modifiers:[],params:[],returns:null}],displayName:"TextDiff",props:{after:{defaultValue:{value:'""',computed:!1},description:"",type:{name:"string"},required:!1},before:{defaultValue:{value:'""',computed:!1},description:"",type:{name:"string"},required:!1},title:{description:"",type:{name:"string"},required:!0}}};export{F as T};
