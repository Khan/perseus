var C=Object.defineProperty;var T=(s,o,e)=>o in s?C(s,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[o]=e;var t=(s,o,e)=>(T(s,typeof o!="symbol"?o+"":o,e),e);import{j as v}from"./jsx-runtime-BT65X5dW.js";import{r as M}from"./index-C6mWTJJr.js";import{h as w}from"./index-B1Gws05u.js";class f extends M.Component{constructor(){super(...arguments);t(this,"_isMounted");t(this,"_observer");t(this,"_measuringInitialized");t(this,"_originalWidth");t(this,"_node");t(this,"state",{visible:!1,marginBottomPx:0,zoomed:!0});t(this,"reset",()=>{this._isMounted&&this.state.visible&&(this._originalWidth=null,this.setState({visible:!1,compactHeight:null,expandedHeight:null,zoomed:!0},()=>{this.measureAndScaleChildToFit(!1)}))});t(this,"stopPropagationIfZoomed",e=>{this.state.zoomed||e.stopPropagation()});t(this,"handleClickIfZoomed",e=>{this.state.zoomed||(e.stopPropagation(),this.handleClick())});t(this,"handleClick",()=>{this.setState({zoomed:!this.state.zoomed})})}componentDidMount(){this._isMounted=!0,this.maybeInitializeMeasuring()}componentDidUpdate(){this.maybeInitializeMeasuring()}componentWillUnmount(){window.removeEventListener("resize",this.reset),this._observer&&this._observer.disconnect(),this._isMounted=!1}maybeInitializeMeasuring(){const e=this.props.readyToMeasure&&!this._measuringInitialized;this._isMounted&&e&&(this._measuringInitialized=!0,this._node=w.findDOMNode(this),setTimeout(()=>this.measureAndScaleChildToFit(!1),0),window.MutationObserver&&(this._observer=new MutationObserver(i=>{if(this._isMounted){for(const n of i)if(n.target!==this._node){this.measureAndScaleChildToFit(this.state.zoomed);break}}}),this._observer.observe(this._node,{childList:!0,subtree:!0,attributes:!0})),window.addEventListener("resize",this.reset))}measureAndScaleChildToFit(e){var h;if(!this._isMounted)return;let i=this._node,n=i;for(;n&&n.offsetWidth===0;)n=((h=n.parentElement)==null?void 0:h.closest(".perseus-renderer"))??null;n&&(i=n);const a={width:i.offsetWidth,height:i.offsetHeight},r=this.props.computeChildBounds(this._node,a),l=r.width+1,d=r.height+1;if(l>a.width){const u=a.width/l;this.setState({scale:u,zoomed:e,compactHeight:Math.ceil(u*d),expandedHeight:d}),setTimeout(()=>{this._isMounted&&this.setState({visible:!0})})}else this.setState({visible:!0})}render(){const{visible:e,scale:i,compactHeight:n,expandedHeight:a,zoomed:r}=this.state,{animateHeight:l,disableEntranceAnimation:d}=this.props,u=e?{transitionProperty:l?"opacity transform height":"opacity transform",transitionDuration:"0.3s",transitionTimingFunction:"ease-out"}:{},m=!d&&!e,c=m?" translate(0, 8px)":"",g=m?0:1,p=(i??1).toString(),b=r?`scale(1, 1) ${c}`:`scale(${p}, ${p}) ${c}`,y={display:"block",width:"100%",height:r?a:n,transform:b,transformOrigin:"0 0",opacity:g,WebkitTapHighlightColor:"transparent",...u};return v.jsx("span",{onClick:this.handleClick,onClickCapture:this.handleClickIfZoomed,onTouchCancelCapture:this.stopPropagationIfZoomed,onTouchEndCapture:this.stopPropagationIfZoomed,onTouchStartCapture:this.stopPropagationIfZoomed,style:y,children:this.props.children})}}t(f,"defaultProps",{animateHeight:!1,readyToMeasure:!0,disableEntranceAnimation:!1,computeChildBounds:e=>{const i=e.firstElementChild;return{width:i.offsetWidth,height:i.offsetHeight}}});f.__docgenInfo={description:"",methods:[{name:"reset",docblock:null,modifiers:[],params:[],returns:{type:{name:"void"}}},{name:"maybeInitializeMeasuring",docblock:`Calls measureAndScaleChildToFit and sets up a MutationObserver
to call measureAndScaleChildToFit if Zoomable's children change.

If the readyToMeasure prop isn't true or if measuring has already
been initialized this method does nothing.`,modifiers:[],params:[],returns:null,description:`Calls measureAndScaleChildToFit and sets up a MutationObserver
to call measureAndScaleChildToFit if Zoomable's children change.

If the readyToMeasure prop isn't true or if measuring has already
been initialized this method does nothing.`},{name:"stopPropagationIfZoomed",docblock:null,modifiers:[],params:[{name:"e",optional:!1,type:{name:"ReactTouchEvent",raw:"React.TouchEvent",alias:"React.TouchEvent"}}],returns:null},{name:"measureAndScaleChildToFit",docblock:null,modifiers:[],params:[{name:"zoomed",optional:!1,type:{name:"boolean"}}],returns:null},{name:"handleClickIfZoomed",docblock:null,modifiers:[],params:[{name:"e",optional:!1,type:{name:"ReactMouseEvent",raw:"React.MouseEvent",alias:"React.MouseEvent"}}],returns:null},{name:"handleClick",docblock:null,modifiers:[],params:[],returns:null}],displayName:"Zoomable",props:{children:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},animateHeight:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},disableEntranceAnimation:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},computeChildBounds:{required:!1,tsType:{name:"signature",type:"function",raw:`(
    parentNode: HTMLElement,
    parentBounds: Bounds,
) => Bounds`,signature:{arguments:[{type:{name:"HTMLElement"},name:"parentNode"},{type:{name:"signature",type:"object",raw:`{
    width: number;
    height: number;
}`,signature:{properties:[{key:"width",value:{name:"number",required:!0}},{key:"height",value:{name:"number",required:!0}}]}},name:"parentBounds"}],return:{name:"signature",type:"object",raw:`{
    width: number;
    height: number;
}`,signature:{properties:[{key:"width",value:{name:"number",required:!0}},{key:"height",value:{name:"number",required:!0}}]}}}},description:`Optional function that allows customizations in zooming.

Defaults to just using the bounding client rect of the first DOM
element of this component.`,defaultValue:{value:`(parentNode) => {
    const firstChild = parentNode.firstElementChild;

    return {
        // @ts-expect-error - TS2531 - Object is possibly 'null'. | TS2339 - Property 'offsetWidth' does not exist on type 'Element'.
        width: firstChild.offsetWidth,
        // @ts-expect-error - TS2531 - Object is possibly 'null'. | TS2339 - Property 'offsetHeight' does not exist on type 'Element'.
        height: firstChild.offsetHeight,
    };
}`,computed:!1}},readyToMeasure:{required:!1,tsType:{name:"boolean"},description:`Optional boolean specifying whether the component is ready to measure
or not.  Defaults to true for synchronous components like tables.`,defaultValue:{value:"true",computed:!1}}}};export{f as Z};
