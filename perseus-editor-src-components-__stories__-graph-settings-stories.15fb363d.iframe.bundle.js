"use strict";(self.webpackChunkperseus=self.webpackChunkperseus||[]).push([[9620],{"./packages/perseus-editor/src/components/__stories__/graph-settings.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,default:()=>graph_settings_stories});var react=__webpack_require__("./node_modules/react/index.js"),graph_settings=__webpack_require__("./packages/perseus-editor/src/components/graph-settings.tsx");const graph_settings_stories={title:"Perseus/Editor/Components/Graph Settings",component:graph_settings.Z,argTypes:{editableSettings:{control:{type:"array",options:["canvas","graph","snap","image","measure"]}},box:{control:{type:"array"}},range:{control:{type:"object"}},labels:{control:{type:"object"}},step:{control:{type:"object"}},gridStep:{control:{type:"object"}},snapStep:{control:{type:"object"}},valid:{control:{type:"text"}},backgroundImage:{control:{type:"object"}},markings:{control:{type:"select"},table:{defaultValue:{summary:"graph"},type:{summary:'"graph" | "grid" | "none"'}},type:{name:"enum",value:["graph","grid","none"],required:!1}},rulerLabel:{control:{type:"text"}},rulerTicks:{control:{type:"number"}},showTooltips:{control:{type:"boolean"}},onChange:{control:{type:"function"}}}},Default=args=>react.createElement(graph_settings.Z,args);Default.args={range:[[-10,10],[-10,10]]},Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"(args): React.ReactElement => {\n  return <GraphSettings {...args} />;\n}",...Default.parameters?.docs?.source}}};try{Default.displayName="Default",Default.__docgenInfo={description:"",displayName:"Default",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/perseus-editor/src/components/__stories__/graph-settings.stories.tsx#Default"]={docgenInfo:Default.__docgenInfo,name:"Default",path:"packages/perseus-editor/src/components/__stories__/graph-settings.stories.tsx#Default"})}catch(__react_docgen_typescript_loader_error){}},"./packages/perseus-editor/src/components/graph-settings.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _khanacademy_perseus__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/perseus/src/index.ts"),create_react_class__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/create-react-class/index.js"),create_react_class__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(create_react_class__WEBPACK_IMPORTED_MODULE_1__),prop_types__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_5__),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react/index.js"),react_dom__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/react-dom/index.js"),underscore__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/underscore/modules/index-all.js");const{ButtonGroup,InfoTip,PropCheckBox,RangeInput}=_khanacademy_perseus__WEBPACK_IMPORTED_MODULE_0__.components,{getDependencies}=_khanacademy_perseus__WEBPACK_IMPORTED_MODULE_0__.Dependencies,defaultBackgroundImage={url:null,width:0,height:0};const __WEBPACK_DEFAULT_EXPORT__=create_react_class__WEBPACK_IMPORTED_MODULE_1___default()({displayName:"GraphSettings",propTypes:{..._khanacademy_perseus__WEBPACK_IMPORTED_MODULE_0__.ye.i,editableSettings:prop_types__WEBPACK_IMPORTED_MODULE_5___default().arrayOf(prop_types__WEBPACK_IMPORTED_MODULE_5___default().oneOf(["canvas","graph","snap","image","measure"])),box:prop_types__WEBPACK_IMPORTED_MODULE_5___default().arrayOf(prop_types__WEBPACK_IMPORTED_MODULE_5___default().number),labels:prop_types__WEBPACK_IMPORTED_MODULE_5___default().arrayOf(prop_types__WEBPACK_IMPORTED_MODULE_5___default().string),range:prop_types__WEBPACK_IMPORTED_MODULE_5___default().arrayOf(prop_types__WEBPACK_IMPORTED_MODULE_5___default().arrayOf(prop_types__WEBPACK_IMPORTED_MODULE_5___default().number)),step:prop_types__WEBPACK_IMPORTED_MODULE_5___default().arrayOf(prop_types__WEBPACK_IMPORTED_MODULE_5___default().number),gridStep:prop_types__WEBPACK_IMPORTED_MODULE_5___default().arrayOf(prop_types__WEBPACK_IMPORTED_MODULE_5___default().number),snapStep:prop_types__WEBPACK_IMPORTED_MODULE_5___default().arrayOf(prop_types__WEBPACK_IMPORTED_MODULE_5___default().number),valid:prop_types__WEBPACK_IMPORTED_MODULE_5___default().oneOfType([prop_types__WEBPACK_IMPORTED_MODULE_5___default().bool,prop_types__WEBPACK_IMPORTED_MODULE_5___default().string]),backgroundImage:prop_types__WEBPACK_IMPORTED_MODULE_5___default().object,markings:prop_types__WEBPACK_IMPORTED_MODULE_5___default().oneOf(["graph","grid","none"]),showProtractor:prop_types__WEBPACK_IMPORTED_MODULE_5___default().bool,showRuler:prop_types__WEBPACK_IMPORTED_MODULE_5___default().bool,showTooltips:prop_types__WEBPACK_IMPORTED_MODULE_5___default().bool,rulerLabel:prop_types__WEBPACK_IMPORTED_MODULE_5___default().string,rulerTicks:prop_types__WEBPACK_IMPORTED_MODULE_5___default().number},getDefaultProps:function(){return{editableSettings:["graph","snap","image","measure"],box:[_khanacademy_perseus__WEBPACK_IMPORTED_MODULE_0__.Yu.defaultBoxSizeSmall,_khanacademy_perseus__WEBPACK_IMPORTED_MODULE_0__.Yu.defaultBoxSizeSmall],labels:["x","y"],range:[[-10,10],[-10,10]],step:[1,1],gridStep:[1,1],snapStep:[1,1],valid:!0,backgroundImage:defaultBackgroundImage,markings:"graph",showProtractor:!1,showRuler:!1,showTooltips:!1,rulerLabel:"",rulerTicks:10}},getInitialState:function(){return this.stateFromProps(this.props)},componentDidMount:function(){this._isMounted=!0,this.changeGraph=underscore__WEBPACK_IMPORTED_MODULE_4__.ZP.debounce(this.changeGraph,300)},UNSAFE_componentWillReceiveProps:function(nextProps){underscore__WEBPACK_IMPORTED_MODULE_4__.ZP.isEqual(this.props.labels,nextProps.labels)&&underscore__WEBPACK_IMPORTED_MODULE_4__.ZP.isEqual(this.props.gridStep,nextProps.gridStep)&&underscore__WEBPACK_IMPORTED_MODULE_4__.ZP.isEqual(this.props.snapStep,nextProps.snapStep)&&underscore__WEBPACK_IMPORTED_MODULE_4__.ZP.isEqual(this.props.step,nextProps.step)&&underscore__WEBPACK_IMPORTED_MODULE_4__.ZP.isEqual(this.props.range,nextProps.range)&&underscore__WEBPACK_IMPORTED_MODULE_4__.ZP.isEqual(this.props.backgroundImage,nextProps.backgroundImage)||this.setState(this.stateFromProps(nextProps))},componentWillUnmount:function(){this._isMounted=!1},stateFromProps:function(props){return{labelsTextbox:props.labels,gridStepTextbox:props.gridStep,snapStepTextbox:props.snapStep,stepTextbox:props.step,rangeTextbox:props.range,backgroundImage:underscore__WEBPACK_IMPORTED_MODULE_4__.ZP.clone(props.backgroundImage)}},change(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return _khanacademy_perseus__WEBPACK_IMPORTED_MODULE_0__.ye.m.apply(this,args)},changeRulerLabel:function(e){this.change({rulerLabel:e.target.value})},changeRulerTicks:function(e){this.change({rulerTicks:+e.target.value})},changeBackgroundUrl:function(e){if("keypress"===e.type&&"Enter"!==e.key)return;const setUrl=(url,width,height)=>{const image=underscore__WEBPACK_IMPORTED_MODULE_4__.ZP.clone(this.props.backgroundImage);image.url=url,image.width=width,image.height=height,this.setState({backgroundImage:image},this.changeGraph)},url=react_dom__WEBPACK_IMPORTED_MODULE_3__.findDOMNode(this.refs["bg-url"]).value;url?_khanacademy_perseus__WEBPACK_IMPORTED_MODULE_0__.Util.getImageSize(url,((width,height)=>{this._isMounted&&setUrl(url,width,height)})):setUrl(null,0,0)},renderLabelChoices:function(choices){return underscore__WEBPACK_IMPORTED_MODULE_4__.ZP.map(choices,(function(nameAndValue){return react__WEBPACK_IMPORTED_MODULE_2__.createElement("option",{value:nameAndValue[1]},nameAndValue[0])}))},validRange:function(range){return underscore__WEBPACK_IMPORTED_MODULE_4__.ZP.every(range,(function(num){return underscore__WEBPACK_IMPORTED_MODULE_4__.ZP.isFinite(num)}))?!(range[0]>=range[1])||"Range must have a higher number on the right":"Range must be a valid number"},validateStepValue:function(settings){const{step,range,name,minTicks,maxTicks}=settings;if(!underscore__WEBPACK_IMPORTED_MODULE_4__.ZP.isFinite(step))return name+" must be a valid number";const nSteps=function numSteps(range,step){return Math.floor((range[1]-range[0])/step)}(range,step);return nSteps<minTicks?name+" is too large, there must be at least "+minTicks+" ticks.":!(nSteps>maxTicks)||name+" is too small, there can be at most "+maxTicks+" ticks."},validSnapStep:function(step,range){return this.validateStepValue({step,range,name:"Snap step",minTicks:5,maxTicks:60})},validGridStep:function(step,range){return this.validateStepValue({step,range,name:"Grid step",minTicks:3,maxTicks:60})},validStep:function(step,range){return this.validateStepValue({step,range,name:"Step",minTicks:3,maxTicks:20})},validBackgroundImageSize:function(image){if(!image.url)return!0;return!!(image.width<=450&&image.height<=450)||"Image must be smaller than 450px x 450px."},validateGraphSettings:function(range,step,gridStep,snapStep,image){const self=this;let msg;const goodRange=underscore__WEBPACK_IMPORTED_MODULE_4__.ZP.every(range,(function(range){return msg=self.validRange(range),!0===msg}));if(!goodRange)return msg;const goodStep=underscore__WEBPACK_IMPORTED_MODULE_4__.ZP.every(step,(function(step,i){return msg=self.validStep(step,range[i]),!0===msg}));if(!goodStep)return msg;const goodGridStep=underscore__WEBPACK_IMPORTED_MODULE_4__.ZP.every(gridStep,(function(gridStep,i){return msg=self.validGridStep(gridStep,range[i]),!0===msg}));if(!goodGridStep)return msg;const goodSnapStep=underscore__WEBPACK_IMPORTED_MODULE_4__.ZP.every(snapStep,(function(snapStep,i){return msg=self.validSnapStep(snapStep,range[i]),!0===msg}));if(!goodSnapStep)return msg;const goodImageSize=this.validBackgroundImageSize(image);return!0===goodImageSize||(msg=goodImageSize,msg)},changeLabel:function(i,e){const val=e.target.value,labels=this.state.labelsTextbox.slice();labels[i]=val,this.setState({labelsTextbox:labels},this.changeGraph)},changeRange:function(i,values){const ranges=this.state.rangeTextbox.slice();ranges[i]=values;const step=this.state.stepTextbox.slice(),gridStep=this.state.gridStepTextbox.slice(),snapStep=this.state.snapStepTextbox.slice(),scale=_khanacademy_perseus__WEBPACK_IMPORTED_MODULE_0__.Util.scaleFromExtent(ranges[i],this.props.box[i]);!0===this.validRange(ranges[i])&&(step[i]=_khanacademy_perseus__WEBPACK_IMPORTED_MODULE_0__.Util.tickStepFromExtent(ranges[i],this.props.box[i]),gridStep[i]=_khanacademy_perseus__WEBPACK_IMPORTED_MODULE_0__.Util.gridStepFromTickStep(step[i],scale),snapStep[i]=gridStep[i]/2),this.setState({stepTextbox:step,gridStepTextbox:gridStep,snapStepTextbox:snapStep,rangeTextbox:ranges},this.changeGraph)},changeStep:function(step){this.setState({stepTextbox:step},this.changeGraph)},changeSnapStep:function(snapStep){this.setState({snapStepTextbox:snapStep},this.changeGraph)},changeGridStep:function(gridStep){this.setState({gridStepTextbox:gridStep,snapStepTextbox:underscore__WEBPACK_IMPORTED_MODULE_4__.ZP.map(gridStep,(function(step){return step/2}))},this.changeGraph)},changeGraph:function(){const labels=this.state.labelsTextbox,range=underscore__WEBPACK_IMPORTED_MODULE_4__.ZP.map(this.state.rangeTextbox,(function(range){return underscore__WEBPACK_IMPORTED_MODULE_4__.ZP.map(range,Number)})),step=underscore__WEBPACK_IMPORTED_MODULE_4__.ZP.map(this.state.stepTextbox,Number),gridStep=this.state.gridStepTextbox,snapStep=this.state.snapStepTextbox,image=this.state.backgroundImage,validationResult=this.validateGraphSettings(range,step,gridStep,snapStep,image);!0===validationResult?this.change({valid:!0,labels,range,step,gridStep,snapStep,backgroundImage:image}):this.change({valid:validationResult})},render:function(){const scale=[_khanacademy_perseus__WEBPACK_IMPORTED_MODULE_0__.TR.roundTo(2,_khanacademy_perseus__WEBPACK_IMPORTED_MODULE_0__.Util.scaleFromExtent(this.props.range[0],this.props.box[0])),_khanacademy_perseus__WEBPACK_IMPORTED_MODULE_0__.TR.roundTo(2,_khanacademy_perseus__WEBPACK_IMPORTED_MODULE_0__.Util.scaleFromExtent(this.props.range[1],this.props.box[1]))],{TeX}=getDependencies();return react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",null,underscore__WEBPACK_IMPORTED_MODULE_4__.ZP.contains(this.props.editableSettings,"canvas")&&react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",{className:"graph-settings"},react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",{className:"perseus-widget-row"},"Canvas size (x,y pixels)",react__WEBPACK_IMPORTED_MODULE_2__.createElement(RangeInput,{value:this.props.box,onChange:box=>{this.change({box})}})),react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",{className:"perseus-widget-row"},"Scale (px per div):"," ",react__WEBPACK_IMPORTED_MODULE_2__.createElement(TeX,null,"("+scale[0]+", "+scale[1]+")"))),underscore__WEBPACK_IMPORTED_MODULE_4__.ZP.contains(this.props.editableSettings,"graph")&&react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",{className:"graph-settings"},react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",{className:"perseus-widget-row"},react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",{className:"perseus-widget-left-col"}," ","x Label",react__WEBPACK_IMPORTED_MODULE_2__.createElement("input",{type:"text",className:"graph-settings-axis-label",ref:"labels-0",onChange:e=>this.changeLabel(0,e),value:this.state.labelsTextbox[0]||""})),react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",{className:"perseus-widget-right-col"},"y Label",react__WEBPACK_IMPORTED_MODULE_2__.createElement("input",{type:"text",className:"graph-settings-axis-label",ref:"labels-1",onChange:e=>this.changeLabel(1,e),value:this.state.labelsTextbox[1]||""}))),react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",{className:"perseus-widget-row"},react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",{className:"perseus-widget-left-col"},"x Range",react__WEBPACK_IMPORTED_MODULE_2__.createElement(RangeInput,{value:this.state.rangeTextbox[0],onChange:vals=>this.changeRange(0,vals)})),react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",{className:"perseus-widget-right-col"},"y Range",react__WEBPACK_IMPORTED_MODULE_2__.createElement(RangeInput,{value:this.state.rangeTextbox[1],onChange:vals=>this.changeRange(1,vals)}))),react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",{className:"perseus-widget-row"},react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",{className:"perseus-widget-left-col"},"Tick Step",react__WEBPACK_IMPORTED_MODULE_2__.createElement(RangeInput,{value:this.state.stepTextbox,onChange:this.changeStep})),react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",{className:"perseus-widget-right-col"},"Grid Step",react__WEBPACK_IMPORTED_MODULE_2__.createElement(RangeInput,{value:this.state.gridStepTextbox,onChange:this.changeGridStep}))),underscore__WEBPACK_IMPORTED_MODULE_4__.ZP.contains(this.props.editableSettings,"snap")&&react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",{className:"perseus-widget-row"},react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",{className:"perseus-widget-left-col"},"Snap Step",react__WEBPACK_IMPORTED_MODULE_2__.createElement(RangeInput,{value:this.state.snapStepTextbox,onChange:this.changeSnapStep}))),react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",{className:"perseus-widget-row"},react__WEBPACK_IMPORTED_MODULE_2__.createElement("label",null,"Markings: "),react__WEBPACK_IMPORTED_MODULE_2__.createElement(ButtonGroup,{value:this.props.markings,allowEmpty:!1,buttons:[{value:"graph",content:"Graph"},{value:"grid",content:"Grid"},{value:"none",content:"None"}],onChange:this.change("markings")})),react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",{className:"perseus-widget-left-col"},react__WEBPACK_IMPORTED_MODULE_2__.createElement(PropCheckBox,{label:"Show tooltips",showTooltips:this.props.showTooltips,onChange:this.change}))),underscore__WEBPACK_IMPORTED_MODULE_4__.ZP.contains(this.props.editableSettings,"image")&&react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",{className:"image-settings"},react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",null,"Background image:"),react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",null,"Url:"," ",react__WEBPACK_IMPORTED_MODULE_2__.createElement("input",{type:"text",className:"graph-settings-background-url",ref:"bg-url",value:this.state.backgroundImage.url||"",onChange:e=>{const image=underscore__WEBPACK_IMPORTED_MODULE_4__.ZP.clone(this.props.backgroundImage);image.url=e.target.value,this.setState({backgroundImage:image})},onKeyPress:this.changeBackgroundUrl,onBlur:this.changeBackgroundUrl}),react__WEBPACK_IMPORTED_MODULE_2__.createElement(InfoTip,null,react__WEBPACK_IMPORTED_MODULE_2__.createElement("p",null,'Create an image in graphie, or use the "Add image" function to create a background.')))),underscore__WEBPACK_IMPORTED_MODULE_4__.ZP.contains(this.props.editableSettings,"measure")&&react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",{className:"misc-settings"},react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",{className:"perseus-widget-row"},react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",{className:"perseus-widget-left-col"},react__WEBPACK_IMPORTED_MODULE_2__.createElement(PropCheckBox,{label:"Show ruler",showRuler:this.props.showRuler,onChange:this.change})),react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",{className:"perseus-widget-right-col"},react__WEBPACK_IMPORTED_MODULE_2__.createElement(PropCheckBox,{label:"Show protractor",showProtractor:this.props.showProtractor,onChange:this.change}))),this.props.showRuler&&react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",null,react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",null,react__WEBPACK_IMPORTED_MODULE_2__.createElement("label",null," ","Ruler label:"," ",react__WEBPACK_IMPORTED_MODULE_2__.createElement("select",{onChange:this.changeRulerLabel,value:this.props.rulerLabel},react__WEBPACK_IMPORTED_MODULE_2__.createElement("option",{value:""},"None"),react__WEBPACK_IMPORTED_MODULE_2__.createElement("optgroup",{label:"Metric"},this.renderLabelChoices([["milimeters","mm"],["centimeters","cm"],["meters","m"],["kilometers","km"]])),react__WEBPACK_IMPORTED_MODULE_2__.createElement("optgroup",{label:"Imperial"},this.renderLabelChoices([["inches","in"],["feet","ft"],["yards","yd"],["miles","mi"]]))))),react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",null,react__WEBPACK_IMPORTED_MODULE_2__.createElement("label",null," ","Ruler ticks:"," ",react__WEBPACK_IMPORTED_MODULE_2__.createElement("select",{onChange:this.changeRulerTicks,value:this.props.rulerTicks},underscore__WEBPACK_IMPORTED_MODULE_4__.ZP.map([1,2,4,8,10,16],(function(n){return react__WEBPACK_IMPORTED_MODULE_2__.createElement("option",{value:n},n)}))))))))}})}}]);